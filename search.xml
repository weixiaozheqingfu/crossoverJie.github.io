<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[HashMap? ConcurrentHashMap? ç›¸ä¿¡çœ‹å®Œè¿™ç¯‡æ²¡äººèƒ½éš¾ä½ä½ ï¼]]></title>
    <url>%2F2018%2F07%2F23%2Fjava-senior%2FConcurrentHashMap%2F</url>
    <content type="text"><![CDATA[å‰è¨€Map è¿™æ ·çš„ Key Value åœ¨è½¯ä»¶å¼€å‘ä¸­æ˜¯éžå¸¸ç»å…¸çš„ç»“æž„ï¼Œå¸¸ç”¨äºŽåœ¨å†…å­˜ä¸­å­˜æ”¾æ•°æ®ã€‚ æœ¬ç¯‡ä¸»è¦æƒ³è®¨è®º ConcurrentHashMap è¿™æ ·ä¸€ä¸ªå¹¶å‘å®¹å™¨ï¼Œåœ¨æ­£å¼å¼€å§‹ä¹‹å‰æˆ‘è§‰å¾—æœ‰å¿…è¦è°ˆè°ˆ HashMapï¼Œæ²¡æœ‰å®ƒå°±ä¸ä¼šæœ‰åŽé¢çš„ ConcurrentHashMapã€‚ HashMapä¼—æ‰€å‘¨çŸ¥ HashMap åº•å±‚æ˜¯åŸºäºŽ æ•°ç»„ + é“¾è¡¨ ç»„æˆçš„ï¼Œä¸è¿‡åœ¨ jdk1.7 å’Œ 1.8 ä¸­å…·ä½“å®žçŽ°ç¨æœ‰ä¸åŒã€‚ Base 1.71.7 ä¸­çš„æ•°æ®ç»“æž„å›¾ï¼š å…ˆæ¥çœ‹çœ‹ 1.7 ä¸­çš„å®žçŽ°ã€‚ è¿™æ˜¯ HashMap ä¸­æ¯”è¾ƒæ ¸å¿ƒçš„å‡ ä¸ªæˆå‘˜å˜é‡ï¼›çœ‹çœ‹åˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ åˆå§‹åŒ–æ¡¶å¤§å°ï¼Œå› ä¸ºåº•å±‚æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥è¿™æ˜¯æ•°ç»„é»˜è®¤çš„å¤§å°ã€‚ æ¡¶æœ€å¤§å€¼ã€‚ é»˜è®¤çš„è´Ÿè½½å› å­ï¼ˆ0.75ï¼‰ table çœŸæ­£å­˜æ”¾æ•°æ®çš„æ•°ç»„ã€‚ Map å­˜æ”¾æ•°é‡çš„å¤§å°ã€‚ æ¡¶å¤§å°ï¼Œå¯åœ¨åˆå§‹åŒ–æ—¶æ˜¾å¼æŒ‡å®šã€‚ è´Ÿè½½å› å­ï¼Œå¯åœ¨åˆå§‹åŒ–æ—¶æ˜¾å¼æŒ‡å®šã€‚ é‡ç‚¹è§£é‡Šä¸‹è´Ÿè½½å› å­ï¼š ç”±äºŽç»™å®šçš„ HashMap çš„å®¹é‡å¤§å°æ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚é»˜è®¤åˆå§‹åŒ–ï¼š 123456789101112131415161718public HashMap() &#123; this(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR);&#125;public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); this.loadFactor = loadFactor; threshold = initialCapacity; init();&#125; ç»™å®šçš„é»˜è®¤å®¹é‡ä¸º 16ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚Map åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸æ–­çš„å¾€é‡Œé¢å­˜æ”¾æ•°æ®ï¼Œå½“æ•°é‡è¾¾åˆ°äº† 16 * 0.75 = 12 å°±éœ€è¦å°†å½“å‰ 16 çš„å®¹é‡è¿›è¡Œæ‰©å®¹ï¼Œè€Œæ‰©å®¹è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ° rehashã€å¤åˆ¶æ•°æ®ç­‰æ“ä½œï¼Œæ‰€ä»¥éžå¸¸æ¶ˆè€—æ€§èƒ½ã€‚ å› æ­¤é€šå¸¸å»ºè®®èƒ½æå‰é¢„ä¼° HashMap çš„å¤§å°æœ€å¥½ï¼Œå°½é‡çš„å‡å°‘æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚ æ ¹æ®ä»£ç å¯ä»¥çœ‹åˆ°å…¶å®žçœŸæ­£å­˜æ”¾æ•°æ®çš„æ˜¯ transient Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE; è¿™ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå®ƒåˆæ˜¯å¦‚ä½•å®šä¹‰çš„å‘¢ï¼Ÿ Entry æ˜¯ HashMap ä¸­çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œä»Žä»–çš„æˆå‘˜å˜é‡å¾ˆå®¹æ˜“çœ‹å‡ºï¼š key å°±æ˜¯å†™å…¥æ—¶çš„é”®ã€‚ value è‡ªç„¶å°±æ˜¯å€¼ã€‚ å¼€å§‹çš„æ—¶å€™å°±æåˆ° HashMap æ˜¯ç”±æ•°ç»„å’Œé“¾è¡¨ç»„æˆï¼Œæ‰€ä»¥è¿™ä¸ª next å°±æ˜¯ç”¨äºŽå®žçŽ°é“¾è¡¨ç»“æž„ã€‚ hash å­˜æ”¾çš„æ˜¯å½“å‰ key çš„ hashcodeã€‚ çŸ¥æ™“äº†åŸºæœ¬ç»“æž„ï¼Œé‚£æ¥çœ‹çœ‹å…¶ä¸­é‡è¦çš„å†™å…¥ã€èŽ·å–å‡½æ•°ï¼š put æ–¹æ³•12345678910111213141516171819202122public V put(K key, V value) &#123; if (table == EMPTY_TABLE) &#123; inflateTable(threshold); &#125; if (key == null) return putForNullKey(value); int hash = hash(key); int i = indexFor(hash, table.length); for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; &#125; &#125; modCount++; addEntry(hash, key, value, i); return null;&#125; åˆ¤æ–­å½“å‰æ•°ç»„æ˜¯å¦éœ€è¦åˆå§‹åŒ–ã€‚ å¦‚æžœ key ä¸ºç©ºï¼Œåˆ™ put ä¸€ä¸ªç©ºå€¼è¿›åŽ»ã€‚ æ ¹æ® key è®¡ç®—å‡º hashcodeã€‚ æ ¹æ®è®¡ç®—å‡ºçš„ hashcode å®šä½å‡ºæ‰€åœ¨æ¡¶ã€‚ å¦‚æžœæ¡¶æ˜¯ä¸€ä¸ªé“¾è¡¨åˆ™éœ€è¦éåŽ†åˆ¤æ–­é‡Œé¢çš„ hashcodeã€key æ˜¯å¦å’Œä¼ å…¥ key ç›¸ç­‰ï¼Œå¦‚æžœç›¸ç­‰åˆ™è¿›è¡Œè¦†ç›–ï¼Œå¹¶è¿”å›žåŽŸæ¥çš„å€¼ã€‚ å¦‚æžœæ¡¶æ˜¯ç©ºçš„ï¼Œè¯´æ˜Žå½“å‰ä½ç½®æ²¡æœ‰æ•°æ®å­˜å…¥ï¼›æ–°å¢žä¸€ä¸ª Entry å¯¹è±¡å†™å…¥å½“å‰ä½ç½®ã€‚ 123456789101112131415void addEntry(int hash, K key, V value, int bucketIndex) &#123; if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) &#123; resize(2 * table.length); hash = (null != key) ? hash(key) : 0; bucketIndex = indexFor(hash, table.length); &#125; createEntry(hash, key, value, bucketIndex);&#125;void createEntry(int hash, K key, V value, int bucketIndex) &#123; Entry&lt;K,V&gt; e = table[bucketIndex]; table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); size++;&#125; å½“è°ƒç”¨ addEntry å†™å…¥ Entry æ—¶éœ€è¦åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚ å¦‚æžœéœ€è¦å°±è¿›è¡Œä¸¤å€æ‰©å……ï¼Œå¹¶å°†å½“å‰çš„ key é‡æ–° hash å¹¶å®šä½ã€‚ è€Œåœ¨ createEntry ä¸­ä¼šå°†å½“å‰ä½ç½®çš„æ¡¶ä¼ å…¥åˆ°æ–°å»ºçš„æ¡¶ä¸­ï¼Œå¦‚æžœå½“å‰æ¡¶æœ‰å€¼å°±ä¼šåœ¨ä½ç½®å½¢æˆé“¾è¡¨ã€‚ get æ–¹æ³•å†æ¥çœ‹çœ‹ get å‡½æ•°ï¼š 123456789101112131415161718192021222324public V get(Object key) &#123; if (key == null) return getForNullKey(); Entry&lt;K,V&gt; entry = getEntry(key); return null == entry ? null : entry.getValue();&#125;final Entry&lt;K,V&gt; getEntry(Object key) &#123; if (size == 0) &#123; return null; &#125; int hash = (key == null) ? 0 : hash(key); for (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; return null;&#125; é¦–å…ˆä¹Ÿæ˜¯æ ¹æ® key è®¡ç®—å‡º hashcodeï¼Œç„¶åŽå®šä½åˆ°å…·ä½“çš„æ¡¶ä¸­ã€‚ åˆ¤æ–­è¯¥ä½ç½®æ˜¯å¦ä¸ºé“¾è¡¨ã€‚ ä¸æ˜¯é“¾è¡¨å°±æ ¹æ® keyã€key çš„ hashcode æ˜¯å¦ç›¸ç­‰æ¥è¿”å›žå€¼ã€‚ ä¸ºé“¾è¡¨åˆ™éœ€è¦éåŽ†ç›´åˆ° key åŠ hashcode ç›¸ç­‰æ—¶å€™å°±è¿”å›žå€¼ã€‚ å•¥éƒ½æ²¡å–åˆ°å°±ç›´æŽ¥è¿”å›ž null ã€‚ Base 1.8ä¸çŸ¥é“ 1.7 çš„å®žçŽ°å¤§å®¶çœ‹å‡ºéœ€è¦ä¼˜åŒ–çš„ç‚¹æ²¡æœ‰ï¼Ÿ å…¶å®žä¸€ä¸ªå¾ˆæ˜Žæ˜¾çš„åœ°æ–¹å°±æ˜¯ï¼š å½“ Hash å†²çªä¸¥é‡æ—¶ï¼Œåœ¨æ¡¶ä¸Šå½¢æˆçš„é“¾è¡¨ä¼šå˜çš„è¶Šæ¥è¶Šé•¿ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢æ—¶çš„æ•ˆçŽ‡å°±ä¼šè¶Šæ¥è¶Šä½Žï¼›æ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚ å› æ­¤ 1.8 ä¸­é‡ç‚¹ä¼˜åŒ–äº†è¿™ä¸ªæŸ¥è¯¢æ•ˆçŽ‡ã€‚ 1.8 HashMap ç»“æž„å›¾ï¼š å…ˆæ¥çœ‹çœ‹å‡ ä¸ªæ ¸å¿ƒçš„æˆå‘˜å˜é‡ï¼š 12345678910111213141516171819202122232425262728static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16/** * The maximum capacity, used if a higher value is implicitly specified * by either of the constructors with arguments. * MUST be a power of two &lt;= 1&lt;&lt;30. */static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;/** * The load factor used when none specified in constructor. */static final float DEFAULT_LOAD_FACTOR = 0.75f;static final int TREEIFY_THRESHOLD = 8;transient Node&lt;K,V&gt;[] table;/** * Holds cached entrySet(). Note that AbstractMap fields are used * for keySet() and values(). */transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;/** * The number of key-value mappings contained in this map. */transient int size; å’Œ 1.7 å¤§ä½“ä¸Šéƒ½å·®ä¸å¤šï¼Œè¿˜æ˜¯æœ‰å‡ ä¸ªé‡è¦çš„åŒºåˆ«ï¼š TREEIFY_THRESHOLD ç”¨äºŽåˆ¤æ–­æ˜¯å¦éœ€è¦å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘çš„é˜ˆå€¼ã€‚ HashEntry ä¿®æ”¹ä¸º Nodeã€‚ Node çš„æ ¸å¿ƒç»„æˆå…¶å®žä¹Ÿæ˜¯å’Œ 1.7 ä¸­çš„ HashEntry ä¸€æ ·ï¼Œå­˜æ”¾çš„éƒ½æ˜¯ key value hashcode next ç­‰æ•°æ®ã€‚ å†æ¥çœ‹çœ‹æ ¸å¿ƒæ–¹æ³•ã€‚ put æ–¹æ³• çœ‹ä¼¼è¦æ¯” 1.7 çš„å¤æ‚ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥æ‹†è§£ï¼š åˆ¤æ–­å½“å‰æ¡¶æ˜¯å¦ä¸ºç©ºï¼Œç©ºçš„å°±éœ€è¦åˆå§‹åŒ–ï¼ˆresize ä¸­ä¼šåˆ¤æ–­æ˜¯å¦è¿›è¡Œåˆå§‹åŒ–ï¼‰ã€‚ æ ¹æ®å½“å‰ key çš„ hashcode å®šä½åˆ°å…·ä½“çš„æ¡¶ä¸­å¹¶åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºè¡¨æ˜Žæ²¡æœ‰ Hash å†²çªå°±ç›´æŽ¥åœ¨å½“å‰ä½ç½®åˆ›å»ºä¸€ä¸ªæ–°æ¡¶å³å¯ã€‚ å¦‚æžœå½“å‰æ¡¶æœ‰å€¼ï¼ˆ Hash å†²çªï¼‰ï¼Œé‚£ä¹ˆå°±è¦æ¯”è¾ƒå½“å‰æ¡¶ä¸­çš„ keyã€key çš„ hashcode ä¸Žå†™å…¥çš„ key æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰å°±èµ‹å€¼ç»™ e,åœ¨ç¬¬ 8 æ­¥çš„æ—¶å€™ä¼šç»Ÿä¸€è¿›è¡Œèµ‹å€¼åŠè¿”å›žã€‚ å¦‚æžœå½“å‰æ¡¶ä¸ºçº¢é»‘æ ‘ï¼Œé‚£å°±è¦æŒ‰ç…§çº¢é»‘æ ‘çš„æ–¹å¼å†™å…¥æ•°æ®ã€‚ å¦‚æžœæ˜¯ä¸ªé“¾è¡¨ï¼Œå°±éœ€è¦å°†å½“å‰çš„ keyã€value å°è£…æˆä¸€ä¸ªæ–°èŠ‚ç‚¹å†™å…¥åˆ°å½“å‰æ¡¶çš„åŽé¢ï¼ˆå½¢æˆé“¾è¡¨ï¼‰ã€‚ æŽ¥ç€åˆ¤æ–­å½“å‰é“¾è¡¨çš„å¤§å°æ˜¯å¦å¤§äºŽé¢„è®¾çš„é˜ˆå€¼ï¼Œå¤§äºŽæ—¶å°±è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ å¦‚æžœåœ¨éåŽ†è¿‡ç¨‹ä¸­æ‰¾åˆ° key ç›¸åŒæ—¶ç›´æŽ¥é€€å‡ºéåŽ†ã€‚ å¦‚æžœ e != null å°±ç›¸å½“äºŽå­˜åœ¨ç›¸åŒçš„ key,é‚£å°±éœ€è¦å°†å€¼è¦†ç›–ã€‚ æœ€åŽåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚ get æ–¹æ³•12345678910111213141516171819202122232425public V get(Object key) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; if ((e = first.next) != null) &#123; if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null;&#125; get æ–¹æ³•çœ‹èµ·æ¥å°±è¦ç®€å•è®¸å¤šäº†ã€‚ é¦–å…ˆå°† key hash ä¹‹åŽå–å¾—æ‰€å®šä½çš„æ¡¶ã€‚ å¦‚æžœæ¡¶ä¸ºç©ºåˆ™ç›´æŽ¥è¿”å›ž null ã€‚ å¦åˆ™åˆ¤æ–­æ¡¶çš„ç¬¬ä¸€ä¸ªä½ç½®(æœ‰å¯èƒ½æ˜¯é“¾è¡¨ã€çº¢é»‘æ ‘)çš„ key æ˜¯å¦ä¸ºæŸ¥è¯¢çš„ keyï¼Œæ˜¯å°±ç›´æŽ¥è¿”å›ž valueã€‚ å¦‚æžœç¬¬ä¸€ä¸ªä¸åŒ¹é…ï¼Œåˆ™åˆ¤æ–­å®ƒçš„ä¸‹ä¸€ä¸ªæ˜¯çº¢é»‘æ ‘è¿˜æ˜¯é“¾è¡¨ã€‚ çº¢é»‘æ ‘å°±æŒ‰ç…§æ ‘çš„æŸ¥æ‰¾æ–¹å¼è¿”å›žå€¼ã€‚ ä¸ç„¶å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éåŽ†åŒ¹é…è¿”å›žå€¼ã€‚ ä»Žè¿™ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼ˆget/putï¼‰å¯ä»¥çœ‹å‡º 1.8 ä¸­å¯¹å¤§é“¾è¡¨åšäº†ä¼˜åŒ–ï¼Œä¿®æ”¹ä¸ºçº¢é»‘æ ‘ä¹‹åŽæŸ¥è¯¢æ•ˆçŽ‡ç›´æŽ¥æé«˜åˆ°äº† O(logn)ã€‚ ä½†æ˜¯ HashMap åŽŸæœ‰çš„é—®é¢˜ä¹Ÿéƒ½å­˜åœ¨ï¼Œæ¯”å¦‚åœ¨å¹¶å‘åœºæ™¯ä¸‹ä½¿ç”¨æ—¶å®¹æ˜“å‡ºçŽ°æ­»å¾ªçŽ¯ã€‚ 123456789final HashMap&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();for (int i = 0; i &lt; 1000; i++) &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; map.put(UUID.randomUUID().toString(), ""); &#125; &#125;).start();&#125; ä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç®€å•åˆ†æžä¸‹ã€‚ çœ‹è¿‡ä¸Šæ–‡çš„è¿˜è®°å¾—åœ¨ HashMap æ‰©å®¹çš„æ—¶å€™ä¼šè°ƒç”¨ resize() æ–¹æ³•ï¼Œå°±æ˜¯è¿™é‡Œçš„å¹¶å‘æ“ä½œå®¹æ˜“åœ¨ä¸€ä¸ªæ¡¶ä¸Šå½¢æˆçŽ¯å½¢é“¾è¡¨ï¼›è¿™æ ·å½“èŽ·å–ä¸€ä¸ªä¸å­˜åœ¨çš„ key æ—¶ï¼Œè®¡ç®—å‡ºçš„ index æ­£å¥½æ˜¯çŽ¯å½¢é“¾è¡¨çš„ä¸‹æ ‡å°±ä¼šå‡ºçŽ°æ­»å¾ªçŽ¯ã€‚ å¦‚ä¸‹å›¾ï¼š éåŽ†æ–¹å¼è¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ˜¯ HashMap çš„éåŽ†æ–¹å¼ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§ï¼š 123456789101112Iterator&lt;Map.Entry&lt;String, Integer&gt;&gt; entryIterator = map.entrySet().iterator(); while (entryIterator.hasNext()) &#123; Map.Entry&lt;String, Integer&gt; next = entryIterator.next(); System.out.println("key=" + next.getKey() + " value=" + next.getValue()); &#125; Iterator&lt;String&gt; iterator = map.keySet().iterator(); while (iterator.hasNext())&#123; String key = iterator.next(); System.out.println("key=" + key + " value=" + map.get(key)); &#125; å¼ºçƒˆå»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§ EntrySet è¿›è¡ŒéåŽ†ã€‚ ç¬¬ä¸€ç§å¯ä»¥æŠŠ key value åŒæ—¶å–å‡ºï¼Œç¬¬äºŒç§è¿˜å¾—éœ€è¦é€šè¿‡ key å–ä¸€æ¬¡ valueï¼Œæ•ˆçŽ‡è¾ƒä½Žã€‚ ç®€å•æ€»ç»“ä¸‹ HashMapï¼šæ— è®ºæ˜¯ 1.7 è¿˜æ˜¯ 1.8 å…¶å®žéƒ½èƒ½çœ‹å‡º JDK æ²¡æœ‰å¯¹å®ƒåšä»»ä½•çš„åŒæ­¥æ“ä½œï¼Œæ‰€ä»¥å¹¶å‘ä¼šå‡ºé—®é¢˜ï¼Œç”šè‡³å‡ºçŽ°æ­»å¾ªçŽ¯å¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ã€‚ å› æ­¤ JDK æŽ¨å‡ºäº†ä¸“é¡¹ä¸“ç”¨çš„ ConcurrentHashMap ï¼Œè¯¥ç±»ä½äºŽ java.util.concurrent åŒ…ä¸‹ï¼Œä¸“é—¨ç”¨äºŽè§£å†³å¹¶å‘é—®é¢˜ã€‚ åšæŒçœ‹åˆ°è¿™é‡Œçš„æœ‹å‹ç®—æ˜¯å·²ç»æŠŠ ConcurrentHashMap çš„åŸºç¡€å·²ç»æ‰“ç‰¢äº†ï¼Œä¸‹é¢æ­£å¼å¼€å§‹åˆ†æžã€‚ ConcurrentHashMapConcurrentHashMap åŒæ ·ä¹Ÿåˆ†ä¸º 1.7 ã€1.8 ç‰ˆï¼Œä¸¤è€…åœ¨å®žçŽ°ä¸Šç•¥æœ‰ä¸åŒã€‚ Base 1.7å…ˆæ¥çœ‹çœ‹ 1.7 çš„å®žçŽ°ï¼Œä¸‹é¢æ˜¯ä»–çš„ç»“æž„å›¾ï¼š å¦‚å›¾æ‰€ç¤ºï¼Œæ˜¯ç”± Segment æ•°ç»„ã€HashEntry ç»„æˆï¼Œå’Œ HashMap ä¸€æ ·ï¼Œä»ç„¶æ˜¯æ•°ç»„åŠ é“¾è¡¨ã€‚ å®ƒçš„æ ¸å¿ƒæˆå‘˜å˜é‡ï¼š 1234567/** * Segment æ•°ç»„ï¼Œå­˜æ”¾æ•°æ®æ—¶é¦–å…ˆéœ€è¦å®šä½åˆ°å…·ä½“çš„ Segment ä¸­ã€‚ */final Segment&lt;K,V&gt;[] segments;transient Set&lt;K&gt; keySet;transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet; Segment æ˜¯ ConcurrentHashMap çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œä¸»è¦çš„ç»„æˆå¦‚ä¸‹ï¼š 12345678910111213141516 static final class Segment&lt;K,V&gt; extends ReentrantLock implements Serializable &#123; private static final long serialVersionUID = 2249069246763182397L; // å’Œ HashMap ä¸­çš„ HashEntry ä½œç”¨ä¸€æ ·ï¼ŒçœŸæ­£å­˜æ”¾æ•°æ®çš„æ¡¶ transient volatile HashEntry&lt;K,V&gt;[] table; transient int count; transient int modCount; transient int threshold; final float loadFactor; &#125; çœ‹çœ‹å…¶ä¸­ HashEntry çš„ç»„æˆï¼š å’Œ HashMap éžå¸¸ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å…¶ä¸­çš„æ ¸å¿ƒæ•°æ®å¦‚ value ï¼Œä»¥åŠé“¾è¡¨éƒ½æ˜¯ volatile ä¿®é¥°çš„ï¼Œä¿è¯äº†èŽ·å–æ—¶çš„å¯è§æ€§ã€‚ åŽŸç†ä¸Šæ¥è¯´ï¼šConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”æŠ€æœ¯ï¼Œå…¶ä¸­ Segment ç»§æ‰¿äºŽ ReentrantLockã€‚ä¸ä¼šåƒ HashTable é‚£æ ·ä¸ç®¡æ˜¯ put è¿˜æ˜¯ get æ“ä½œéƒ½éœ€è¦åšåŒæ­¥å¤„ç†ï¼Œç†è®ºä¸Š ConcurrentHashMap æ”¯æŒ CurrencyLevel (Segment æ•°ç»„æ•°é‡)çš„çº¿ç¨‹å¹¶å‘ã€‚æ¯å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®ä¸€ä¸ª Segment æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ Segmentã€‚ ä¸‹é¢ä¹Ÿæ¥çœ‹çœ‹æ ¸å¿ƒçš„ put get æ–¹æ³•ã€‚ put æ–¹æ³•1234567891011public V put(K key, V value) &#123; Segment&lt;K,V&gt; s; if (value == null) throw new NullPointerException(); int hash = hash(key); int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask; if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject // nonvolatile; recheck (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) // in ensureSegment s = ensureSegment(j); return s.put(key, hash, value, false);&#125; é¦–å…ˆæ˜¯é€šè¿‡ key å®šä½åˆ° Segmentï¼Œä¹‹åŽåœ¨å¯¹åº”çš„ Segment ä¸­è¿›è¡Œå…·ä½“çš„ putã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243final V put(K key, int hash, V value, boolean onlyIfAbsent) &#123; HashEntry&lt;K,V&gt; node = tryLock() ? null : scanAndLockForPut(key, hash, value); V oldValue; try &#123; HashEntry&lt;K,V&gt;[] tab = table; int index = (tab.length - 1) &amp; hash; HashEntry&lt;K,V&gt; first = entryAt(tab, index); for (HashEntry&lt;K,V&gt; e = first;;) &#123; if (e != null) &#123; K k; if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) &#123; oldValue = e.value; if (!onlyIfAbsent) &#123; e.value = value; ++modCount; &#125; break; &#125; e = e.next; &#125; else &#123; if (node != null) node.setNext(first); else node = new HashEntry&lt;K,V&gt;(hash, key, value, first); int c = count + 1; if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY) rehash(node); else setEntryAt(tab, index, node); ++modCount; count = c; oldValue = null; break; &#125; &#125; &#125; finally &#123; unlock(); &#125; return oldValue;&#125; è™½ç„¶ HashEntry ä¸­çš„ value æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å¹¶å‘çš„åŽŸå­æ€§ï¼Œæ‰€ä»¥ put æ“ä½œæ—¶ä»ç„¶éœ€è¦åŠ é”å¤„ç†ã€‚ é¦–å…ˆç¬¬ä¸€æ­¥çš„æ—¶å€™ä¼šå°è¯•èŽ·å–é”ï¼Œå¦‚æžœèŽ·å–å¤±è´¥è‚¯å®šå°±æœ‰å…¶ä»–çº¿ç¨‹å­˜åœ¨ç«žäº‰ï¼Œåˆ™åˆ©ç”¨ scanAndLockForPut() è‡ªæ—‹èŽ·å–é”ã€‚ å°è¯•è‡ªæ—‹èŽ·å–é”ã€‚ å¦‚æžœé‡è¯•çš„æ¬¡æ•°è¾¾åˆ°äº† MAX_SCAN_RETRIES åˆ™æ”¹ä¸ºé˜»å¡žé”èŽ·å–ï¼Œä¿è¯èƒ½èŽ·å–æˆåŠŸã€‚ å†ç»“åˆå›¾çœ‹çœ‹ put çš„æµç¨‹ã€‚ å°†å½“å‰ Segment ä¸­çš„ table é€šè¿‡ key çš„ hashcode å®šä½åˆ° HashEntryã€‚ éåŽ†è¯¥ HashEntryï¼Œå¦‚æžœä¸ä¸ºç©ºåˆ™åˆ¤æ–­ä¼ å…¥çš„ key å’Œå½“å‰éåŽ†çš„ key æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¦†ç›–æ—§çš„ valueã€‚ ä¸ä¸ºç©ºåˆ™éœ€è¦æ–°å»ºä¸€ä¸ª HashEntry å¹¶åŠ å…¥åˆ° Segment ä¸­ï¼ŒåŒæ—¶ä¼šå…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚ æœ€åŽä¼šè§£é™¤åœ¨ 1 ä¸­æ‰€èŽ·å–å½“å‰ Segment çš„é”ã€‚ get æ–¹æ³•1234567891011121314151617public V get(Object key) &#123; Segment&lt;K,V&gt; s; // manually integrate access methods to reduce overhead HashEntry&lt;K,V&gt;[] tab; int h = hash(key); long u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE; if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp; (tab = s.table) != null) &#123; for (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile (tab, ((long)(((tab.length - 1) &amp; h)) &lt;&lt; TSHIFT) + TBASE); e != null; e = e.next) &#123; K k; if ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k))) return e.value; &#125; &#125; return null;&#125; get é€»è¾‘æ¯”è¾ƒç®€å•ï¼š åªéœ€è¦å°† Key é€šè¿‡ Hash ä¹‹åŽå®šä½åˆ°å…·ä½“çš„ Segment ï¼Œå†é€šè¿‡ä¸€æ¬¡ Hash å®šä½åˆ°å…·ä½“çš„å…ƒç´ ä¸Šã€‚ ç”±äºŽ HashEntry ä¸­çš„ value å±žæ€§æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥æ¯æ¬¡èŽ·å–æ—¶éƒ½æ˜¯æœ€æ–°å€¼ã€‚ ConcurrentHashMap çš„ get æ–¹æ³•æ˜¯éžå¸¸é«˜æ•ˆçš„ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹éƒ½ä¸éœ€è¦åŠ é”ã€‚ Base 1.81.7 å·²ç»è§£å†³äº†å¹¶å‘é—®é¢˜ï¼Œå¹¶ä¸”èƒ½æ”¯æŒ N ä¸ª Segment è¿™ä¹ˆå¤šæ¬¡æ•°çš„å¹¶å‘ï¼Œä½†ä¾ç„¶å­˜åœ¨ HashMap åœ¨ 1.7 ç‰ˆæœ¬ä¸­çš„é—®é¢˜ã€‚ é‚£å°±æ˜¯æŸ¥è¯¢éåŽ†é“¾è¡¨æ•ˆçŽ‡å¤ªä½Žã€‚ å› æ­¤ 1.8 åšäº†ä¸€äº›æ•°æ®ç»“æž„ä¸Šçš„è°ƒæ•´ã€‚ é¦–å…ˆæ¥çœ‹ä¸‹åº•å±‚çš„ç»„æˆç»“æž„ï¼š çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å’Œ 1.8 HashMap ç»“æž„ç±»ä¼¼ï¼Ÿ å…¶ä¸­æŠ›å¼ƒäº†åŽŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œè€Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚ ä¹Ÿå°† 1.7 ä¸­å­˜æ”¾æ•°æ®çš„ HashEntry æ”¹ä¸º Nodeï¼Œä½†ä½œç”¨éƒ½æ˜¯ç›¸åŒçš„ã€‚ å…¶ä¸­çš„ val next éƒ½ç”¨äº† volatile ä¿®é¥°ï¼Œä¿è¯äº†å¯è§æ€§ã€‚ put æ–¹æ³•é‡ç‚¹æ¥çœ‹çœ‹ put å‡½æ•°ï¼š æ ¹æ® key è®¡ç®—å‡º hashcode ã€‚ åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–ã€‚ f å³ä¸ºå½“å‰ key å®šä½å‡ºçš„ Nodeï¼Œå¦‚æžœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸã€‚ å¦‚æžœå½“å‰ä½ç½®çš„ hashcode == MOVED == -1,åˆ™éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚ å¦‚æžœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ®ã€‚ å¦‚æžœæ•°é‡å¤§äºŽ TREEIFY_THRESHOLD åˆ™è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ get æ–¹æ³• æ ¹æ®è®¡ç®—å‡ºæ¥çš„ hashcode å¯»å€ï¼Œå¦‚æžœå°±åœ¨æ¡¶ä¸Šé‚£ä¹ˆç›´æŽ¥è¿”å›žå€¼ã€‚ å¦‚æžœæ˜¯çº¢é»‘æ ‘é‚£å°±æŒ‰ç…§æ ‘çš„æ–¹å¼èŽ·å–å€¼ã€‚ å°±ä¸æ»¡è¶³é‚£å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éåŽ†èŽ·å–å€¼ã€‚ 1.8 åœ¨ 1.7 çš„æ•°æ®ç»“æž„ä¸Šåšäº†å¤§çš„æ”¹åŠ¨ï¼Œé‡‡ç”¨çº¢é»‘æ ‘ä¹‹åŽå¯ä»¥ä¿è¯æŸ¥è¯¢æ•ˆçŽ‡ï¼ˆO(logn)ï¼‰ï¼Œç”šè‡³å–æ¶ˆäº† ReentrantLock æ”¹ä¸ºäº† synchronizedï¼Œè¿™æ ·å¯ä»¥çœ‹å‡ºåœ¨æ–°ç‰ˆçš„ JDK ä¸­å¯¹ synchronized ä¼˜åŒ–æ˜¯å¾ˆåˆ°ä½çš„ã€‚ æ€»ç»“çœ‹å®Œäº†æ•´ä¸ª HashMap å’Œ ConcurrentHashMap åœ¨ 1.7 å’Œ 1.8 ä¸­ä¸åŒçš„å®žçŽ°æ–¹å¼ç›¸ä¿¡å¤§å®¶å¯¹ä»–ä»¬çš„ç†è§£åº”è¯¥ä¼šæ›´åŠ åˆ°ä½ã€‚ å…¶å®žè¿™å—ä¹Ÿæ˜¯é¢è¯•çš„é‡ç‚¹å†…å®¹ï¼Œé€šå¸¸çš„å¥—è·¯æ˜¯ï¼š è°ˆè°ˆä½ ç†è§£çš„ HashMapï¼Œè®²è®²å…¶ä¸­çš„ get put è¿‡ç¨‹ã€‚ 1.8 åšäº†ä»€ä¹ˆä¼˜åŒ–ï¼Ÿ æ˜¯çº¿ç¨‹å®‰å…¨çš„å˜›ï¼Ÿ ä¸å®‰å…¨ä¼šå¯¼è‡´å“ªäº›é—®é¢˜ï¼Ÿ å¦‚ä½•è§£å†³ï¼Ÿæœ‰æ²¡æœ‰çº¿ç¨‹å®‰å…¨çš„å¹¶å‘å®¹å™¨ï¼Ÿ ConcurrentHashMap æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ 1.7ã€1.8 å®žçŽ°æœ‰ä½•ä¸åŒï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿ è¿™ä¸€ä¸²é—®é¢˜ç›¸ä¿¡å¤§å®¶ä»”ç»†çœ‹å®Œéƒ½èƒ½æ€¼å›žé¢è¯•å®˜ã€‚ é™¤äº†é¢è¯•ä¼šé—®åˆ°ä¹‹å¤–å¹³æ—¶çš„åº”ç”¨å…¶å®žä¹Ÿè›®å¤šï¼Œåƒä¹‹å‰è°ˆåˆ°çš„ Guava ä¸­ Cache çš„å®žçŽ°å°±æ˜¯åˆ©ç”¨ ConcurrentHashMap çš„æ€æƒ³ã€‚ åŒæ—¶ä¹Ÿèƒ½å­¦ä¹  JDK ä½œè€…å¤§ç‰›ä»¬çš„ä¼˜åŒ–æ€è·¯ä»¥åŠå¹¶å‘è§£å†³æ–¹æ¡ˆã€‚ å…¶å®žå†™è¿™ç¯‡çš„å‰ææ˜¯æºäºŽ GitHub ä¸Šçš„ä¸€ä¸ª Issuesï¼Œä¹Ÿå¸Œæœ›å¤§å®¶èƒ½å‚ä¸Žè¿›æ¥ï¼Œå…±åŒç»´æŠ¤å¥½è¿™ä¸ªé¡¹ç›®ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview æ¬¢è¿Žå…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>concurrent</tag>
        <tag>ConcurrentHashMap</tag>
        <tag>HashMap</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Guava æºç åˆ†æžï¼ˆCache åŽŸç†ã€äºŒé˜¶æ®µã€‘ï¼‰]]></title>
    <url>%2F2018%2F07%2F16%2Fguava%2Fguava-cache-2%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨ä¸Šæ–‡ã€ŒGuava æºç åˆ†æžï¼ˆCache åŽŸç†ï¼‰ã€ä¸­åˆ†æžäº† Guava Cache çš„ç›¸å…³åŽŸç†ã€‚ æ–‡æœ«æåˆ°äº†å›žæ”¶æœºåˆ¶ã€ç§»é™¤æ—¶é—´é€šçŸ¥ç­‰å†…å®¹ï¼Œè®¸å¤šæœ‹å‹ä¹ŸæŒºæ„Ÿå…´è¶£ï¼Œè¿™æ¬¡å°±è¿™ä¸¤ä¸ªå†…å®¹å†æ¥åˆ†æžåˆ†æžã€‚ åœ¨å¼€å§‹ä¹‹å‰å…ˆè¡¥ä¹ ä¸‹ Java è‡ªå¸¦çš„ä¸¤ä¸ªç‰¹æ€§ï¼ŒGuava ä¸­éƒ½æœ‰å…·ä½“çš„åº”ç”¨ã€‚ Java ä¸­çš„å¼•ç”¨é¦–å…ˆæ˜¯ Java ä¸­çš„å¼•ç”¨ã€‚ åœ¨ä¹‹å‰åˆ†äº«è¿‡ JVM æ˜¯æ ¹æ®å¯è¾¾æ€§åˆ†æžç®—æ³•æ‰¾å‡ºéœ€è¦å›žæ”¶çš„å¯¹è±¡ï¼Œåˆ¤æ–­å¯¹è±¡çš„å­˜æ´»çŠ¶æ€éƒ½å’Œå¼•ç”¨æœ‰å…³ã€‚ åœ¨ JDK1.2 ä¹‹å‰è¿™ç‚¹è®¾è®¡çš„éžå¸¸ç®€å•ï¼šä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€åªæœ‰å¼•ç”¨å’Œæ²¡è¢«å¼•ç”¨ä¸¤ç§åŒºåˆ«ã€‚ è¿™æ ·çš„åˆ’åˆ†å¯¹åžƒåœ¾å›žæ”¶ä¸æ˜¯å¾ˆå‹å¥½ï¼Œå› ä¸ºæ€»æœ‰ä¸€äº›å¯¹è±¡çš„çŠ¶æ€å¤„äºŽè¿™ä¸¤ä¹‹é—´ã€‚ å› æ­¤ 1.2 ä¹‹åŽæ–°å¢žäº†å››ç§çŠ¶æ€ç”¨äºŽæ›´ç»†ç²’åº¦çš„åˆ’åˆ†å¼•ç”¨å…³ç³»ï¼š å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰:è¿™ç§å¯¹è±¡æœ€ä¸ºå¸¸è§ï¼Œæ¯”å¦‚ A a = new A();è¿™å°±æ˜¯å…¸åž‹çš„å¼ºå¼•ç”¨ï¼›è¿™æ ·çš„å¼ºå¼•ç”¨å…³ç³»æ˜¯ä¸èƒ½è¢«åžƒåœ¾å›žæ”¶çš„ã€‚ è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰:è¿™æ ·çš„å¼•ç”¨è¡¨æ˜Žä¸€äº›æœ‰ç”¨ä½†ä¸æ˜¯å¿…è¦çš„å¯¹è±¡ï¼Œåœ¨å°†å‘ç”Ÿåžƒåœ¾å›žæ”¶ä¹‹å‰æ˜¯éœ€è¦å°†è¿™æ ·çš„å¯¹è±¡å†æ¬¡å›žæ”¶ã€‚ å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰:è¿™æ˜¯ä¸€ç§æ¯”è½¯å¼•ç”¨è¿˜å¼±çš„å¼•ç”¨å…³ç³»ï¼Œä¹Ÿæ˜¯å­˜æ”¾éžå¿…é¡»çš„å¯¹è±¡ã€‚å½“åžƒåœ¾å›žæ”¶æ—¶ï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œè¿™æ ·çš„å¯¹è±¡éƒ½ä¼šè¢«å›žæ”¶ã€‚ è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰:è¿™æ˜¯ä¸€ç§æœ€å¼±çš„å¼•ç”¨å…³ç³»ï¼Œç”šè‡³æ²¡æ³•é€šè¿‡å¼•ç”¨æ¥èŽ·å–å¯¹è±¡ï¼Œå®ƒå”¯ä¸€çš„ä½œç”¨å°±æ˜¯åœ¨è¢«å›žæ”¶æ—¶å¯ä»¥èŽ·å¾—é€šçŸ¥ã€‚ äº‹ä»¶å›žè°ƒäº‹ä»¶å›žè°ƒå…¶å®žæ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œæ¯”å¦‚ä¹‹å‰è®²è¿‡çš„ Netty å°±ä½¿ç”¨äº†è¿™æ ·çš„è®¾è®¡ã€‚ è¿™é‡Œé‡‡ç”¨ä¸€ä¸ª demoï¼Œè¯•ä¸‹å¦‚ä¸‹åŠŸèƒ½ï¼š Caller å‘ Notifier æé—®ã€‚ æé—®æ–¹å¼æ˜¯å¼‚æ­¥ï¼ŒæŽ¥ç€åšå…¶ä»–äº‹æƒ…ã€‚ Notifier æ”¶åˆ°é—®é¢˜æ‰§è¡Œè®¡ç®—ç„¶åŽå›žè°ƒ Caller å‘ŠçŸ¥ç»“æžœã€‚ åœ¨ Java ä¸­åˆ©ç”¨æŽ¥å£æ¥å®žçŽ°å›žè°ƒï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰ä¸€ä¸ªæŽ¥å£ï¼š 12345678public interface CallBackListener &#123; /** * å›žè°ƒé€šçŸ¥å‡½æ•° * @param msg */ void callBackNotify(String msg) ;&#125; Caller ä¸­è°ƒç”¨ Notifier æ‰§è¡Œæé—®ï¼Œè°ƒç”¨æ—¶å°†æŽ¥å£ä¼ é€’è¿‡åŽ»ï¼š 1234567891011121314151617181920212223242526272829303132333435public class Caller &#123; private final static Logger LOGGER = LoggerFactory.getLogger(Caller.class); private CallBackListener callBackListener ; private Notifier notifier ; private String question ; /** * ä½¿ç”¨ */ public void call()&#123; LOGGER.info("å¼€å§‹æé—®"); //æ–°å»ºçº¿ç¨‹ï¼Œè¾¾åˆ°å¼‚æ­¥æ•ˆæžœ new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; notifier.execute(Caller.this,question); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); LOGGER.info("æé—®å®Œæ¯•ï¼Œæˆ‘åŽ»å¹²å…¶ä»–äº‹äº†"); &#125; //éšè— getter/setter &#125; Notifier æ”¶åˆ°æé—®ï¼Œæ‰§è¡Œè®¡ç®—ï¼ˆè€—æ—¶æ“ä½œï¼‰ï¼Œæœ€åŽåšå‡ºå“åº”ï¼ˆå›žè°ƒæŽ¥å£ï¼Œå‘Šè¯‰ Caller ç»“æžœï¼‰ã€‚ 12345678910111213141516public class Notifier &#123; private final static Logger LOGGER = LoggerFactory.getLogger(Notifier.class); public void execute(Caller caller, String msg) throws InterruptedException &#123; LOGGER.info("æ”¶åˆ°æ¶ˆæ¯=ã€&#123;&#125;ã€‘", msg); LOGGER.info("ç­‰å¾…å“åº”ä¸­ã€‚ã€‚ã€‚ã€‚ã€‚"); TimeUnit.SECONDS.sleep(2); caller.getCallBackListener().callBackNotify("æˆ‘åœ¨åŒ—äº¬ï¼"); &#125;&#125; æ¨¡æ‹Ÿæ‰§è¡Œï¼š 123456789101112131415public static void main(String[] args) &#123; Notifier notifier = new Notifier() ; Caller caller = new Caller() ; caller.setNotifier(notifier) ; caller.setQuestion("ä½ åœ¨å“ªå„¿ï¼"); caller.setCallBackListener(new CallBackListener() &#123; @Override public void callBackNotify(String msg) &#123; LOGGER.info("å›žå¤=ã€&#123;&#125;ã€‘" ,msg); &#125; &#125;); caller.call();&#125; æœ€åŽæ‰§è¡Œç»“æžœï¼š 123452018-07-15 19:52:11.105 [main] INFO c.crossoverjie.guava.callback.Caller - å¼€å§‹æé—®2018-07-15 19:52:11.118 [main] INFO c.crossoverjie.guava.callback.Caller - æé—®å®Œæ¯•ï¼Œæˆ‘åŽ»å¹²å…¶ä»–äº‹äº†2018-07-15 19:52:11.117 [Thread-0] INFO c.c.guava.callback.Notifier - æ”¶åˆ°æ¶ˆæ¯=ã€ä½ åœ¨å“ªå„¿ï¼ã€‘2018-07-15 19:52:11.121 [Thread-0] INFO c.c.guava.callback.Notifier - ç­‰å¾…å“åº”ä¸­ã€‚ã€‚ã€‚ã€‚ã€‚2018-07-15 19:52:13.124 [Thread-0] INFO com.crossoverjie.guava.callback.Main - å›žå¤=ã€æˆ‘åœ¨åŒ—äº¬ï¼ã€‘ è¿™æ ·ä¸€ä¸ªæ¨¡æ‹Ÿçš„å¼‚æ­¥äº‹ä»¶å›žè°ƒå°±å®Œæˆäº†ã€‚ Guava çš„ç”¨æ³•Guava å°±æ˜¯åˆ©ç”¨äº†ä¸Šæ–‡çš„ä¸¤ä¸ªç‰¹æ€§æ¥å®žçŽ°äº†å¼•ç”¨å›žæ”¶åŠç§»é™¤é€šçŸ¥ã€‚ å¼•ç”¨å¯ä»¥åœ¨åˆå§‹åŒ–ç¼“å­˜æ—¶åˆ©ç”¨ï¼š CacheBuilder.weakKeys() CacheBuilder.weakValues() CacheBuilder.softValues() æ¥è‡ªå®šä¹‰é”®å’Œå€¼çš„å¼•ç”¨å…³ç³»ã€‚ åœ¨ä¸Šæ–‡çš„åˆ†æžä¸­å¯ä»¥çœ‹å‡º Cache ä¸­çš„ ReferenceEntry æ˜¯ç±»ä¼¼äºŽ HashMap çš„ Entry å­˜æ”¾æ•°æ®çš„ã€‚ æ¥çœ‹çœ‹ ReferenceEntry çš„å®šä¹‰ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344 interface ReferenceEntry&lt;K, V&gt; &#123; /** * Returns the value reference from this entry. */ ValueReference&lt;K, V&gt; getValueReference(); /** * Sets the value reference for this entry. */ void setValueReference(ValueReference&lt;K, V&gt; valueReference); /** * Returns the next entry in the chain. */ @Nullable ReferenceEntry&lt;K, V&gt; getNext(); /** * Returns the entry's hash. */ int getHash(); /** * Returns the key for this entry. */ @Nullable K getKey(); /* * Used by entries that use access order. Access entries are maintained in a doubly-linked list. * New entries are added at the tail of the list at write time; stale entries are expired from * the head of the list. */ /** * Returns the time that this entry was last accessed, in ns. */ long getAccessTime(); /** * Sets the entry access time in ns. */ void setAccessTime(long time);&#125; åŒ…å«äº†å¾ˆå¤šå¸¸ç”¨çš„æ“ä½œï¼Œå¦‚å€¼å¼•ç”¨ã€é”®å¼•ç”¨ã€è®¿é—®æ—¶é—´ç­‰ã€‚ æ ¹æ® ValueReference&lt;K, V&gt; getValueReference(); çš„å®žçŽ°ï¼š å…·æœ‰å¼ºå¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸åŒå®žçŽ°ã€‚ key ä¹Ÿæ˜¯ç›¸åŒçš„é“ç†ï¼š å½“ä½¿ç”¨è¿™æ ·çš„æž„é€ æ–¹å¼æ—¶ï¼Œå¼±å¼•ç”¨çš„ key å’Œ value éƒ½ä¼šè¢«åžƒåœ¾å›žæ”¶ã€‚ å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜¾å¼çš„å›žæ”¶ï¼š 1234567891011121314151617/** * Discards any cached value for key &#123;@code key&#125;. * å•ä¸ªå›žæ”¶ */void invalidate(Object key);/** * Discards any cached values for keys &#123;@code keys&#125;. * * @since 11.0 */void invalidateAll(Iterable&lt;?&gt; keys);/** * Discards all entries in the cache. */void invalidateAll(); å›žè°ƒæ”¹é€ äº†ä¹‹å‰çš„ä¾‹å­ï¼š 1234567891011121314loadingCache = CacheBuilder.newBuilder() .expireAfterWrite(2, TimeUnit.SECONDS) .removalListener(new RemovalListener&lt;Object, Object&gt;() &#123; @Override public void onRemoval(RemovalNotification&lt;Object, Object&gt; notification) &#123; LOGGER.info("åˆ é™¤åŽŸå› =&#123;&#125;ï¼Œåˆ é™¤ key=&#123;&#125;,åˆ é™¤ value=&#123;&#125;",notification.getCause(),notification.getKey(),notification.getValue()); &#125; &#125;) .build(new CacheLoader&lt;Integer, AtomicLong&gt;() &#123; @Override public AtomicLong load(Integer key) throws Exception &#123; return new AtomicLong(0); &#125; &#125;); æ‰§è¡Œç»“æžœï¼š 1234562018-07-15 20:41:07.433 [main] INFO c.crossoverjie.guava.CacheLoaderTest - å½“å‰ç¼“å­˜å€¼=0,ç¼“å­˜å¤§å°=12018-07-15 20:41:07.442 [main] INFO c.crossoverjie.guava.CacheLoaderTest - ç¼“å­˜çš„æ‰€æœ‰å†…å®¹=&#123;1000=0&#125;2018-07-15 20:41:07.443 [main] INFO c.crossoverjie.guava.CacheLoaderTest - job running times=102018-07-15 20:41:10.461 [main] INFO c.crossoverjie.guava.CacheLoaderTest - åˆ é™¤åŽŸå› =EXPIREDï¼Œåˆ é™¤ key=1000,åˆ é™¤ value=12018-07-15 20:41:10.462 [main] INFO c.crossoverjie.guava.CacheLoaderTest - å½“å‰ç¼“å­˜å€¼=0,ç¼“å­˜å¤§å°=12018-07-15 20:41:10.462 [main] INFO c.crossoverjie.guava.CacheLoaderTest - ç¼“å­˜çš„æ‰€æœ‰å†…å®¹=&#123;1000=0&#125; å¯ä»¥çœ‹å‡ºå½“ç¼“å­˜è¢«åˆ é™¤çš„æ—¶å€™ä¼šå›žè°ƒæˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œå¹¶å‘ŠçŸ¥åˆ é™¤åŽŸå› ã€‚ é‚£ä¹ˆ Guava æ˜¯å¦‚ä½•å®žçŽ°çš„å‘¢ï¼Ÿ æ ¹æ® LocalCache ä¸­çš„ getLiveValue() ä¸­åˆ¤æ–­ç¼“å­˜è¿‡æœŸæ—¶ï¼Œè·Ÿç€è¿™é‡Œçš„è°ƒç”¨å…³ç³»å°±ä¼šä¸€ç›´è·Ÿåˆ°ï¼š removeValueFromChain() ä¸­çš„ï¼š enqueueNotification() æ–¹æ³•ä¼šå°†å›žæ”¶çš„ç¼“å­˜ï¼ˆåŒ…å«äº† keyï¼Œvalueï¼‰ä»¥åŠå›žæ”¶åŽŸå› åŒ…è£…æˆä¹‹å‰å®šä¹‰çš„äº‹ä»¶æŽ¥å£åŠ å…¥åˆ°ä¸€ä¸ªæœ¬åœ°é˜Ÿåˆ—ä¸­ã€‚ è¿™æ ·ä¸€çœ‹ä¹Ÿæ²¡æœ‰å›žè°ƒæˆ‘ä»¬åˆå§‹åŒ–æ—¶å€™çš„äº‹ä»¶å•Šã€‚ ä¸è¿‡ç”¨è¿‡é˜Ÿåˆ—çš„åŒå­¦åº”è¯¥èƒ½çŒœå‡ºï¼Œæ—¢ç„¶è¿™é‡Œå†™å…¥é˜Ÿåˆ—ï¼Œé‚£å°±è‚¯å®šå°±æœ‰æ¶ˆè´¹ã€‚ æˆ‘ä»¬å›žåˆ°èŽ·å–ç¼“å­˜çš„åœ°æ–¹ï¼š åœ¨ finally ä¸­æ‰§è¡Œäº† postReadCleanup() æ–¹æ³•ï¼›å…¶å®žåœ¨è¿™é‡Œé¢å°±æ˜¯å¯¹åˆšæ‰çš„é˜Ÿåˆ—è¿›è¡Œäº†æ¶ˆè´¹ï¼š ä¸€ç›´è·Ÿè¿›æ¥å°±ä¼šå‘çŽ°è¿™é‡Œæ¶ˆè´¹äº†é˜Ÿåˆ—ï¼Œå°†ä¹‹å‰åŒ…è£…å¥½çš„ç§»é™¤æ¶ˆæ¯è°ƒç”¨äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„äº‹ä»¶ï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡äº‹ä»¶å›žè°ƒã€‚ æ€»ç»“ä»¥ä¸Šæ‰€æœ‰æºç ï¼š https://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/guava/callback/Main.java é€šè¿‡åˆ†æž Guava çš„æºç å¯ä»¥è®©æˆ‘ä»¬å­¦ä¹ åˆ°é¡¶çº§çš„è®¾è®¡åŠå®žçŽ°æ–¹å¼ï¼Œç”šè‡³è‡ªå·±ä¹Ÿèƒ½å°è¯•ç¼–å†™ã€‚ Guava é‡Œè¿˜æœ‰å¾ˆå¤šå¼ºå¤§çš„å¢žå¼ºå®žçŽ°ï¼Œå€¼å¾—æˆ‘ä»¬å†å¥½å¥½ç ”ç©¶ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview æ¬¢è¿Žå…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Guava</category>
      </categories>
      <tags>
        <tag>Cache</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€æ¬¡çº¿ä¸Šé—®é¢˜æŽ’æŸ¥æ‰€å¼•å‘çš„æ€è€ƒ]]></title>
    <url>%2F2018%2F07%2F08%2Fjava-senior%2FJVM-Troubleshoot%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰æˆ–å¤šæˆ–å°‘åˆ†äº«è¿‡ä¸€äº›å†…å­˜æ¨¡åž‹ã€å¯¹è±¡åˆ›å»ºä¹‹ç±»çš„å†…å®¹ï¼Œå…¶å®žå¤§éƒ¨åˆ†äººçœ‹å®Œéƒ½æ˜¯æ‡µæ‡µæ‡‚æ‡‚ï¼Œä¹Ÿä¸çŸ¥é“è¿™äº›çš„å®žé™…æ„ä¹‰ã€‚ ç›´åˆ°æœ‰ä¸€å¤©ä½ ä¼šç¢°åˆ°çº¿ä¸Šå¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œå¦‚ï¼š çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªä»»åŠ¡è¿Ÿè¿Ÿæ²¡æœ‰è¿”å›žï¼Œåº”ç”¨å‡æ­»ã€‚ æŽ¥å£å“åº”ç¼“æ…¢ï¼Œç”šè‡³è¯·æ±‚è¶…æ—¶ã€‚ CPU é«˜è´Ÿè½½è¿è¡Œã€‚ è¿™ç±»é—®é¢˜å¹¶ä¸åƒä¸€ä¸ªç©ºæŒ‡é’ˆã€æ•°ç»„è¶Šç•Œè¿™æ ·æ˜Žæ˜¾å¥½æŸ¥ï¼Œè¿™æ—¶å°±éœ€è¦åˆšæ‰æåˆ°çš„å†…å­˜æ¨¡åž‹ã€å¯¹è±¡åˆ›å»ºã€çº¿ç¨‹ç­‰ç›¸å…³çŸ¥è¯†ç»“åˆåœ¨ä¸€èµ·æ¥æŽ’æŸ¥é—®é¢˜äº†ã€‚ æ­£å¥½è¿™æ¬¡å€ŸåŠ©ä¹‹å‰çš„ä¸€æ¬¡ç”Ÿäº§é—®é¢˜æ¥èŠèŠå¦‚ä½•æŽ’æŸ¥å’Œè§£å†³é—®é¢˜ã€‚ ç”Ÿäº§çŽ°è±¡é¦–å…ˆçœ‹çœ‹é—®é¢˜çš„èƒŒæ™¯å§ï¼š æˆ‘è¿™å…¶å®žæ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œåœ¨å›ºå®šçš„æ—¶é—´ä¼šå¼€å¯ N ä¸ªçº¿ç¨‹å¹¶å‘çš„ä»Ž Redis ä¸­èŽ·å–æ•°æ®è¿›è¡Œè¿ç®—ã€‚ ä¸šåŠ¡é€»è¾‘éžå¸¸ç®€å•ï¼Œä½†åº”ç”¨ä¸€èˆ¬æ¶‰åŠåˆ°å¤šçº¿ç¨‹ä¹‹åŽå†ç®€å•çš„äº‹æƒ…éƒ½è¦å°å¿ƒå¯¹å¾…ã€‚ æžœä¸å…¶ç„¶è¿™æ¬¡å°±å‡ºé—®é¢˜äº†ã€‚ çŽ°è±¡:åŽŸæœ¬åªéœ€è¦æ‰§è¡Œå‡ åˆ†é’Ÿçš„ä»»åŠ¡æ‰§è¡Œäº†å‡ ä¸ªå°æ—¶éƒ½æ²¡é€€å‡ºã€‚ç¿»éäº†æ‰€æœ‰çš„æ—¥å¿—éƒ½æ²¡æ‰¾åˆ°å¼‚å¸¸ã€‚ äºŽæ˜¯ä¾¿å¼€å§‹å®šä½é—®é¢˜ä¹‹è·¯ã€‚ å®šä½é—®é¢˜æ—¢ç„¶æ²¡åŠžæ³•ç›´æŽ¥ä»Žæ—¥å¿—ä¸­å‘çŽ°å¼‚å¸¸ï¼Œé‚£å°±åªèƒ½çœ‹çœ‹åº”ç”¨åˆ°åº•åœ¨å¹²å˜›äº†ã€‚ æœ€å¸¸è§çš„å·¥å…·å°±æ˜¯ JDK è‡ªå¸¦çš„é‚£ä¸€å¥—ã€‚ è¿™æ¬¡æˆ‘ä½¿ç”¨äº† jstack æ¥æŸ¥çœ‹çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µï¼Œå®ƒçš„ä½œç”¨å…¶å®žå°±æ˜¯ dump å½“å‰çš„çº¿ç¨‹å †æ ˆã€‚ å½“ç„¶åœ¨ dump ä¹‹å‰æ˜¯éœ€è¦çŸ¥é“æˆ‘åº”ç”¨çš„ pid çš„ï¼Œå¯ä»¥ä½¿ç”¨ jps -v è¿™æ ·çš„æ–¹å¼åˆ—å‡ºæ‰€æœ‰çš„ Java è¿›ç¨‹ã€‚ å½“ç„¶å¦‚æžœçŸ¥é“å…³é”®å­—çš„è¯ç›´æŽ¥ä½¿ç”¨ ps aux|grep java ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ æ‹¿åˆ° pid=1523 äº†ä¹‹åŽå°±å¯ä»¥åˆ©ç”¨ jstack 1523 &gt; 1523.log è¿™æ ·çš„æ–¹å¼å°† dump æ–‡ä»¶è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ å¦‚æžœåº”ç”¨ç®€å•ä¸å¤æ‚ï¼Œçº¿ç¨‹è¿™äº›ä¹Ÿæ¯”è¾ƒå°‘å…¶å®žå¯ä»¥ç›´æŽ¥æ‰“å¼€æŸ¥çœ‹ã€‚ ä½†å¤æ‚çš„åº”ç”¨å¯¼å‡ºæ¥çš„æ—¥å¿—æ–‡ä»¶ä¹Ÿæ¯”è¾ƒå¤§è¿˜æ˜¯å»ºè®®ç”¨ä¸“ä¸šçš„åˆ†æžå·¥å…·ã€‚ æˆ‘è¿™é‡Œçš„æ—¥å¿—æ¯”è¾ƒå°‘ç›´æŽ¥æ‰“å¼€å°±å¯ä»¥äº†ã€‚ å› ä¸ºæˆ‘æ¸…æ¥šçŸ¥é“åº”ç”¨ä¸­å¼€å¯çš„çº¿ç¨‹åç§°ï¼Œæ‰€ä»¥ç›´æŽ¥æ ¹æ®çº¿ç¨‹åå°±å¯ä»¥åœ¨æ—¥å¿—ä¸­æ‰¾åˆ°ç›¸å…³çš„å †æ ˆï¼š æ‰€ä»¥é€šå¸¸å»ºè®®å¤§å®¶çº¿ç¨‹åå­—ç»™çš„æœ‰æ„ä¹‰ï¼Œåœ¨æŽ’æŸ¥é—®é¢˜æ—¶å¾ˆæœ‰å¿…è¦ã€‚ å…¶å®žå…¶ä»–å‡ ä¸ªçº¿ç¨‹éƒ½å’Œè¿™é‡Œçš„å †æ ˆç±»ä¼¼ï¼Œå¾ˆæ˜Žæ˜¾çš„çœ‹å‡ºéƒ½æ˜¯åœ¨åš Redis è¿žæŽ¥ã€‚ äºŽæ˜¯æˆ‘ç™»å½• Redis æŸ¥çœ‹äº†å½“å‰çš„è¿žæŽ¥æ•°ï¼Œå‘çŽ°å·²ç»éžå¸¸é«˜äº†ã€‚ è¿™æ · Redis çš„å“åº”è‡ªç„¶ä¹Ÿå°±å˜æ…¢äº†ã€‚ æŽ¥ç€åˆ©ç”¨ jps -v åˆ—å‡ºäº†å½“å‰æ‰€ä»¥åœ¨è·‘çš„ Java è¿›ç¨‹ï¼Œæžœä¸å…¶ç„¶æœ‰å¥½å‡ ä¸ªåº”ç”¨éƒ½åœ¨æŸ¥è¯¢ Redisï¼Œè€Œä¸”éƒ½æ˜¯å¹¶å‘è¿žæŽ¥ï¼Œé—®é¢˜è‡ªç„¶å°±æ‰¾åˆ°äº†ã€‚ è§£å†³åŠžæ³• æ‰€ä»¥é—®é¢˜çš„ä¸»è¦åŽŸå› æ˜¯ï¼šå¤§é‡çš„åº”ç”¨å¹¶å‘æŸ¥è¯¢ Redisï¼Œå¯¼è‡´ Redis çš„æ€§èƒ½é™ä½Žã€‚ æ—¢ç„¶æ‰¾åˆ°äº†é—®é¢˜ï¼Œé‚£å¦‚ä½•è§£å†³å‘¢ï¼Ÿ å‡å°‘åŒæ—¶æŸ¥è¯¢ Redis çš„åº”ç”¨ï¼Œåˆ†å¼€æ—¶æ®µé™ä½Ž Redis çš„åŽ‹åŠ›ã€‚ å°† Redis å¤åˆ¶å‡ ä¸ªé›†ç¾¤ï¼Œå„ä¸ªåº”ç”¨åˆ†å¼€æŸ¥è¯¢ã€‚ä½†æ˜¯è¿™æ ·ä¼šæ¶‰åŠåˆ°æ•°æ®çš„åŒæ­¥ç­‰è¿ç»´æ“ä½œï¼Œæˆ–è€…ç”±ç¨‹åºäº†è¿›è¡ŒåŒæ­¥ä¹Ÿä¼šå¢žåŠ å¤æ‚åº¦ã€‚ ç›®å‰æˆ‘ä»¬é€‰æ‹©çš„æ˜¯ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œæ•ˆæžœå¾ˆæ˜Žæ˜¾ã€‚ æœ¬åœ°æ¨¡æ‹Ÿä¸Šæ–‡ä»‹ç»çš„æ˜¯çº¿ç¨‹ç›¸å…³é—®é¢˜ï¼ŒçŽ°åœ¨æ¥åˆ†æžä¸‹å†…å­˜çš„é—®é¢˜ã€‚ ä»¥è¿™ä¸ªç±»ä¸ºä¾‹ï¼š https://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/oom/heap/HeapOOM.java 123456789public class HeapOOM &#123; public static void main(String[] args) &#123; List&lt;String&gt; list = new ArrayList&lt;&gt;(10) ; while (true)&#123; list.add("1") ; &#125; &#125;&#125; å¯åŠ¨å‚æ•°å¦‚ä¸‹ï¼š 1234-Xms20m-Xmx20m-XX:+HeapDumpOnOutOfMemoryError-XX:HeapDumpPath=/Users/xx/Documents ä¸ºäº†æ›´å¿«çš„çªå‡ºå†…å­˜é—®é¢˜å°†å †çš„æœ€å¤§å†…å­˜å›ºå®šåœ¨ 20Mï¼ŒåŒæ—¶åœ¨ JVM å‡ºçŽ° OOM çš„æ—¶å€™è‡ªåŠ¨ dump å†…å­˜åˆ° /Users/xx/Documents(ä¸é…è·¯å¾„åˆ™ä¼šç”Ÿæˆåœ¨å½“å‰ç›®å½•)ã€‚ æ‰§è¡Œä¹‹åŽæžœä¸å…¶ç„¶å‡ºçŽ°äº†å¼‚å¸¸ï¼š åŒæ—¶å¯¹åº”çš„å†…å­˜ dump æ–‡ä»¶ä¹Ÿç”Ÿæˆäº†ã€‚ å†…å­˜åˆ†æžè¿™æ—¶å°±éœ€è¦ç›¸åº”çš„å·¥å…·è¿›è¡Œåˆ†æžäº†ï¼Œæœ€å¸¸ç”¨çš„è‡ªç„¶å°±æ˜¯ MAT äº†ã€‚ æˆ‘è¯•äº†ä¸€ä¸ªåœ¨çº¿å·¥å…·ä¹Ÿä¸é”™ï¼ˆæ–‡ä»¶å¤§äº†å°±ä¸é€‚åˆäº†ï¼‰ï¼š http://heaphero.io/index.jsp ä¸Šä¼ åˆšæ‰ç”Ÿæˆçš„å†…å­˜æ–‡ä»¶ä¹‹åŽï¼š å› ä¸ºæ˜¯å†…å­˜æº¢å‡ºï¼Œæ‰€ä»¥ä¸»è¦è§‚å¯Ÿä¸‹å¤§å¯¹è±¡ï¼š ä¹Ÿæœ‰ç›¸åº”æç¤ºï¼Œè¿™ä¸ªå¾ˆæœ‰å¯èƒ½å°±æ˜¯å†…å­˜æº¢å‡ºçš„å¯¹è±¡ï¼Œç‚¹è¿›åŽ»ä¹‹åŽï¼š çœ‹åˆ°è¿™ä¸ªå †æ ˆå…¶å®žå°±å¾ˆæ˜Žæ˜¾äº†ï¼š åœ¨å‘ ArrayList ä¸­ä¸åœçš„å†™å…¥æ•°æ®æ—¶ï¼Œä¼šå¯¼è‡´é¢‘ç¹çš„æ‰©å®¹ä¹Ÿå°±æ˜¯æ•°ç»„å¤åˆ¶è¿™äº›è¿‡ç¨‹ï¼Œæœ€ç»ˆè¾¾åˆ° 20M çš„ä¸Šé™å¯¼è‡´å†…å­˜æº¢å‡ºäº†ã€‚ æ›´å¤šå»ºè®®ä¸Šæ–‡è¯´è¿‡ï¼Œä¸€æ—¦ä½¿ç”¨äº†å¤šçº¿ç¨‹ï¼Œé‚£å°±è¦æ ¼å¤–å°å¿ƒã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›æ—¥å¸¸å»ºè®®ï¼š å°½é‡ä¸è¦åœ¨çº¿ç¨‹ä¸­åšå¤§é‡è€—æ—¶çš„ç½‘ç»œæ“ä½œï¼Œå¦‚æŸ¥è¯¢æ•°æ®åº“ï¼ˆå¯ä»¥çš„è¯åœ¨ä¸€å¼€å§‹å°±å°†æ•°æ®ä»Žä»Ž DB ä¸­æŸ¥å‡ºå‡†å¤‡å¥½ï¼‰ã€‚ å°½å¯èƒ½çš„å‡å°‘å¤šçº¿ç¨‹ç«žäº‰é”ã€‚å¯ä»¥å°†æ•°æ®åˆ†æ®µï¼Œå„ä¸ªçº¿ç¨‹åˆ†åˆ«è¯»å–ã€‚ å¤šåˆ©ç”¨ CAS+è‡ªæ—‹ çš„æ–¹å¼æ›´æ–°æ•°æ®ï¼Œå‡å°‘é”çš„ä½¿ç”¨ã€‚ åº”ç”¨ä¸­åŠ ä¸Š -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp å‚æ•°ï¼Œåœ¨å†…å­˜æº¢å‡ºæ—¶è‡³å°‘å¯ä»¥æ‹¿åˆ°å†…å­˜æ—¥å¿—ã€‚ çº¿ç¨‹æ± ç›‘æŽ§ã€‚å¦‚çº¿ç¨‹æ± å¤§å°ã€é˜Ÿåˆ—å¤§å°ã€æœ€å¤§çº¿ç¨‹æ•°ç­‰æ•°æ®ï¼Œå¯æå‰åšå¥½é¢„ä¼°ã€‚ JVM ç›‘æŽ§ï¼Œå¯ä»¥çœ‹åˆ°å †å†…å­˜çš„æ¶¨å¹…è¶‹åŠ¿ï¼ŒGC æ›²çº¿ç­‰æ•°æ®ï¼Œä¹Ÿå¯ä»¥æå‰åšå¥½å‡†å¤‡ã€‚ æ€»ç»“çº¿ä¸Šé—®é¢˜å®šä½éœ€è¦ç»¼åˆæŠ€èƒ½ï¼Œæ‰€ä»¥æ˜¯éœ€è¦ä¸€äº›åŸºç¡€æŠ€èƒ½ã€‚å¦‚çº¿ç¨‹ã€å†…å­˜æ¨¡åž‹ã€Linux ç­‰ã€‚ å½“ç„¶è¿™äº›é—®é¢˜æ²¡æœ‰å®žæ“è¿‡éƒ½æ˜¯çº¸ä¸Šè°ˆå…µï¼›å¦‚æžœç¬¬ä¸€æ¬¡ç¢°åˆ°çº¿ä¸Šé—®é¢˜ï¼Œä¸è¦æ…Œå¼ ï¼Œåè€Œåº”è¯¥åº†å¹¸è§£å†³ä¹‹åŽä½ åˆä¼šä¹ å¾—ä¸€é¡¹æŠ€èƒ½ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview æ¬¢è¿Žå…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>concurrent</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Netty(äºŒ) ä»Žçº¿ç¨‹æ¨¡åž‹çš„è§’åº¦çœ‹ Netty ä¸ºä»€ä¹ˆæ˜¯é«˜æ€§èƒ½çš„ï¼Ÿ]]></title>
    <url>%2F2018%2F07%2F04%2Fnetty%2FNetty(2)Thread-model%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨ä¹‹å‰çš„ SpringBoot æ•´åˆé•¿è¿žæŽ¥å¿ƒè·³æœºåˆ¶ ä¸€æ–‡ä¸­è®¤è¯†äº† Nettyã€‚ ä½†å…¶å®žåªæ˜¯èƒ½ç”¨ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ Nettyï¼Ÿå®ƒæœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿè¿™äº›å…¶å®žéƒ½ä¸æ¸…æ¥šã€‚ æœ¬æ–‡å°±æ¥ä»ŽåŽ†å²æºå¤´è¯´é“è¯´é“ã€‚ ä¼ ç»Ÿ IOåœ¨ Netty ä»¥åŠ NIO å‡ºçŽ°ä¹‹å‰ï¼Œæˆ‘ä»¬å†™ IO åº”ç”¨å…¶å®žç”¨çš„éƒ½æ˜¯ç”¨ java.io.* ä¸‹æ‰€æä¾›çš„åŒ…ã€‚ æ¯”å¦‚ä¸‹é¢çš„ä¼ªä»£ç ï¼š 123456789ServeSocket serverSocket = new ServeSocket(8080);Socket socket = serverSocket.accept() ;BufferReader in = .... ;String request ; while((request = in.readLine()) != null)&#123; new Thread(new Task()).start()&#125; å¤§æ¦‚æ˜¯è¿™æ ·ï¼Œå…¶å®žä¸»è¦æƒ³è¡¨è¾¾çš„æ˜¯ï¼šè¿™æ ·ä¸€ä¸ªçº¿ç¨‹åªèƒ½å¤„ç†ä¸€ä¸ªè¿žæŽ¥ã€‚ å¦‚æžœæ˜¯ 100 ä¸ªå®¢æˆ·ç«¯è¿žæŽ¥é‚£å°±å¾—å¼€ 100 ä¸ªçº¿ç¨‹ï¼Œ1000 é‚£å°±å¾— 1000 ä¸ªçº¿ç¨‹ã€‚ è¦çŸ¥é“çº¿ç¨‹èµ„æºéžå¸¸å®è´µï¼Œæ¯æ¬¡çš„åˆ›å»ºéƒ½ä¼šå¸¦æ¥æ¶ˆè€—ï¼Œè€Œä¸”æ¯ä¸ªçº¿ç¨‹è¿˜å¾—ä¸ºå®ƒåˆ†é…å¯¹åº”çš„æ ˆå†…å­˜ã€‚ å³ä¾¿æ˜¯æˆ‘ä»¬ç»™ JVM è¶³å¤Ÿçš„å†…å­˜ï¼Œå¤§é‡çº¿ç¨‹æ‰€å¸¦æ¥çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿæ˜¯å—ä¸äº†çš„ã€‚ å¹¶ä¸”ä¼ ç»Ÿ IO æ˜¯é˜»å¡žæ¨¡å¼ï¼Œæ¯ä¸€æ¬¡çš„å“åº”å¿…é¡»çš„æ˜¯å‘èµ· IO è¯·æ±‚ï¼Œå¤„ç†è¯·æ±‚å®Œæˆå†åŒæ—¶è¿”å›žï¼Œç›´æŽ¥çš„ç»“æžœå°±æ˜¯æ€§èƒ½å·®ï¼Œåžåé‡ä½Žã€‚ Reactor æ¨¡åž‹å› æ­¤ä¸šç•Œå¸¸ç”¨çš„é«˜æ€§èƒ½ IO æ¨¡åž‹æ˜¯ Reactorã€‚ å®ƒæ˜¯ä¸€ç§å¼‚æ­¥ã€éžé˜»å¡žçš„äº‹ä»¶é©±åŠ¨æ¨¡åž‹ã€‚ é€šå¸¸ä¹Ÿè¡¨çŽ°ä¸ºä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š å•çº¿ç¨‹ ä»Žå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š å®ƒæ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥æŽ¥æ”¶å®¢æˆ·ç«¯çš„è¿žæŽ¥ï¼Œå¹¶å°†è¯¥è¯·æ±‚åˆ†å‘åˆ°å¯¹åº”çš„äº‹ä»¶å¤„ç† handler ä¸­ï¼Œæ•´ä¸ªè¿‡ç¨‹å®Œå…¨æ˜¯å¼‚æ­¥éžé˜»å¡žçš„ï¼›å¹¶ä¸”å®Œå…¨ä¸å­˜åœ¨å…±äº«èµ„æºçš„é—®é¢˜ã€‚æ‰€ä»¥ç†è®ºä¸Šæ¥è¯´åžåé‡ä¹Ÿè¿˜ä¸é”™ã€‚ ä½†ç”±äºŽæ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯¹å¤šæ ¸ CPU åˆ©ç”¨çŽ‡ä¸é«˜ï¼Œä¸€æ—¦æœ‰å¤§é‡çš„å®¢æˆ·ç«¯è¿žæŽ¥ä¸Šæ¥æ€§èƒ½å¿…ç„¶ä¸‹é™ï¼Œç”šè‡³ä¼šæœ‰å¤§é‡è¯·æ±‚æ— æ³•å“åº”ã€‚æœ€åçš„æƒ…å†µæ˜¯ä¸€æ—¦è¿™ä¸ªçº¿ç¨‹å“ªé‡Œæ²¡æœ‰å¤„ç†å¥½è¿›å…¥äº†æ­»å¾ªçŽ¯é‚£æ•´ä¸ªæœåŠ¡éƒ½å°†ä¸å¯ç”¨ï¼ å¤šçº¿ç¨‹ å› æ­¤äº§ç”Ÿäº†å¤šçº¿ç¨‹æ¨¡åž‹ã€‚ å…¶å®žæœ€å¤§çš„æ”¹è¿›å°±æ˜¯å°†åŽŸæœ‰çš„äº‹ä»¶å¤„ç†æ”¹ä¸ºäº†å¤šçº¿ç¨‹ã€‚ å¯ä»¥åŸºäºŽ Java è‡ªèº«çš„çº¿ç¨‹æ± å®žçŽ°ï¼Œè¿™æ ·åœ¨å¤§é‡è¯·æ±‚çš„å¤„ç†ä¸Šæ€§èƒ½æç¤ºæ˜¯å·¨å¤§çš„ã€‚ è™½ç„¶å¦‚æ­¤ï¼Œä½†ç†è®ºä¸Šæ¥è¯´ä¾ç„¶æœ‰ä¸€ä¸ªåœ°æ–¹æ˜¯å•ç‚¹çš„ï¼›é‚£å°±æ˜¯å¤„ç†å®¢æˆ·ç«¯è¿žæŽ¥çš„çº¿ç¨‹ã€‚ å› ä¸ºå¤§å¤šæ•°æœåŠ¡ç«¯åº”ç”¨æˆ–å¤šæˆ–å°‘åœ¨è¿žæŽ¥æ—¶éƒ½ä¼šå¤„ç†ä¸€äº›ä¸šåŠ¡ï¼Œå¦‚é‰´æƒä¹‹ç±»çš„ï¼Œå½“è¿žæŽ¥çš„å®¢æˆ·ç«¯è¶Šæ¥è¶Šå¤šæ—¶è¿™ä¸€ä¸ªçº¿ç¨‹ä¾ç„¶ä¼šå­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚ äºŽæ˜¯åˆæœ‰äº†ä¸‹é¢çš„çº¿ç¨‹æ¨¡åž‹ã€‚ ä¸»ä»Žå¤šçº¿ç¨‹ è¯¥æ¨¡åž‹å°†å®¢æˆ·ç«¯è¿žæŽ¥é‚£ä¸€å—çš„çº¿ç¨‹ä¹Ÿæ”¹ä¸ºå¤šçº¿ç¨‹ï¼Œç§°ä¸ºä¸»çº¿ç¨‹ã€‚ åŒæ—¶ä¹Ÿæ˜¯å¤šä¸ªå­çº¿ç¨‹æ¥å¤„ç†äº‹ä»¶å“åº”ï¼Œè¿™æ ·æ— è®ºæ˜¯è¿žæŽ¥è¿˜æ˜¯äº‹ä»¶éƒ½æ˜¯é«˜æ€§èƒ½çš„ã€‚ Netty å®žçŽ°ä»¥ä¸Šè°ˆäº†è¿™ä¹ˆå¤šå…¶å®ž Netty çš„çº¿ç¨‹æ¨¡åž‹ä¸Žä¹‹çš„ç±»ä¼¼ã€‚ æˆ‘ä»¬å›žåˆ°ä¹‹å‰ SpringBoot æ•´åˆé•¿è¿žæŽ¥å¿ƒè·³æœºåˆ¶TCP-Heartbeat/) ä¸­çš„æœåŠ¡ç«¯ä»£ç ï¼š 1234567891011121314151617181920212223242526private EventLoopGroup boss = new NioEventLoopGroup();private EventLoopGroup work = new NioEventLoopGroup();/** * å¯åŠ¨ Netty * * @return * @throws InterruptedException */@PostConstructpublic void start() throws InterruptedException &#123; ServerBootstrap bootstrap = new ServerBootstrap() .group(boss, work) .channel(NioServerSocketChannel.class) .localAddress(new InetSocketAddress(nettyPort)) //ä¿æŒé•¿è¿žæŽ¥ .childOption(ChannelOption.SO_KEEPALIVE, true) .childHandler(new HeartbeatInitializer()); ChannelFuture future = bootstrap.bind().sync(); if (future.isSuccess()) &#123; LOGGER.info("å¯åŠ¨ Netty æˆåŠŸ"); &#125;&#125; å…¶å®žè¿™é‡Œçš„ boss å°±ç›¸å½“äºŽ Reactor æ¨¡åž‹ä¸­å¤„ç†å®¢æˆ·ç«¯è¿žæŽ¥çš„çº¿ç¨‹æ± ã€‚ work è‡ªç„¶å°±æ˜¯å¤„ç†äº‹ä»¶çš„çº¿ç¨‹æ± äº†ã€‚ é‚£ä¹ˆå¦‚ä½•æ¥å®žçŽ°ä¸Šæ–‡çš„ä¸‰ç§æ¨¡å¼å‘¢ï¼Ÿå…¶å®žä¹Ÿå¾ˆç®€å•ï¼š å•çº¿ç¨‹æ¨¡åž‹ï¼š 1234private EventLoopGroup group = new NioEventLoopGroup();ServerBootstrap bootstrap = new ServerBootstrap() .group(group) .childHandler(new HeartbeatInitializer()); å¤šçº¿ç¨‹æ¨¡åž‹ï¼š 12345private EventLoopGroup boss = new NioEventLoopGroup(1);private EventLoopGroup work = new NioEventLoopGroup();ServerBootstrap bootstrap = new ServerBootstrap() .group(boss,work) .childHandler(new HeartbeatInitializer()); ä¸»ä»Žå¤šçº¿ç¨‹ï¼š 12345private EventLoopGroup boss = new NioEventLoopGroup();private EventLoopGroup work = new NioEventLoopGroup();ServerBootstrap bootstrap = new ServerBootstrap() .group(boss,work) .childHandler(new HeartbeatInitializer()); ç›¸ä¿¡å¤§å®¶ä¸€çœ‹ä¹Ÿæ˜Žç™½ã€‚ æ€»ç»“å…¶å®žçœ‹è¿‡äº† Netty çš„çº¿ç¨‹æ¨¡åž‹ä¹‹åŽèƒ½å¦å¯¹æˆ‘ä»¬å¹³æ—¶åšé«˜æ€§èƒ½åº”ç”¨å¸¦æ¥ç‚¹å¯å‘å‘¢ï¼Ÿ æˆ‘è®¤ä¸ºæ˜¯å¯ä»¥çš„ï¼š æŽ¥å£åŒæ­¥è½¬å¼‚æ­¥å¤„ç†ã€‚ å›žè°ƒé€šçŸ¥ç»“æžœã€‚ å¤šçº¿ç¨‹æé«˜å¹¶å‘æ•ˆçŽ‡ã€‚ æ— éžä¹Ÿå°±æ˜¯è¿™äº›ï¼Œåªæ˜¯åšäº†è¿™äº›ä¹‹åŽå°±ä¼šå¸¦æ¥å…¶ä»–é—®é¢˜ï¼š å¼‚æ­¥ä¹‹åŽäº‹åŠ¡å¦‚ä½•ä¿è¯ï¼Ÿ å›žè°ƒå¤±è´¥çš„æƒ…å†µï¼Ÿ å¤šçº¿ç¨‹æ‰€å¸¦æ¥çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€å…±äº«èµ„æºçš„é—®é¢˜ã€‚ è¿™å°±æ˜¯ä¸€ä¸ªåšå¼ˆçš„è¿‡ç¨‹ï¼Œæƒ³è¦åšåˆ°ä¸€ä¸ªå°½é‡é«˜æ•ˆçš„åº”ç”¨æ˜¯éœ€è¦ä¸æ–­ç£¨åˆè¯•é”™çš„ã€‚ ä¸Šæ–‡ç›¸å…³çš„ä»£ç ï¼š https://github.com/crossoverJie/netty-action æ¬¢è¿Žå…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>å†…å­˜æ¨¡åž‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ä¸ªå­¦æ¸£çš„é˜¿é‡Œä¹‹è·¯]]></title>
    <url>%2F2018%2F06%2F21%2Fpersonal%2FInterview-experience%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘æœ‰äº›æœ‹å‹åœ¨é¢è¯•é˜¿é‡Œï¼ŒåŠ ä¸Š Java-Interview é¡¹ç›®çš„åŽŸå› ä¹Ÿæœ‰å°ä¼™ä¼´å’Œæˆ‘è®¨è®ºï¼Œè¿‘æœŸä¹Ÿåœ¨è´Ÿè´£éƒ¨é—¨çš„æ‹›è˜ï¼Œè¿™è®©æˆ‘æƒ³èµ·å¹´åˆé‚£æ®µé•¿è¾¾ä¸‰ä¸ªæœˆçš„å¥‡è‘©é¢è¯•ç»åŽ†ðŸ¤£ã€‚ æœ¬æ¥æ²¡æƒ³æ‹¿å‡ºæ¥è¯´çš„ï¼Œæ¯•ç«Ÿæœ€åŽä¹Ÿæ²¡æˆã€‚ ä½†ç”±äºŽé‚£å‡ ä¸ªæœˆçš„ç»åŽ†è®©æˆ‘äº†è§£åˆ°äº†å¤§åŽ‚çš„å·¥ä½œæ–¹å¼ã€å¯¹å€™é€‰åŒå­¦çš„è€ƒå¯Ÿé‡ç‚¹ä»¥åŠé¢è¯•å®˜çš„å¥—è·¯ç­‰éƒ½æœ‰äº†å…¨æ–°çš„è®¤è¯†ã€‚ å½“ç„¶æœ€é‡è¦çš„æ˜¯è¿™æ®µæ—¶é—´çš„æŸ¥æ¼è¡¥ç¼ºä¹Ÿè®©è‡ªå·±ç²¾è¿›ä¸å°‘ã€‚ å…ˆäº¤ä»£ä¸‹èƒŒæ™¯å§ï¼š ä»ŽåŽ»å¹´ 12 æœˆåˆ°ä»Šå¹´ä¸‰æœˆåº•ï¼Œæˆ‘å‰å‰åŽåŽé¢äº†é˜¿é‡Œä¸‰ä¸ªéƒ¨é—¨ã€‚ å…¶ä¸­ä¸¤ä¸ªéƒ¨é—¨é€šè¿‡äº†æŠ€æœ¯é¢è¯•ï¼Œè¿˜æœ‰ä¸€ä¸ªè·ªåœ¨äº†ä¸‰é¢ã€‚ å…‰çœ‹ç»“æžœè¿˜ä¸é”™ï¼Œä½†æ•´ä¸ªæµç¨‹å ªç§°æ›²æŠ˜ã€‚ ä¸‹é¢æˆ‘ä¼šå°½é‡æè¿°æµç¨‹ä»¥åŠå¤§è‡´çš„é¢è¯•é¢˜ç›®å¤§çº²ï¼Œå¸Œæœ›å¯¹æƒ³è¦è·³æ§½ã€æ­£åœ¨é¢è¯•çš„åŒå­¦å¸¦æ¥ç‚¹çµæ„Ÿï¼Œå¸®åŠ©å¯èƒ½è°ˆä¸ä¸Šï¼Œä½†å¯å‘è¿˜æ˜¯èƒ½æœ‰ã€‚ ä»¥ä¸‹å†…å®¹è¾ƒé•¿ï¼Œè¯·å†æ¬¡å¤‡å¥½ç“œå­æ¿å‡³ã€‚ A éƒ¨é—¨é¦–å…ˆæ˜¯ç¬¬ä¸€æ¬¡æœºä¼šï¼ŒåŽ»å¹´ 12 æœˆä»½æœ‰ä½å¤§ä½¬åŠ æˆ‘ï¼ŒåŽæ¥æ‰çŸ¥é“æ˜¯ä¸€ä¸ªéƒ¨é—¨çš„æŠ€æœ¯ Leader åœ¨ç½‘ä¸Šçœ‹åˆ°æˆ‘çš„åšå®¢ï¼Œé—®æˆ‘æƒ³ä¸æƒ³æ¥é˜¿é‡Œè¯•è¯•ã€‚ è¿™æ—¶è·ç¦»ä¸Šæ¬¡é¢é˜¿é‡Œä¹Ÿè¿‡åŽ»ä¸€å¹´å¤šäº†ï¼Œä¹Ÿæƒ³çœ‹çœ‹çŽ°åœ¨å‡ æ–¤å‡ ä¸¤ï¼ŒäºŽæ˜¯ä¾¿åŒæ„äº†ã€‚ åœ¨æŽ¨èä¸€å‘¨ä¹‹åŽæ”¶åˆ°äº†æ­å·žæ‰“æ¥çš„ç”µè¯ï¼Œè¯´æ¥ä¹Ÿå·§ï¼Œé‚£æ—¶å€™æˆ‘æ­£åœ¨æœºåœºå€™æœºï¼Œè·ç¦»ç™»è®°è¿˜æœ‰å¤§æ¦‚ä¸€ä¸ªå°æ—¶ï¼Œå¿ƒæƒ³æ—¶é—´è‚¯å®šå¤Ÿäº†ã€‚ é‚£æ˜¯æˆ‘æ—¶éš”ä¸€å¹´å¤šç¬¬ä¸€æ¬¡é¢è¯•ï¼Œè¿˜æ˜¯åœ¨æœºåœºè¿™æ ·å˜ˆæ‚çš„çŽ¯å¢ƒé‡Œã€‚å¤šå¤šå°‘å°‘è¿˜æ˜¯æœ‰äº›ç´§å¼ ã€‚ ä¸€é¢ä»¥ä¸‹æ˜¯æˆ‘å°è±¡æ¯”è¾ƒæ·±åˆ»çš„å†…å®¹ï¼š é¢è¯•å®˜ï¼š è°ˆè°ˆä½ åšè¿‡é¡¹ç›®ä¸­å°è±¡è¾ƒæ·±æˆ–è‡ªè®¤ä¸ºåšçš„æ¯”è¾ƒå¥½çš„åœ°æ–¹ï¼Ÿ åšä¸»ï¼š æˆ‘è§‰å¾—æˆ‘åœ¨ XX åšçš„ä¸é”™ï¼Œç”¨äº† XX éœ€æ±‚å®žçŽ° XX åŠŸèƒ½ï¼Œæ€§èƒ½æé«˜äº† N å€ã€‚ é¢è¯•å®˜ï¼š ä½ è¯´ä½¿ç”¨åˆ°äº† AOP ï¼Œèƒ½è°ˆè°ˆå®ƒçš„å®žçŽ°åŽŸç†å˜›ï¼Ÿ åšä¸»ï¼š å®ƒæ˜¯ä¾é åŠ¨æ€ä»£ç†å®žçŽ°çš„ï¼ŒåŠ¨æ€ä»£ç†åˆåˆ†ä¸º JDK è‡ªèº«çš„ä»¥åŠ CGLIB ã€‚ã€‚ã€‚ã€‚ é¢è¯•å®˜ï¼š å—¯ï¼Œèƒ½è¯´è¯´ä»–ä»¬çš„ä¸åŒåŠä¼˜ç¼ºç‚¹å˜›ï¼Ÿ åšä¸»ï¼š JDK æ˜¯åŸºäºŽæŽ¥å£å®žçŽ°ï¼Œè€Œ CGLIB ç»§æ‰¿ä»£ç†ç±»ã€‚ã€‚ã€‚ å°±æ˜¯è¿™æ ·ä¼šä¸€ç›´é—®ä¸‹åŽ»ï¼Œå¦‚æžœèŠçš„å·®ä¸å¤šäº†å°±å¼€å§‹é—®ä¸€äº›é›¶æ•£çš„é—®é¢˜ï¼š JMM å†…å­˜æ¨¡åž‹ï¼Œå¦‚ä½•åˆ’åˆ†çš„ï¼Ÿåˆ†åˆ«å­˜å‚¨ä»€ä¹ˆå†…å®¹ï¼Ÿçº¿ç¨‹å®‰å…¨ä¸Žå¦ï¼Ÿ ç±»åŠ è½½æœºåˆ¶ï¼Œè°ˆåˆ°åŒäº²å§”æ´¾æ¨¡åž‹åŽä¼šé—®åˆ°å“ªäº›è¿åäº†åŒäº²å§”æ´¾æ¨¡åž‹ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦åŒäº²å§”æ´¾ï¼Ÿå¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ å¹³æ—¶æ€Žä¹ˆä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿæœ‰å“ªäº›å¥½å¤„ï¼Ÿçº¿ç¨‹æ± çš„å‡ ä¸ªæ ¸å¿ƒå‚æ•°çš„æ„ä¹‰ï¼Ÿ çº¿ç¨‹é—´é€šä¿¡çš„æ–¹å¼ï¼Ÿ HashMap çš„åŽŸç†ï¼Ÿå½“è°ˆåˆ°çº¿ç¨‹ä¸å®‰å…¨æ—¶è‡ªç„¶å¼•ç”³å‡º ConcurrentHashMap ï¼Œå®ƒçš„å®žçŽ°åŽŸç†ï¼Ÿ åˆ†åº“åˆ†è¡¨å¦‚ä½•è®¾è®¡ï¼Ÿåž‚ç›´æ‹†åˆ†ã€æ°´å¹³æ‹†åˆ†ï¼Ÿ ä¸šåŠ¡ ID çš„ç”Ÿæˆè§„åˆ™ï¼Œæœ‰å“ªäº›æ–¹å¼ï¼Ÿ SQL è°ƒä¼˜ï¼Ÿå¹³æ—¶ä½¿ç”¨æ•°æ®åº“æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ å½“ä¸€ä¸ªåº”ç”¨å¯åŠ¨ç¼“æ…¢å¦‚ä½•ä¼˜åŒ–ï¼Ÿ å¤§æ¦‚æ˜¯ä»¥ä¸Šè¿™äº›ï¼Œå½“èŠåˆ°å€’æ•°ç¬¬äºŒä¸ªæ—¶æˆ‘å·²ç»ç™»æœºäº†ã€‚æœ€åŽä¸å¾—ä¸æå‰æŒ‚æ–­ï¼Œç»“æŸä¹‹å‰å‘Šè¯‰æˆ‘ä¹‹åŽä¼šæ¢ä¸€ä¸ªåŒäº‹å’Œæˆ‘æ²Ÿé€šï¼Œå¬åˆ°è¿™æ ·çš„å›žå¤ä¸€é¢åº”è¯¥æ˜¯è¿‡äº†ï¼ŒåŽé¢ä¹Ÿç¡®å®žè¯å®žäº†è¿™ç‚¹ã€‚ äºŒé¢å¤§æ¦‚è¿‡äº†ä¸€å‘¨ï¼ŒäºŒé¢å¦‚æœŸè€Œè‡³ã€‚ æˆ‘å¬å£°éŸ³å¾ˆç†Ÿï¼Œå°±å°è¯•é—®ä¸‹æ˜¯ä¸æ˜¯ä¹‹å‰ä¸€é¢çš„é¢è¯•å®˜ï¼Œç»“æžœçœŸæ˜¯ã€‚ ç”±äºŽäºŒé¢çš„é¢è¯•å®˜ä¸´æ—¶æœ‰äº‹æ‰€ä»¥ä»–æ¥æ›¿ä¸€ä¸‹ã€‚äºŽæ˜¯æˆ‘èµ¶ç´§é—®ä»–èƒ½å¦æŠŠä¹‹å‰ç­”çš„ä¸å¥½çš„å†è¯´è¯´ï¼Ÿçš„åˆ°äº†è‚¯å®šçš„ç­”å¤åŽå¼€å§‹äº†æˆ‘çš„è¡¨æ¼”ã€‚ æœ‰äº†ç¬¬ä¸€æ¬¡çš„ç»éªŒè¿™ä¸€æ¬¡è‡ªç„¶ä¹Ÿè½»è½¦ç†Ÿè·¯ï¼ŒåŽŸæœ¬æ„Ÿè§‰ä¸€åˆ‡å°½åœ¨æŽŒæ¡å´è¢«å‘ŠçŸ¥éœ€è¦ç¬”è¯•çªç„¶è¢«æ¿€é†’ã€‚ ç¬”è¯•æ˜¯ä¸€ä¸ªåœ¨çº¿å¹³å°ï¼Œéœ€è¦åœ¨ç½‘é¡µä¸­å†™ä»£ç ï¼Œä¼šæœ‰ä¸€ä¸ªæ˜Žç¡®çš„é¢˜ç›®ï¼š ä»Žä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­æ ¹æ®å…³é”®å­—è¯»å–æ—¥å¿—ï¼Œè®°å½•å‡ºçŽ°çš„æ¬¡æ•°ï¼Œæœ€åŽæŒ‰ç…§æ¬¡æ•°æŽ’åºæ‰“å°ã€‚ åœ¨è¿™è¿‡ç¨‹ä¸­åˆ‡è®°è¦å’Œé¢è¯•å®˜å¤šå¤šäº¤æµï¼Œå› ä¸ºç¬”è¯•æœ‰æ—¶é—´é™åˆ¶ï¼Œåˆ«åˆ°æœ€åŽå‘çŽ°é¢˜ç›®ç†è§£é”™äº†ï¼Œè¿™å°±å’Œé«˜è€ƒä½œæ–‡å†™å®Œå‘çŽ°æ–¹å‘é”™äº†ä¸€æ ·è¦å‘½ã€‚ è€Œä¸”åœ¨æ²Ÿé€šè¿‡ç¨‹ä¸­ä½“çŽ°å‡ºä½ è§£é¢˜çš„æ€è·¯ï¼Œå³ä½¿æœ€ç»ˆç»“æžœä¸å¯¹ï¼Œä½†è¯´ä¸å®šæ€è€ƒçš„è¿‡ç¨‹å¾ˆç¬¦åˆé¢è¯•å®˜çš„èƒƒå£å“¦ã€‚è¿™ä¹Ÿå’Œä»Šå¹´çš„é«˜è€ƒæ”¹å·ä¸€æ ·ï¼›è¿‡ç¨‹æ­£ç¡®å¾—é«˜åˆ†ï¼Œåªæœ‰ç»“æžœå¾—ä½Žåˆ†ã€‚ ä¸‰é¢åˆè¿‡äº†å·®ä¸å¤šä¸€å‘¨çš„æ—¶é—´æŽ¥åˆ°äº†ä¸‰é¢çš„ç”µè¯ï¼Œä¸€èˆ¬åˆ°äº†ä¸‰é¢ä¼šæ˜¯æŠ€æœ¯ Leader ä¹‹ç±»çš„è§’è‰²ã€‚ è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šè¿‡å¤šå¼ºè°ƒæŠ€æœ¯ç»†èŠ‚ï¼Œæ›´å¤šçš„è€ƒå¯Ÿè½¯ä»¶èƒ½ï¼Œæ¯”å¦‚å›¢é˜Ÿåä½œã€å­¦ä¹ èƒ½åŠ›ç­‰ã€‚ ä½†æˆ‘è®°å¾—ä¹Ÿé—®äº†ä»¥ä¸‹ä¸€äº›æŠ€æœ¯é—®é¢˜ï¼š è°ˆè°ˆä½ æ‰€ç†è§£çš„ HTTP åè®®ï¼Ÿ å¯¹ TCP çš„ç†è§£ï¼Ÿä¸‰æ¬¡æ¡æ‰‹ï¼Ÿæ»‘åŠ¨çª—å£ï¼Ÿ åŸºæœ¬ç®—æ³•ï¼ŒBase64 ç­‰ã€‚ Java å†…å­˜æ¨¡åž‹ï¼ŒHappen Before çš„ç†è§£ã€‚ ä¸€å‘¨ä¹‹åŽæˆ‘æŽ¥åˆ°äº† HR åŠ©ç†çš„ç”µè¯çº¦äº†å’Œ HRBP ä»¥åŠäº§å“æŠ€æœ¯è´Ÿè´£äººçš„è§†é¢‘é¢è¯•ã€‚ ä½†æ˜¯æˆ‘å´æ²¡æœ‰é¢ä¸‹åŽ»ï¼Œå…·ä½“åŽŸå› å¾—å¾€ä¸‹çœ‹ã€‚ B éƒ¨é—¨åœ¨ A éƒ¨é—¨ä¸‰é¢å®ŒæˆåŽï¼Œæˆ‘ç­‰äº†å·®ä¸å¤šä¸€æ˜ŸæœŸï¼Œè¿™æœŸé—´æˆ‘å´æ”¶åˆ°äº†ä¸€å°é‚®ä»¶ã€‚ å¤§æ¦‚å†…å®¹æ˜¯ä»–åœ¨ GitHub ä¸Šçœ‹åˆ°çš„æˆ‘ï¼Œä»–ä»¬çš„æŠ€æœ¯æ€»ç›‘å¯¹æˆ‘å¾ˆæ„Ÿå…´è¶£ï¼ˆæˆ‘éƒ½ä¸æ•¢ç›¸ä¿¡æˆ‘çš„çœ¼é•œï¼‰ï¼Œé—®æˆ‘æƒ³ä¸æƒ³æ¥é˜¿é‡Œè¯•è¯•ã€‚ æˆ‘å¯¹æ¯”äº† A B éƒ¨é—¨çš„åŒºåˆ«å‘çŽ° B éƒ¨é—¨åœ¨åšçš„äº‹æƒ…ä¸Šç¡®å®žæ›´åŠ æœ‰è¯±æƒ‘åŠ›ï¼Œä¹‹åŽæˆ‘è¡¨è¾¾äº†æœ‰ä¸€ä¸ªé¢è¯•æ­£åœ¨æµç¨‹ä¸­çš„é¡¾è™‘ï¼›å¯¹æ–¹è¡¨ç¤ºå¯ä»¥ç§ä¸‹å’Œæˆ‘å¿«é€Ÿçš„è¿›è¡Œä¸‰é¢ï¼Œå¦‚æžœä¸€åˆ‡æ²¡é—®é¢˜å†äº¤ç”±æˆ‘è‡ªè¡Œé€‰æ‹©ã€‚è‡³å°‘å¯¹åŒæ–¹éƒ½æ˜¯ä¸€ä¸ªåŒèµ¢å˜›ã€‚ æˆ‘æƒ³ä¹Ÿä¸äºï¼Œå¹¶ä¸”å¯¹æ–¹å¾ˆæœ‰è¯šæ„ï¼Œå°±ç­”åº”è¯•è¯•ï¼›äºŽæ˜¯ä¾¿æœ‰äº†ä¸‹é¢çš„é¢è¯•ï¼š ä¸€é¢é¢è¯•å®˜ï¼š å¯¹ Java é”çš„ç†è§£ï¼Ÿ åšä¸»ï¼š æˆ‘è°ˆåˆ°äº† synchronizeï¼ŒLock æŽ¥å£çš„åº”ç”¨ã€‚ é¢è¯•å®˜ï¼š ä»–ä»¬ä¸¤è€…çš„åŒºåˆ«ä»¥åŠä¼˜ç¼ºç‚¹å‘¢ï¼Ÿ åšä¸»ï¼š synchronize åœ¨ JDK1.6 ä¹‹å‰ç§°ä¸ºé‡é‡é”ï¼Œæ˜¯é€šè¿‡è¿›å‡ºå¯¹è±¡ç›‘è§†å™¨æ¥å®žçŽ°åŒæ­¥çš„ï¼›1.6 ä¹‹åŽåšäº† XX ä¼˜åŒ–ã€‚ã€‚ã€‚ è€Œ ReentrantLock æ˜¯åˆ©ç”¨äº†ä¸€ä¸ªå·§å¦™æ•°æ®ç»“æž„å®žçŽ°çš„ï¼Œå¹¶ä¸”åŠ é”è§£é”æ˜¯æ˜¾å¼çš„ã€‚ã€‚ã€‚ ä¹‹åŽåˆå¼•ç”³åˆ°åˆ†å¸ƒå¼é”ï¼Œå…‰è¿™å—å°±èŠäº†å·®ä¸å¤šåŠä¸ªå°æ—¶ã€‚ ä¹‹åŽåˆèŠåˆ°äº†æˆ‘çš„å¼€æºé¡¹ç›®ï¼š æ˜¯å¦‚ä½•æƒ³åšè¿™ä¸ªé¡¹ç›®çš„ï¼Ÿ å·²ç»æœ‰ä¸€äº›å…³æ³¨äº†åŽç»­æ˜¯å¦‚ä½•è§„åˆ’çš„ï¼Ÿ ä½ ä»ŠåŽçš„å­¦ä¹ è®¡åˆ’æ˜¯ä»€ä¹ˆï¼Ÿ å¹³æ—¶çœ‹å“ªäº›ä¹¦ï¼Ÿ ä¹‹åŽæŠ€æœ¯èŠçš„ä¸æ˜¯å¾ˆå¤šï¼Œä½†å¯¹äºŽä¸ªäººå‘å±•å´èŠäº†ä¸å°‘ã€‚ å…³äºŽé”ç›¸å…³çš„å†…å®¹å¯ä»¥å‚è€ƒè¿™é‡Œï¼šReentrantLock å®žçŽ°åŽŸç† synchronize å…³é”®å­—åŽŸç† äºŒé¢éš”äº†å·®ä¸å¤šä¸€å¤©çš„æ—¶é—´ï¼ŒäºŒé¢å¾ˆå¿«å°±æ¥äº†ã€‚ å†…å®¹ä¸æ˜¯å¾ˆå¤šï¼š çº¿ç¨‹é—´é€šä¿¡çš„å¤šç§æ–¹å¼ï¼Ÿ é™æµç®—æ³•ï¼Ÿå•æœºé™æµï¼Ÿåˆ†å¸ƒå¼é™æµï¼Ÿ æåˆ°äº† Guava Cache ,äº†è§£å®ƒçš„å®žçŽ°åŽŸç†å˜›ï¼Ÿ å¦‚ä½•å®šä½ä¸€ä¸ªçº¿ä¸Šé—®é¢˜ï¼Ÿ CPU é«˜è´Ÿè½½ï¼ŸOOM æŽ’æŸ¥ç­‰ï¼Ÿ èŠå®Œä¹‹åŽè¡¨ç¤ºç¬¬äºŒå¤©åº”è¯¥ä¼šæœ‰ä¸‰é¢ã€‚ ä¸‰é¢ä¸‰é¢çš„é¢è¯•å®˜åº”è¯¥æ˜¯ä¹‹å‰é‚®ä»¶ä¸­æåˆ°çš„é‚£ä½æ€»ç›‘å¤§ä½¬ï¼Œä»¥å‰åº”è¯¥ä¹Ÿæ˜¯ä¸€çº¿çš„æŠ€æœ¯å¤§ç‰›ï¼›èŠçš„é—®é¢˜ä¸æ˜¯å¾ˆå¤šï¼š è°ˆè°ˆå¯¹ Netty çš„ç†è§£ï¼Ÿ Netty çš„çº¿ç¨‹æ¨¡åž‹ï¼Ÿ å†™ä¸€ä¸ª LRU ç¼“å­˜ã€‚ ç¬”è¯•æœ¬ä»¥ä¸ºæŠ€æœ¯é¢è¯•å®Œäº†ï¼Œç»“æžœåŽé¢å‘ŠçŸ¥æ‰€æœ‰çš„é¢è¯•æµç¨‹éƒ½å¾—æœ‰ç¬”è¯•äº†ï¼ŒäºŽæ˜¯åˆå‚ä¸Žäº†ä¸€æ¬¡ç¬”è¯•ï¼š äº¤æ›¿æ‰“å°å¥‡å¶æ•° è¿™ä¸ªç›¸å¯¹æ¯”è¾ƒç®€å•ï¼ŒåŸºäºŽé”ã€ç­‰å¾…å”¤é†’æœºåˆ¶éƒ½æ˜¯å¯ä»¥çš„ã€‚æœ€åŽä¹Ÿå‘ŠçŸ¥ç¬”è¯•é€šè¿‡ã€‚ ä¹‹åŽåœ¨æŽ¨èæˆ‘çš„é‚£ä½å¤§ä½¬çš„å¸®åŠ©ä¸‹æˆå‰§èˆ¬çš„é€šè¿‡äº†æ•´ä¸ªæŠ€æœ¯è½®ï¼ˆçœŸçš„å¾ˆæ„Ÿè°¢ä»–çš„è®¤å¯ï¼‰ï¼Œå¹¶ä¸”å¾—çŸ¥è¿™ä¸ªæ¶ˆæ¯æ˜¯åœ¨æˆ‘åˆšå¥½å’Œ A éƒ¨é—¨çº¦å¥½è§†é¢‘é¢è¯•æ—¶é—´ä¹‹åŽã€‚ ä¹Ÿå°±æ„å‘³ç€æˆ‘å¿…é¡»æ‹’æŽ‰ä¸€ä¸ªéƒ¨é—¨ï¼ æ²¡çœ‹é”™ï¼Œæ˜¯æˆ‘è¦æ‹’æŽ‰ä¸€ä¸ªã€‚è¿™å¯¹æˆ‘æ¥è¯´ç¡®å®žå¤ªéš¾äº†ï¼Œæˆ‘åŽ‹æ ¹æ²¡æƒ³è¿‡è¿˜æœ‰ä¸¤ä¸ªæœºä¼šæ‘†åœ¨æˆ‘é¢å‰ã€‚ æœ€åŽå‡­ç€ä¸ªäººçš„çˆ±å¥½ä»¥åŠ B éƒ¨é—¨çš„çƒ­æƒ…æˆ‘å¾ˆä¸å¥½æ„æ€çš„æ‹’æŽ‰äº† A éƒ¨é—¨ã€‚ã€‚ã€‚ HR é¢åœ¨é¢è¿™ä¹‹å‰æˆ‘ä»Žæ¥æ²¡æœ‰é¢è¿‡è¿™æ ·å¤§åŽ‚çš„ HR æµç¨‹ï¼ŒäºŽæ˜¯ç–¯ç‹‚æœç´¢ï¼Œå¸Œæœ›èƒ½å¼¥è¡¥ç‚¹ç»éªŒã€‚ ä¹Ÿè®¸è¿™å°±æ˜¯ä¹æžç”Ÿæ‚²å§ï¼Œæˆ‘ç¡®å®žçŒœä¸­äº† HR é—®çš„å¤§éƒ¨åˆ†é—®é¢˜ï¼Œä½†é—æ†¾çš„æ˜¯æœ€ç»ˆä¾ç„¶æ²¡èƒ½é€šè¿‡ã€‚ åŽæ¥æˆ‘åœ¨æƒ³å¦‚æžœæˆ‘æ²¡æœ‰æ‹’æŽ‰ A ï¼Œä¼šä¸ä¼šç»“å±€ä¸ä¸€æ ·äº†ï¼Ÿ ä½†çŽ°å®žå°±æ˜¯å¦‚æ­¤ï¼Œæ²¡æœ‰é‚£ä¹ˆå¤šå‡è®¾ï¼Œå¹¶ä¸”æ¯ä¸ªäººä¹Ÿå¾—ä¸ºè‡ªå·±çš„é€‰æ‹©è´Ÿè´£ï¼ å¤§æ¦‚çš„é—®é¢˜æ˜¯ï¼š ä¸ºä»€ä¹ˆæƒ³æ¥é˜¿é‡Œï¼Ÿ ä¸ªäººåšçš„æœ€æˆåŠŸæœ€æœ‰æŒ‘æˆ˜çš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ å·¥ä½œä¸­æœ€éš¾å¿˜çš„ç»åŽ†ï¼Ÿ å¯¹åŠ å…¥æˆ‘ä»¬å›¢é˜Ÿæœ‰ä½•æœŸå¾…ï¼Ÿ C éƒ¨é—¨HR è¿™å…³è¢« Pass ä¹‹åŽæ²¡å¤šä¹…æˆ‘å±…ç„¶åˆæ”¶åˆ°äº†ç¬¬ä¸‰ä¸ªéƒ¨é—¨çš„é‚€çº¦ã€‚ è¯´å®žè¯å½“æ—¶æˆ‘æ˜¯æ‹’ç»çš„ï¼Œä¹‹å‰ç»åŽ†äº†å°†è¿‘ä¸¤ä¸ªæœˆçš„æ—¶é—´å´æ²¡èƒ½å¦‚æ„¿æˆ‘å†…å¿ƒæ˜¯å´©æºƒçš„ã€‚ æˆ‘å‘è”ç³»æˆ‘çš„å¤§ä½¬è¡¨è¾¾äº†æˆ‘çš„æƒ³æ³•ï¼Œä»–å€’è§‰å¾—æˆ‘æœ€åŽè¢« pass çš„åŽŸå› æ˜¯ä¸ªå°é—®é¢˜ï¼Œå†å°è¯•çš„è¯ä¼šæœ‰å¾ˆå¤§çš„å‡ çŽ‡é€šè¿‡ã€‚ æˆ‘æŠŠè¿™äº‹ç»™æœ‹å‹è¯´äº†ä¹‹åŽä¹Ÿæ”¯æŒæˆ‘å†è¯•è¯•ï¼Œåæ­£ä¹Ÿæ²¡å•¥æŸå¤±å˜›ï¼Œè€Œä¸”é¢è¯•çš„çŠ¶æ€è¿˜åœ¨ã€‚ æ‰€ä»¥æˆ‘åˆè¢«æ‰“äº†é¸¡è¡€ï¼Œæ‰æœ‰äº†ä¸‹é¢çš„é¢è¯•ç»è¿‡ï¼š ä¸€é¢é¢è¯•å®˜ï¼š æœåŠ¡åŒ–æ¡†æž¶çš„é€‰åž‹å’Œå·®å¼‚ï¼Ÿ åšä¸»ï¼š ä¸€èµ·æŽ¢è®¨äº† SpringCloudã€Dubboã€Thrift çš„å·®å¼‚ï¼Œä¼˜ç¼ºç‚¹ç­‰ã€‚ é¢è¯•å®˜ï¼š ä¸€è‡´æ€§ Hash ç®—æ³•çš„åŽŸç†ï¼Ÿ åšä¸»ï¼š å°†æ•°æ® Hash ä¹‹åŽè½åˆ°ä¸€ä¸ª 0 ~ 2^32-1 æž„æˆçš„ä¸€ä¸ªçŽ¯ä¸Šã€‚ã€‚ã€‚ã€‚ é¢è¯•å®˜ï¼š è°ˆè°ˆä½ ç†è§£çš„ Zookeeperï¼Ÿ åšä¸»ï¼š ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒå™¨ã€‚ã€‚ã€‚ é¢è¯•å®˜ï¼š å¦‚ä½•å¤„ç† MQ é‡å¤æ¶ˆè´¹ï¼Ÿ åšä¸»ï¼š ä¸šåŠ¡å¹‚ç­‰å¤„ç†ã€‚ã€‚ã€‚ã€‚ é¢è¯•å®˜ï¼š å®¢æˆ·ç«¯è´Ÿè½½ç®—æ³•ï¼Ÿ åšä¸»ï¼š è½®è¯¢ã€éšæœºã€ä¸€è‡´æ€§ Hashã€æ•…éšœè½¬ç§»ã€LRU ç­‰ã€‚ã€‚ é¢è¯•å®˜ï¼š long ç±»åž‹çš„èµ‹å€¼æ˜¯å¦æ˜¯åŽŸå­çš„ï¼Ÿ åšä¸»ï¼š ä¸æ˜¯ã€‚ã€‚ã€‚ é¢è¯•å®˜ï¼š volatile å…³é”®å­—çš„åŽŸç†åŠä½œç”¨ï¼Ÿhappen Beforeï¼Ÿ åšä¸»ï¼š å¯è§æ€§ã€ä¸€è‡´æ€§ã€‚ã€‚ äºŒé¢ä¸€é¢ä¹‹åŽå¤§æ¦‚ä¸€å‘¨çš„æ—¶é—´æŽ¥åˆ°äº†äºŒé¢çš„ç”µè¯ï¼š åŽŸä»¥ä¸ºä¼šåƒä¹‹å‰ä¸€æ ·ç›´æŽ¥è¿›å…¥ç¬”è¯•ï¼Œè¿™æ¬¡ä¸Šæ¥å…ˆç®€å•èŠäº†ä¸‹ï¼š è°ˆè°ˆå¯¹å¾®æœåŠ¡çš„ç†è§£ï¼Œå¥½å¤„ä»¥åŠå¼Šç«¯ï¼Ÿ åˆ†å¸ƒå¼ç¼“å­˜çš„è®¾è®¡ï¼Ÿçƒ­ç‚¹ç¼“å­˜ï¼Ÿ ä¹‹åŽæ‰æ­£å¼è¿›å…¥ç¬”è¯•æµç¨‹ï¼š è¿™æ¬¡ä¸»è¦è€ƒå¯Ÿè®¾è®¡èƒ½åŠ›ï¼Œå…¶å®žå°±æ˜¯å¯¹è®¾è®¡æ¨¡å¼çš„ç†è§£ï¼Ÿèƒ½å¦åº”å¯¹åŽç»­çš„æ‰©å±•æ€§ã€‚ ç¬”è¯•å®Œäº†ä¹‹åŽä¹Ÿå’Œé¢è¯•å®˜äº¤æµï¼ŒåŽŸä»¥ä¸ºä¼šæ˜¯ç®—æ³•ä¹‹ç±»çš„æµ‹è¯•ï¼ŒåŽæ¥å¾—çŸ¥ä»–èƒ½çœ‹åˆ°å‰å‡ è½®çš„ç¬”è¯•æƒ…å†µï¼Œç‰¹åœ°æŒ‘çš„æ²¡æœ‰åšè¿‡çš„æ–¹å‘ã€‚ æ‰€ä»¥å¤§å®¶ä¹Ÿä¸ç”¨åˆ»æ„åŽ»æŠ¼é¢˜ï¼Œæ€»æœ‰ä½ æƒ³ä¸åˆ°çš„ï¼Œå¹³æ—¶å¤šç§¯ç´¯æ‰æ˜¯ç¡¬é“ç†ã€‚ ä¸‰é¢åˆè¿‡äº†ä¸¤å‘¨å·¦å³ï¼Œå¾—åˆ° HR é€šçŸ¥ï¼›å¸Œæœ›èƒ½è¿‡åŽ»æ­å·žå‚åŠ çŽ°åœºé¢è¯•ã€‚å¹¶ä¸”é˜¿é‡ŒåŒ…äº†æ¥å›žçš„æœºç¥¨é…’åº—ç­‰ã€‚ å¯è§é˜¿é‡Œå¯¹äººæ‰æ¸´æœ›è¿˜æ˜¯èˆå¾—ä¸‹æˆæœ¬çš„ã€‚ æ—¢ç„¶éƒ½è¿™æ ·äº†ï¼Œå°±å½“æˆä¸€æ¬¡æ—…æ¸¸æ‰€ä»¥åŽ»äº†ä¸€è¶Ÿæ­å·žã€‚ çŽ°åœºé¢çš„æ—¶å€™æœ‰åˆ«äºŽå…¶ä»–é¢è¯•ï¼Œæ˜¯ç”±ä¸¤ä¸ªé¢è¯•å®˜åŒæ—¶å‚ä¸Žï¼š ç»™ä¸€ä¸ªåœºæ™¯ï¼Œè°ˆè°ˆä½ çš„æž¶æž„æ–¹å¼ã€‚ è¿™å°±å¯¹å¹³æ—¶çš„ç§¯ç´¯è¦æ±‚è¾ƒé«˜äº†ã€‚ è¿˜æœ‰ä¸€ä¸ªå°è±¡è¾ƒæ·±çš„æ˜¯ï¼š åœ¨ç½‘é¡µä¸Šç‚¹å‡»ä¸€ä¸ªæŒ‰é’®åˆ°æœåŠ¡å™¨çš„æ•´ä¸ªæµç¨‹ï¼Œå°½é‡å®Œæ•´ã€‚ å…¶å®žä¹‹å‰çœ‹è¿‡ï¼Œå¥½åƒæ˜¯ Google çš„ä¸€ä¸ªé¢è¯•é¢˜ã€‚ å®Œäº†ä¹‹åŽè®©æˆ‘å›žåŽ»ç­‰é€šçŸ¥ï¼Œæ²¡æœ‰è§åˆ° HR æˆ‘å°±çŸ¥é“å‡‰äº†ï¼Œæžœä¸å…¶ç„¶ã€‚ æ€»ç»“çœ‹åˆ°è¿™é‡Œçš„æœ‹å‹åº”è¯¥éƒ½æ˜¯è€é“äº†ï¼Œæˆ‘ä¹ŸæŠŠä¸Šæ–‡æåˆ°çš„å¤§å¤šæ•°é¢è¯•é¢˜æ•´ç†åœ¨äº† GitHubï¼š åŽ‚åº“åœ°å€ï¼š https://github.com/crossoverJie/Java-Interview æœ€åŽæ€»ç»“ä¸‹è¿™å°†è¿‘å››ä¸ªæœˆçš„é¢è¯•å¿ƒå¾—ï¼š ä¸€å®šè¦ç§¯æžçš„æŽ¨é”€è‡ªå·±ï¼Œåƒåœ¨ A éƒ¨é—¨çš„ä¸‰é¢æ—¶ï¼Œç”±äºŽåŸºç¡€ç­”å¾—ä¸æ˜¯å¾ˆå¥½ï¼›æ‰€ä»¥æœ€åŽæˆ‘è¡¨è¾¾äº†è‡ªå·±çš„æ€åº¦ï¼Œå¯¹å·¥ä½œã€æŠ€æœ¯çš„ç§¯æžæ€§ã€‚è®©é¢è¯•å®˜çœ‹åˆ°ä½ çš„æ½œåŠ›å€¼å¾—ä¸€ä¸ª HC åé¢ã€‚ é¢è¯•è¿‡ç¨‹ä¸­é‡åˆ°è‡ªå·±çš„ä¸ä¼šçš„å¯ä»¥ä¸»åŠ¨æå‡ºï¼Œåˆ‡ä¸å¯ä¸æ‡‚è£…æ‡‚ï¼Œè¿™ä¸€é—®å°±éœ²é¦…ã€‚å¯ä»¥å°†é¢è¯•å®˜å¼•å¯¼åˆ°è‡ªå·±æ“…é•¿çš„é¢†åŸŸã€‚æ¯”å¦‚å½“æ—¶æˆ‘æ­£å¥½ç ”ç©¶äº†é”ï¼Œæ‰€ä»¥å’Œé¢è¯•å®˜ä¸€èŠå°±æ˜¯åŠå°æ—¶è¿™å°±æ˜¯åŠ åˆ†é¡¹ã€‚ å¹³æ—¶è¦ä¸»åŠ¨ç§¯ç´¯çŸ¥è¯†ã€‚å†™åšå®¢å’Œå‚ä¸Žå¼€æºé¡¹ç›®å°±æ˜¯å¾ˆå¥½çš„æ–¹å¼ã€‚ åšå®¢å¯ä»¥è®°å½•è‡ªå·±è¸©è¿‡çš„å‘ï¼ŒåŠ æ·±å°è±¡ï¼Œè€Œä¸”åœ¨å†™çš„è¿‡ç¨‹ä¸­å¯ä»¥æŸ¥æ¼è¡¥ç¼ºï¼Œæœ€åŽæŠŠæ•´ä¸ªçŸ¥è¯†ä½“ç³»å·©å›ºçš„æ¯”è¾ƒç‰¢å›ºï¼Œè‰¯å¥½çš„å†…å®¹è¿˜å¯ä»¥å¾—åˆ°æ„æƒ³ä¸åˆ°çš„æ”¶èŽ·ï¼Œæ¯”å¦‚æˆ‘ç¬¬ä¸€æ¬¡é¢è¯•çš„æœºä¼šã€‚ GitHub æ˜¯å¼€å‘è€…çš„ä¸€å¼ åç‰‡ï¼Œç§¯æžå‚ä¸Žå¼€æºé¡¹ç›®å¯ä»¥å’Œå…¨çƒå¤§ä½¬å¤´è„‘é£Žæš´ï¼Œå¹¶ä¸”åœ¨é¢è¯•è¿‡ç¨‹ä¸­ç»å¯¹æ˜¯ä¸€ä¸ªåŠ åˆ†åˆ©å™¨ã€‚ é¢è¯•å®˜ä¸€èˆ¬æœ€åŽéƒ½ä¼šé—®ä½ æœ‰ä»€ä¹ˆè¦é—®æˆ‘çš„ï¼Ÿåƒä¸‡ä¸è¦é—®ä¸€äº›å…¬å¸ç¦åˆ©å¾…é‡ä¹‹ç±»çš„é—®é¢˜ã€‚å¯ä»¥é—®ä¸‹æœ¬æ¬¡é¢è¯•çš„è¡¨çŽ°ï¼Ÿè¿˜æœ‰å“ªäº›éœ€è¦å®Œå–„çš„ï¼Ÿä»Žè€ŒçŸ¥é“è‡ªå·±ç­”å¾—å¦‚ä½•ä¹Ÿèƒ½è¡¥å…¨è‡ªå·±ã€‚ è¿˜æœ‰ä¸€ç‚¹ï¼šä¸è¦åœ¨æŸæ¬¡é¢è¯•å¤±åˆ©åŽå¦å®šè‡ªå·±ï¼Œæœ‰æ—¶çœŸçš„ä¸æ˜¯è‡ªå·±èƒ½åŠ›ä¸è¡Œã€‚è¿™ä¸ªä¹Ÿè®²ç¼˜åˆ†ã€‚ å¡žç¿å¤±é©¬ç„‰çŸ¥éžç¦ æˆ‘å°±æ˜¯ä¸ªä¾‹å­ï¼Œè™½ç„¶æœ€åŽæ²¡èƒ½åŽ»æˆé˜¿é‡Œï¼ŒçŽ°åœ¨åœ¨å…¬å¸ä¹Ÿæ˜¯ä¸€ä¸ªéƒ¨é—¨çš„æŠ€æœ¯è´Ÿè´£äººï¼Œåœ¨æˆ‘ä»¬åŸŽå¸‚è¿˜æœ‰ä¸ªçªï¼Œæ¸©é¦¨çš„å®¶ï¼Œå’Œå¥³æœ‹å‹ä¸€èµ·ä¸ºæƒ³è¦çš„ç”Ÿæ´»åŠªåŠ›å¥‹æ–—ã€‚ æ¬¢è¿Žå…³æ³¨ä½œè€…å…¬ä¼—å·äºŽæˆ‘äº¤æµðŸ¤—ã€‚]]></content>
      <categories>
        <category>Interview</category>
        <category>Person</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Guava æºç åˆ†æžï¼ˆCache åŽŸç†ï¼‰]]></title>
    <url>%2F2018%2F06%2F13%2Fguava%2Fguava-cache%2F</url>
    <content type="text"><![CDATA[å‰è¨€Google å‡ºçš„ Guava æ˜¯ Java æ ¸å¿ƒå¢žå¼ºçš„åº“ï¼Œåº”ç”¨éžå¸¸å¹¿æ³›ã€‚ æˆ‘å¹³æ—¶ç”¨çš„ä¹ŸæŒºé¢‘ç¹ï¼Œè¿™æ¬¡å°±å€ŸåŠ©æ—¥å¸¸ä½¿ç”¨çš„ Cache ç»„ä»¶æ¥çœ‹çœ‹ Google å¤§ç‰›ä»¬æ˜¯å¦‚ä½•è®¾è®¡çš„ã€‚ ç¼“å­˜ æœ¬æ¬¡ä¸»è¦è®¨è®ºç¼“å­˜ã€‚ ç¼“å­˜åœ¨æ—¥å¸¸å¼€å‘ä¸­ä¸¾è¶³è½»é‡ï¼Œå¦‚æžœä½ çš„åº”ç”¨å¯¹æŸç±»æ•°æ®æœ‰ç€è¾ƒé«˜çš„è¯»å–é¢‘æ¬¡ï¼Œå¹¶ä¸”æ”¹åŠ¨è¾ƒå°æ—¶é‚£å°±éžå¸¸é€‚åˆåˆ©ç”¨ç¼“å­˜æ¥æé«˜æ€§èƒ½ã€‚ ç¼“å­˜ä¹‹æ‰€ä»¥å¯ä»¥æé«˜æ€§èƒ½æ˜¯å› ä¸ºå®ƒçš„è¯»å–æ•ˆçŽ‡å¾ˆé«˜ï¼Œå°±åƒæ˜¯ CPU çš„ L1ã€L2ã€L3 ç¼“å­˜ä¸€æ ·ï¼Œçº§åˆ«è¶Šé«˜ç›¸åº”çš„è¯»å–é€Ÿåº¦ä¹Ÿä¼šè¶Šå¿«ã€‚ ä½†ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¥½å¤„éƒ½å ï¼Œè¯»å–é€Ÿåº¦å¿«äº†ä½†æ˜¯å®ƒçš„å†…å­˜æ›´å°èµ„æºæ›´å®è´µï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“ç¼“å­˜çœŸæ­£éœ€è¦çš„æ•°æ®ã€‚ å…¶å®žä¹Ÿå°±æ˜¯å…¸åž‹çš„ç©ºé—´æ¢æ—¶é—´ã€‚ ä¸‹é¢è°ˆè°ˆ Java ä¸­æ‰€ç”¨åˆ°çš„ç¼“å­˜ã€‚ JVM ç¼“å­˜é¦–å…ˆæ˜¯ JVM ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯å †ç¼“å­˜ã€‚ å…¶å®žå°±æ˜¯åˆ›å»ºä¸€äº›å…¨å±€å˜é‡ï¼Œå¦‚ Mapã€List ä¹‹ç±»çš„å®¹å™¨ç”¨äºŽå­˜æ”¾æ•°æ®ã€‚ è¿™æ ·çš„ä¼˜åŠ¿æ˜¯ä½¿ç”¨ç®€å•ä½†æ˜¯ä¹Ÿæœ‰ä»¥ä¸‹é—®é¢˜ï¼š åªèƒ½æ˜¾å¼çš„å†™å…¥ï¼Œæ¸…é™¤æ•°æ®ã€‚ ä¸èƒ½æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ·˜æ±°æ•°æ®ï¼Œå¦‚ LRUï¼ŒLFUï¼ŒFIFO ç­‰ã€‚ æ¸…é™¤æ•°æ®æ—¶çš„å›žè°ƒé€šçŸ¥ã€‚ å…¶ä»–ä¸€äº›å®šåˆ¶åŠŸèƒ½ç­‰ã€‚ Ehcacheã€Guava Cacheæ‰€ä»¥å‡ºçŽ°äº†ä¸€äº›ä¸“é—¨ç”¨ä½œ JVM ç¼“å­˜çš„å¼€æºå·¥å…·å‡ºçŽ°äº†ï¼Œå¦‚æœ¬æ–‡æåˆ°çš„ Guava Cacheã€‚ å®ƒå…·æœ‰ä¸Šæ–‡ JVM ç¼“å­˜ä¸å…·æœ‰çš„åŠŸèƒ½ï¼Œå¦‚è‡ªåŠ¨æ¸…é™¤æ•°æ®ã€å¤šç§æ¸…é™¤ç®—æ³•ã€æ¸…é™¤å›žè°ƒç­‰ã€‚ ä½†ä¹Ÿæ­£å› ä¸ºæœ‰äº†è¿™äº›åŠŸèƒ½ï¼Œè¿™æ ·çš„ç¼“å­˜å¿…ç„¶ä¼šå¤šå‡ºè®¸å¤šä¸œè¥¿éœ€è¦é¢å¤–ç»´æŠ¤ï¼Œè‡ªç„¶ä¹Ÿå°±å¢žåŠ äº†ç³»ç»Ÿçš„æ¶ˆè€—ã€‚ åˆ†å¸ƒå¼ç¼“å­˜åˆšæ‰æåˆ°çš„ä¸¤ç§ç¼“å­˜å…¶å®žéƒ½æ˜¯å †å†…ç¼“å­˜ï¼Œåªèƒ½åœ¨å•ä¸ªèŠ‚ç‚¹ä¸­ä½¿ç”¨ï¼Œè¿™æ ·åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹å°±æ‹›æž¶ä¸ä½äº†ã€‚ äºŽæ˜¯ä¹Ÿæœ‰äº†ä¸€äº›ç¼“å­˜ä¸­é—´ä»¶ï¼Œå¦‚ Redisã€Memcachedï¼Œåœ¨åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹å¯ä»¥å…±äº«å†…å­˜ã€‚ å…·ä½“ä¸åœ¨æœ¬æ¬¡çš„è®¨è®ºèŒƒå›´ã€‚ Guava Cache ç¤ºä¾‹ä¹‹æ‰€ä»¥æƒ³åˆ° Guava çš„ Cacheï¼Œä¹Ÿæ˜¯æœ€è¿‘åœ¨åšä¸€ä¸ªéœ€æ±‚ï¼Œå¤§ä½“å¦‚ä¸‹ï¼š ä»Ž Kafka å®žæ—¶è¯»å–å‡ºåº”ç”¨ç³»ç»Ÿçš„æ—¥å¿—ä¿¡æ¯ï¼Œè¯¥æ—¥å¿—ä¿¡æ¯åŒ…å«äº†åº”ç”¨çš„å¥åº·çŠ¶å†µã€‚å¦‚æžœåœ¨æ—¶é—´çª—å£ N å†…å‘ç”Ÿäº† X æ¬¡å¼‚å¸¸ä¿¡æ¯ï¼Œç›¸åº”çš„æˆ‘å°±éœ€è¦ä½œå‡ºåé¦ˆï¼ˆæŠ¥è­¦ã€è®°å½•æ—¥å¿—ç­‰ï¼‰ã€‚ å¯¹æ­¤ Guava çš„ Cache å°±éžå¸¸é€‚åˆï¼Œæˆ‘åˆ©ç”¨äº†å®ƒçš„ N ä¸ªæ—¶é—´å†…ä¸å†™å…¥æ•°æ®æ—¶ç¼“å­˜å°±æ¸…ç©ºçš„ç‰¹ç‚¹ï¼Œåœ¨æ¯æ¬¡è¯»å–æ•°æ®æ—¶åˆ¤æ–­å¼‚å¸¸ä¿¡æ¯æ˜¯å¦å¤§äºŽ X å³å¯ã€‚ ä¼ªä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132@Value("$&#123;alert.in.time:2&#125;")private int time ;@Beanpublic LoadingCache buildCache()&#123; return CacheBuilder.newBuilder() .expireAfterWrite(time, TimeUnit.MINUTES) .build(new CacheLoader&lt;Long, AtomicLong&gt;() &#123; @Override public AtomicLong load(Long key) throws Exception &#123; return new AtomicLong(0); &#125; &#125;);&#125;/** * åˆ¤æ–­æ˜¯å¦éœ€è¦æŠ¥è­¦ */public void checkAlert() &#123; try &#123; if (counter.get(KEY).incrementAndGet() &gt;= limit) &#123; LOGGER.info("***********æŠ¥è­¦***********"); //å°†ç¼“å­˜æ¸…ç©º counter.get(KEY).getAndSet(0L); &#125; &#125; catch (ExecutionException e) &#123; LOGGER.error("Exception", e); &#125;&#125; é¦–å…ˆæ˜¯æž„å»ºäº† LoadingCache å¯¹è±¡ï¼Œåœ¨ N åˆ†é’Ÿå†…ä¸å†™å…¥æ•°æ®æ—¶å°±å›žæ”¶ç¼“å­˜ï¼ˆå½“é€šè¿‡ Key èŽ·å–ä¸åˆ°ç¼“å­˜æ—¶ï¼Œé»˜è®¤è¿”å›ž 0ï¼‰ã€‚ ç„¶åŽåœ¨æ¯æ¬¡æ¶ˆè´¹æ—¶å€™è°ƒç”¨ checkAlert() æ–¹æ³•è¿›è¡Œæ ¡éªŒï¼Œè¿™æ ·å°±å¯ä»¥è¾¾åˆ°ä¸Šæ–‡çš„éœ€æ±‚ã€‚ æˆ‘ä»¬æ¥è®¾æƒ³ä¸‹ Guava å®ƒæ˜¯å¦‚ä½•å®žçŽ°è¿‡æœŸè‡ªåŠ¨æ¸…é™¤æ•°æ®ï¼Œå¹¶ä¸”æ˜¯å¯ä»¥æŒ‰ç…§ LRU è¿™æ ·çš„æ–¹å¼æ¸…é™¤çš„ã€‚ å¤§èƒ†å‡è®¾ä¸‹ï¼š å†…éƒ¨é€šè¿‡ä¸€ä¸ªé˜Ÿåˆ—æ¥ç»´æŠ¤ç¼“å­˜çš„é¡ºåºï¼Œæ¯æ¬¡è®¿é—®è¿‡çš„æ•°æ®ç§»åŠ¨åˆ°é˜Ÿåˆ—å¤´éƒ¨ï¼Œå¹¶ä¸”é¢å¤–å¼€å¯ä¸€ä¸ªçº¿ç¨‹æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸå°±åˆ æŽ‰ã€‚æœ‰ç‚¹ç±»ä¼¼äºŽæˆ‘ä¹‹å‰å†™è¿‡çš„ åŠ¨æ‰‹å®žçŽ°ä¸€ä¸ª LRU cache èƒ¡é€‚è¯´è¿‡ï¼šå¤§èƒ†å‡è®¾å°å¿ƒè®ºè¯ ä¸‹é¢æ¥çœ‹çœ‹ Guava åˆ°åº•æ˜¯æ€Žä¹ˆå®žçŽ°ã€‚ åŽŸç†åˆ†æžçœ‹åŽŸç†æœ€å¥½ä¸è¿‡æ˜¯è·Ÿä»£ç ä¸€æ­¥æ­¥èµ°äº†ï¼š ç¤ºä¾‹ä»£ç åœ¨è¿™é‡Œï¼š https://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/guava/CacheLoaderTest.java ä¸ºäº†èƒ½çœ‹å‡º Guava æ˜¯æ€Žä¹ˆåˆ é™¤è¿‡æœŸæ•°æ®çš„åœ¨èŽ·å–ç¼“å­˜ä¹‹å‰ä¼‘çœ äº† 5 ç§’é’Ÿï¼Œè¾¾åˆ°äº†è¶…æ—¶æ¡ä»¶ã€‚ æœ€ç»ˆä¼šå‘çŽ°åœ¨ com.google.common.cache.LocalCache ç±»çš„ 2187 è¡Œæ¯”è¾ƒå…³é”®ã€‚ å†è·Ÿè¿›åŽ»ä¹‹å‰ç¬¬ 2182 è¡Œä¼šå‘çŽ°å…ˆè¦åˆ¤æ–­ count æ˜¯å¦å¤§äºŽ 0ï¼Œè¿™ä¸ª count ä¿å­˜çš„æ˜¯å½“å‰ç¼“å­˜çš„æ•°é‡ï¼Œå¹¶ç”¨ volatile ä¿®é¥°ä¿è¯äº†å¯è§æ€§ã€‚ æ›´å¤šå…³äºŽ volatile çš„ç›¸å…³ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ ä½ åº”è¯¥çŸ¥é“çš„ volatile å…³é”®å­— æŽ¥ç€å¾€ä¸‹è·Ÿåˆ°ï¼š 2761 è¡Œï¼Œæ ¹æ®æ–¹æ³•åç§°å¯ä»¥çœ‹å‡ºæ˜¯åˆ¤æ–­å½“å‰çš„ Entry æ˜¯å¦è¿‡æœŸï¼Œè¯¥ entry å°±æ˜¯é€šè¿‡ key æŸ¥è¯¢åˆ°çš„ã€‚ è¿™é‡Œå°±å¾ˆæ˜Žæ˜¾çš„çœ‹å‡ºæ˜¯æ ¹æ®æ ¹æ®æž„å»ºæ—¶æŒ‡å®šçš„è¿‡æœŸæ–¹å¼æ¥åˆ¤æ–­å½“å‰ key æ˜¯å¦è¿‡æœŸäº†ã€‚ å¦‚æžœè¿‡æœŸå°±å¾€ä¸‹èµ°ï¼Œå°è¯•è¿›è¡Œè¿‡æœŸåˆ é™¤ï¼ˆéœ€è¦åŠ é”ï¼ŒåŽé¢ä¼šå…·ä½“è®¨è®ºï¼‰ã€‚ åˆ°äº†è¿™é‡Œä¹Ÿå¾ˆæ¸…æ™°äº†ï¼š èŽ·å–å½“å‰ç¼“å­˜çš„æ€»æ•°é‡ è‡ªå‡ä¸€ï¼ˆå‰é¢èŽ·å–äº†é”ï¼Œæ‰€ä»¥çº¿ç¨‹å®‰å…¨ï¼‰ åˆ é™¤å¹¶å°†æ›´æ–°çš„æ€»æ•°èµ‹å€¼åˆ° countã€‚ å…¶å®žå¤§ä½“ä¸Šå°±æ˜¯è¿™ä¸ªæµç¨‹ï¼ŒGuava å¹¶æ²¡æœ‰æŒ‰ç…§ä¹‹å‰çŒœæƒ³çš„å¦èµ·ä¸€ä¸ªçº¿ç¨‹æ¥ç»´æŠ¤è¿‡æœŸæ•°æ®ã€‚ åº”è¯¥æ˜¯ä»¥ä¸‹åŽŸå› ï¼š æ–°èµ·çº¿ç¨‹éœ€è¦èµ„æºæ¶ˆè€—ã€‚ ç»´æŠ¤è¿‡æœŸæ•°æ®è¿˜è¦èŽ·å–é¢å¤–çš„é”ï¼Œå¢žåŠ äº†æ¶ˆè€—ã€‚ è€Œåœ¨æŸ¥è¯¢æ—¶å€™é¡ºå¸¦åšäº†è¿™äº›äº‹æƒ…ï¼Œä½†æ˜¯å¦‚æžœè¯¥ç¼“å­˜è¿Ÿè¿Ÿæ²¡æœ‰è®¿é—®ä¹Ÿä¼šå­˜åœ¨æ•°æ®ä¸èƒ½è¢«å›žæ”¶çš„æƒ…å†µï¼Œä¸è¿‡è¿™å¯¹äºŽä¸€ä¸ªé«˜åžåçš„åº”ç”¨æ¥è¯´ä¹Ÿä¸æ˜¯é—®é¢˜ã€‚ æ€»ç»“æœ€åŽå†æ¥æ€»ç»“ä¸‹ Guava çš„ Cacheã€‚ å…¶å®žåœ¨ä¸Šæ–‡è·Ÿä»£ç æ—¶ä¼šå‘çŽ°é€šè¿‡ä¸€ä¸ª key å®šä½æ•°æ®æ—¶æœ‰ä»¥ä¸‹ä»£ç ï¼š å¦‚æžœæœ‰çœ‹è¿‡ ConcurrentHashMap çš„åŽŸç† åº”è¯¥ä¼šæƒ³åˆ°è¿™å…¶å®žéžå¸¸ç±»ä¼¼ã€‚ å…¶å®ž Guava Cache ä¸ºäº†æ»¡è¶³å¹¶å‘åœºæ™¯çš„ä½¿ç”¨ï¼Œæ ¸å¿ƒçš„æ•°æ®ç»“æž„å°±æ˜¯æŒ‰ç…§ ConcurrentHashMap æ¥çš„ï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ª key å®šä½åˆ°ä¸€ä¸ªå…·ä½“ä½ç½®çš„è¿‡ç¨‹ã€‚ å…ˆæ‰¾åˆ° Segmentï¼Œå†æ‰¾å…·ä½“çš„ä½ç½®ï¼Œç­‰äºŽæ˜¯åšäº†ä¸¤æ¬¡ Hash å®šä½ã€‚ ä¸Šæ–‡æœ‰ä¸€ä¸ªå‡è®¾æ˜¯å¯¹çš„ï¼Œå®ƒå†…éƒ¨ä¼šç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ— accessQueue,writeQueue ç”¨äºŽè®°å½•ç¼“å­˜é¡ºåºï¼Œè¿™æ ·æ‰å¯ä»¥æŒ‰ç…§é¡ºåºæ·˜æ±°æ•°æ®ï¼ˆç±»ä¼¼äºŽåˆ©ç”¨ LinkedHashMap æ¥åš LRU ç¼“å­˜ï¼‰ã€‚ åŒæ—¶ä»Žä¸Šæ–‡çš„æž„å»ºæ–¹å¼æ¥çœ‹ï¼Œå®ƒä¹Ÿæ˜¯æž„å»ºè€…æ¨¡å¼æ¥åˆ›å»ºå¯¹è±¡çš„ã€‚ å› ä¸ºä½œä¸ºä¸€ä¸ªç»™å¼€å‘è€…ä½¿ç”¨çš„å·¥å…·ï¼Œéœ€è¦æœ‰å¾ˆå¤šçš„è‡ªå®šä¹‰å±žæ€§ï¼Œåˆ©ç”¨æž„å»ºåˆ™æ¨¡å¼å†åˆé€‚ä¸è¿‡äº†ã€‚ Guava å…¶å®žè¿˜æœ‰å¾ˆå¤šä¸œè¥¿æ²¡è°ˆåˆ°ï¼Œæ¯”å¦‚å®ƒåˆ©ç”¨ GC æ¥å›žæ”¶å†…å­˜ï¼Œç§»é™¤æ•°æ®æ—¶çš„å›žè°ƒé€šçŸ¥ç­‰ã€‚ä¹‹åŽå†æŽ¥ç€è®¨è®ºã€‚ æ‰«ç å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼Œç¬¬ä¸€æ—¶é—´èŽ·å–æ¶ˆæ¯ã€‚]]></content>
      <categories>
        <category>Guava</category>
      </categories>
      <tags>
        <tag>Cache</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å·¥å…·çš„ä¸€æ¬¡å°å‡çº§â«]]></title>
    <url>%2F2018%2F06%2F07%2Fdistributed-lock%2Fdistributed-lock-redis-update%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰åœ¨åš ç§’æ€æž¶æž„å®žè·µ æ—¶æœ‰æåˆ°å¯¹ distributed-redis-tool çš„ä¸€æ¬¡å°å‡çº§ï¼Œä½†æ˜¯æ²¡æœ‰ç»†è¯´ã€‚ å…¶å®žä¸»è¦åŽŸå› æ˜¯ï¼š ç§’æ€æ—¶æˆ‘åšåŽ‹æµ‹ï¼šç”±äºŽé›†æˆäº†è¿™ä¸ªé™æµç»„ä»¶ï¼Œå¹¶å‘åˆæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥å¯¼è‡´è¿žæŽ¥ã€æ–­å¼€ Redis éžå¸¸é¢‘ç¹ã€‚æœ€ç»ˆå¯¼è‡´èŽ·å–ä¸äº† Redis connection çš„å¼‚å¸¸ã€‚ æ± åŒ–æŠ€æœ¯è¿™å°±æ˜¯ä¸€ä¸ªå…¸åž‹çš„å¯¹ç¨€ç¼ºèµ„æºä½¿ç”¨ä¸å–„å¯¼è‡´çš„ã€‚ ä½•ä¸ºç¨€ç¼ºèµ„æºï¼Ÿå¸¸è§çš„æœ‰ï¼š çº¿ç¨‹ æ•°æ®åº“è¿žæŽ¥ ç½‘ç»œè¿žæŽ¥ç­‰ è¿™äº›èµ„æºéƒ½æœ‰å…±åŒçš„ç‰¹ç‚¹ï¼šåˆ›å»ºé”€æ¯æˆæœ¬è¾ƒé«˜ã€‚ è¿™é‡Œæ¶‰åŠåˆ°çš„ Redis è¿žæŽ¥ä¹Ÿå±žäºŽè¯¥ç±»èµ„æºã€‚ æˆ‘ä»¬å¸Œæœ›å°†è¿™äº›ç¨€æœ‰èµ„æºç®¡ç†èµ·æ¥æ”¾åˆ°ä¸€ä¸ªæ± å­é‡Œï¼Œå½“éœ€è¦æ—¶å°±ä»Žä¸­èŽ·å–ï¼Œç”¨å®Œå°±æ”¾å›žåŽ»ï¼Œä¸å¤Ÿç”¨æ—¶å°±ç­‰å¾…ï¼ˆæˆ–è¿”å›žï¼‰ã€‚ è¿™æ ·æˆ‘ä»¬åªéœ€è¦åˆå§‹åŒ–å¹¶ç»´æŠ¤å¥½è¿™ä¸ªæ± å­ï¼Œå°±èƒ½é¿å…é¢‘ç¹çš„åˆ›å»ºã€é”€æ¯è¿™äº›èµ„æºï¼ˆä¹Ÿæœ‰èµ„æºé•¿æœŸæœªä½¿ç”¨éœ€è¦ç¼©å®¹çš„æƒ…å†µï¼‰ã€‚ é€šå¸¸æˆ‘ä»¬ç§°è¿™é¡¹å§¿åŠ¿ä¸ºæ± åŒ–æŠ€æœ¯ï¼Œå¦‚å¸¸è§çš„ï¼š çº¿ç¨‹æ±  å„ç§èµ„æºçš„è¿žæŽ¥æ± ç­‰ã€‚ ä¸ºæ­¤æˆ‘å°†ä½¿ç”¨åˆ° Redis çš„ åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é™æµ éƒ½å‡çº§ä¸ºåˆ©ç”¨è¿žæŽ¥æ± æ¥èŽ·å– Redis çš„è¿žæŽ¥ã€‚ è¿™é‡Œä»¥åˆ†å¸ƒå¼é”ä¸ºä¾‹ï¼š å°†ä½¿ç”¨çš„ api ä¿®æ”¹ä¸ºï¼š åŽŸæœ‰ï¼š 123456789101112131415161718@Configurationpublic class RedisLockConfig &#123; @Bean public RedisLock build()&#123; //Need to get Redis connection RedisLock redisLock = new RedisLock() ; HostAndPort hostAndPort = new HostAndPort("127.0.0.1",7000) ; JedisCluster jedisCluster = new JedisCluster(hostAndPort) ; RedisLock redisLock = new RedisLock.Builder(jedisCluster) .lockPrefix("lock_test") .sleepTime(100) .build(); return redisLock ; &#125;&#125; çŽ°åœ¨ï¼š123456789101112131415161718@Configurationpublic class RedisLockConfig &#123; private Logger logger = LoggerFactory.getLogger(RedisLockConfig.class); @Autowired private JedisConnectionFactory jedisConnectionFactory; @Bean public RedisLock build() &#123; RedisLock redisLock = new RedisLock.Builder(jedisConnectionFactory,RedisToolsConstant.SINGLE) .lockPrefix("lock_") .sleepTime(100) .build(); return redisLock; &#125;&#125; å°†ä»¥å‰çš„ Jedis ä¿®æ”¹ä¸º JedisConnectionFactoryï¼ŒåŽç»­çš„ Redis è¿žæŽ¥å°±å¯é€šè¿‡è¿™ä¸ªå¯¹è±¡èŽ·å–ã€‚ å¹¶ä¸”æ˜¾ç¤ºçš„ä¼ å…¥ä½¿ç”¨ RedisCluster è¿˜æ˜¯å•æœºçš„ Redisã€‚ æ‰€ä»¥åœ¨çœŸæ­£æ“ä½œ Redis æ—¶éœ€è¦ä¿®æ”¹ï¼š 1234567891011121314151617181920212223242526272829303132333435public boolean tryLock(String key, String request) &#123; //get connection Object connection = getConnection(); String result ; if (connection instanceof Jedis)&#123; result = ((Jedis) connection).set(lockPrefix + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); ((Jedis) connection).close(); &#125;else &#123; result = ((JedisCluster) connection).set(lockPrefix + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); try &#123; ((JedisCluster) connection).close(); &#125; catch (IOException e) &#123; logger.error("IOException",e); &#125; &#125; if (LOCK_MSG.equals(result)) &#123; return true; &#125; else &#123; return false; &#125;&#125;//èŽ·å–è¿žæŽ¥private Object getConnection() &#123; Object connection ; if (type == RedisToolsConstant.SINGLE)&#123; RedisConnection redisConnection = jedisConnectionFactory.getConnection(); connection = redisConnection.getNativeConnection(); &#125;else &#123; RedisClusterConnection clusterConnection = jedisConnectionFactory.getClusterConnection(); connection = clusterConnection.getNativeConnection() ; &#125; return connection;&#125; æœ€å¤§çš„æ”¹å˜å°±æ˜¯å°†åŽŸæœ‰æ“ä½œ Redis çš„å¯¹è±¡ï¼ˆT extends JedisCommandsï¼‰æ”¹ä¸ºä»Žè¿žæŽ¥æ± ä¸­èŽ·å–ã€‚ ç”±äºŽä½¿ç”¨äº† org.springframework.data.redis.connection.jedis.JedisConnectionFactory ä½œä¸º Redis è¿žæŽ¥æ± ã€‚ æ‰€ä»¥éœ€è¦å†ä½¿ç”¨æ—¶æž„ä»¶å¥½è¿™ä¸ªå¯¹è±¡ï¼š 1234567891011121314151617181920212223242526272829JedisPoolConfig config = new JedisPoolConfig();config.setMaxIdle(10);config.setMaxTotal(300);config.setMaxWaitMillis(10000);config.setTestOnBorrow(true);config.setTestOnReturn(true);RedisClusterConfiguration redisClusterConfiguration = new RedisClusterConfiguration();redisClusterConfiguration.addClusterNode(new RedisNode("10.19.13.51", 7000));//å•æœºJedisConnectionFactory jedisConnectionFactory = new JedisConnectionFactory(config);//é›†ç¾¤//JedisConnectionFactory jedisConnectionFactory = new JedisConnectionFactory(redisClusterConfiguration) ;jedisConnectionFactory.setHostName("47.98.194.60");jedisConnectionFactory.setPort(6379);jedisConnectionFactory.setPassword("");jedisConnectionFactory.setTimeout(100000);jedisConnectionFactory.afterPropertiesSet();//jedisConnectionFactory.setShardInfo(new JedisShardInfo("47.98.194.60", 6379));//JedisCluster jedisCluster = new JedisCluster(hostAndPort);HostAndPort hostAndPort = new HostAndPort("10.19.13.51", 7000);JedisCluster jedisCluster = new JedisCluster(hostAndPort);redisLock = new RedisLock.Builder(jedisConnectionFactory, RedisToolsConstant.SINGLE) .lockPrefix("lock_") .sleepTime(100) .build(); çœ‹èµ·æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦æž„å»ºå¯¹è±¡çš„è¾ƒå¤šã€‚ ä½†æ•´åˆ Spring ä½¿ç”¨æ—¶å°±è¦æ¸…æ™°è®¸å¤šã€‚ é…åˆ SpringSpring å¾ˆå¤§çš„ä¸€ä¸ªä½œç”¨å°±æ˜¯å¸®æˆ‘ä»¬ç®¡ç†å¯¹è±¡ï¼Œæ‰€ä»¥åƒä¸Šæ–‡é‚£äº›çœ‹ä¼¼å¾ˆå¤æ‚çš„å¯¹è±¡éƒ½å¯ä»¥äº¤ç”±å®ƒæ¥ç®¡ç†ï¼š 12345678910111213141516171819202122232425&lt;!-- jedis é…ç½® --&gt; &lt;bean id="JedispoolConfig" class="redis.clients.jedis.JedisPoolConfig"&gt; &lt;property name="maxIdle" value="$&#123;redis.maxIdle&#125;"/&gt; &lt;property name="maxTotal" value="$&#123;redis.maxTotal&#125;"/&gt; &lt;property name="maxWaitMillis" value="$&#123;redis.maxWait&#125;"/&gt; &lt;property name="testOnBorrow" value="$&#123;redis.testOnBorrow&#125;"/&gt; &lt;property name="testOnReturn" value="$&#123;redis.testOnBorrow&#125;"/&gt; &lt;/bean&gt; &lt;!-- redisæœåŠ¡å™¨ä¸­å¿ƒ --&gt; &lt;bean id="connectionFactory" class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory"&gt; &lt;property name="poolConfig" ref="JedispoolConfig"/&gt; &lt;property name="port" value="$&#123;redis.port&#125;"/&gt; &lt;property name="hostName" value="$&#123;redis.host&#125;"/&gt; &lt;property name="password" value="$&#123;redis.password&#125;"/&gt; &lt;property name="timeout" value="$&#123;redis.timeout&#125;"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;bean id="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate"&gt; &lt;property name="connectionFactory" ref="connectionFactory"/&gt; &lt;property name="keySerializer"&gt; &lt;bean class="org.springframework.data.redis.serializer.StringRedisSerializer"/&gt; &lt;/property&gt; &lt;property name="valueSerializer"&gt; &lt;bean class="org.springframework.data.redis.serializer.StringRedisSerializer"/&gt; &lt;/property&gt; &lt;/bean&gt; è¿™ä¸ªå…¶å®žæ²¡å¤šå°‘å¥½è¯´çš„ï¼Œå°±ç®—æ˜¯æ¢æˆ SpringBoot ä¹Ÿæ˜¯åˆ›å»º JedispoolConfig,connectionFactory,redisTemplate è¿™äº› bean å³å¯ã€‚ æ€»ç»“æ¢ä¸ºè¿žæŽ¥æ± ä¹‹åŽå†è¿›è¡ŒåŽ‹æµ‹è‡ªç„¶æ²¡æœ‰å‡ºçŽ°èŽ·å–ä¸äº† Redis è¿žæŽ¥çš„å¼‚å¸¸ï¼ˆå¹¶å‘è¾¾åˆ°ä¸€å®šçš„é‡ä¹Ÿä¼šå‡ºé”™ï¼‰è¯´æ˜Žæ›´æ–°æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ æŽ¨èæœ‰ç”¨åˆ°è¯¥ç»„ä»¶çš„æœ‹å‹éƒ½å‡çº§ä¸‹ï¼Œä¹Ÿæ¬¢è¿Žæå‡º Issues å’Œ PRã€‚ é¡¹ç›®åœ°å€ï¼š https://github.com/crossoverJie/distributed-redis-tool]]></content>
      <categories>
        <category>Distributed Tools</category>
      </categories>
      <tags>
        <tag>Distributed Lock</tag>
        <tag>Distributed Limited</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®°äºŽ 2018 å¹´é«˜è€ƒï¼]]></title>
    <url>%2F2018%2F06%2F06%2Fexam%2F2018-06-07-The-university-entrance-exam%2F</url>
    <content type="text"><![CDATA[2012/02/28 2012å¹´äºŒæœˆäºŒåå…«æ—¥ã€‚ è¿™å¤©å­¦æ ¡ä¸¾è¡Œäº†é«˜è€ƒ 100 å¤©èª“å¸ˆå¤§ä¼šï¼Œå½“æ—¶å®Œå…¨ä¸çŸ¥é“æ„å‘³ç€ä»€ä¹ˆï¼Œåªæ„Ÿè§‰çŽ°åœºçƒ­è¡€æ²¸è…¾ã€æ¿€æƒ…é«˜æ¶¨ï¼Œå¿ƒé‡Œå‘Šè¯‰è‡ªå·±å°±ç®—åªå‰©ä¸‹ 100 å¤©æˆ‘ä¹Ÿèƒ½è€ƒä¸Šæ¸…åŽå…¶æ¬¡ä¹Ÿæ˜¯åŒ—å¤§ã€‚ 2012/06/03 2012å¹´å…­æœˆä¸‰æ—¥ã€‚ æ™šè‡ªä¹ æ‹¿å‡ºå‰æ®µæ—¶é—´åˆšæ‹çš„æ¯•ä¸šåˆç…§ï¼Œæ¨æ­»æ‘„å½±å¸ˆï¼Œæ²¡æœ‰æŠ“æ‹åˆ°æˆ‘æœ€å¸…çš„è§’åº¦ðŸ˜¡ã€‚ 2012/06/04 2012å¹´å…­æœˆå››æ—¥ã€‚ ç¦»æ ¡å‰çš„æœ€åŽä¸€æ™šï¼Œæˆ‘ä»¬åƒå¾€å¸¸æ¯å‘¨çš„éŸ³ä¹æ™šè‡ªä¹ ä¸€æ ·ï¼Œç”±éŸ³ä¹å§”å‘˜ï¼ˆ@çŒªå¨…ï¼‰å¸¦ç€å¤§å®¶å”±å¯ç±³å°å­çš„é’æ˜¥çºªå¿µå†Œã€‚ å°çº¢å§ï¼ˆç­ä¸»ä»»ï¼‰ç‰¹åˆ«çš„æ²¡æ¥æŸ¥å²—ã€‚ å¿ƒé‡Œæƒ³ç€ï¼Œè¿™å°±æ˜¯é’æ˜¥å˜›ï¼Ÿä¹Ÿä¸è¿‡å¦‚æ­¤ã€‚ å¤§å®¶æ‹¿ç€çƒ­å’Œçš„æ‰‹æœºï¼ˆæ‰å‘çš„ï¼Œå¹³æ—¶ä¼šæ”¶ï¼‰è‚†æ„çš„æ‹ç€ç…§ç‰‡ï¼š é‚£æ—¶æ²¡æœ‰ç¾Žé¢œã€æ²¡æœ‰ä¿®å›¾ï¼Œä¸€åˆ‡éƒ½æ˜¯é‚£ä¹ˆå’Œè°ã€‚ 2012/06/05 2012å¹´å…­æœˆäº”æ—¥ã€‚ æ˜¯è¿›æ´¥ï¼ˆæ±Ÿæ´¥ï¼‰èµ¶è€ƒï¼Œèµ°æ—¶ç‰¹åœ°åœ¨å…­é£Ÿå ‚ä¹°äº†ä¸€ä¸ªåŒ…å­ï¼Œæ²¡æƒ³åˆ°æ˜¯åœ¨å­¦æ ¡æœ€åŽä¸€é¡¿æ—©é¤ã€‚ è½¦ä¸Šå¤§å®¶æœ‰è¯´æœ‰ç¬‘ï¼Œå—¯ï¼Œå°±åƒæ˜¯èµ„æ·±å¯¼æ¸¸å¸¦çš„ä¸€ä¸ªä½Žä»·æ—…æ¸¸å›¢ï¼Œæ¯äººå¿ƒé‡Œå……æ»¡äº†æƒŠå–œå´ä¸çŸ¥å³å°†é¢ä¸´ä»€ä¹ˆã€‚ 2012/06/07 2012å¹´å…­æœˆä¸ƒæ—¥ã€‚ å¤§å®¶åœ¨å„è‡ªçš„è€ƒåœºå¥‹ç¬”ç–¾ä¹¦ï¼Œç”¨ä¸¤å¤©å››åœºè€ƒè¯•æ¥ä¸ºé«˜ä¸­ä¸‰å¹´ç”»ä¸Šå¥å·ã€‚ æœ‰çš„æ¢¦æƒ³è¿›å…¥ç†æƒ³çš„å¤§å­¦ã€å’Œå¿ƒä»ªçš„ TA é•¿ç›¸åŽ®å®ˆï¼Œå½“ç„¶ä¹Ÿæœ‰å›žå®¶ç»§æ‰¿ç™¾ä¸‡å®¶äº§ðŸ˜‚ã€‚ è€Œæˆ‘å½“æ—¶åªæƒ³å¿«é€Ÿçš„ç»“æŸè¿™ä¸€åˆ‡ï¼Œé«˜ä¸­ä¸‰å¹´ï¼Œç‰¹åˆ«æ˜¯é«˜ä¸‰è¿™å¹´çœŸçš„æ˜¯å¤Ÿäº†ã€‚æ¯å¤©åšä¸å®Œçš„å·å­ï¼ŒèƒŒä¸å®Œçš„è¯—è¯ï¼Œè¿˜å¾—æƒ³ç€ä¸ºé™ˆå®¶è€ç¥–å®—å‡ºä¸€ä½æ­£å„¿å…«ç»çš„å¤§å­¦ç”Ÿã€‚ æ‰€ä»¥è€ƒè¯•å®Œå…¨é‡‡ç”¨äººå·åˆä¸€çš„å¿ƒæ€ï¼ˆèƒ½åšå°±åšï¼Œä¸ä¼šå°±è¿‡ï¼‰å¿«é€Ÿçš„è¿‡å®Œäº†è¿™ä¸¤å¤©ã€‚ è¿™äº›ä½œæ–‡é¢˜ç›®è¿˜çœ‹å¾—æ‡‚å˜›ã€‚ã€‚ 2018/06/07 2018å¹´å…­æœˆä¸ƒæ—¥ã€‚ é«˜ä¸­å­¦è¿‡è®¸å¤šå…³äºŽæ—¶å…‰é£žé€çš„æˆè¯­ã€å¤è¯—ï¼Œä½†éƒ½æ²¡æœ‰äº²èº«ä½“ä¼šé‚£ä¹ˆæ·±åˆ»ï¼ å…­å¹´æ—¶é—´ï¼Œçº¢äº†æ¨±æ¡ƒï¼Œç»¿äº†èŠ­è•‰ã€‚ æœ‰çš„æ­¥å…¥èŒåœºã€å‡èŒåŠ è–ªã€æ±‚å©šæˆåŠŸã€ç©¿ä¸Šå©šçº±ã€ç»„å»ºå®¶åº­ã€åˆä¸ºäººæ¯ã€‚ æ¯äººéƒ½è¿‡ç€å„è‡ªçš„ç”Ÿæ´»ï¼Œä½†ä¸€æ—¦ç›¸è§å°±æœ‰æ•°ä¸å°½çš„è¯é¢˜ï¼ˆ@æ±Ÿæºï¼‰ï¼Œé€ƒè¯¾æ‰“çƒã€ç¿»å¢™ä¸Šç½‘ã€æš—æ‹å¥³ç¥žã€å¤©å¤©å‘ä¸Šã€ä½œä¸šå·å­ã€‚ è¿™å¥è¯é€ç»™é«˜2012çº§10ç­çš„æ‰€æœ‰åŒå­¦ï¼š æ„¿ä½ å‡ºèµ°åŠç”Ÿï¼Œå½’æ¥ä»æ˜¯å°‘å¹´ ä¸€å¤§æ³¢å›¾ç‰‡å³å°†è¢­æ¥ï¼š æ‘†æ‹è™½å¥½ï¼Œä¸è¦æŠ½çƒŸå“¦ï¼š å°çº¢å§ç”Ÿæ—¥å¿«ä¹ï¼Œæ°¸è¿œåå…«ï¼š é›†ä½“ç”Ÿæ—¥ï¼Œå¹´å¹´åå…«ï¼š çŠ¶å…ƒä¹¦æ‘Šï¼Œä¸æ˜¯ç¬¬ä¸€ä¸å–ï¼š]]></content>
      <categories>
        <category>å°æƒ…ç»ª</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Netty(ä¸€) SpringBoot æ•´åˆé•¿è¿žæŽ¥å¿ƒè·³æœºåˆ¶]]></title>
    <url>%2F2018%2F05%2F24%2Fnetty%2FNetty(1)TCP-Heartbeat%2F</url>
    <content type="text"><![CDATA[å‰è¨€Netty æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ NIO ç½‘ç»œæ¡†æž¶ï¼Œæœ¬æ–‡åŸºäºŽ SpringBoot ä»¥å¸¸è§çš„å¿ƒè·³æœºåˆ¶æ¥è®¤è¯† Nettyã€‚ æœ€ç»ˆèƒ½è¾¾åˆ°çš„æ•ˆæžœï¼š å®¢æˆ·ç«¯æ¯éš” N ç§’æ£€æµ‹æ˜¯å¦éœ€è¦å‘é€å¿ƒè·³ã€‚ æœåŠ¡ç«¯ä¹Ÿæ¯éš” N ç§’æ£€æµ‹æ˜¯å¦éœ€è¦å‘é€å¿ƒè·³ã€‚ æœåŠ¡ç«¯å¯ä»¥ä¸»åŠ¨ push æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯ã€‚ åŸºäºŽ SpringBoot ç›‘æŽ§ï¼Œå¯ä»¥æŸ¥çœ‹å®žæ—¶è¿žæŽ¥ä»¥åŠå„ç§åº”ç”¨ä¿¡æ¯ã€‚ æ•ˆæžœå¦‚ä¸‹ï¼š IdleStateHandlerNetty å¯ä»¥ä½¿ç”¨ IdleStateHandler æ¥å®žçŽ°è¿žæŽ¥ç®¡ç†ï¼Œå½“è¿žæŽ¥ç©ºé—²æ—¶é—´å¤ªé•¿ï¼ˆæ²¡æœ‰å‘é€ã€æŽ¥æ”¶æ¶ˆæ¯ï¼‰æ—¶åˆ™ä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬ä¾¿å¯åœ¨è¯¥äº‹ä»¶ä¸­å®žçŽ°å¿ƒè·³æœºåˆ¶ã€‚ å®¢æˆ·ç«¯å¿ƒè·³å½“å®¢æˆ·ç«¯ç©ºé—²äº† N ç§’æ²¡æœ‰ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯æ—¶ä¼šè‡ªåŠ¨å‘é€ä¸€ä¸ªå¿ƒè·³æ¥ç»´æŒè¿žæŽ¥ã€‚ æ ¸å¿ƒä»£ç ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334public class EchoClientHandle extends SimpleChannelInboundHandler&lt;ByteBuf&gt; &#123; private final static Logger LOGGER = LoggerFactory.getLogger(EchoClientHandle.class); @Override public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception &#123; if (evt instanceof IdleStateEvent)&#123; IdleStateEvent idleStateEvent = (IdleStateEvent) evt ; if (idleStateEvent.state() == IdleState.WRITER_IDLE)&#123; LOGGER.info("å·²ç» 10 ç§’æ²¡æœ‰å‘é€ä¿¡æ¯ï¼"); //å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ CustomProtocol heartBeat = SpringBeanFactory.getBean("heartBeat", CustomProtocol.class); ctx.writeAndFlush(heartBeat).addListener(ChannelFutureListener.CLOSE_ON_FAILURE) ; &#125; &#125; super.userEventTriggered(ctx, evt); &#125; @Override protected void channelRead0(ChannelHandlerContext channelHandlerContext, ByteBuf in) throws Exception &#123; //ä»ŽæœåŠ¡ç«¯æ”¶åˆ°æ¶ˆæ¯æ—¶è¢«è°ƒç”¨ LOGGER.info("å®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯=&#123;&#125;",in.toString(CharsetUtil.UTF_8)) ; &#125;&#125; å®žçŽ°éžå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨äº‹ä»¶å›žè°ƒä¸­å‘é€ä¸€ä¸ªæ¶ˆæ¯å³å¯ã€‚ ç”±äºŽæ•´åˆäº† SpringBoot ï¼Œæ‰€ä»¥å‘é€çš„å¿ƒè·³ä¿¡æ¯æ˜¯ä¸€ä¸ªå•ä¾‹çš„ Beanã€‚ 123456789101112@Configurationpublic class HeartBeatConfig &#123; @Value("$&#123;channel.id&#125;") private long id ; @Bean(value = "heartBeat") public CustomProtocol heartBeat()&#123; return new CustomProtocol(id,"ping") ; &#125;&#125; è¿™é‡Œæ¶‰åŠåˆ°äº†è‡ªå®šä¹‰åè®®çš„å†…å®¹ï¼Œè¯·ç»§ç»­æŸ¥çœ‹ä¸‹æ–‡ã€‚ å½“ç„¶å°‘ä¸äº†å¯åŠ¨å¼•å¯¼ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344@Componentpublic class HeartbeatClient &#123; private final static Logger LOGGER = LoggerFactory.getLogger(HeartbeatClient.class); private EventLoopGroup group = new NioEventLoopGroup(); @Value("$&#123;netty.server.port&#125;") private int nettyPort; @Value("$&#123;netty.server.host&#125;") private String host; private SocketChannel channel; @PostConstruct public void start() throws InterruptedException &#123; Bootstrap bootstrap = new Bootstrap(); bootstrap.group(group) .channel(NioSocketChannel.class) .handler(new CustomerHandleInitializer()) ; ChannelFuture future = bootstrap.connect(host, nettyPort).sync(); if (future.isSuccess()) &#123; LOGGER.info("å¯åŠ¨ Netty æˆåŠŸ"); &#125; channel = (SocketChannel) future.channel(); &#125; &#125;public class CustomerHandleInitializer extends ChannelInitializer&lt;Channel&gt; &#123; @Override protected void initChannel(Channel ch) throws Exception &#123; ch.pipeline() //10 ç§’æ²¡å‘é€æ¶ˆæ¯ å°†IdleStateHandler æ·»åŠ åˆ° ChannelPipeline ä¸­ .addLast(new IdleStateHandler(0, 10, 0)) .addLast(new HeartbeatEncode()) .addLast(new EchoClientHandle()) ; &#125;&#125; æ‰€ä»¥å½“åº”ç”¨å¯åŠ¨æ¯éš” 10 ç§’ä¼šæ£€æµ‹æ˜¯å¦å‘é€è¿‡æ¶ˆæ¯ï¼Œä¸ç„¶å°±ä¼šå‘é€å¿ƒè·³ä¿¡æ¯ã€‚ æœåŠ¡ç«¯å¿ƒè·³æœåŠ¡å™¨ç«¯çš„å¿ƒè·³å…¶å®žä¹Ÿæ˜¯ç±»ä¼¼ï¼Œä¹Ÿéœ€è¦åœ¨ ChannelPipeline ä¸­æ·»åŠ ä¸€ä¸ª IdleStateHandler ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class HeartBeatSimpleHandle extends SimpleChannelInboundHandler&lt;CustomProtocol&gt; &#123; private final static Logger LOGGER = LoggerFactory.getLogger(HeartBeatSimpleHandle.class); private static final ByteBuf HEART_BEAT = Unpooled.unreleasableBuffer(Unpooled.copiedBuffer(new CustomProtocol(123456L,"pong").toString(),CharsetUtil.UTF_8)); /** * å–æ¶ˆç»‘å®š * @param ctx * @throws Exception */ @Override public void channelInactive(ChannelHandlerContext ctx) throws Exception &#123; NettySocketHolder.remove((NioSocketChannel) ctx.channel()); &#125; @Override public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception &#123; if (evt instanceof IdleStateEvent)&#123; IdleStateEvent idleStateEvent = (IdleStateEvent) evt ; if (idleStateEvent.state() == IdleState.READER_IDLE)&#123; LOGGER.info("å·²ç»5ç§’æ²¡æœ‰æ”¶åˆ°ä¿¡æ¯ï¼"); //å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ ctx.writeAndFlush(HEART_BEAT).addListener(ChannelFutureListener.CLOSE_ON_FAILURE) ; &#125; &#125; super.userEventTriggered(ctx, evt); &#125; @Override protected void channelRead0(ChannelHandlerContext ctx, CustomProtocol customProtocol) throws Exception &#123; LOGGER.info("æ”¶åˆ°customProtocol=&#123;&#125;", customProtocol); //ä¿å­˜å®¢æˆ·ç«¯ä¸Ž Channel ä¹‹é—´çš„å…³ç³» NettySocketHolder.put(customProtocol.getId(),(NioSocketChannel)ctx.channel()) ; &#125;&#125; è¿™é‡Œæœ‰ç‚¹éœ€è¦æ³¨æ„ï¼š å½“æœ‰å¤šä¸ªå®¢æˆ·ç«¯è¿žä¸Šæ¥æ—¶ï¼ŒæœåŠ¡ç«¯éœ€è¦åŒºåˆ†å¼€ï¼Œä¸ç„¶å“åº”æ¶ˆæ¯å°±ä¼šå‘ç”Ÿæ··ä¹±ã€‚ æ‰€ä»¥æ¯å½“æœ‰ä¸ªè¿žæŽ¥ä¸Šæ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å°†å½“å‰çš„ Channel ä¸Žè¿žä¸Šçš„å®¢æˆ·ç«¯ ID è¿›è¡Œå…³è”ï¼ˆå› æ­¤æ¯ä¸ªè¿žä¸Šçš„å®¢æˆ·ç«¯ ID éƒ½å¿…é¡»å”¯ä¸€ï¼‰ã€‚ è¿™é‡Œé‡‡ç”¨äº†ä¸€ä¸ª Map æ¥ä¿å­˜è¿™ä¸ªå…³ç³»ï¼Œå¹¶ä¸”åœ¨æ–­å¼€è¿žæŽ¥æ—¶è‡ªåŠ¨å–æ¶ˆè¿™ä¸ªå…³è”ã€‚ 12345678910111213141516171819public class NettySocketHolder &#123; private static final Map&lt;Long, NioSocketChannel&gt; MAP = new ConcurrentHashMap&lt;&gt;(16); public static void put(Long id, NioSocketChannel socketChannel) &#123; MAP.put(id, socketChannel); &#125; public static NioSocketChannel get(Long id) &#123; return MAP.get(id); &#125; public static Map&lt;Long, NioSocketChannel&gt; getMAP() &#123; return MAP; &#125; public static void remove(NioSocketChannel nioSocketChannel) &#123; MAP.entrySet().stream().filter(entry -&gt; entry.getValue() == nioSocketChannel).forEach(entry -&gt; MAP.remove(entry.getKey())); &#125;&#125; å¯åŠ¨å¼•å¯¼ç¨‹åºï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859Componentpublic class HeartBeatServer &#123; private final static Logger LOGGER = LoggerFactory.getLogger(HeartBeatServer.class); private EventLoopGroup boss = new NioEventLoopGroup(); private EventLoopGroup work = new NioEventLoopGroup(); @Value("$&#123;netty.server.port&#125;") private int nettyPort; /** * å¯åŠ¨ Netty * * @return * @throws InterruptedException */ @PostConstruct public void start() throws InterruptedException &#123; ServerBootstrap bootstrap = new ServerBootstrap() .group(boss, work) .channel(NioServerSocketChannel.class) .localAddress(new InetSocketAddress(nettyPort)) //ä¿æŒé•¿è¿žæŽ¥ .childOption(ChannelOption.SO_KEEPALIVE, true) .childHandler(new HeartbeatInitializer()); ChannelFuture future = bootstrap.bind().sync(); if (future.isSuccess()) &#123; LOGGER.info("å¯åŠ¨ Netty æˆåŠŸ"); &#125; &#125; /** * é”€æ¯ */ @PreDestroy public void destroy() &#123; boss.shutdownGracefully().syncUninterruptibly(); work.shutdownGracefully().syncUninterruptibly(); LOGGER.info("å…³é—­ Netty æˆåŠŸ"); &#125;&#125; public class HeartbeatInitializer extends ChannelInitializer&lt;Channel&gt; &#123; @Override protected void initChannel(Channel ch) throws Exception &#123; ch.pipeline() //äº”ç§’æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ å°†IdleStateHandler æ·»åŠ åˆ° ChannelPipeline ä¸­ .addLast(new IdleStateHandler(5, 0, 0)) .addLast(new HeartbeatDecoder()) .addLast(new HeartBeatSimpleHandle()); &#125;&#125; ä¹Ÿæ˜¯åŒæ ·å°†IdleStateHandler æ·»åŠ åˆ° ChannelPipeline ä¸­ï¼Œä¹Ÿä¼šæœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯5ç§’æ ¡éªŒä¸€æ¬¡æ˜¯å¦æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œå¦åˆ™å°±ä¸»åŠ¨å‘é€ä¸€æ¬¡è¯·æ±‚ã€‚ å› ä¸ºæµ‹è¯•æ˜¯æœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯è¿žä¸Šæ‰€ä»¥æœ‰ä¸¤ä¸ªæ—¥å¿—ã€‚ è‡ªå®šä¹‰åè®®ä¸Šæ–‡å…¶å®žéƒ½çœ‹åˆ°äº†ï¼šæœåŠ¡ç«¯ä¸Žå®¢æˆ·ç«¯é‡‡ç”¨çš„æ˜¯è‡ªå®šä¹‰çš„ POJO è¿›è¡Œé€šè®¯çš„ã€‚ æ‰€ä»¥éœ€è¦åœ¨å®¢æˆ·ç«¯è¿›è¡Œç¼–ç ï¼ŒæœåŠ¡ç«¯è¿›è¡Œè§£ç ï¼Œä¹Ÿéƒ½åªéœ€è¦å„è‡ªå®žçŽ°ä¸€ä¸ªç¼–è§£ç å™¨å³å¯ã€‚ CustomProtocolï¼š 1234567public class CustomProtocol implements Serializable&#123; private static final long serialVersionUID = 4671171056588401542L; private long id ; private String content ; //çœç•¥ getter/setter&#125; å®¢æˆ·ç«¯çš„ç¼–ç å™¨ï¼š 123456789public class HeartbeatEncode extends MessageToByteEncoder&lt;CustomProtocol&gt; &#123; @Override protected void encode(ChannelHandlerContext ctx, CustomProtocol msg, ByteBuf out) throws Exception &#123; out.writeLong(msg.getId()) ; out.writeBytes(msg.getContent().getBytes()) ; &#125;&#125; ä¹Ÿå°±æ˜¯è¯´æ¶ˆæ¯çš„å‰å…«ä¸ªå­—èŠ‚ä¸º headerï¼Œå‰©ä½™çš„å…¨æ˜¯ contentã€‚ æœåŠ¡ç«¯çš„è§£ç å™¨ï¼š 12345678910111213141516public class HeartbeatDecoder extends ByteToMessageDecoder &#123; @Override protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception &#123; long id = in.readLong() ; byte[] bytes = new byte[in.readableBytes()] ; in.readBytes(bytes) ; String content = new String(bytes) ; CustomProtocol customProtocol = new CustomProtocol() ; customProtocol.setId(id); customProtocol.setContent(content) ; out.add(customProtocol) ; &#125;&#125; åªéœ€è¦æŒ‰ç…§åˆšæ‰çš„è§„åˆ™è¿›è¡Œè§£ç å³å¯ã€‚ å®žçŽ°åŽŸç†å…¶å®žè”æƒ³åˆ° IdleStateHandler çš„åŠŸèƒ½ï¼Œè‡ªç„¶ä¹Ÿèƒ½æƒ³åˆ°å®ƒå®žçŽ°çš„åŽŸç†ï¼š åº”è¯¥ä¼šå­˜åœ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çš„çº¿ç¨‹åŽ»å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚ æ¥çœ‹çœ‹å®ƒçš„æºç ï¼š é¦–å…ˆæ˜¯æž„é€ å‡½æ•°: 12345678public IdleStateHandler( int readerIdleTimeSeconds, int writerIdleTimeSeconds, int allIdleTimeSeconds) &#123; this(readerIdleTimeSeconds, writerIdleTimeSeconds, allIdleTimeSeconds, TimeUnit.SECONDS);&#125; å…¶å®žå°±æ˜¯åˆå§‹åŒ–äº†å‡ ä¸ªæ•°æ®ï¼š readerIdleTimeSecondsï¼šä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ•°æ®è¯»å– writerIdleTimeSecondsï¼šä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ•°æ®å‘é€ allIdleTimeSecondsï¼šä»¥ä¸Šä¸¤ç§æ»¡è¶³å…¶ä¸­ä¸€ä¸ªå³å¯ å› ä¸º IdleStateHandler ä¹Ÿæ˜¯ä¸€ç§ ChannelHandlerï¼Œæ‰€ä»¥ä¼šåœ¨ channelActive ä¸­åˆå§‹åŒ–ä»»åŠ¡ï¼š 1234567891011121314151617181920212223242526272829303132333435@Overridepublic void channelActive(ChannelHandlerContext ctx) throws Exception &#123; // This method will be invoked only if this handler was added // before channelActive() event is fired. If a user adds this handler // after the channelActive() event, initialize() will be called by beforeAdd(). initialize(ctx); super.channelActive(ctx);&#125;private void initialize(ChannelHandlerContext ctx) &#123; // Avoid the case where destroy() is called before scheduling timeouts. // See: https://github.com/netty/netty/issues/143 switch (state) &#123; case 1: case 2: return; &#125; state = 1; initOutputChanged(ctx); lastReadTime = lastWriteTime = ticksInNanos(); if (readerIdleTimeNanos &gt; 0) &#123; readerIdleTimeout = schedule(ctx, new ReaderIdleTimeoutTask(ctx), readerIdleTimeNanos, TimeUnit.NANOSECONDS); &#125; if (writerIdleTimeNanos &gt; 0) &#123; writerIdleTimeout = schedule(ctx, new WriterIdleTimeoutTask(ctx), writerIdleTimeNanos, TimeUnit.NANOSECONDS); &#125; if (allIdleTimeNanos &gt; 0) &#123; allIdleTimeout = schedule(ctx, new AllIdleTimeoutTask(ctx), allIdleTimeNanos, TimeUnit.NANOSECONDS); &#125;&#125; ä¹Ÿå°±æ˜¯ä¼šæŒ‰ç…§æˆ‘ä»¬ç»™å®šçš„æ—¶é—´åˆå§‹åŒ–å‡ºå®šæ—¶ä»»åŠ¡ã€‚ æŽ¥ç€åœ¨ä»»åŠ¡çœŸæ­£æ‰§è¡Œæ—¶è¿›è¡Œåˆ¤æ–­ï¼š 1234567891011121314151617181920212223242526272829303132private final class ReaderIdleTimeoutTask extends AbstractIdleTask &#123; ReaderIdleTimeoutTask(ChannelHandlerContext ctx) &#123; super(ctx); &#125; @Override protected void run(ChannelHandlerContext ctx) &#123; long nextDelay = readerIdleTimeNanos; if (!reading) &#123; nextDelay -= ticksInNanos() - lastReadTime; &#125; if (nextDelay &lt;= 0) &#123; // Reader is idle - set a new timeout and notify the callback. readerIdleTimeout = schedule(ctx, this, readerIdleTimeNanos, TimeUnit.NANOSECONDS); boolean first = firstReaderIdleEvent; firstReaderIdleEvent = false; try &#123; IdleStateEvent event = newIdleStateEvent(IdleState.READER_IDLE, first); channelIdle(ctx, event); &#125; catch (Throwable t) &#123; ctx.fireExceptionCaught(t); &#125; &#125; else &#123; // Read occurred before the timeout - set a new timeout with shorter delay. readerIdleTimeout = schedule(ctx, this, nextDelay, TimeUnit.NANOSECONDS); &#125; &#125;&#125; å¦‚æžœæ»¡è¶³æ¡ä»¶åˆ™ä¼šç”Ÿæˆä¸€ä¸ª IdleStateEvent äº‹ä»¶ã€‚ SpringBoot ç›‘æŽ§ç”±äºŽæ•´åˆäº† SpringBoot ä¹‹åŽä¸ä½†å¯ä»¥åˆ©ç”¨ Spring å¸®æˆ‘ä»¬ç®¡ç†å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å®ƒæ¥åšåº”ç”¨ç›‘æŽ§ã€‚ actuator ç›‘æŽ§å½“æˆ‘ä»¬ä¸ºå¼•å…¥äº†: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; å°±å¼€å¯äº† SpringBoot çš„ actuator ç›‘æŽ§åŠŸèƒ½ï¼Œä»–å¯ä»¥æš´éœ²å‡ºå¾ˆå¤šç›‘æŽ§ç«¯ç‚¹ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚ å¦‚ä¸€äº›åº”ç”¨ä¸­çš„ä¸€äº›ç»Ÿè®¡æ•°æ®ï¼š å­˜åœ¨çš„ Beansï¼š æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ï¼šhttps://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html ä½†æ˜¯å¦‚æžœæˆ‘æƒ³ç›‘æŽ§çŽ°åœ¨æˆ‘çš„æœåŠ¡ç«¯æœ‰å¤šå°‘å®¢æˆ·ç«¯è¿žä¸Šæ¥äº†ï¼Œåˆ†åˆ«çš„ ID æ˜¯å¤šå°‘ï¼Ÿ å…¶å®žå°±æ˜¯å®žæ—¶æŸ¥çœ‹æˆ‘å†…éƒ¨å®šä¹‰çš„é‚£ä¸ªå…³è”å…³ç³»çš„ Mapã€‚ è¿™å°±éœ€è¦æš´éœ²è‡ªå®šä¹‰ç«¯ç‚¹äº†ã€‚ è‡ªå®šä¹‰ç«¯ç‚¹æš´éœ²çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼š ç»§æ‰¿ AbstractEndpoint å¹¶å¤å†™å…¶ä¸­çš„ invoke å‡½æ•°ï¼š 1234567891011121314151617public class CustomEndpoint extends AbstractEndpoint&lt;Map&lt;Long,NioSocketChannel&gt;&gt; &#123; /** * ç›‘æŽ§ç«¯ç‚¹çš„ è®¿é—®åœ°å€ * @param id */ public CustomEndpoint(String id) &#123; //false è¡¨ç¤ºä¸æ˜¯æ•æ„Ÿç«¯ç‚¹ super(id, false); &#125; @Override public Map&lt;Long, NioSocketChannel&gt; invoke() &#123; return NettySocketHolder.getMAP(); &#125;&#125; å…¶å®žå°±æ˜¯è¿”å›žäº† Map ä¸­çš„æ•°æ®ã€‚ å†é…ç½®ä¸€ä¸ªè¯¥ç±»åž‹çš„ Bean å³å¯ï¼š 12345678910111213@Configurationpublic class EndPointConfig &#123; @Value("$&#123;monitor.channel.map.key&#125;") private String channelMap; @Bean public CustomEndpoint buildEndPoint()&#123; CustomEndpoint customEndpoint = new CustomEndpoint(channelMap) ; return customEndpoint ; &#125;&#125; è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ monitor.channel.map.key æ¥è®¿é—®äº†ï¼š ä¸€ä¸ªå®¢æˆ·ç«¯è¿žæŽ¥æ—¶ï¼š ä¸¤ä¸ªå®¢æˆ·ç«¯è¿žæŽ¥æ—¶ï¼š æ•´åˆ SBAè¿™æ ·å…¶å®žç›‘æŽ§åŠŸèƒ½å·²ç»å¯ä»¥æ»¡è¶³äº†ï¼Œä½†èƒ½ä¸èƒ½å±•ç¤ºçš„æ›´ç¾Žè§‚ã€å¹¶ä¸”å¤šä¸ªåº”ç”¨ä¹Ÿå¯ä»¥æ–¹ä¾¿æŸ¥çœ‹å‘¢ï¼Ÿ æœ‰è¿™æ ·çš„å¼€æºå·¥å…·å¸®æˆ‘ä»¬åšåˆ°äº†ï¼š https://github.com/codecentric/spring-boot-admin ç®€å•æ¥è¯´æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥å·¥å…·å°† actuator æš´éœ²å‡ºæ¥çš„æŽ¥å£å¯è§†åŒ–å¹¶èšåˆçš„å±•ç¤ºåœ¨é¡µé¢ä¸­ï¼š æŽ¥å…¥ä¹Ÿå¾ˆç®€å•ï¼Œé¦–å…ˆéœ€è¦å¼•å…¥ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-starter-client&lt;/artifactId&gt;&lt;/dependency&gt; å¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ï¼š 1234# å…³é—­å¥åº·æ£€æŸ¥æƒé™management.security.enabled=false# SpringAdmin åœ°å€spring.boot.admin.url=http://127.0.0.1:8888 åœ¨å¯åŠ¨åº”ç”¨ä¹‹å‰å…ˆè®² SpringBootAdmin éƒ¨ç½²å¥½ï¼š è¿™ä¸ªåº”ç”¨å°±æ˜¯ä¸€ä¸ªçº¯ç²¹çš„ SpringBoot ï¼Œåªéœ€è¦åœ¨ä¸»å‡½æ•°ä¸ŠåŠ å…¥ @EnableAdminServer æ³¨è§£ã€‚ 12345678910@SpringBootApplication@Configuration@EnableAutoConfiguration@EnableAdminServerpublic class AdminApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(AdminApplication.class, args); &#125;&#125; å¼•å…¥ï¼š 12345678910&lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-starter-server&lt;/artifactId&gt; &lt;version&gt;1.5.7&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-server-ui&lt;/artifactId&gt; &lt;version&gt;1.5.6&lt;/version&gt;&lt;/dependency&gt; ä¹‹åŽç›´æŽ¥å¯åŠ¨å°±è¡Œäº†ã€‚ è¿™æ ·æˆ‘ä»¬åœ¨ SpringBootAdmin çš„é¡µé¢ä¸­å°±å¯ä»¥æŸ¥çœ‹å¾ˆå¤šåº”ç”¨ä¿¡æ¯äº†ã€‚ æ›´å¤šå†…å®¹è¯·å‚è€ƒå®˜æ–¹æŒ‡å—ï¼š http://codecentric.github.io/spring-boot-admin/1.5.6/ è‡ªå®šä¹‰ç›‘æŽ§æ•°æ®å…¶å®žæˆ‘ä»¬å®Œå…¨å¯ä»¥å€ŸåŠ© actuator ä»¥åŠè¿™ä¸ªå¯è§†åŒ–é¡µé¢å¸®æˆ‘ä»¬ç›‘æŽ§ä¸€äº›ç®€å•çš„åº¦é‡ä¿¡æ¯ã€‚ æ¯”å¦‚æˆ‘åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸­å†™äº†ä¸¤ä¸ª Rest æŽ¥å£ç”¨äºŽå‘å¯¹æ–¹å‘é€æ¶ˆæ¯ã€‚ åªæ˜¯æƒ³è¦è®°å½•åˆ†åˆ«å‘é€äº†å¤šå°‘æ¬¡ï¼š å®¢æˆ·ç«¯ï¼š 123456789101112131415161718192021222324252627282930313233343536@Controller@RequestMapping("/")public class IndexController &#123; /** * ç»Ÿè®¡ service */ @Autowired private CounterService counterService; @Autowired private HeartbeatClient heartbeatClient ; /** * å‘æœåŠ¡ç«¯å‘æ¶ˆæ¯ * @param sendMsgReqVO * @return */ @ApiOperation("å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯") @RequestMapping("sendMsg") @ResponseBody public BaseResponse&lt;SendMsgResVO&gt; sendMsg(@RequestBody SendMsgReqVO sendMsgReqVO)&#123; BaseResponse&lt;SendMsgResVO&gt; res = new BaseResponse(); heartbeatClient.sendMsg(new CustomProtocol(sendMsgReqVO.getId(),sendMsgReqVO.getMsg())) ; // åˆ©ç”¨ actuator æ¥è‡ªå¢ž counterService.increment(Constants.COUNTER_CLIENT_PUSH_COUNT); SendMsgResVO sendMsgResVO = new SendMsgResVO() ; sendMsgResVO.setMsg("OK") ; res.setCode(StatusEnum.SUCCESS.getCode()) ; res.setMessage(StatusEnum.SUCCESS.getMessage()) ; res.setDataBody(sendMsgResVO) ; return res ; &#125;&#125; åªè¦æˆ‘ä»¬å¼•å…¥äº† actuator çš„åŒ…ï¼Œé‚£å°±å¯ä»¥ç›´æŽ¥æ³¨å…¥ counterService ï¼Œåˆ©ç”¨å®ƒæ¥å¸®æˆ‘ä»¬è®°å½•æ•°æ®ã€‚ å½“æˆ‘ä»¬è°ƒç”¨è¯¥æŽ¥å£æ—¶ï¼š åœ¨ç›‘æŽ§é¡µé¢ä¸­å¯ä»¥æŸ¥è¯¢åˆšæ‰çš„è°ƒç”¨æƒ…å†µï¼š æœåŠ¡ç«¯ä¸»åŠ¨ push æ¶ˆæ¯ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œåªæ˜¯éœ€è¦åœ¨å‘é€æ—¶å€™æ ¹æ®å®¢æˆ·ç«¯çš„ ID æŸ¥è¯¢åˆ°å…·ä½“çš„ Channel å‘é€ï¼š æ€»ç»“ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å• Netty å¿ƒè·³ç¤ºä¾‹ï¼Œå¹¶æ¼”ç¤ºäº† SpringBoot çš„ç›‘æŽ§ï¼Œä¹‹åŽä¼šç»§ç»­æ›´æ–° Netty ç›¸å…³å†…å®¹ï¼Œæ¬¢è¿Žå…³æ³¨åŠæŒ‡æ­£ã€‚ æœ¬æ–‡æ‰€æœ‰ä»£ç ï¼š https://github.com/crossoverJie/netty-action å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>TCP</tag>
        <tag>Heartbeat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[1K star+ çš„é¡¹ç›®æ˜¯å¦‚ä½•ç‚¼æˆçš„ï¼Ÿ]]></title>
    <url>%2F2018%2F05%2F15%2Fskill%2F1Kstar%2F</url>
    <content type="text"><![CDATA[å‰è¨€é¦–å…ˆæ ‡é¢˜å…šä¸€ä¸‹ï¼Œå…¶å®žè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•æˆ‘çš„ç¬¬äºŒä¸ªè¿‡ 1K star çš„é¡¹ç›® Java-Interviewï¼Œé¡ºä¾¿åˆ†äº«ä¸‹å…¶ä¸­çš„è¿‡ç¨‹åŠç»éªŒã€‚ éœ€æ±‚é€‰æ‹©Java-Interviewä¹‹æ‰€ä»¥è¦åšè¿™ä¸ªé¡¹ç›®ä¸»è¦æ˜¯å½“æ—¶æˆ‘æ­£åœ¨é¢é˜¿é‡Œçš„ä¸¤ä¸ªéƒ¨é—¨ï¼Œéžå¸¸å¹¸è¿çš„æ˜¯æŠ€æœ¯é¢éƒ½è¿‡äº†ã€‚å…¶ä¸­çš„è¿‡ç¨‹çœŸæ˜¯è®©æˆ‘å—ç›ŠåŒªæµ…æ›´æ˜¯å°è±¡æ·±åˆ»ï¼Œæ‰€ä»¥å°±æƒ³æŠŠæœŸé—´çš„é—®é¢˜è®°å½•ä¸‹æ¥ï¼ŒåŠ ä¸Šè‡ªå·±çš„ç†è§£å¸Œæœ›èƒ½å¯¹å…¶ä»–æœ‹å‹èµ·åˆ°å¸®åŠ©ã€‚ æ­£å¥½é‚£æ®µæ—¶é—´ä¹Ÿæ˜¯ä¼ è¯´ä¸­çš„é‡‘ä¸‰é“¶å››ï¼Œæ‰€ä»¥æ— å½¢ä¸­ä¹Ÿå«é¡ºåŠ¿è€Œä¸ºå§ðŸ˜ã€‚ SSMè¿™ä¸ªé¡¹ç›®çš„åŽ†å²å°±æ¯”è¾ƒæ‚ ä¹…äº†ï¼Œæˆ‘çœ‹äº†ä¸‹ç¬¬ä¸€æ¬¡æäº¤å·®ä¸å¤šæ˜¯ä¸¤å¹´å‰ã€‚ ä»Žè¿™ä¸ªåå­—ä¹Ÿå¯ä»¥çœ‹å‡ºå½“åˆè¿˜æ˜¯ä¸€ä¸ªåˆšå…¥è¡Œæ²¡å¤šä¹…çš„å°èœé¸Ÿï¼Œå› ä¸ºä¹‹å‰åœ¨å­¦ Java çš„æ—¶å€™çœŸçš„èµ°äº†å¾ˆå¤šå†¤æž‰è·¯ï¼Œæ‰€ä»¥ä»Žå¤´å¼€å§‹è®°å½•åˆ°çŽ°åœ¨æ•´ä¸ªè¿‡ç¨‹æ‰€å­¦åˆ°çš„ä¸œè¥¿ï¼Œè¸©è¿‡çš„å‘ã€‚ ç”±äºŽæ˜¯é¢å‘å°ç™½ï¼Œå…¥é—¨ç®€å•ï¼Œä¸Šæ‰‹è¾ƒå¿«ä¹Ÿå–çš„äº†ä¸€å®šçš„å…³æ³¨ã€‚ å…¶å®žä»Žè¿™ä¸¤ä¸ªé¡¹ç›®å¯ä»¥çœ‹å‡ºé€‰æ‹©ä¸€ä¸ªæ–¹å‘æ˜¯å¾ˆé‡è¦çš„ã€‚ ä»¥åŠè¯¥é¡¹ç›®è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œé•¿æœŸçš„è§„åˆ’ï¼Œå—ä¼—æ˜¯å“ªäº›éƒ½è¦è€ƒè™‘æ¸…æ¥š(æ€Žä¹ˆæœ‰ç‚¹åƒåšäº§å“ðŸ˜…ï¼Œå…¶å®žè¿™å°±æ˜¯ä½ è‡ªå·±çš„äº§å“)ã€‚ æ¯”å¦‚è¿™ä¸¤ä¸ªé¡¹ç›®çš„ç›®æ ‡ï¼š Java-Interviewï¼šæŒç»­æ›´æ–°é¢è¯•é—®é¢˜ï¼Œå¸Œæœ›èƒ½è®©é¢è¯•è€…çŸ¥å…¶ç„¶ä¹ŸçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚ SSMï¼šåšä¸»ä»Žå°ç™½åˆ°çŽ°åœ¨å®žé™…å¼€å‘æ‰€é‡åˆ°çš„é—®é¢˜è®°å½•ï¼Œä»¥åŠå®žæˆ˜ç»éªŒï¼ŒçŽ°åœ¨é€æ¸ä¼šåˆ†äº«ä¸€äº›éš¾ç‚¹ä»¥åŠåº•å±‚ã€‚å—ä¼—å¤§å¤šæ˜¯å°ç™½ã€‚ æ–‡æ¡£å¾ˆé‡è¦æ—¢ç„¶é¡¹ç›®åšå‡ºæ¥æ˜¯ç»™äººç”¨çš„ï¼Œé‚£æ–‡æ¡£å°±æ˜¾å¾—è‡³å…³é‡è¦äº†ã€‚ å°±åƒæ—¥å¸¸å’Œå‰ç«¯æ€¼æŽ¥å£æ—¶ï¼Œæœ‰ä¸€ä¸ªæ ‡å‡†çš„æ–‡æ¡£è¾“å‡ºæ¯”åœ¨ç™½æ¿ä¸ŠæŠ˜è…¾åŠå¤©è¦é«˜çš„å¤šã€‚ å…¶å®žä»”ç»†è§‚å¯Ÿ GitHub ä¸Šçƒ­é—¨çš„é¡¹ç›®ï¼Œä¼šå‘çŽ°ä»–ä»¬çš„æ–‡æ¡£å‡ ä¹Žéƒ½æœ‰ä¸€äº›å…±åŒç»“æž„ï¼š ç®€å•æè¿°é¡¹ç›®æ˜¯å¹²ä»€ä¹ˆçš„ã€‚ å¿«é€Ÿå¯åŠ¨ã€‚ æœ€è¿‘æ›´æ–°ã€‚ Q/A ç­”ç–‘ã€‚ é¡¹ç›®æˆªå›¾ã€‚ ä¸»è¦ç›®çš„å°±æ˜¯è¦ç®€å•æ˜“è¯»ï¼Œå¿«é€Ÿä¸Šæ‰‹ã€‚ ç„¶åŽæŠŠä¸€äº›å¤æ‚çš„å¦‚ç³»ç»Ÿè®¾è®¡ã€å¼€å‘æŒ‡å—ç­‰å¯ä»¥æ”¾åˆ° wiki ä¸­ã€‚ åˆ‡è®°ä¸è¦ä»€ä¹ˆä¸œè¥¿éƒ½å¾€ README.MD ä¸­å†™ï¼Œä¿æŒä¸€ä¸ªç®€æ´çš„æ–‡æ¡£å¯ä»¥åŠ åˆ†å“¦ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥åœ¨é¦–é¡µåŠ å…¥ä¸€äº›å¾½ç« å¦‚ï¼š ä¹Ÿèƒ½èµ·åˆ°ä¸€äº›ç§¯æžä½œç”¨ã€‚ ç§¯æžæŽ¨èä»£ç è´¨é‡è¿™ä¸ªå°±ä¸å¤šè¯´äº†ï¼Œè¿™åº”è¯¥æ˜¯æœ€åŸºæœ¬çš„è¦æ±‚ã€‚ ä¿—è¯è¯´ï¼šé…’é¦™ä¸æ€•å··å­æ·±ã€‚ ä½†å¯¹äºŽåšå¼€æºé¡¹ç›®æ¥è¯´å°±ä¸å¤ªé€‚åº”äº†ï¼Œå½“ä½ å¹¸è¾›è‹¦è‹¦åšäº†ä¸€ä¸ªè‡ªè®¤ä¸ºå¾ˆä¸é”™çš„é¡¹ç›®ï¼Œç»“æžœä¸€å¹´è¿‡åŽ»äº†éƒ½æ— äººé—®æ´¥ï¼Œè¿™ä¸å…ä¼šæœ‰ç‚¹æ‰“å‡»ç§¯æžæ€§ã€‚ æ‰€ä»¥é€‚å½“çš„è‡ªæˆ‘æŽ¨èå°±å¾ˆæœ‰å¿…è¦äº†ã€‚ ä¸Šå›¾æ˜¯æˆ‘åšå®¢ã€é¡¹ç›®çš„ä¸»è¦æµé‡æ¥æºã€‚ ä¸‹é¢æ˜¯æˆ‘è‡ªèº«ä½“éªŒæ¯”è¾ƒä¼˜è´¨çš„æŽ¨èæ¸ é“ï¼š å¼€å‘è€…å¤´æ¡ï¼šç”±äºŽæˆªå›¾çš„æ—¶å€™æ²¡æœ‰æ–°å‘æ–‡ç« ï¼Œä¹‹å‰é‚£ç¯‡ç§’æ€æž¶æž„å®žè·µå‘äº†ä¹‹åŽåšå®¢ 80% çš„æµé‡éƒ½æ˜¯ä»Žå¤´æ¡è¿‡æ¥çš„ï¼Œè€Œä¸”è´¨é‡å¾ˆé«˜ï¼Œä¸å¾—ä¸ç‚¹ä¸ªèµžã€‚ å¹¶å‘ç¼–ç¨‹ç½‘: å¹¶å‘ç¼–ç¨‹ç½‘æ˜¯ç”±é˜¿é‡Œå¤§ç‰›æ¸…è‹±(ä¹°äº†é‚£æœ¬ã€Šå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹å°±è¢«åœˆç²‰äº†)åˆ›åŠžçš„ï¼Œå…¶ä¸­çš„æ–‡ç« è´¨é‡æ™®éè¾ƒé«˜(å¯¼è‡´ä¹Ÿä¼šæœ‰ä¸€ç‚¹å†™ä½œé—¨æ§›)ã€‚ç”±äºŽç½‘ç«™çš„æµé‡ä¹Ÿæ¯”è¾ƒé«˜ï¼Œåªè¦ä½ çš„æ–‡ç« è´¨é‡ä¸é”™è‚¯å®šä¼šå¾—åˆ°å¥½å¤„ã€‚ æŽ˜é‡‘ï¼šæŽ˜é‡‘è¿™ä¸¤å¹´ä¹Ÿæ¯”è¾ƒç«ï¼Œæ˜¯ä¸“é—¨åšå¼€å‘è€…å†…å®¹çš„ï¼Œä¹Ÿæ˜¯ç½‘ç«™æµé‡ä¸é”™ã€‚ å¼€æºä¸­å›½ï¼šå¼€æºä¸­å›½çš„åšå®¢ä¹Ÿä¸é”™ï¼Œè‡ªå·±ä¹Ÿæœ‰ä»£ç æ‰˜ç®¡ï¼Œä½†æˆ‘è¿˜æ˜¯æ›´å–œæ¬¢ç”¨ GitHubï¼Œä¸€èˆ¬ä¸Šäº†ç¼–è¾‘æŽ¨èéƒ½ä¼šæœ‰ä¸é”™çš„è®¿é—®é‡ã€‚ V2EXï¼šå¤§åé¼Žé¼Žçš„ V ç«™ï¼Œå…¶å®žå—ä¼—è¾ƒå°‘ï¼Œæ­£å› ä¸ºå¦‚æ­¤ä¹Ÿå½¢æˆäº†ç‹¬æœ‰çš„æ–‡åŒ–ï¼Œå› æ­¤ä¹Ÿæ˜¯æˆ‘æ¯å¤©æ¯”é€›(æ‘¸é±¼)çš„ç½‘ç«™ï¼Œç”±äºŽå—ä¼—å¤§å¤šæ˜¯å¼€å‘è€…æ‰€ä»¥ä¹Ÿèƒ½å¾—åˆ°å¾ˆå¤šæœ‰ç”¨çš„åé¦ˆã€‚ å¤§ä½¬æŽ¨èï¼šæœ€å¿«æ·çš„æ–¹å¼å…¶å®žå°±æ˜¯å£å£ç›¸ä¼ ï¼Œå…¶ä¸­å½“ç„¶æ˜¯å¤§ä½¬çš„æ•ˆçŽ‡æœ€é«˜ã€‚ä¹‹å‰æœ‰ä¸ªçº¯æ´çš„å¾®ç¬‘ã€ç¨‹åºçŒ¿DD éƒ½æŠ•è¿‡ç¨¿ï¼Œä¹Ÿèƒ½å¸¦æ¥ä¸é”™çš„æµé‡ã€‚ ç®€ä¹¦:æœ¬æ¥ä¸æƒ³æŽ¨èç®€ä¹¦çš„ï¼ˆä¹‹å‰çš„äº‹ä»¶ä»¥åŠçŽ°åœ¨é¸¡æ±¤å¤ªå¤šï¼‰ï¼Œä½†æ˜¯æµé‡è¿˜å¯ä»¥ï¼ŒçŽ°åœ¨å°±çº¯ç²¹å½“åšåšå®¢å¤‡ä»½çš„å·¥å…·äº†ã€‚ åšæŒä¸‹æ¥ä¹‹åŽä¼šå‘çŽ°ï¼šåªè¦è‡ªå·±åšæŒã€ä¿è¯è´¨é‡æœ€åŽä¼šå½¢æˆè‡ªå·±çš„é˜…è¯»åœˆå­ï¼Œåˆ°åŽé¢ç”šè‡³ä¼šæœ‰å…¶ä»–æœ‹å‹ä¸»åŠ¨æ¥æ‰¾ä½ åˆ†äº«ï¼Œè¿™äº›éƒ½æ˜¯è‡ªæˆ‘æå‡çš„è¿‡ç¨‹ã€‚ ä¸å¿˜åˆå¿ƒå½“åˆåšçš„ç¬¬ä¸€ä¸ªå¼€æºé¡¹ç›®å°±æ˜¯ SSMï¼Œå®Œå…¨å—å¤Ÿå­¦ä¹ æ—¶æ‰¾èµ„æ–™çš„ç—›è‹¦ï¼Œä¹Ÿå¾—åˆ°äº†å¾ˆå¤šäººçš„å¸®åŠ©ï¼Œæ‰€ä»¥æ‰æœ‰äº†è¯¥é¡¹ç›®ã€‚ å¹³æ—¶å·¥ä½œä¸­æˆ–å¤šæˆ–å°‘éƒ½ä¼šç”¨åˆ°å¼€æºé¡¹ç›®ï¼Œå…¶å®žæˆ‘ä»¬å¤§éƒ¨åˆ†äººä¹Ÿå†™ä¸å‡º Springã€Guava è¿™æ ·çš„é¡¹ç›®ï¼Œåªæ˜¯å†è¿™è¿‡ç¨‹ä¸­å¯ä»¥å‚ä¸Žè¿›åŽ»ï¼Œæ”¶èŽ·ä¹Ÿæ˜¯éžå¸¸ä¸°å¯Œçš„ã€‚ ä¸¤å¹´å‰å‚ä¸Žå¼€æºåˆ°çŽ°åœ¨æœ‰æ”¶åˆ°é¢è¯•é‚€è¯·ã€ç‰©è´¨å¥–åŠ±è¿™äº›éƒ½æ˜¯æ­£é¢ç§¯æžçš„ï¼Œå¯ä»¥é¼“åŠ±æˆ‘ä»¬æŽ¥ç€åšä¸‹åŽ»ã€‚ ä½†æœ€å¤šçš„è¿˜æ˜¯åœ¨è¿™è¿‡ç¨‹ä¸­ç»“è¯†äº†å¾ˆå¤šæœ‹å‹ï¼ŒæŠ€æœ¯èƒ½åŠ›æå‡ä¹Ÿå¾ˆæ˜Žæ˜¾ï¼Œè¿™äº›éƒ½æ˜¯ä¿æŒè‡ªæˆ‘å¯æŒç»­å‘å±•çš„å¿…è¦æ¡ä»¶ã€‚]]></content>
      <categories>
        <category>å°æŠ€å·§</category>
      </categories>
      <tags>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åå…«) ç§’æ€æž¶æž„å®žè·µ]]></title>
    <url>%2F2018%2F05%2F07%2Fssm%2FSSM18-seconds-kill%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰åœ¨ Java-Interview ä¸­æåˆ°è¿‡ç§’æ€æž¶æž„çš„è®¾è®¡ï¼Œè¿™æ¬¡åŸºäºŽå…¶ä¸­çš„ç†è®ºç®€å•å®žçŽ°äº†ä¸€ä¸‹ã€‚ æœ¬æ¬¡é‡‡ç”¨å¾ªåºæ¸è¿›çš„æ–¹å¼é€æ­¥æé«˜æ€§èƒ½è¾¾åˆ°å¹¶å‘ç§’æ€çš„æ•ˆæžœï¼Œæ–‡ç« è¾ƒé•¿è¯·å‡†å¤‡å¥½ç“œå­æ¿å‡³(liushuizhangðŸ˜‚)ã€‚ æœ¬æ–‡æ‰€æœ‰æ¶‰åŠçš„ä»£ç ï¼š https://github.com/crossoverJie/SSM https://github.com/crossoverJie/distributed-redis-tool æœ€ç»ˆæž¶æž„å›¾ï¼š å…ˆç®€å•æ ¹æ®è¿™ä¸ªå›¾è°ˆä¸‹è¯·æ±‚çš„æµè½¬ï¼Œå› ä¸ºåŽé¢ä¸ç®¡æ€Žä¹ˆæ”¹è¿›è¿™ä¸ªéƒ½æ˜¯æ²¡æœ‰å˜çš„ã€‚ å‰ç«¯è¯·æ±‚è¿›å…¥ web å±‚ï¼Œå¯¹åº”çš„ä»£ç å°±æ˜¯ controllerã€‚ ä¹‹åŽå°†çœŸæ­£çš„åº“å­˜æ ¡éªŒã€ä¸‹å•ç­‰è¯·æ±‚å‘å¾€ Service å±‚ï¼ˆå…¶ä¸­ RPC è°ƒç”¨ä¾ç„¶é‡‡ç”¨çš„ dubboï¼Œåªæ˜¯æ›´æ–°ä¸ºæœ€æ–°ç‰ˆæœ¬ï¼Œæœ¬æ¬¡ä¸ä¼šè¿‡å¤šè®¨è®º dubbo ç›¸å…³çš„ç»†èŠ‚ï¼Œæœ‰å…´è¶£çš„å¯ä»¥æŸ¥çœ‹ åŸºäºŽdubboçš„åˆ†å¸ƒå¼æž¶æž„ï¼‰ã€‚ Service å±‚å†å¯¹æ•°æ®è¿›è¡Œè½åœ°ï¼Œä¸‹å•å®Œæˆã€‚ æ— é™åˆ¶å…¶å®žæŠ›å¼€ç§’æ€è¿™ä¸ªåœºæ™¯æ¥è¯´æ­£å¸¸çš„ä¸€ä¸ªä¸‹å•æµç¨‹å¯ä»¥ç®€å•åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š æ ¡éªŒåº“å­˜ æ‰£åº“å­˜ åˆ›å»ºè®¢å• æ”¯ä»˜ åŸºäºŽä¸Šæ–‡çš„æž¶æž„æ‰€ä»¥æˆ‘ä»¬æœ‰äº†ä»¥ä¸‹å®žçŽ°ï¼š å…ˆçœ‹çœ‹å®žé™…é¡¹ç›®çš„ç»“æž„ï¼š è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·ï¼š æä¾›å‡ºä¸€ä¸ª API ç”¨äºŽ Service å±‚å®žçŽ°ï¼Œä»¥åŠ web å±‚æ¶ˆè´¹ã€‚ web å±‚ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ª SpringMVCã€‚ Service å±‚åˆ™æ˜¯çœŸæ­£çš„æ•°æ®è½åœ°ã€‚ SSM-SECONDS-KILL-ORDER-CONSUMER åˆ™æ˜¯åŽæ–‡ä¼šæåˆ°çš„ Kafka æ¶ˆè´¹ã€‚ æ•°æ®åº“ä¹Ÿæ˜¯åªæœ‰ç®€å•çš„ä¸¤å¼ è¡¨æ¨¡æ‹Ÿä¸‹å•ï¼š 1234567891011121314151617CREATE TABLE `stock` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `name` varchar(50) NOT NULL DEFAULT '' COMMENT 'åç§°', `count` int(11) NOT NULL COMMENT 'åº“å­˜', `sale` int(11) NOT NULL COMMENT 'å·²å”®', `version` int(11) NOT NULL COMMENT 'ä¹è§‚é”ï¼Œç‰ˆæœ¬å·', PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;CREATE TABLE `stock_order` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `sid` int(11) NOT NULL COMMENT 'åº“å­˜ID', `name` varchar(30) NOT NULL DEFAULT '' COMMENT 'å•†å“åç§°', `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´', PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=55 DEFAULT CHARSET=utf8; web å±‚ controller å®žçŽ°: 12345678910111213141516171819@Autowiredprivate StockService stockService;@Autowiredprivate OrderService orderService;@RequestMapping("/createWrongOrder/&#123;sid&#125;")@ResponseBodypublic String createWrongOrder(@PathVariable int sid) &#123; logger.info("sid=[&#123;&#125;]", sid); int id = 0; try &#123; id = orderService.createWrongOrder(sid); &#125; catch (Exception e) &#123; logger.error("Exception",e); &#125; return String.valueOf(id);&#125; å…¶ä¸­ web ä½œä¸ºä¸€ä¸ªæ¶ˆè´¹è€…è°ƒç”¨çœ‹ OrderService æä¾›å‡ºæ¥çš„ dubbo æœåŠ¡ã€‚ Service å±‚ï¼ŒOrderService å®žçŽ°ï¼š é¦–å…ˆæ˜¯å¯¹ API çš„å®žçŽ°(ä¼šåœ¨ API æä¾›å‡ºæŽ¥å£)ï¼š 1234567891011@Servicepublic class OrderServiceImpl implements OrderService &#123; @Resource(name = "DBOrderService") private com.crossoverJie.seconds.kill.service.OrderService orderService ; @Override public int createWrongOrder(int sid) throws Exception &#123; return orderService.createWrongOrder(sid); &#125;&#125; è¿™é‡Œåªæ˜¯ç®€å•è°ƒç”¨äº† DBOrderService ä¸­çš„å®žçŽ°ï¼ŒDBOrderService æ‰æ˜¯çœŸæ­£çš„æ•°æ®è½åœ°ï¼Œä¹Ÿå°±æ˜¯å†™æ•°æ®åº“äº†ã€‚ DBOrderService å®žçŽ°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546Transactional(rollbackFor = Exception.class)@Service(value = "DBOrderService")public class OrderServiceImpl implements OrderService &#123; @Resource(name = "DBStockService") private com.crossoverJie.seconds.kill.service.StockService stockService; @Autowired private StockOrderMapper orderMapper; @Override public int createWrongOrder(int sid) throws Exception&#123; //æ ¡éªŒåº“å­˜ Stock stock = checkStock(sid); //æ‰£åº“å­˜ saleStock(stock); //åˆ›å»ºè®¢å• int id = createOrder(stock); return id; &#125; private Stock checkStock(int sid) &#123; Stock stock = stockService.getStockById(sid); if (stock.getSale().equals(stock.getCount())) &#123; throw new RuntimeException("åº“å­˜ä¸è¶³"); &#125; return stock; &#125; private int saleStock(Stock stock) &#123; stock.setSale(stock.getSale() + 1); return stockService.updateStockById(stock); &#125; private int createOrder(Stock stock) &#123; StockOrder order = new StockOrder(); order.setSid(stock.getId()); order.setName(stock.getName()); int id = orderMapper.insertSelective(order); return id; &#125; &#125; é¢„å…ˆåˆå§‹åŒ–äº† 10 æ¡åº“å­˜ã€‚ æ‰‹åŠ¨è°ƒç”¨ä¸‹ createWrongOrder/1 æŽ¥å£å‘çŽ°ï¼š åº“å­˜è¡¨ï¼š è®¢å•è¡¨ï¼š ä¸€åˆ‡çœ‹èµ·æ¥éƒ½æ²¡æœ‰é—®é¢˜ï¼Œæ•°æ®ä¹Ÿæ­£å¸¸ã€‚ ä½†æ˜¯å½“ç”¨ JMeter å¹¶å‘æµ‹è¯•æ—¶ï¼š æµ‹è¯•é…ç½®æ˜¯ï¼š300ä¸ªçº¿ç¨‹å¹¶å‘ï¼Œæµ‹è¯•ä¸¤è½®æ¥çœ‹çœ‹æ•°æ®åº“ä¸­çš„ç»“æžœï¼š è¯·æ±‚éƒ½å“åº”æˆåŠŸï¼Œåº“å­˜ç¡®å®žä¹Ÿæ‰£å®Œäº†ï¼Œä½†æ˜¯è®¢å•å´ç”Ÿæˆäº† 124 æ¡è®°å½•ã€‚ è¿™æ˜¾ç„¶æ˜¯å…¸åž‹çš„è¶…å–çŽ°è±¡ã€‚ å…¶å®žçŽ°åœ¨å†åŽ»æ‰‹åŠ¨è°ƒç”¨æŽ¥å£ä¼šè¿”å›žåº“å­˜ä¸è¶³ï¼Œä½†ä¸ºæ—¶æ™šçŸ£ã€‚ ä¹è§‚é”æ›´æ–°æ€Žä¹ˆæ¥é¿å…ä¸Šè¿°çš„çŽ°è±¡å‘¢ï¼Ÿ æœ€ç®€å•çš„åšæ³•è‡ªç„¶æ˜¯ä¹è§‚é”äº†ï¼Œè¿™é‡Œä¸è¿‡å¤šè®¨è®ºè¿™ä¸ªï¼Œä¸ç†Ÿæ‚‰çš„æœ‹å‹å¯ä»¥çœ‹ä¸‹è¿™ç¯‡ã€‚ æ¥çœ‹çœ‹å…·ä½“å®žçŽ°ï¼š å…¶å®žå…¶ä»–çš„éƒ½æ²¡æ€Žä¹ˆæ”¹ï¼Œä¸»è¦æ˜¯ Service å±‚ã€‚ 123456789101112131415161718192021@Overridepublic int createOptimisticOrder(int sid) throws Exception &#123; //æ ¡éªŒåº“å­˜ Stock stock = checkStock(sid); //ä¹è§‚é”æ›´æ–°åº“å­˜ saleStockOptimistic(stock); //åˆ›å»ºè®¢å• int id = createOrder(stock); return id;&#125;private void saleStockOptimistic(Stock stock) &#123; int count = stockService.updateStockByOptimistic(stock); if (count == 0)&#123; throw new RuntimeException("å¹¶å‘æ›´æ–°åº“å­˜å¤±è´¥") ; &#125;&#125; å¯¹åº”çš„ XMLï¼š 1234567891011&lt;update id="updateByOptimistic" parameterType="com.crossoverJie.seconds.kill.pojo.Stock"&gt; update stock &lt;set&gt; sale = sale + 1, version = version + 1, &lt;/set&gt; WHERE id = #&#123;id,jdbcType=INTEGER&#125; AND version = #&#123;version,jdbcType=INTEGER&#125;&lt;/update&gt; åŒæ ·çš„æµ‹è¯•æ¡ä»¶ï¼Œæˆ‘ä»¬å†è¿›è¡Œä¸Šé¢çš„æµ‹è¯• /createOptimisticOrder/1ï¼š è¿™æ¬¡å‘çŽ°æ— è®ºæ˜¯åº“å­˜è®¢å•éƒ½æ˜¯ OK çš„ã€‚ æŸ¥çœ‹æ—¥å¿—å‘çŽ°ï¼š å¾ˆå¤šå¹¶å‘è¯·æ±‚ä¼šå“åº”é”™è¯¯ï¼Œè¿™å°±è¾¾åˆ°äº†æ•ˆæžœã€‚ æé«˜åžåé‡ä¸ºäº†è¿›ä¸€æ­¥æé«˜ç§’æ€æ—¶çš„åžåé‡ä»¥åŠå“åº”æ•ˆçŽ‡ï¼Œè¿™é‡Œçš„ web å’Œ Service éƒ½è¿›è¡Œäº†æ¨ªå‘æ‰©å±•ã€‚ web åˆ©ç”¨ Nginx è¿›è¡Œè´Ÿè½½ã€‚ Service ä¹Ÿæ˜¯å¤šå°åº”ç”¨ã€‚ å†ç”¨ JMeter æµ‹è¯•æ—¶å¯ä»¥ç›´è§‚çš„çœ‹åˆ°æ•ˆæžœã€‚ ç”±äºŽæˆ‘æ˜¯åœ¨é˜¿é‡Œäº‘çš„ä¸€å°å°æ°´ç®¡æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•çš„ï¼ŒåŠ ä¸Šé…ç½®ä¸é«˜ã€åº”ç”¨éƒ½åœ¨åŒä¸€å°ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰å®Œå…¨ä½“çŽ°å‡ºæ€§èƒ½ä¸Šçš„ä¼˜åŠ¿ï¼ˆ Nginx åšè´Ÿè½½è½¬å‘æ—¶å€™ä¹Ÿä¼šå¢žåŠ é¢å¤–çš„ç½‘ç»œæ¶ˆè€—ï¼‰ã€‚ shell è„šæœ¬å®žçŽ°ç®€å•çš„ CIç”±äºŽåº”ç”¨å¤šå°éƒ¨ç½²ä¹‹åŽï¼Œæ‰‹åŠ¨å‘ç‰ˆæµ‹è¯•çš„ç—›è‹¦ç›¸ä¿¡ç»åŽ†è¿‡çš„éƒ½æœ‰ä½“ä¼šã€‚ è¿™æ¬¡å¹¶æ²¡æœ‰ç²¾åŠ›åŽ»æ­å»ºå®Œæ•´çš„ CI CDï¼Œåªæ˜¯å†™äº†ä¸€ä¸ªç®€å•çš„è„šæœ¬å®žçŽ°äº†è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œå¸Œæœ›å¯¹è¿™æ–¹é¢æ²¡æœ‰ç»éªŒçš„åŒå­¦å¸¦æ¥ä¸€ç‚¹å¯å‘ï¼š æž„å»º web12345678910111213141516171819202122232425262728293031323334353637383940414243#!/bin/bash# æž„å»º web æ¶ˆè´¹è€…#read appnameappname=&quot;consumer&quot;echo &quot;input=&quot;$appnamePID=$(ps -ef | grep $appname | grep -v grep | awk &apos;&#123;print $2&#125;&apos;)# éåŽ†æ€æŽ‰ pidfor var in $&#123;PID[@]&#125;;do echo &quot;loop pid= $var&quot; kill -9 $vardoneecho &quot;kill $appname success&quot;cd ..git pullcd SSM-SECONDS-KILLmvn -Dmaven.test.skip=true clean packageecho &quot;build war success&quot;cp /home/crossoverJie/SSM/SSM-SECONDS-KILL/SSM-SECONDS-KILL-WEB/target/SSM-SECONDS-KILL-WEB-2.2.0-SNAPSHOT.war /home/crossoverJie/tomcat/tomcat-dubbo-consumer-8083/webappsecho &quot;cp tomcat-dubbo-consumer-8083/webapps ok!&quot;cp /home/crossoverJie/SSM/SSM-SECONDS-KILL/SSM-SECONDS-KILL-WEB/target/SSM-SECONDS-KILL-WEB-2.2.0-SNAPSHOT.war /home/crossoverJie/tomcat/tomcat-dubbo-consumer-7083-slave/webappsecho &quot;cp tomcat-dubbo-consumer-7083-slave/webapps ok!&quot;sh /home/crossoverJie/tomcat/tomcat-dubbo-consumer-8083/bin/startup.shecho &quot;tomcat-dubbo-consumer-8083/bin/startup.sh success&quot;sh /home/crossoverJie/tomcat/tomcat-dubbo-consumer-7083-slave/bin/startup.shecho &quot;tomcat-dubbo-consumer-7083-slave/bin/startup.sh success&quot;echo &quot;start $appname success&quot; æž„å»º Service1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253# æž„å»ºæœåŠ¡æä¾›è€…#read appnameappname=&quot;provider&quot;echo &quot;input=&quot;$appnamePID=$(ps -ef | grep $appname | grep -v grep | awk &apos;&#123;print $2&#125;&apos;)#if [ $? -eq 0 ]; then# echo &quot;process id:$PID&quot;#else# echo &quot;process $appname not exit&quot;# exit#fi# éåŽ†æ€æŽ‰ pidfor var in $&#123;PID[@]&#125;;do echo &quot;loop pid= $var&quot; kill -9 $vardoneecho &quot;kill $appname success&quot;cd ..git pullcd SSM-SECONDS-KILLmvn -Dmaven.test.skip=true clean packageecho &quot;build war success&quot;cp /home/crossoverJie/SSM/SSM-SECONDS-KILL/SSM-SECONDS-KILL-SERVICE/target/SSM-SECONDS-KILL-SERVICE-2.2.0-SNAPSHOT.war /home/crossoverJie/tomcat/tomcat-dubbo-provider-8080/webappsecho &quot;cp tomcat-dubbo-provider-8080/webapps ok!&quot;cp /home/crossoverJie/SSM/SSM-SECONDS-KILL/SSM-SECONDS-KILL-SERVICE/target/SSM-SECONDS-KILL-SERVICE-2.2.0-SNAPSHOT.war /home/crossoverJie/tomcat/tomcat-dubbo-provider-7080-slave/webappsecho &quot;cp tomcat-dubbo-provider-7080-slave/webapps ok!&quot;sh /home/crossoverJie/tomcat/tomcat-dubbo-provider-8080/bin/startup.shecho &quot;tomcat-dubbo-provider-8080/bin/startup.sh success&quot;sh /home/crossoverJie/tomcat/tomcat-dubbo-provider-7080-slave/bin/startup.shecho &quot;tomcat-dubbo-provider-8080/bin/startup.sh success&quot;echo &quot;start $appname success&quot; ä¹‹åŽæ¯å½“æˆ‘æœ‰æ›´æ–°ï¼Œåªéœ€è¦æ‰§è¡Œè¿™ä¸¤ä¸ªè„šæœ¬å°±å¯ä»¥å¸®æˆ‘è‡ªåŠ¨æž„å»ºã€‚ éƒ½æ˜¯æœ€åŸºç¡€çš„ Linux å‘½ä»¤ï¼Œç›¸ä¿¡å¤§å®¶éƒ½çœ‹å¾—æ˜Žç™½ã€‚ ä¹è§‚é”æ›´æ–° + åˆ†å¸ƒå¼é™æµä¸Šæ–‡çš„ç»“æžœçœ‹ä¼¼æ²¡æœ‰é—®é¢˜ï¼Œå…¶å®žè¿˜å·®å¾—è¿œå‘¢ã€‚ è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿäº† 300 ä¸ªå¹¶å‘æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å½“è¯·æ±‚è¾¾åˆ°äº† 3000 ï¼Œ3Wï¼Œ300W å‘¢ï¼Ÿ è™½è¯´å¯ä»¥æ¨ªå‘æ‰©å±•å¯ä»¥æ”¯æ’‘æ›´å¤šçš„è¯·æ±‚ã€‚ ä½†æ˜¯èƒ½ä¸èƒ½åˆ©ç”¨æœ€å°‘çš„èµ„æºè§£å†³é—®é¢˜å‘¢ï¼Ÿ å…¶å®žä»”ç»†åˆ†æžä¸‹ä¼šå‘çŽ°ï¼š å‡è®¾æˆ‘çš„å•†å“ä¸€å…±åªæœ‰ 10 ä¸ªåº“å­˜ï¼Œé‚£ä¹ˆæ— è®ºä½ å¤šå°‘äººæ¥ä¹°å…¶å®žæœ€ç»ˆä¹Ÿæœ€å¤šåªæœ‰ 10 äººå¯ä»¥ä¸‹å•æˆåŠŸã€‚ æ‰€ä»¥å…¶ä¸­ä¼šæœ‰ 99% çš„è¯·æ±‚éƒ½æ˜¯æ— æ•ˆçš„ã€‚ å¤§å®¶éƒ½çŸ¥é“ï¼šå¤§å¤šæ•°åº”ç”¨æ•°æ®åº“éƒ½æ˜¯åŽ‹å€’éª†é©¼çš„æœ€åŽä¸€æ ¹ç¨»è‰ã€‚ é€šè¿‡ Druid çš„ç›‘æŽ§æ¥çœ‹çœ‹ä¹‹å‰è¯·æ±‚æ•°æ®åº“çš„æƒ…å†µï¼š å› ä¸º Service æ˜¯ä¸¤ä¸ªåº”ç”¨ã€‚ æ•°æ®åº“ä¹Ÿæœ‰ 20 å¤šä¸ªè¿žæŽ¥ã€‚ æ€Žä¹ˆæ ·æ¥ä¼˜åŒ–å‘¢ï¼Ÿå…¶å®žå¾ˆå®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯åˆ†å¸ƒå¼é™æµã€‚ æˆ‘ä»¬å°†å¹¶å‘æŽ§åˆ¶åœ¨ä¸€ä¸ªå¯æŽ§çš„èŒƒå›´ä¹‹å†…ï¼Œç„¶åŽå¿«é€Ÿå¤±è´¥è¿™æ ·å°±èƒ½æœ€å¤§ç¨‹åº¦çš„ä¿æŠ¤ç³»ç»Ÿã€‚ distributed-redis-tool â¬†ï¸v1.0.3ä¸ºæ­¤è¿˜å¯¹ https://github.com/crossoverJie/distributed-redis-tool è¿›è¡Œäº†å°å°çš„å‡çº§ã€‚ å› ä¸ºåŠ ä¸Šè¯¥ç»„ä»¶ä¹‹åŽæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šç»è¿‡ Redisï¼Œæ‰€ä»¥å¯¹ Redis èµ„æºçš„ä½¿ç”¨ä¹Ÿæ˜¯è¦éžå¸¸å°å¿ƒã€‚ API æ›´æ–°ä¿®æ”¹ä¹‹åŽçš„ API å¦‚ä¸‹ï¼š 123456789101112131415161718192021@Configurationpublic class RedisLimitConfig &#123; private Logger logger = LoggerFactory.getLogger(RedisLimitConfig.class); @Value("$&#123;redis.limit&#125;") private int limit; @Autowired private JedisConnectionFactory jedisConnectionFactory; @Bean public RedisLimit build() &#123; RedisLimit redisLimit = new RedisLimit.Builder(jedisConnectionFactory, RedisToolsConstant.SINGLE) .limit(limit) .build(); return redisLimit; &#125;&#125; è¿™é‡Œæž„å»ºå™¨æ”¹ç”¨äº† JedisConnectionFactoryï¼Œæ‰€ä»¥å¾—é…åˆ Spring æ¥ä¸€èµ·ä½¿ç”¨ã€‚ å¹¶åœ¨åˆå§‹åŒ–æ—¶æ˜¾ç¤ºä¼ å…¥ Redis æ˜¯ä»¥é›†ç¾¤æ–¹å¼éƒ¨ç½²è¿˜æ˜¯å•æœºï¼ˆå¼ºçƒˆå»ºè®®é›†ç¾¤ï¼Œé™æµä¹‹åŽå¯¹ Redis è¿˜æ˜¯æœ‰ä¸€å®šçš„åŽ‹åŠ›ï¼‰ã€‚ é™æµå®žçŽ°æ—¢ç„¶ API æ›´æ–°äº†ï¼Œå®žçŽ°è‡ªç„¶ä¹Ÿè¦ä¿®æ”¹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546/** * limit traffic * @return if true */public boolean limit() &#123; //get connection Object connection = getConnection(); Object result = limitRequest(connection); if (FAIL_CODE != (Long) result) &#123; return true; &#125; else &#123; return false; &#125;&#125;private Object limitRequest(Object connection) &#123; Object result = null; String key = String.valueOf(System.currentTimeMillis() / 1000); if (connection instanceof Jedis)&#123; result = ((Jedis)connection).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); ((Jedis) connection).close(); &#125;else &#123; result = ((JedisCluster) connection).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); try &#123; ((JedisCluster) connection).close(); &#125; catch (IOException e) &#123; logger.error("IOException",e); &#125; &#125; return result;&#125;private Object getConnection() &#123; Object connection ; if (type == RedisToolsConstant.SINGLE)&#123; RedisConnection redisConnection = jedisConnectionFactory.getConnection(); connection = redisConnection.getNativeConnection(); &#125;else &#123; RedisClusterConnection clusterConnection = jedisConnectionFactory.getClusterConnection(); connection = clusterConnection.getNativeConnection() ; &#125; return connection;&#125; å¦‚æžœæ˜¯åŽŸç”Ÿçš„ Spring åº”ç”¨å¾—é‡‡ç”¨ @SpringControllerLimit(errorCode = 200) æ³¨è§£ã€‚ å®žé™…ä½¿ç”¨å¦‚ä¸‹ï¼š web ç«¯ï¼š 123456789101112131415161718/** * ä¹è§‚é”æ›´æ–°åº“å­˜ é™æµ * @param sid * @return */@SpringControllerLimit(errorCode = 200)@RequestMapping("/createOptimisticLimitOrder/&#123;sid&#125;")@ResponseBodypublic String createOptimisticLimitOrder(@PathVariable int sid) &#123; logger.info("sid=[&#123;&#125;]", sid); int id = 0; try &#123; id = orderService.createOptimisticOrder(sid); &#125; catch (Exception e) &#123; logger.error("Exception",e); &#125; return String.valueOf(id);&#125; Service ç«¯å°±æ²¡ä»€ä¹ˆæ›´æ–°äº†ï¼Œä¾ç„¶æ˜¯é‡‡ç”¨çš„ä¹è§‚é”æ›´æ–°æ•°æ®åº“ã€‚ å†åŽ‹æµ‹çœ‹ä¸‹æ•ˆæžœ /createOptimisticLimitOrderByRedis/1ï¼š é¦–å…ˆæ˜¯çœ‹ç»“æžœæ²¡æœ‰é—®é¢˜ï¼Œå†çœ‹æ•°æ®åº“è¿žæŽ¥ä»¥åŠå¹¶å‘è¯·æ±‚æ•°éƒ½æœ‰æ˜Žæ˜¾çš„ä¸‹é™ã€‚ ä¹è§‚é”æ›´æ–° + åˆ†å¸ƒå¼é™æµ + Redis ç¼“å­˜å…¶å®žä»”ç»†è§‚å¯Ÿ Druid ç›‘æŽ§æ•°æ®å‘çŽ°è¿™ä¸ª SQL è¢«å¤šæ¬¡æŸ¥è¯¢ï¼š å…¶å®žè¿™æ˜¯å®žæ—¶æŸ¥è¯¢åº“å­˜çš„ SQLï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨æ¯æ¬¡ä¸‹å•ä¹‹å‰åˆ¤æ–­æ˜¯å¦è¿˜æœ‰åº“å­˜ã€‚ è¿™ä¹Ÿæ˜¯ä¸ªä¼˜åŒ–ç‚¹ã€‚ è¿™ç§æ•°æ®æˆ‘ä»¬å®Œå…¨å¯ä»¥æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ•ˆçŽ‡æ¯”åœ¨æ•°æ®åº“è¦é«˜å¾ˆå¤šã€‚ ç”±äºŽæˆ‘ä»¬çš„åº”ç”¨æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰€ä»¥å †å†…ç¼“å­˜æ˜¾ç„¶ä¸åˆé€‚ï¼ŒRedis å°±éžå¸¸é€‚åˆã€‚ è¿™æ¬¡ä¸»è¦æ”¹é€ çš„æ˜¯ Service å±‚ï¼š æ¯æ¬¡æŸ¥è¯¢åº“å­˜æ—¶èµ° Redisã€‚ æ‰£åº“å­˜æ—¶æ›´æ–° Redisã€‚ éœ€è¦æå‰å°†åº“å­˜ä¿¡æ¯å†™å…¥ Redisï¼ˆæ‰‹åŠ¨æˆ–è€…ç¨‹åºè‡ªåŠ¨éƒ½å¯ä»¥ï¼‰ã€‚ ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344@Overridepublic int createOptimisticOrderUseRedis(int sid) throws Exception &#123; //æ£€éªŒåº“å­˜ï¼Œä»Ž Redis èŽ·å– Stock stock = checkStockByRedis(sid); //ä¹è§‚é”æ›´æ–°åº“å­˜ ä»¥åŠæ›´æ–° Redis saleStockOptimisticByRedis(stock); //åˆ›å»ºè®¢å• int id = createOrder(stock); return id ;&#125;private Stock checkStockByRedis(int sid) throws Exception &#123; Integer count = Integer.parseInt(redisTemplate.opsForValue().get(RedisKeysConstant.STOCK_COUNT + sid)); Integer sale = Integer.parseInt(redisTemplate.opsForValue().get(RedisKeysConstant.STOCK_SALE + sid)); if (count.equals(sale))&#123; throw new RuntimeException("åº“å­˜ä¸è¶³ Redis currentCount=" + sale); &#125; Integer version = Integer.parseInt(redisTemplate.opsForValue().get(RedisKeysConstant.STOCK_VERSION + sid)); Stock stock = new Stock() ; stock.setId(sid); stock.setCount(count); stock.setSale(sale); stock.setVersion(version); return stock;&#125; /** * ä¹è§‚é”æ›´æ–°æ•°æ®åº“ è¿˜è¦æ›´æ–° Redis * @param stock */private void saleStockOptimisticByRedis(Stock stock) &#123; int count = stockService.updateStockByOptimistic(stock); if (count == 0)&#123; throw new RuntimeException("å¹¶å‘æ›´æ–°åº“å­˜å¤±è´¥") ; &#125; //è‡ªå¢ž redisTemplate.opsForValue().increment(RedisKeysConstant.STOCK_SALE + stock.getId(),1) ; redisTemplate.opsForValue().increment(RedisKeysConstant.STOCK_VERSION + stock.getId(),1) ;&#125; åŽ‹æµ‹çœ‹çœ‹å®žé™…æ•ˆæžœ /createOptimisticLimitOrderByRedis/1ï¼š æœ€åŽå‘çŽ°æ•°æ®æ²¡é—®é¢˜ï¼Œæ•°æ®åº“çš„è¯·æ±‚ä¸Žå¹¶å‘ä¹Ÿéƒ½ä¸‹æ¥äº†ã€‚ ä¹è§‚é”æ›´æ–° + åˆ†å¸ƒå¼é™æµ + Redis ç¼“å­˜ + Kafka å¼‚æ­¥æœ€åŽçš„ä¼˜åŒ–è¿˜æ˜¯æƒ³å¦‚ä½•æ¥å†æ¬¡æé«˜åžåé‡ä»¥åŠæ€§èƒ½çš„ã€‚ æˆ‘ä»¬ä¸Šæ–‡æ‰€æœ‰ä¾‹å­å…¶å®žéƒ½æ˜¯åŒæ­¥è¯·æ±‚ï¼Œå®Œå…¨å¯ä»¥åˆ©ç”¨åŒæ­¥è½¬å¼‚æ­¥æ¥æé«˜æ€§èƒ½å•Šã€‚ è¿™é‡Œæˆ‘ä»¬å°†å†™è®¢å•ä»¥åŠæ›´æ–°åº“å­˜çš„æ“ä½œè¿›è¡Œå¼‚æ­¥åŒ–ï¼Œåˆ©ç”¨ Kafka æ¥è¿›è¡Œè§£è€¦å’Œé˜Ÿåˆ—çš„ä½œç”¨ã€‚ æ¯å½“ä¸€ä¸ªè¯·æ±‚é€šè¿‡äº†é™æµåˆ°è¾¾äº† Service å±‚é€šè¿‡äº†åº“å­˜æ ¡éªŒä¹‹åŽå°±å°†è®¢å•ä¿¡æ¯å‘ç»™ Kafka ï¼Œè¿™æ ·ä¸€ä¸ªè¯·æ±‚å°±å¯ä»¥ç›´æŽ¥è¿”å›žäº†ã€‚ æ¶ˆè´¹ç¨‹åºå†å¯¹æ•°æ®è¿›è¡Œå…¥åº“è½åœ°ã€‚ å› ä¸ºå¼‚æ­¥äº†ï¼Œæ‰€ä»¥æœ€ç»ˆéœ€è¦é‡‡å–å›žè°ƒæˆ–è€…æ˜¯å…¶ä»–æé†’çš„æ–¹å¼æé†’ç”¨æˆ·è´­ä¹°å®Œæˆã€‚ è¿™é‡Œä»£ç è¾ƒå¤šå°±ä¸è´´äº†ï¼Œæ¶ˆè´¹ç¨‹åºå…¶å®žå°±æ˜¯æŠŠä¹‹å‰çš„ Service å±‚çš„é€»è¾‘é‡å†™äº†ä¸€éï¼Œä¸è¿‡é‡‡ç”¨çš„æ˜¯ SpringBootã€‚ æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹ä¸‹ã€‚ https://github.com/crossoverJie/SSM/tree/master/SSM-SECONDS-KILL/SSM-SECONDS-KILL-ORDER-CONSUMER æ€»ç»“å…¶å®žç»è¿‡ä¸Šé¢çš„ä¸€é¡¿ä¼˜åŒ–æ€»ç»“èµ·æ¥æ— éžå°±æ˜¯ä»¥ä¸‹å‡ ç‚¹ï¼š å°½é‡å°†è¯·æ±‚æ‹¦æˆªåœ¨ä¸Šæ¸¸ã€‚ è¿˜å¯ä»¥æ ¹æ® UID è¿›è¡Œé™æµã€‚ æœ€å¤§ç¨‹åº¦çš„å‡å°‘è¯·æ±‚è½åˆ° DBã€‚ å¤šåˆ©ç”¨ç¼“å­˜ã€‚ åŒæ­¥æ“ä½œå¼‚æ­¥åŒ–ã€‚ fail fastï¼Œå°½æ—©å¤±è´¥ï¼Œä¿æŠ¤åº”ç”¨ã€‚ ç å­—ä¸æ˜“ï¼Œè¿™åº”è¯¥æ˜¯æˆ‘å†™è¿‡å­—æ•°æœ€å¤šçš„äº†ï¼Œæƒ³æƒ³å½“å¹´é«˜ä¸­ 800 å­—çš„ä½œæ–‡éƒ½æ†‹ä¸å‡ºæ¥ðŸ˜‚ï¼Œå¯æƒ³è€ŒçŸ¥æ˜¯æœ‰å¤šéš¾å¾—äº†ã€‚ ä»¥ä¸Šå†…å®¹æ¬¢è¿Žè®¨è®ºã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>SSM</category>
        <category>Distributed Tools</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Kafka</tag>
        <tag>Redis</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(ä¸ƒ)åˆ†å¸ƒå¼é™æµ]]></title>
    <url>%2F2018%2F04%2F28%2Fsbc%2Fsbc7-Distributed-Limit%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ¬æ–‡æŽ¥ç€ä¸Šæ–‡åº”ç”¨é™æµè¿›è¡Œè®¨è®ºã€‚ ä¹‹å‰è°ˆåˆ°çš„é™æµæ–¹æ¡ˆåªèƒ½é’ˆå¯¹äºŽå•ä¸ª JVM æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯å•æœºåº”ç”¨ã€‚è€Œå¯¹äºŽçŽ°åœ¨æ™®éçš„åˆ†å¸ƒå¼åº”ç”¨ä¹Ÿå¾—æœ‰ä¸€ä¸ªåˆ†å¸ƒå¼é™æµçš„æ–¹æ¡ˆã€‚ åŸºäºŽæ­¤å°è¯•å†™äº†è¿™ä¸ªç»„ä»¶ï¼š https://github.com/crossoverJie/distributed-redis-tool DEMOä»¥ä¸‹é‡‡ç”¨çš„æ˜¯ https://github.com/crossoverJie/springboot-cloud æ¥åšæ¼”ç¤ºã€‚ åœ¨ Order åº”ç”¨æä¾›çš„æŽ¥å£ä¸­é‡‡å–äº†é™æµã€‚é¦–å…ˆæ˜¯é…ç½®äº†é™æµå·¥å…·çš„ Bean: 12345678910111213141516171819202122@Configurationpublic class RedisLimitConfig &#123; @Value("$&#123;redis.limit&#125;") private int limit; @Autowired private JedisConnectionFactory jedisConnectionFactory; @Bean public RedisLimit build() &#123; RedisClusterConnection clusterConnection = jedisConnectionFactory.getClusterConnection(); JedisCluster jedisCluster = (JedisCluster) clusterConnection.getNativeConnection(); RedisLimit redisLimit = new RedisLimit.Builder&lt;&gt;(jedisCluster) .limit(limit) .build(); return redisLimit; &#125;&#125; æŽ¥ç€åœ¨ Controller ä½¿ç”¨ç»„ä»¶ï¼š 123456789101112131415161718192021222324252627@Autowiredprivate RedisLimit redisLimit ;@Override@CheckReqNopublic BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) &#123; BaseResponse&lt;OrderNoResVO&gt; res = new BaseResponse(); //é™æµ boolean limit = redisLimit.limit(); if (!limit)&#123; res.setCode(StatusEnum.REQUEST_LIMIT.getCode()); res.setMessage(StatusEnum.REQUEST_LIMIT.getMessage()); return res ; &#125; res.setReqNo(orderNoReq.getReqNo()); if (null == orderNoReq.getAppId())&#123; throw new SBCException(StatusEnum.FAIL); &#125; OrderNoResVO orderNoRes = new OrderNoResVO() ; orderNoRes.setOrderId(DateUtil.getLongTime()); res.setCode(StatusEnum.SUCCESS.getCode()); res.setMessage(StatusEnum.SUCCESS.getMessage()); res.setDataBody(orderNoRes); return res ;&#125; ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œä¹Ÿæä¾›äº†æ³¨è§£: 1234567@Override@ControllerLimitpublic BaseResponse&lt;OrderNoResVO&gt; getOrderNoLimit(@RequestBody OrderNoReqVO orderNoReq) &#123; BaseResponse&lt;OrderNoResVO&gt; res = new BaseResponse(); // ä¸šåŠ¡é€»è¾‘ return res ;&#125; è¯¥æ³¨è§£æ‹¦æˆªäº† http è¯·æ±‚ï¼Œä¼šå†è¯·æ±‚è¾¾åˆ°é˜ˆå€¼æ—¶ç›´æŽ¥è¿”å›žã€‚ æ™®é€šæ–¹æ³•ä¹Ÿå¯ä½¿ç”¨: 12@CommonLimitpublic void doSomething()&#123;&#125; ä¼šåœ¨è°ƒç”¨è¾¾åˆ°é˜ˆå€¼æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚ ä¸ºäº†æ¨¡æ‹Ÿå¹¶å‘ï¼Œåœ¨ User åº”ç”¨ä¸­å¼€å¯äº† 10 ä¸ªçº¿ç¨‹è°ƒç”¨ Order(é™æµæ¬¡æ•°ä¸º5) æŽ¥å£(ä¹Ÿå¯ä½¿ç”¨ä¸“ä¸šçš„å¹¶å‘æµ‹è¯•å·¥å…· JMeter ç­‰)ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041@Overridepublic BaseResponse&lt;UserResVO&gt; getUserByFeign(@RequestBody UserReqVO userReq) &#123; //è°ƒç”¨è¿œç¨‹æœåŠ¡ OrderNoReqVO vo = new OrderNoReqVO(); vo.setAppId(1L); vo.setReqNo(userReq.getReqNo()); for (int i = 0; i &lt; 10; i++) &#123; executorService.execute(new Worker(vo, orderServiceClient)); &#125; UserRes userRes = new UserRes(); userRes.setUserId(123); userRes.setUserName("å¼ ä¸‰"); userRes.setReqNo(userReq.getReqNo()); userRes.setCode(StatusEnum.SUCCESS.getCode()); userRes.setMessage("æˆåŠŸ"); return userRes;&#125;private static class Worker implements Runnable &#123; private OrderNoReqVO vo; private OrderServiceClient orderServiceClient; public Worker(OrderNoReqVO vo, OrderServiceClient orderServiceClient) &#123; this.vo = vo; this.orderServiceClient = orderServiceClient; &#125; @Override public void run() &#123; BaseResponse&lt;OrderNoResVO&gt; orderNo = orderServiceClient.getOrderNoCommonLimit(vo); logger.info("è¿œç¨‹è¿”å›ž:" + JSON.toJSONString(orderNo)); &#125;&#125; ä¸ºäº†éªŒè¯åˆ†å¸ƒå¼æ•ˆæžœå¯åŠ¨äº†ä¸¤ä¸ª Order åº”ç”¨ã€‚ æ•ˆæžœå¦‚ä¸‹ï¼š å®žçŽ°åŽŸç†å®žçŽ°åŽŸç†å…¶å®žå¾ˆç®€å•ã€‚æ—¢ç„¶è¦è¾¾åˆ°åˆ†å¸ƒå¼å…¨å±€é™æµçš„æ•ˆæžœï¼Œé‚£è‡ªç„¶éœ€è¦ä¸€ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶æ¥è®°å½•è¯·æ±‚çš„æ¬¡æ•°ã€‚ å…¶ä¸­ Redis å°±éžå¸¸é€‚åˆè¿™æ ·çš„åœºæ™¯ã€‚ æ¯æ¬¡è¯·æ±‚æ—¶å°†å½“å‰æ—¶é—´(ç²¾ç¡®åˆ°ç§’)ä½œä¸º Key å†™å…¥åˆ° Redis ä¸­ï¼Œè¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 2 ç§’ï¼ŒRedis å°†è¯¥ Key çš„å€¼è¿›è¡Œè‡ªå¢žã€‚ å½“è¾¾åˆ°é˜ˆå€¼æ—¶è¿”å›žé”™è¯¯ã€‚ å†™å…¥ Redis çš„æ“ä½œç”¨ Lua è„šæœ¬æ¥å®Œæˆï¼Œåˆ©ç”¨ Redis çš„å•çº¿ç¨‹æœºåˆ¶å¯ä»¥ä¿è¯æ¯ä¸ª Redis è¯·æ±‚çš„åŽŸå­æ€§ã€‚ Lua è„šæœ¬å¦‚ä¸‹: 123456789101112131415161718--lua ä¸‹æ ‡ä»Ž 1 å¼€å§‹-- é™æµ keylocal key = KEYS[1]-- é™æµå¤§å°local limit = tonumber(ARGV[1])-- èŽ·å–å½“å‰æµé‡å¤§å°local curentLimit = tonumber(redis.call('get', key) or "0")if curentLimit + 1 &gt; limit then -- è¾¾åˆ°é™æµå¤§å° è¿”å›ž return 0;else -- æ²¡æœ‰è¾¾åˆ°é˜ˆå€¼ value + 1 redis.call("INCRBY", key, 1) redis.call("EXPIRE", key, 2) return curentLimit + 1end Java ä¸­çš„è°ƒç”¨é€»è¾‘: 123456789101112131415161718public boolean limit() &#123; String key = String.valueOf(System.currentTimeMillis() / 1000); Object result = null; if (jedis instanceof Jedis) &#123; result = ((Jedis) this.jedis).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); &#125; else if (jedis instanceof JedisCluster) &#123; result = ((JedisCluster) this.jedis).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); &#125; else &#123; //throw new RuntimeException("instance is error") ; return false; &#125; if (FAIL_CODE != (Long) result) &#123; return true; &#125; else &#123; return false; &#125;&#125; æ‰€ä»¥åªéœ€è¦åœ¨éœ€è¦é™æµçš„åœ°æ–¹è°ƒç”¨è¯¥æ–¹æ³•å¯¹è¿”å›žå€¼è¿›è¡Œåˆ¤æ–­å³å¯è¾¾åˆ°é™æµçš„ç›®çš„ã€‚ å½“ç„¶è¿™åªæ˜¯åˆ©ç”¨ Redis åšäº†ä¸€ä¸ªç²—æš´çš„è®¡æ•°å™¨ï¼Œå¦‚æžœæƒ³å®žçŽ°ç±»ä¼¼äºŽä¸Šæ–‡ä¸­çš„ä»¤ç‰Œæ¡¶ç®—æ³•å¯ä»¥åŸºäºŽ Lua è‡ªè¡Œå®žçŽ°ã€‚ Builder æž„å»ºå™¨åœ¨è®¾è®¡è¿™ä¸ªç»„ä»¶æ—¶æƒ³å°½é‡çš„æä¾›ç»™ä½¿ç”¨è€…æ¸…æ™°ã€å¯è¯»æ€§ã€ä¸æ˜“å‡ºé”™çš„ APIã€‚ æ¯”å¦‚ç¬¬ä¸€æ­¥ï¼Œå¦‚ä½•æž„å»ºä¸€ä¸ªé™æµå¯¹è±¡ã€‚ æœ€å¸¸ç”¨çš„æ–¹å¼è‡ªç„¶å°±æ˜¯æž„é€ å‡½æ•°ï¼Œå¦‚æžœæœ‰å¤šä¸ªåŸŸåˆ™å¯ä»¥é‡‡ç”¨é‡å æž„é€ å™¨çš„æ–¹å¼: 123public A()&#123;&#125;public A(int a)&#123;&#125;public A(int a,int b)&#123;&#125; ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼šå¦‚æžœå‚æ•°è¿‡å¤šä¼šå¯¼è‡´éš¾ä»¥é˜…è¯»ï¼Œç”šè‡³å¦‚æžœå‚æ•°ç±»åž‹ä¸€è‡´çš„æƒ…å†µä¸‹å®¢æˆ·ç«¯é¢ å€’äº†é¡ºåºï¼Œä½†ä¸ä¼šå¼•èµ·è­¦å‘Šä»Žè€Œå‡ºçŽ°éš¾ä»¥é¢„æµ‹çš„ç»“æžœã€‚ ç¬¬äºŒç§æ–¹æ¡ˆå¯ä»¥é‡‡ç”¨ JavaBean æ¨¡å¼ï¼Œåˆ©ç”¨ setter æ–¹æ³•è¿›è¡Œæž„å»º: 123A a = new A();a.setA(a);a.setB(b); è¿™ç§æ–¹å¼æ¸…æ™°æ˜“è¯»ï¼Œä½†å´å®¹æ˜“è®©å¯¹è±¡å¤„äºŽä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œä½¿å¯¹è±¡å¤„äºŽçº¿ç¨‹ä¸å®‰å…¨çš„çŠ¶æ€ã€‚ æ‰€ä»¥è¿™é‡Œé‡‡ç”¨äº†ç¬¬ä¸‰ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œæž„å»ºå™¨ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576public class RedisLimit &#123; private JedisCommands jedis; private int limit = 200; private static final int FAIL_CODE = 0; /** * lua script */ private String script; private RedisLimit(Builder builder) &#123; this.limit = builder.limit ; this.jedis = builder.jedis ; buildScript(); &#125; /** * limit traffic * @return if true */ public boolean limit() &#123; String key = String.valueOf(System.currentTimeMillis() / 1000); Object result = null; if (jedis instanceof Jedis) &#123; result = ((Jedis) this.jedis).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); &#125; else if (jedis instanceof JedisCluster) &#123; result = ((JedisCluster) this.jedis).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); &#125; else &#123; //throw new RuntimeException("instance is error") ; return false; &#125; if (FAIL_CODE != (Long) result) &#123; return true; &#125; else &#123; return false; &#125; &#125; /** * read lua script */ private void buildScript() &#123; script = ScriptUtil.getScript("limit.lua"); &#125; /** * the builder * @param &lt;T&gt; */ public static class Builder&lt;T extends JedisCommands&gt;&#123; private T jedis = null ; private int limit = 200; public Builder(T jedis)&#123; this.jedis = jedis ; &#125; public Builder limit(int limit)&#123; this.limit = limit ; return this; &#125; public RedisLimit build()&#123; return new RedisLimit(this) ; &#125; &#125;&#125; è¿™æ ·å®¢æˆ·ç«¯åœ¨ä½¿ç”¨æ—¶: 123RedisLimit redisLimit = new RedisLimit.Builder&lt;&gt;(jedisCluster) .limit(limit) .build(); æ›´åŠ çš„ç®€å•ç›´æŽ¥ï¼Œå¹¶ä¸”é¿å…äº†å°†åˆ›å»ºè¿‡ç¨‹åˆ†æˆäº†å¤šä¸ªå­æ­¥éª¤ã€‚ è¿™åœ¨æœ‰å¤šä¸ªæž„é€ å‚æ•°ï¼Œä½†åˆä¸æ˜¯å¿…é€‰å­—æ®µæ—¶å¾ˆæœ‰ä½œç”¨ã€‚ å› æ­¤é¡ºä¾¿å°†åˆ†å¸ƒå¼é”çš„æž„å»ºå™¨æ–¹å¼ä¹Ÿä¸€å¹¶æ›´æ–°äº†ï¼š https://github.com/crossoverJie/distributed-redis-tool#features æ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒ Effective Java APIä»Žä¸Šæ–‡å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨è¿‡ç¨‹å°±æ˜¯è°ƒç”¨ limit æ–¹æ³•ã€‚ 12345//é™æµ boolean limit = redisLimit.limit(); if (!limit)&#123; //å…·ä½“é™æµé€»è¾‘ &#125; ä¸ºäº†å‡å°‘ä¾µå…¥æ€§ï¼Œä¹Ÿä¸ºäº†ç®€åŒ–å®¢æˆ·ç«¯æä¾›äº†ä¸¤ç§æ³¨è§£æ–¹å¼ã€‚ @ControllerLimitè¯¥æ³¨è§£å¯ä»¥ä½œç”¨äºŽ @RequestMapping ä¿®é¥°çš„æŽ¥å£ä¸­ï¼Œå¹¶ä¼šåœ¨é™æµåŽæä¾›é™æµå“åº”ã€‚ å®žçŽ°å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849@Componentpublic class WebIntercept extends WebMvcConfigurerAdapter &#123; private static Logger logger = LoggerFactory.getLogger(WebIntercept.class); @Autowired private RedisLimit redisLimit; @Override public void addInterceptors(InterceptorRegistry registry) &#123; registry.addInterceptor(new CustomInterceptor()) .addPathPatterns("/**"); &#125; private class CustomInterceptor extends HandlerInterceptorAdapter &#123; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; if (redisLimit == null) &#123; throw new NullPointerException("redisLimit is null"); &#125; if (handler instanceof HandlerMethod) &#123; HandlerMethod method = (HandlerMethod) handler; ControllerLimit annotation = method.getMethodAnnotation(ControllerLimit.class); if (annotation == null) &#123; //skip return true; &#125; boolean limit = redisLimit.limit(); if (!limit) &#123; logger.warn("request has bean limit"); response.sendError(500, "request limit"); return false; &#125; &#125; return true; &#125; &#125;&#125; å…¶å®žå°±æ˜¯å®žçŽ°äº† SpringMVC ä¸­çš„æ‹¦æˆªå™¨ï¼Œå¹¶åœ¨æ‹¦æˆªè¿‡ç¨‹ä¸­åˆ¤æ–­æ˜¯å¦æœ‰ä½¿ç”¨æ³¨è§£ï¼Œä»Žè€Œè°ƒç”¨é™æµé€»è¾‘ã€‚ å‰ææ˜¯åº”ç”¨éœ€è¦æ‰«æåˆ°è¯¥ç±»ï¼Œè®© Spring è¿›è¡Œç®¡ç†ã€‚ 1@ComponentScan(value = "com.crossoverjie.distributed.intercept") @CommonLimitå½“ç„¶ä¹Ÿå¯ä»¥åœ¨æ™®é€šæ–¹æ³•ä¸­ä½¿ç”¨ã€‚å®žçŽ°åŽŸç†åˆ™æ˜¯ Spring AOP (SpringMVC çš„æ‹¦æˆªå™¨æœ¬è´¨ä¹Ÿæ˜¯ AOP)ã€‚ 12345678910111213141516171819202122232425262728@Aspect@Component@EnableAspectJAutoProxy(proxyTargetClass = true)public class CommonAspect &#123; private static Logger logger = LoggerFactory.getLogger(CommonAspect.class); @Autowired private RedisLimit redisLimit ; @Pointcut("@annotation(com.crossoverjie.distributed.annotation.CommonLimit)") private void check()&#123;&#125; @Before("check()") public void before(JoinPoint joinPoint) throws Exception &#123; if (redisLimit == null) &#123; throw new NullPointerException("redisLimit is null"); &#125; boolean limit = redisLimit.limit(); if (!limit) &#123; logger.warn("request has bean limit"); throw new RuntimeException("request has bean limit") ; &#125; &#125;&#125; å¾ˆç®€å•ï¼Œä¹Ÿæ˜¯åœ¨æ‹¦æˆªè¿‡ç¨‹ä¸­è°ƒç”¨é™æµã€‚ å½“ç„¶ä½¿ç”¨æ—¶ä¹Ÿå¾—æ‰«æåˆ°è¯¥åŒ…: 1@ComponentScan(value = "com.crossoverjie.distributed.intercept") æ€»ç»“é™æµåœ¨ä¸€ä¸ªé«˜å¹¶å‘å¤§æµé‡çš„ç³»ç»Ÿä¸­æ˜¯ä¿æŠ¤åº”ç”¨çš„ä¸€ä¸ªåˆ©å™¨ï¼Œæˆç†Ÿçš„æ–¹æ¡ˆä¹Ÿå¾ˆå¤šï¼Œå¸Œæœ›å¯¹åˆšäº†è§£è¿™ä¸€å—çš„æœ‹å‹æä¾›ä¸€äº›æ€è·¯ã€‚ ä»¥ä¸Šæ‰€æœ‰çš„æºç ï¼š https://github.com/crossoverJie/distributed-redis-tool https://github.com/crossoverJie/springboot-cloud æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç‚¹ä¸ª Star æˆ–æ˜¯æäº¤ PRã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>sbc</category>
        <category>Distributed Tools</category>
      </categories>
      <tags>
        <tag>Distributed Limited</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€è¯‘ã€‘å¯¹äºŽåˆå­¦è€…ä»€ä¹ˆæ˜¯æœ€å¥½çš„ç¼–ç¨‹è¯­è¨€ï¼Ÿ]]></title>
    <url>%2F2018%2F04%2F12%2Ftranslation%2Ftranslation-What%20Is%20The%20Best%20Programming%20Language%20to%20Start%2F</url>
    <content type="text"><![CDATA[åŽŸæ–‡é“¾æŽ¥Pythonï¼ŸJavaï¼ŸRubyï¼ŸJavaScriptï¼Ÿæœ‰éžå¸¸å¤šçš„é€‰æ‹©ã€‚é€‰æ‹©ä¸€ç§ç¼–ç¨‹è¯­è¨€å¼€å§‹ä½ çš„ç¼–ç ä¹‹æ—…ä¸åº”è¯¥æ˜¯ä¸€ä»¶è‰°å·¨çš„ä»»åŠ¡ã€‚ äº‹å®žä¸Šï¼šä½ å°†è¦å­¦ä¹ çš„è¯­è¨€å¹¶ä¸æ˜¯ç‰¹åˆ«é‡è¦ï¼Œæ›´é‡è¦çš„æ˜¯å­¦ä¹ ç¼–ç¨‹çš„ç†å¿µã€‚å¯¹äºŽä»»ä½•ç¼–ç¨‹è¯­è¨€æ¥è¯´çŸ¥è¯†çš„å¯ä¼ é€’æ€§éƒ½æ˜¯è‡³å…³é‡è¦çš„ã€‚ æˆ‘å­¦ä¹ çš„ç¬¬ä¸€é—¨è¯­è¨€æ˜¯ Javaï¼Œå­¦ä¹ äº†å¾ªçŽ¯ï¼Œwhile å¾ªçŽ¯ï¼Œæ¡ä»¶ï¼Œå‡½æ•°ï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹å’Œè®¸å¤šç¼–ç¨‹ç†å¿µã€‚ ç„¶è€Œï¼Œé€‰æ‹©ä¸€é—¨èƒ½åœ¨ç¼–ç¨‹é¢†åŸŸè½»æ¾æ‰¾åˆ°å·¥ä½œçš„è¯­è¨€æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å¯¹äºŽåˆå­¦è€…æ¥è¯´ï¼Œæˆ‘è¿™é‡Œæœ‰ä¸€ä»½åˆ—è¡¨æŽ¨èç»™ä½ ï¼š PythonPython åœ¨ç¾Žå›½å¤§å­¦é‡Œæ˜¯æœ€å—æ¬¢è¿Žçš„å…¥é—¨åž‹è¯­è¨€ã€‚ å°±åƒ JavaScript ä¸€æ ·ï¼ŒPython ä¹Ÿéžå¸¸çµæ´»ï¼ŒçŽ°åœ¨è¢«ç”¨äºŽæž„å»ºç”Ÿç‰©ä¿¡æ¯å­¦çš„ web åº”ç”¨ã€‚æˆ‘å¼ºçƒˆæŽ¨èä½ å­¦ä¹  Pythonï¼Œå®ƒæ˜¯å¾ˆæ£’çš„å…¥é—¨é€‰æ‹©ã€‚ JavaJava æ˜¯ä¼ä¸šçŽ¯å¢ƒä¸­ä½¿ç”¨æœ€å¤šçš„è¯­è¨€ï¼Œæ ¹æ® TIOBE ç»Ÿè®¡ Java é•¿å¹´å æ®ç¼–ç¨‹è¯­è¨€æ¦œé¦–ã€‚åŒæ—¶ Java æ˜¯å¼ºç±»åž‹åœ°é™æ€è¯­è¨€ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°åŽ»æè¿°ä¸€äº›ç¼–ç¨‹ç†å¿µã€‚ Java ä½œä¸ºæœ€å¸¸ä½¿ç”¨çš„è¯­è¨€ï¼Œä½ å¯ä»¥å¾ˆè½»æ¾åœ°åœ¨è¿™æ®µç¼–ç¨‹ä¹‹æ—…ä¸­æ‰¾åˆ° Java çš„ç›¸å…³è¯¾ç¨‹å’ŒæŒ‡å—æ¥èŽ·å¾—å¸®åŠ©ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ Java æž„å»ºæœåŠ¡ç«¯åº”ç”¨ã€Android APP ç­‰åº”ç”¨ç¨‹åºã€‚ RubyRuby æ˜¯æˆ‘æœ€å–œæ¬¢çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒç¼–å†™ç®€å•ï¼Œå®¹æ˜“ç†è§£å¹¶ä¸”ä½¿ç”¨é¡ºæ‰‹ã€‚ å°±åƒ JavaScript ä¸€æ ·ï¼Œå®ƒå­¦èµ·æ¥ç®€å•ä½†æ˜¯ä¸æ˜“æŽŒæ¡ã€‚Ruby åœ¨å¾ˆå¤šå…¬å¸ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼Œæ¯”å¦‚ Airbnb, EBANX, Shopify, Twitter, GitHub ç­‰ç­‰ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªè¶…èµžçš„ 7*24 å°æ—¶çš„åœ¨çº¿ç¤¾åŒºéšæ—¶æä¾›å¸®åŠ©ã€‚Ruby ä»¥ Ruby on Rails æ¡†æž¶è‘—ç§°ï¼Œå®ƒå¯ä»¥å¸®ä½ å¾ˆè½»æ¾çš„æž„å»ºæ•´ä¸ª web åº”ç”¨ã€‚ JavaScriptJavaScript æ˜¯æˆ‘ç”¨è¿‡çš„æœ€çµæ´»çš„è¯­è¨€ä¹‹ä¸€ã€‚ ä½ èƒ½ç”¨å®ƒæž„å»ºæŽ§åˆ¶å°ç¨‹åºï¼Œæ¡Œé¢è½¯ä»¶ï¼Œæ‰‹æœº APPï¼Œå‰ç«¯å¼€å‘ï¼ŒåŽç«¯å¼€å‘ç­‰ç­‰ã€‚å®ƒæ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„ç¼–ç¨‹è¯­è¨€ï¼Œç®€å•æ˜“å­¦ä½†éš¾ä»¥æŽŒæ¡ã€‚ æˆ‘å»ºè®®ä½ å­¦ä¹ å¹¶æŽŒæ¡ JavaScript ï¼Œä½†ä¸æ˜¯ä½œä¸ºç¬¬ä¸€é—¨è¯­è¨€ã€‚ å¯¹äºŽåˆå­¦è€…æ¥è¯´ JavaScript å¾ˆéš¾è°ƒè¯•å¹¶ä¸”ä¸å®¹æ˜“å­¦ä¹ ç¼–ç¨‹ç†å¿µæ¯”å¦‚å¼‚æ­¥ï¼ŒåŽŸåž‹ï¼Œé¢å‘å¯¹è±¡ç­‰ç­‰ã€‚ ä¸è¦çº ç»“è¯­è¨€ä½ éœ€è¦é€šè¿‡é€‰æ‹©ä¸€é—¨è¯­è¨€æ¥å­¦ä¹ ç¼–ç¨‹ç†å¿µï¼Œå½“ä½ å­¦å®Œä¹‹åŽä½ å°†èŠ±è´¹è¾ƒå°çš„å­¦ä¹ æ›²çº¿æ¥å­¦ä¹ ä»»ä½•å…¶ä»–çš„è¯­è¨€ã€‚ å¦‚æžœä½ æƒ³è¦å­¦ä¹ å¦‚ä½•å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€çš„è¯ï¼Œå¯ä»¥é˜…è¯»æˆ‘çš„æ–‡ç«  â€œHow to Learn a New Programming Language or Frameworkâ€ï¼Œå°†ä¼šéžå¸¸æœ‰ç”¨ã€‚]]></content>
      <categories>
        <category>ç¿»è¯‘</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åŠ¨æ‰‹å®žçŽ°ä¸€ä¸ª LRU cache]]></title>
    <url>%2F2018%2F04%2F07%2Falgorithm%2FLRU-cache%2F</url>
    <content type="text"><![CDATA[å‰è¨€LRU æ˜¯ Least Recently Used çš„ç®€å†™ï¼Œå­—é¢æ„æ€åˆ™æ˜¯æœ€è¿‘æœ€å°‘ä½¿ç”¨ã€‚ é€šå¸¸ç”¨äºŽç¼“å­˜çš„æ·˜æ±°ç­–ç•¥å®žçŽ°ï¼Œç”±äºŽç¼“å­˜çš„å†…å­˜éžå¸¸å®è´µï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®æŸç§è§„åˆ™æ¥å‰”é™¤æ•°æ®ä¿è¯å†…å­˜ä¸è¢«æ’‘æ»¡ã€‚ å¦‚å¸¸ç”¨çš„ Redis å°±æœ‰ä»¥ä¸‹å‡ ç§ç­–ç•¥ï¼š ç­–ç•¥ æè¿° volatile-lru ä»Žå·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° volatile-ttl ä»Žå·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±° volatile-random ä»Žå·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±° allkeys-lru ä»Žæ‰€æœ‰æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° allkeys-random ä»Žæ‰€æœ‰æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®è¿›è¡Œæ·˜æ±° no-envicition ç¦æ­¢é©±é€æ•°æ® æ‘˜æŠ„è‡ª:https://github.com/CyC2018/Interview-Notebook/blob/master/notes/Redis.md#%E5%8D%81%E4%B8%89%E6%95%B0%E6%8D%AE%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5 å®žçŽ°ä¸€ä¹‹å‰ä¹Ÿæœ‰æŽ¥è§¦è¿‡ä¸€é“é¢è¯•é¢˜ï¼Œå¤§æ¦‚éœ€æ±‚æ˜¯ï¼š å®žçŽ°ä¸€ä¸ª LRU ç¼“å­˜ï¼Œå½“ç¼“å­˜æ•°æ®è¾¾åˆ° N ä¹‹åŽéœ€è¦æ·˜æ±°æŽ‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ã€‚ N å°æ—¶ä¹‹å†…æ²¡æœ‰è¢«è®¿é—®çš„æ•°æ®ä¹Ÿéœ€è¦æ·˜æ±°æŽ‰ã€‚ ä»¥ä¸‹æ˜¯æˆ‘çš„å®žçŽ°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323public class LRUAbstractMap extends java.util.AbstractMap &#123; private final static Logger LOGGER = LoggerFactory.getLogger(LRUAbstractMap.class); /** * æ£€æŸ¥æ˜¯å¦è¶…æœŸçº¿ç¨‹ */ private ExecutorService checkTimePool ; /** * map æœ€å¤§size */ private final static int MAX_SIZE = 1024 ; private final static ArrayBlockingQueue&lt;Node&gt; QUEUE = new ArrayBlockingQueue&lt;&gt;(MAX_SIZE) ; /** * é»˜è®¤å¤§å° */ private final static int DEFAULT_ARRAY_SIZE =1024 ; /** * æ•°ç»„é•¿åº¦ */ private int arraySize ; /** * æ•°ç»„ */ private Object[] arrays ; /** * åˆ¤æ–­æ˜¯å¦åœæ­¢ flag */ private volatile boolean flag = true ; /** * è¶…æ—¶æ—¶é—´ */ private final static Long EXPIRE_TIME = 60 * 60 * 1000L ; /** * æ•´ä¸ª Map çš„å¤§å° */ private volatile AtomicInteger size ; public LRUAbstractMap() &#123; arraySize = DEFAULT_ARRAY_SIZE; arrays = new Object[arraySize] ; //å¼€å¯ä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥æœ€å…ˆæ”¾å…¥é˜Ÿåˆ—çš„å€¼æ˜¯å¦è¶…æœŸ executeCheckTime(); &#125; /** * å¼€å¯ä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥æœ€å…ˆæ”¾å…¥é˜Ÿåˆ—çš„å€¼æ˜¯å¦è¶…æœŸ è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ */ private void executeCheckTime() &#123; ThreadFactory namedThreadFactory = new ThreadFactoryBuilder() .setNameFormat("check-thread-%d") .setDaemon(true) .build(); checkTimePool = new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;&gt;(1),namedThreadFactory,new ThreadPoolExecutor.AbortPolicy()); checkTimePool.execute(new CheckTimeThread()) ; &#125; @Override public Set&lt;Entry&gt; entrySet() &#123; return super.keySet(); &#125; @Override public Object put(Object key, Object value) &#123; int hash = hash(key); int index = hash % arraySize ; Node currentNode = (Node) arrays[index] ; if (currentNode == null)&#123; arrays[index] = new Node(null,null, key, value); //å†™å…¥é˜Ÿåˆ— QUEUE.offer((Node) arrays[index]) ; sizeUp(); &#125;else &#123; Node cNode = currentNode ; Node nNode = cNode ; //å­˜åœ¨å°±è¦†ç›– if (nNode.key == key)&#123; cNode.val = value ; &#125; while (nNode.next != null)&#123; //key å­˜åœ¨ å°±è¦†ç›– ç®€å•åˆ¤æ–­ if (nNode.key == key)&#123; nNode.val = value ; break ; &#125;else &#123; //ä¸å­˜åœ¨å°±æ–°å¢žé“¾è¡¨ sizeUp(); Node node = new Node(nNode,null,key,value) ; //å†™å…¥é˜Ÿåˆ— QUEUE.offer(currentNode) ; cNode.next = node ; &#125; nNode = nNode.next ; &#125; &#125; return null ; &#125; @Override public Object get(Object key) &#123; int hash = hash(key) ; int index = hash % arraySize ; Node currentNode = (Node) arrays[index] ; if (currentNode == null)&#123; return null ; &#125; if (currentNode.next == null)&#123; //æ›´æ–°æ—¶é—´ currentNode.setUpdateTime(System.currentTimeMillis()); //æ²¡æœ‰å†²çª return currentNode ; &#125; Node nNode = currentNode ; while (nNode.next != null)&#123; if (nNode.key == key)&#123; //æ›´æ–°æ—¶é—´ currentNode.setUpdateTime(System.currentTimeMillis()); return nNode ; &#125; nNode = nNode.next ; &#125; return super.get(key); &#125; @Override public Object remove(Object key) &#123; int hash = hash(key) ; int index = hash % arraySize ; Node currentNode = (Node) arrays[index] ; if (currentNode == null)&#123; return null ; &#125; if (currentNode.key == key)&#123; sizeDown(); arrays[index] = null ; //ç§»é™¤é˜Ÿåˆ— QUEUE.poll(); return currentNode ; &#125; Node nNode = currentNode ; while (nNode.next != null)&#123; if (nNode.key == key)&#123; sizeDown(); //åœ¨é“¾è¡¨ä¸­æ‰¾åˆ°äº† æŠŠä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ next æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ nNode.pre.next = nNode.next ; nNode = null ; //ç§»é™¤é˜Ÿåˆ— QUEUE.poll(); return nNode; &#125; nNode = nNode.next ; &#125; return super.remove(key); &#125; /** * å¢žåŠ size */ private void sizeUp()&#123; //åœ¨putå€¼æ—¶å€™è®¤ä¸ºé‡Œè¾¹å·²ç»æœ‰æ•°æ®äº† flag = true ; if (size == null)&#123; size = new AtomicInteger() ; &#125; int size = this.size.incrementAndGet(); if (size &gt;= MAX_SIZE) &#123; //æ‰¾åˆ°é˜Ÿåˆ—å¤´çš„æ•°æ® Node node = QUEUE.poll() ; if (node == null)&#123; throw new RuntimeException("data error") ; &#125; //ç§»é™¤è¯¥ key Object key = node.key ; remove(key) ; lruCallback() ; &#125; &#125; /** * æ•°é‡å‡å° */ private void sizeDown()&#123; if (QUEUE.size() == 0)&#123; flag = false ; &#125; this.size.decrementAndGet() ; &#125; @Override public int size() &#123; return size.get() ; &#125; /** * é“¾è¡¨ */ private class Node&#123; private Node next ; private Node pre ; private Object key ; private Object val ; private Long updateTime ; public Node(Node pre,Node next, Object key, Object val) &#123; this.pre = pre ; this.next = next; this.key = key; this.val = val; this.updateTime = System.currentTimeMillis() ; &#125; public void setUpdateTime(Long updateTime) &#123; this.updateTime = updateTime; &#125; public Long getUpdateTime() &#123; return updateTime; &#125; @Override public String toString() &#123; return "Node&#123;" + "key=" + key + ", val=" + val + '&#125;'; &#125; &#125; /** * copy HashMap çš„ hash å®žçŽ° * @param key * @return */ public int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); &#125; private void lruCallback()&#123; LOGGER.debug("lruCallback"); &#125; private class CheckTimeThread implements Runnable&#123; @Override public void run() &#123; while (flag)&#123; try &#123; Node node = QUEUE.poll(); if (node == null)&#123; continue ; &#125; Long updateTime = node.getUpdateTime() ; if ((updateTime - System.currentTimeMillis()) &gt;= EXPIRE_TIME)&#123; remove(node.key) ; &#125; &#125; catch (Exception e) &#123; LOGGER.error("InterruptedException"); &#125; &#125; &#125; &#125;&#125; æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç›´æŽ¥ä»Ž: https://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/actual/LRUAbstractMap.java ä¸‹è½½ä»£ç æœ¬åœ°è¿è¡Œã€‚ ä»£ç çœ‹ç€æ¯”è¾ƒå¤šï¼Œå…¶å®žå®žçŽ°çš„æ€è·¯è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼š é‡‡ç”¨äº†ä¸Ž HashMap ä¸€æ ·çš„ä¿å­˜æ•°æ®æ–¹å¼ï¼Œåªæ˜¯è‡ªå·±æ‰‹åŠ¨å®žçŽ°äº†ä¸€ä¸ªç®€æ˜“ç‰ˆã€‚ å†…éƒ¨é‡‡ç”¨äº†ä¸€ä¸ªé˜Ÿåˆ—æ¥ä¿å­˜æ¯æ¬¡å†™å…¥çš„æ•°æ®ã€‚ å†™å…¥çš„æ—¶å€™åˆ¤æ–­ç¼“å­˜æ˜¯å¦å¤§äºŽäº†é˜ˆå€¼ Nï¼Œå¦‚æžœæ»¡è¶³åˆ™æ ¹æ®é˜Ÿåˆ—çš„ FIFO ç‰¹æ€§å°†é˜Ÿåˆ—å¤´çš„æ•°æ®åˆ é™¤ã€‚å› ä¸ºé˜Ÿåˆ—å¤´çš„æ•°æ®è‚¯å®šæ˜¯æœ€å…ˆæ”¾è¿›åŽ»çš„ã€‚ å†å¼€å¯äº†ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ç”¨äºŽåˆ¤æ–­æœ€å…ˆæ”¾è¿›åŽ»çš„æ•°æ®æ˜¯å¦è¶…æœŸï¼ˆå› ä¸ºå°±ç®—è¶…æœŸä¹Ÿæ˜¯æœ€å…ˆæ”¾è¿›åŽ»çš„æ•°æ®æœ€æœ‰å¯èƒ½æ»¡è¶³è¶…æœŸæ¡ä»¶ã€‚ï¼‰ è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹å¯ä»¥æ›´å¥½çš„è¡¨æ˜Žå…¶ç›®çš„ï¼ˆæœ€åçš„æƒ…å†µä¸‹ï¼Œå¦‚æžœæ˜¯ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹æœ€ç»ˆæœ‰å¯èƒ½å¯¼è‡´ç¨‹åºä¸èƒ½æ­£å¸¸é€€å‡ºï¼Œå› ä¸ºè¯¥çº¿ç¨‹ä¸€ç›´åœ¨è¿è¡Œï¼Œå®ˆæŠ¤çº¿ç¨‹åˆ™ä¸ä¼šæœ‰è¿™ä¸ªæƒ…å†µã€‚ï¼‰ ä»¥ä¸Šä»£ç å¤§ä½“åŠŸèƒ½æ»¡è¶³äº†ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªè‡´å‘½é—®é¢˜ã€‚ å°±æ˜¯æœ€è¿‘æœ€å°‘ä½¿ç”¨æ²¡æœ‰æ»¡è¶³ï¼Œåˆ é™¤çš„æ•°æ®éƒ½æ˜¯æœ€å…ˆæ”¾å…¥çš„æ•°æ®ã€‚ ä¸è¿‡å…¶ä¸­çš„ put get æµç¨‹ç®—æ˜¯ä¸€ä¸ªç®€æ˜“çš„ HashMap å®žçŽ°ï¼Œå¯ä»¥å¯¹ HashMap åŠ æ·±ä¸€äº›ç†è§£ã€‚ å®žçŽ°äºŒå› æ­¤å¦‚ä½•æ¥å®žçŽ°ä¸€ä¸ªå®Œæ•´çš„ LRU ç¼“å­˜å‘¢ï¼Œè¿™æ¬¡ä¸è€ƒè™‘è¿‡æœŸæ—¶é—´çš„é—®é¢˜ã€‚ å…¶å®žä»Žä¸Šä¸€ä¸ªå®žçŽ°ä¹Ÿèƒ½æƒ³åˆ°ä¸€äº›æ€è·¯ï¼š è¦è®°å½•æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œé‚£è‡³å°‘éœ€è¦ä¸€ä¸ªæœ‰åºçš„é›†åˆæ¥ä¿è¯å†™å…¥çš„é¡ºåºã€‚ åœ¨ä½¿ç”¨äº†æ•°æ®ä¹‹åŽèƒ½å¤Ÿæ›´æ–°å®ƒçš„é¡ºåºã€‚ åŸºäºŽä»¥ä¸Šä¸¤ç‚¹å¾ˆå®¹æ˜“æƒ³åˆ°ä¸€ä¸ªå¸¸ç”¨çš„æ•°æ®ç»“æž„ï¼šé“¾è¡¨ã€‚ æ¯æ¬¡å†™å…¥æ•°æ®æ—¶å°†æ•°æ®æ”¾å…¥é“¾è¡¨å¤´ç»“ç‚¹ã€‚ ä½¿ç”¨æ•°æ®æ—¶å€™å°†æ•°æ®ç§»åŠ¨åˆ°å¤´ç»“ç‚¹ã€‚ ç¼“å­˜æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ç§»é™¤é“¾è¡¨å°¾éƒ¨æ•°æ®ã€‚ å› æ­¤æœ‰äº†ä»¥ä¸‹å®žçŽ°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211public class LRUMap&lt;K, V&gt; &#123; private final Map&lt;K, V&gt; cacheMap = new HashMap&lt;&gt;(); /** * æœ€å¤§ç¼“å­˜å¤§å° */ private int cacheSize; /** * èŠ‚ç‚¹å¤§å° */ private int nodeCount; /** * å¤´ç»“ç‚¹ */ private Node&lt;K, V&gt; header; /** * å°¾ç»“ç‚¹ */ private Node&lt;K, V&gt; tailer; public LRUMap(int cacheSize) &#123; this.cacheSize = cacheSize; //å¤´ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ä¸ºç©º header = new Node&lt;&gt;(); header.next = null; //å°¾ç»“ç‚¹çš„ä¸Šä¸€ä¸ªç»“ç‚¹ä¸ºç©º tailer = new Node&lt;&gt;(); tailer.tail = null; //åŒå‘é“¾è¡¨ å¤´ç»“ç‚¹çš„ä¸Šç»“ç‚¹æŒ‡å‘å°¾ç»“ç‚¹ header.tail = tailer; //å°¾ç»“ç‚¹çš„ä¸‹ç»“ç‚¹æŒ‡å‘å¤´ç»“ç‚¹ tailer.next = header; &#125; public void put(K key, V value) &#123; cacheMap.put(key, value); //åŒå‘é“¾è¡¨ä¸­æ·»åŠ ç»“ç‚¹ addNode(key, value); &#125; public V get(K key)&#123; Node&lt;K, V&gt; node = getNode(key); //ç§»åŠ¨åˆ°å¤´ç»“ç‚¹ moveToHead(node) ; return cacheMap.get(key); &#125; private void moveToHead(Node&lt;K,V&gt; node)&#123; //å¦‚æžœæ˜¯æœ€åŽçš„ä¸€ä¸ªèŠ‚ç‚¹ if (node.tail == null)&#123; node.next.tail = null ; tailer = node.next ; nodeCount -- ; &#125; //å¦‚æžœæ˜¯æœ¬æ¥å°±æ˜¯å¤´èŠ‚ç‚¹ ä¸ä½œå¤„ç† if (node.next == null)&#123; return ; &#125; //å¦‚æžœå¤„äºŽä¸­é—´èŠ‚ç‚¹ if (node.tail != null &amp;&amp; node.next != null)&#123; //å®ƒçš„ä¸Šä¸€èŠ‚ç‚¹æŒ‡å‘å®ƒçš„ä¸‹ä¸€èŠ‚ç‚¹ ä¹Ÿå°±åˆ é™¤å½“å‰èŠ‚ç‚¹ node.tail.next = node.next ; nodeCount -- ; &#125; //æœ€åŽåœ¨å¤´éƒ¨å¢žåŠ å½“å‰èŠ‚ç‚¹ //æ³¨æ„è¿™é‡Œéœ€è¦é‡æ–° new ä¸€ä¸ªå¯¹è±¡ï¼Œä¸ç„¶åŽŸæœ¬çš„node è¿˜æœ‰ç€ä¸‹é¢çš„å¼•ç”¨ï¼Œä¼šé€ æˆå†…å­˜æº¢å‡ºã€‚ node = new Node&lt;&gt;(node.getKey(),node.getValue()) ; addHead(node) ; &#125; /** * é“¾è¡¨æŸ¥è¯¢ æ•ˆçŽ‡è¾ƒä½Ž * @param key * @return */ private Node&lt;K,V&gt; getNode(K key)&#123; Node&lt;K,V&gt; node = tailer ; while (node != null)&#123; if (node.getKey().equals(key))&#123; return node ; &#125; node = node.next ; &#125; return null ; &#125; /** * å†™å…¥å¤´ç»“ç‚¹ * @param key * @param value */ private void addNode(K key, V value) &#123; Node&lt;K, V&gt; node = new Node&lt;&gt;(key, value); //å®¹é‡æ»¡äº†åˆ é™¤æœ€åŽä¸€ä¸ª if (cacheSize == nodeCount) &#123; //åˆ é™¤å°¾ç»“ç‚¹ delTail(); &#125; //å†™å…¥å¤´ç»“ç‚¹ addHead(node); &#125; /** * æ·»åŠ å¤´ç»“ç‚¹ * * @param node */ private void addHead(Node&lt;K, V&gt; node) &#123; //å†™å…¥å¤´ç»“ç‚¹ header.next = node; node.tail = header; header = node; nodeCount++; //å¦‚æžœå†™å…¥çš„æ•°æ®å¤§äºŽ2ä¸ª å°±å°†åˆå§‹åŒ–çš„å¤´å°¾ç»“ç‚¹åˆ é™¤ if (nodeCount == 2) &#123; tailer.next.next.tail = null; tailer = tailer.next.next; &#125; &#125; private void delTail() &#123; //æŠŠå°¾ç»“ç‚¹ä»Žç¼“å­˜ä¸­åˆ é™¤ cacheMap.remove(tailer.getKey()); //åˆ é™¤å°¾ç»“ç‚¹ tailer.next.tail = null; tailer = tailer.next; nodeCount--; &#125; private class Node&lt;K, V&gt; &#123; private K key; private V value; Node&lt;K, V&gt; tail; Node&lt;K, V&gt; next; public Node(K key, V value) &#123; this.key = key; this.value = value; &#125; public Node() &#123; &#125; public K getKey() &#123; return key; &#125; public void setKey(K key) &#123; this.key = key; &#125; public V getValue() &#123; return value; &#125; public void setValue(V value) &#123; this.value = value; &#125; &#125; @Override public String toString() &#123; StringBuilder sb = new StringBuilder() ; Node&lt;K,V&gt; node = tailer ; while (node != null)&#123; sb.append(node.getKey()).append(":") .append(node.getValue()) .append("--&gt;") ; node = node.next ; &#125; return sb.toString(); &#125;&#125; æºç ï¼šhttps://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/actual/LRUMap.java å®žé™…æ•ˆæžœï¼Œå†™å…¥æ—¶ï¼š 1234567891011121314151617181920 @Test public void put() throws Exception &#123; LRUMap&lt;String,Integer&gt; lruMap = new LRUMap(3) ; lruMap.put("1",1) ; lruMap.put("2",2) ; lruMap.put("3",3) ; System.out.println(lruMap.toString()); lruMap.put("4",4) ; System.out.println(lruMap.toString()); lruMap.put("5",5) ; System.out.println(lruMap.toString()); &#125;//è¾“å‡ºï¼š1:1--&gt;2:2--&gt;3:3--&gt;2:2--&gt;3:3--&gt;4:4--&gt;3:3--&gt;4:4--&gt;5:5--&gt; ä½¿ç”¨æ—¶ï¼š 12345678910111213141516171819202122 @Test public void get() throws Exception &#123; LRUMap&lt;String,Integer&gt; lruMap = new LRUMap(3) ; lruMap.put("1",1) ; lruMap.put("2",2) ; lruMap.put("3",3) ; System.out.println(lruMap.toString()); System.out.println("=============="); Integer integer = lruMap.get("1"); System.out.println(integer); System.out.println("=============="); System.out.println(lruMap.toString()); &#125; //è¾“å‡º1:1--&gt;2:2--&gt;3:3--&gt;==============1==============2:2--&gt;3:3--&gt;1:1--&gt; å®žçŽ°æ€è·¯å’Œä¸Šæ–‡æåˆ°çš„ä¸€è‡´ï¼Œè¯´ä¸‹é‡ç‚¹ï¼š æ•°æ®æ˜¯ç›´æŽ¥åˆ©ç”¨ HashMap æ¥å­˜æ”¾çš„ã€‚ å†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥å­˜æ”¾æ•°æ®ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªå¤´ç»“ç‚¹ headerï¼Œä»¥åŠå°¾ç»“ç‚¹ tailerã€‚ æ¯æ¬¡å†™å…¥å¤´ç»“ç‚¹ï¼Œåˆ é™¤å°¾ç»“ç‚¹æ—¶éƒ½æ˜¯ä¾èµ–äºŽ header tailerï¼Œå¦‚æžœçœ‹ç€æ¯”è¾ƒæ‡µå»ºè®®è‡ªå·±å®žçŽ°ä¸€ä¸ªé“¾è¡¨ç†Ÿæ‚‰ä¸‹ï¼Œæˆ–ç»“åˆä¸‹æ–‡çš„å¯¹è±¡å…³ç³»å›¾ä¸€èµ·ç†è§£ã€‚ ä½¿ç”¨æ•°æ®ç§»åŠ¨åˆ°é“¾è¡¨å¤´æ—¶ï¼Œç¬¬ä¸€æ­¥æ˜¯éœ€è¦åœ¨åŒå‘é“¾è¡¨ä¸­æ‰¾åˆ°è¯¥èŠ‚ç‚¹ã€‚è¿™é‡Œå°±ä½“çŽ°å‡ºé“¾è¡¨çš„é—®é¢˜äº†ã€‚æŸ¥æ‰¾æ•ˆçŽ‡å¾ˆä½Žï¼Œæœ€å·®éœ€è¦ O(N)ã€‚ä¹‹åŽä¾èµ–äºŽå½“å‰èŠ‚ç‚¹è¿›è¡Œç§»åŠ¨ã€‚ åœ¨å†™å…¥å¤´ç»“ç‚¹æ—¶æœ‰åˆ¤æ–­é“¾è¡¨å¤§å°ç­‰äºŽ 2 æ—¶éœ€è¦åˆ é™¤åˆå§‹åŒ–çš„å¤´å°¾ç»“ç‚¹ã€‚è¿™æ˜¯å› ä¸ºåˆå§‹åŒ–æ—¶å€™ç”Ÿæˆäº†ä¸¤ä¸ªåŒå‘èŠ‚ç‚¹ï¼Œæ²¡æœ‰æ•°æ®åªæ˜¯ä¸ºäº†å½¢æˆä¸€ä¸ªæ•°æ®ç»“æž„ã€‚å½“çœŸå®žæ•°æ®è¿›æ¥ä¹‹åŽéœ€è¦åˆ é™¤ä»¥æ–¹ä¾¿åŽç»­çš„æ“ä½œï¼ˆè¿™ç‚¹å¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼‰ã€‚ ä»¥ä¸Šçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œéœ€è¦ä½¿ç”¨è€…è‡ªè¡ŒæŽ§åˆ¶ã€‚ ä¸‹é¢æ˜¯å¯¹è±¡å…³ç³»å›¾ï¼š åˆå§‹åŒ–æ—¶ å†™å…¥æ•°æ®æ—¶12LRUMap&lt;String,Integer&gt; lruMap = new LRUMap(3) ;lruMap.put("1",1) ; 1lruMap.put("2",2) ; 1lruMap.put("3",3) ; 1lruMap.put("4",4) ; èŽ·å–æ•°æ®æ—¶æ•°æ®å’Œä¸Šæ–‡ä¸€æ ·ï¼š 1Integer integer = lruMap.get("2"); é€šè¿‡ä»¥ä¸Šå‡ å¼ å›¾åº”è¯¥æ˜¯å¾ˆå¥½ç†è§£æ•°æ®æ˜¯å¦‚ä½•å­˜æ”¾çš„äº†ã€‚ å®žçŽ°ä¸‰å…¶å®žå¦‚æžœå¯¹ Java çš„é›†åˆæ¯”è¾ƒç†Ÿæ‚‰çš„è¯ï¼Œä¼šå‘çŽ°ä¸Šæ–‡çš„ç»“æž„å’Œ LinkedHashMap éžå¸¸ç±»ä¼¼ã€‚ å¯¹æ­¤ä¸å¤ªç†Ÿæ‚‰çš„æœ‹å‹å¯ä»¥å…ˆäº†è§£ä¸‹ LinkedHashMap åº•å±‚åˆ†æž ã€‚ æ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥å€ŸåŠ©äºŽå®ƒæ¥å®žçŽ°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839public class LRULinkedMap&lt;K,V&gt; &#123; /** * æœ€å¤§ç¼“å­˜å¤§å° */ private int cacheSize; private LinkedHashMap&lt;K,V&gt; cacheMap ; public LRULinkedMap(int cacheSize) &#123; this.cacheSize = cacheSize; cacheMap = new LinkedHashMap(16,0.75F,true)&#123; @Override protected boolean removeEldestEntry(Map.Entry eldest) &#123; if (cacheSize + 1 == cacheMap.size())&#123; return true ; &#125;else &#123; return false ; &#125; &#125; &#125;; &#125; public void put(K key,V value)&#123; cacheMap.put(key,value) ; &#125; public V get(K key)&#123; return cacheMap.get(key) ; &#125; public Collection&lt;Map.Entry&lt;K, V&gt;&gt; getAll() &#123; return new ArrayList&lt;Map.Entry&lt;K, V&gt;&gt;(cacheMap.entrySet()); &#125;&#125; æºç ï¼šhttps://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/actual/LRULinkedMap.java è¿™æ¬¡å°±æ¯”è¾ƒç®€æ´äº†ï¼Œä¹Ÿå°±å‡ è¡Œä»£ç ï¼ˆå…·ä½“çš„é€»è¾‘ LinkedHashMap å·²ç»å¸®æˆ‘ä»¬å®žçŽ°å¥½äº†ï¼‰ å®žé™…æ•ˆæžœ: 123456789101112131415161718192021 @Test public void put() throws Exception &#123; LRULinkedMap&lt;String,Integer&gt; map = new LRULinkedMap(3) ; map.put("1",1); map.put("2",2); map.put("3",3); for (Map.Entry&lt;String, Integer&gt; e : map.getAll())&#123; System.out.print(e.getKey() + " : " + e.getValue() + "\t"); &#125; System.out.println(""); map.put("4",4); for (Map.Entry&lt;String, Integer&gt; e : map.getAll())&#123; System.out.print(e.getKey() + " : " + e.getValue() + "\t"); &#125; &#125; //è¾“å‡º1 : 1 2 : 2 3 : 3 2 : 2 3 : 3 4 : 4 ä½¿ç”¨æ—¶ï¼š 123456789101112131415161718192021222324 @Test public void get() throws Exception &#123; LRULinkedMap&lt;String,Integer&gt; map = new LRULinkedMap(4) ; map.put("1",1); map.put("2",2); map.put("3",3); map.put("4",4); for (Map.Entry&lt;String, Integer&gt; e : map.getAll())&#123; System.out.print(e.getKey() + " : " + e.getValue() + "\t"); &#125; System.out.println(""); map.get("1") ; for (Map.Entry&lt;String, Integer&gt; e : map.getAll())&#123; System.out.print(e.getKey() + " : " + e.getValue() + "\t"); &#125; &#125;&#125;//è¾“å‡º1 : 1 2 : 2 3 : 3 4 : 4 2 : 2 3 : 3 4 : 4 1 : 1 LinkedHashMap å†…éƒ¨ä¹Ÿæœ‰ç»´æŠ¤ä¸€ä¸ªåŒå‘é˜Ÿåˆ—ï¼Œåœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¼šç»™å®šä¸€ä¸ªç¼“å­˜å¤§å°çš„é˜ˆå€¼ã€‚åˆå§‹åŒ–æ—¶è‡ªå®šä¹‰æ˜¯å¦éœ€è¦åˆ é™¤æœ€è¿‘ä¸å¸¸ä½¿ç”¨çš„æ•°æ®ï¼Œå¦‚æžœæ˜¯åˆ™ä¼šæŒ‰ç…§å®žçŽ°äºŒä¸­çš„æ–¹å¼ç®¡ç†æ•°æ®ã€‚ å…¶å®žä¸»è¦ä»£ç å°±æ˜¯é‡å†™äº† LinkedHashMap çš„ removeEldestEntry æ–¹æ³•: 123protected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) &#123; return false;&#125; å®ƒé»˜è®¤æ˜¯è¿”å›ž falseï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šç®¡æœ‰æ²¡æœ‰è¶…è¿‡é˜ˆå€¼ã€‚ æ‰€ä»¥æˆ‘ä»¬è‡ªå®šä¹‰å¤§äºŽäº†é˜ˆå€¼æ—¶è¿”å›ž trueï¼Œè¿™æ · LinkedHashMap å°±ä¼šå¸®æˆ‘ä»¬åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ã€‚ æ€»ç»“ä»¥ä¸Šå°±æ˜¯å¯¹ LRU ç¼“å­˜çš„å®žçŽ°ï¼Œäº†è§£äº†è¿™äº›è‡³å°‘åœ¨å¹³æ—¶ä½¿ç”¨æ—¶å¯ä»¥çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚ å½“ç„¶ä¸šç•Œä½¿ç”¨è¾ƒå¤šçš„è¿˜æœ‰ guava çš„å®žçŽ°ï¼Œå¹¶ä¸”å®ƒè¿˜æ”¯æŒå¤šç§è¿‡æœŸç­–ç•¥ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>ç®—æ³•</category>
        <category>LRU cache</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åŸºäºŽ Redis çš„åˆ†å¸ƒå¼é”]]></title>
    <url>%2F2018%2F03%2F29%2Fdistributed-lock%2Fdistributed-lock-redis%2F</url>
    <content type="text"><![CDATA[å‰è¨€åˆ†å¸ƒå¼é”åœ¨åˆ†å¸ƒå¼åº”ç”¨ä¸­åº”ç”¨å¹¿æ³›ï¼Œæƒ³è¦æžæ‡‚ä¸€ä¸ªæ–°äº‹ç‰©é¦–å…ˆå¾—äº†è§£å®ƒçš„ç”±æ¥ï¼Œè¿™æ ·æ‰èƒ½æ›´åŠ çš„ç†è§£ç”šè‡³å¯ä»¥ä¸¾ä¸€åä¸‰ã€‚ é¦–å…ˆè°ˆåˆ°åˆ†å¸ƒå¼é”è‡ªç„¶ä¹Ÿå°±è”æƒ³åˆ°åˆ†å¸ƒå¼åº”ç”¨ã€‚ åœ¨æˆ‘ä»¬å°†åº”ç”¨æ‹†åˆ†ä¸ºåˆ†å¸ƒå¼åº”ç”¨ä¹‹å‰çš„å•æœºç³»ç»Ÿä¸­ï¼Œå¯¹ä¸€äº›å¹¶å‘åœºæ™¯è¯»å–å…¬å…±èµ„æºæ—¶å¦‚æ‰£åº“å­˜ï¼Œå–è½¦ç¥¨ä¹‹ç±»çš„éœ€æ±‚å¯ä»¥ç®€å•çš„ä½¿ç”¨åŒæ­¥æˆ–è€…æ˜¯åŠ é”å°±å¯ä»¥å®žçŽ°ã€‚ ä½†æ˜¯åº”ç”¨åˆ†å¸ƒå¼äº†ä¹‹åŽç³»ç»Ÿç”±ä»¥å‰çš„å•è¿›ç¨‹å¤šçº¿ç¨‹çš„ç¨‹åºå˜ä¸ºäº†å¤šè¿›ç¨‹å¤šçº¿ç¨‹ï¼Œè¿™æ—¶ä½¿ç”¨ä»¥ä¸Šçš„è§£å†³æ–¹æ¡ˆæ˜Žæ˜¾å°±ä¸å¤Ÿäº†ã€‚ å› æ­¤ä¸šç•Œå¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯å€ŸåŠ©äºŽä¸€ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶å¹¶åˆ©ç”¨å®ƒè‡ªèº«çš„æŽ’ä»–æ€§æ¥è¾¾åˆ°å¤šè¿›ç¨‹çš„äº’æ–¥ã€‚å¦‚ï¼š åŸºäºŽ DB çš„å”¯ä¸€ç´¢å¼•ã€‚ åŸºäºŽ ZK çš„ä¸´æ—¶æœ‰åºèŠ‚ç‚¹ã€‚ åŸºäºŽ Redis çš„ NX EX å‚æ•°ã€‚ è¿™é‡Œä¸»è¦åŸºäºŽ Redis è¿›è¡Œè®¨è®ºã€‚ å®žçŽ°æ—¢ç„¶æ˜¯é€‰ç”¨äº† Redisï¼Œé‚£ä¹ˆå®ƒå°±å¾—å…·æœ‰æŽ’ä»–æ€§æ‰è¡Œã€‚åŒæ—¶å®ƒæœ€å¥½ä¹Ÿæœ‰é”çš„ä¸€äº›åŸºæœ¬ç‰¹æ€§ï¼š é«˜æ€§èƒ½(åŠ ã€è§£é”æ—¶é«˜æ€§èƒ½) å¯ä»¥ä½¿ç”¨é˜»å¡žé”ä¸Žéžé˜»å¡žé”ã€‚ ä¸èƒ½å‡ºçŽ°æ­»é”ã€‚ å¯ç”¨æ€§(ä¸èƒ½å‡ºçŽ°èŠ‚ç‚¹ down æŽ‰åŽåŠ é”å¤±è´¥)ã€‚ è¿™é‡Œåˆ©ç”¨ Redis set key æ—¶çš„ä¸€ä¸ª NX å‚æ•°å¯ä»¥ä¿è¯åœ¨è¿™ä¸ª key ä¸å­˜åœ¨çš„æƒ…å†µä¸‹å†™å…¥æˆåŠŸã€‚å¹¶ä¸”å†åŠ ä¸Š EX å‚æ•°å¯ä»¥è®©è¯¥ key åœ¨è¶…æ—¶ä¹‹åŽè‡ªåŠ¨åˆ é™¤ã€‚ æ‰€ä»¥åˆ©ç”¨ä»¥ä¸Šä¸¤ä¸ªç‰¹æ€§å¯ä»¥ä¿è¯åœ¨åŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªè¿›ç¨‹èŽ·å¾—é”ï¼Œå¹¶ä¸”ä¸ä¼šå‡ºçŽ°æ­»é”(æœ€åçš„æƒ…å†µå°±æ˜¯è¶…æ—¶è‡ªåŠ¨åˆ é™¤ key)ã€‚ åŠ é”å®žçŽ°ä»£ç å¦‚ä¸‹ï¼š 12345678910111213private static final String SET_IF_NOT_EXIST = "NX";private static final String SET_WITH_EXPIRE_TIME = "PX";public boolean tryLock(String key, String request) &#123; String result = this.jedis.set(LOCK_PREFIX + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); if (LOCK_MSG.equals(result))&#123; return true ; &#125;else &#123; return false ; &#125;&#125; æ³¨æ„è¿™é‡Œä½¿ç”¨çš„ jedis çš„ 1String set(String key, String value, String nxxx, String expx, long time); apiã€‚ è¯¥å‘½ä»¤å¯ä»¥ä¿è¯ NX EX çš„åŽŸå­æ€§ã€‚ ä¸€å®šä¸è¦æŠŠä¸¤ä¸ªå‘½ä»¤(NX EX)åˆ†å¼€æ‰§è¡Œï¼Œå¦‚æžœåœ¨ NX ä¹‹åŽç¨‹åºå‡ºçŽ°é—®é¢˜å°±æœ‰å¯èƒ½äº§ç”Ÿæ­»é”ã€‚ é˜»å¡žé”åŒæ—¶ä¹Ÿå¯ä»¥å®žçŽ°ä¸€ä¸ªé˜»å¡žé”ï¼š 123456789101112131415161718192021222324252627282930//ä¸€ç›´é˜»å¡žpublic void lock(String key, String request) throws InterruptedException &#123; for (;;)&#123; String result = this.jedis.set(LOCK_PREFIX + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); if (LOCK_MSG.equals(result))&#123; break ; &#125; //é˜²æ­¢ä¸€ç›´æ¶ˆè€— CPU Thread.sleep(DEFAULT_SLEEP_TIME) ; &#125;&#125; //è‡ªå®šä¹‰é˜»å¡žæ—¶é—´ public boolean lock(String key, String request,int blockTime) throws InterruptedException &#123; while (blockTime &gt;= 0)&#123; String result = this.jedis.set(LOCK_PREFIX + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); if (LOCK_MSG.equals(result))&#123; return true ; &#125; blockTime -= DEFAULT_SLEEP_TIME ; Thread.sleep(DEFAULT_SLEEP_TIME) ; &#125; return false ;&#125; è§£é”è§£é”ä¹Ÿå¾ˆç®€å•ï¼Œå…¶å®žå°±æ˜¯æŠŠè¿™ä¸ª key åˆ æŽ‰å°±ä¸‡äº‹å¤§å‰äº†ï¼Œæ¯”å¦‚ä½¿ç”¨ del key å‘½ä»¤ã€‚ ä½†çŽ°å®žå¾€å¾€æ²¡æœ‰é‚£ä¹ˆ easyã€‚ å¦‚æžœè¿›ç¨‹ A èŽ·å–äº†é”è®¾ç½®äº†è¶…æ—¶æ—¶é—´ï¼Œä½†æ˜¯ç”±äºŽæ‰§è¡Œå‘¨æœŸè¾ƒé•¿å¯¼è‡´åˆ°äº†è¶…æ—¶æ—¶é—´ä¹‹åŽé”å°±è‡ªåŠ¨é‡Šæ”¾äº†ã€‚è¿™æ—¶è¿›ç¨‹ B èŽ·å–äº†è¯¥é”æ‰§è¡Œå¾ˆå¿«å°±é‡Šæ”¾é”ã€‚è¿™æ ·å°±ä¼šå‡ºçŽ°è¿›ç¨‹ B å°†è¿›ç¨‹ A çš„é”é‡Šæ”¾äº†ã€‚ æ‰€ä»¥æœ€å¥½çš„æ–¹å¼æ˜¯åœ¨æ¯æ¬¡è§£é”æ—¶éƒ½éœ€è¦åˆ¤æ–­é”æ˜¯å¦æ˜¯è‡ªå·±çš„ã€‚ è¿™æ—¶å°±éœ€è¦ç»“åˆåŠ é”æœºåˆ¶ä¸€èµ·å®žçŽ°äº†ã€‚ åŠ é”æ—¶éœ€è¦ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œå°†è¯¥å‚æ•°ä½œä¸ºè¿™ä¸ª key çš„ valueï¼Œè¿™æ ·æ¯æ¬¡è§£é”æ—¶åˆ¤æ–­ value æ˜¯å¦ç›¸ç­‰å³å¯ã€‚ æ‰€ä»¥è§£é”ä»£ç å°±ä¸èƒ½æ˜¯ç®€å•çš„ deläº†ã€‚ 1234567891011121314151617181920public boolean unlock(String key,String request)&#123; //lua script String script = "if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end"; Object result = null ; if (jedis instanceof Jedis)&#123; result = ((Jedis)this.jedis).eval(script, Collections.singletonList(LOCK_PREFIX + key), Collections.singletonList(request)); &#125;else if (jedis instanceof JedisCluster)&#123; result = ((JedisCluster)this.jedis).eval(script, Collections.singletonList(LOCK_PREFIX + key), Collections.singletonList(request)); &#125;else &#123; //throw new RuntimeException("instance is error") ; return false ; &#125; if (UNLOCK_MSG.equals(result))&#123; return true ; &#125;else &#123; return false ; &#125;&#125; è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ª lua è„šæœ¬æ¥åˆ¤æ–­ value æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰æ‰æ‰§è¡Œ del å‘½ä»¤ã€‚ ä½¿ç”¨ lua ä¹Ÿå¯ä»¥ä¿è¯è¿™é‡Œä¸¤ä¸ªæ“ä½œçš„åŽŸå­æ€§ã€‚ å› æ­¤ä¸Šæ–‡æåˆ°çš„å››ä¸ªåŸºæœ¬ç‰¹æ€§ä¹Ÿèƒ½æ»¡è¶³äº†ï¼š ä½¿ç”¨ Redis å¯ä»¥ä¿è¯æ€§èƒ½ã€‚ é˜»å¡žé”ä¸Žéžé˜»å¡žé”è§ä¸Šæ–‡ã€‚ åˆ©ç”¨è¶…æ—¶æœºåˆ¶è§£å†³äº†æ­»é”ã€‚ Redis æ”¯æŒé›†ç¾¤éƒ¨ç½²æé«˜äº†å¯ç”¨æ€§ã€‚ ä½¿ç”¨æˆ‘è‡ªå·±æœ‰æ’¸äº†ä¸€ä¸ªå®Œæ•´çš„å®žçŽ°ï¼Œå¹¶ä¸”å·²ç»ç”¨äºŽäº†ç”Ÿäº§ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å¼€ç®±ä½¿ç”¨: maven ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;top.crossoverjie.opensource&lt;/groupId&gt; &lt;artifactId&gt;distributed-redis-lock&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;/dependency&gt; é…ç½® bean : 1234567891011121314@Configurationpublic class RedisLockConfig &#123; @Bean public RedisLock build()&#123; RedisLock redisLock = new RedisLock() ; HostAndPort hostAndPort = new HostAndPort("127.0.0.1",7000) ; JedisCluster jedisCluster = new JedisCluster(hostAndPort) ; // Jedis æˆ– JedisCluster éƒ½å¯ä»¥ redisLock.setJedisCluster(jedisCluster) ; return redisLock ; &#125;&#125; ä½¿ç”¨ï¼š 123456789101112131415161718192021@Autowiredprivate RedisLock redisLock ;public void use() &#123; String key = "key"; String request = UUID.randomUUID().toString(); try &#123; boolean locktest = redisLock.tryLock(key, request); if (!locktest) &#123; System.out.println("locked error"); return; &#125; //do something &#125; finally &#123; redisLock.unlock(key,request) ; &#125;&#125; ä½¿ç”¨å¾ˆç®€å•ã€‚è¿™é‡Œä¸»è¦æ˜¯æƒ³åˆ©ç”¨ Spring æ¥å¸®æˆ‘ä»¬ç®¡ç† RedisLock è¿™ä¸ªå•ä¾‹çš„ beanï¼Œæ‰€ä»¥åœ¨é‡Šæ”¾é”çš„æ—¶å€™éœ€è¦æ‰‹åŠ¨(å› ä¸ºæ•´ä¸ªä¸Šä¸‹æ–‡åªæœ‰ä¸€ä¸ª RedisLock å®žä¾‹)çš„ä¼ å…¥ key ä»¥åŠ request(api çœ‹èµ·æ¥ä¸æ˜¯ç‰¹åˆ«ä¼˜é›…)ã€‚ ä¹Ÿå¯ä»¥åœ¨æ¯æ¬¡ä½¿ç”¨é”çš„æ—¶å€™ new ä¸€ä¸ª RedisLock ä¼ å…¥ key ä»¥åŠ requestï¼Œè¿™æ ·å€’æ˜¯åœ¨è§£é”æ—¶å¾ˆæ–¹ä¾¿ã€‚ä½†æ˜¯éœ€è¦è‡ªè¡Œç®¡ç† RedisLock çš„å®žä¾‹ã€‚å„æœ‰ä¼˜åŠ£å§ã€‚ é¡¹ç›®æºç åœ¨ï¼š https://github.com/crossoverJie/distributed-lock-redis æ¬¢è¿Žè®¨è®ºã€‚ å•æµ‹åœ¨åšè¿™ä¸ªé¡¹ç›®çš„æ—¶å€™è®©æˆ‘ä¸å¾—ä¸æƒ³æä¸€ä¸‹å•æµ‹ã€‚ å› ä¸ºè¿™ä¸ªåº”ç”¨æ˜¯å¼ºä¾èµ–äºŽç¬¬ä¸‰æ–¹ç»„ä»¶çš„(Redis)ï¼Œä½†æ˜¯åœ¨å•æµ‹ä¸­æˆ‘ä»¬éœ€è¦æŽ’é™¤æŽ‰è¿™ç§ä¾èµ–ã€‚æ¯”å¦‚å…¶ä»–ä¼™ä¼´ fork äº†è¯¥é¡¹ç›®æƒ³åœ¨æœ¬åœ°è·‘ä¸€éå•æµ‹ï¼Œç»“æžœè¿è¡Œä¸èµ·æ¥ï¼š æœ‰å¯èƒ½æ˜¯ Redis çš„ ipã€ç«¯å£å’Œå•æµ‹é‡Œçš„ä¸ä¸€è‡´ã€‚ Redis è‡ªèº«å¯èƒ½ä¹Ÿæœ‰é—®é¢˜ã€‚ ä¹Ÿæœ‰å¯èƒ½æ˜¯è¯¥åŒå­¦çš„çŽ¯å¢ƒä¸­å¹¶æ²¡æœ‰ Redisã€‚ æ‰€ä»¥æœ€å¥½æ˜¯è¦æŠŠè¿™äº›å¤–éƒ¨ä¸ç¨³å®šçš„å› ç´ æŽ’é™¤æŽ‰ï¼Œå•æµ‹åªæµ‹æˆ‘ä»¬å†™å¥½çš„ä»£ç ã€‚ äºŽæ˜¯å°±å¯ä»¥å¼•å…¥å•æµ‹åˆ©å™¨ Mock äº†ã€‚ å®ƒçš„æƒ³æ³•å¾ˆç®€ç­”ï¼Œå°±æ˜¯è¦æŠŠä½ æ‰€ä¾èµ–çš„å¤–éƒ¨èµ„æºç»Ÿç»Ÿå±è”½æŽ‰ã€‚å¦‚ï¼šæ•°æ®åº“ã€å¤–éƒ¨æŽ¥å£ã€å¤–éƒ¨æ–‡ä»¶ç­‰ç­‰ã€‚ ä½¿ç”¨æ–¹å¼ä¹ŸæŒºç®€å•ï¼Œå¯ä»¥å‚è€ƒè¯¥é¡¹ç›®çš„å•æµ‹ï¼š 12345678910111213141516@Testpublic void tryLock() throws Exception &#123; String key = "test"; String request = UUID.randomUUID().toString(); Mockito.when(jedisCluster.set(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyLong())).thenReturn("OK"); boolean locktest = redisLock.tryLock(key, request); System.out.println("locktest=" + locktest); Assert.assertTrue(locktest); //check Mockito.verify(jedisCluster).set(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyLong());&#125; è¿™é‡Œåªæ˜¯ç®€å•æ¼”ç¤ºä¸‹ï¼Œå¯ä»¥çš„è¯ä¸‹æ¬¡ä»”ç»†åˆ†æžåˆ†æžã€‚ å®ƒçš„åŽŸç†å…¶å®žä¹ŸæŒºç®€å•ï¼Œdebug çš„è¯å¯ä»¥å¾ˆç›´æŽ¥çš„çœ‹å‡ºæ¥ï¼š è¿™é‡Œæˆ‘ä»¬æ‰€ä¾èµ–çš„ JedisCluster å…¶å®žæ˜¯ä¸€ä¸ª cglib ä»£ç†å¯¹è±¡ã€‚æ‰€ä»¥ä¹Ÿä¸éš¾æƒ³åˆ°å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° JedisCluster çš„ set å‡½æ•°å¹¶éœ€è¦å®ƒçš„è¿”å›žå€¼ã€‚ Mock å°±å°†è¯¥å¯¹è±¡ä»£ç†äº†ï¼Œå¹¶åœ¨å®žé™…æ‰§è¡Œ set æ–¹æ³•åŽç»™ä½ è¿”å›žäº†ä¸€ä¸ªä½ è‡ªå®šä¹‰çš„å€¼ã€‚ è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšå¿ƒæ‰€æ¬²çš„æµ‹è¯•äº†ï¼Œå®Œå…¨æŠŠå¤–éƒ¨ä¾èµ–æ‰€å±è”½äº†ã€‚ æ€»ç»“è‡³æ­¤ä¸€ä¸ªåŸºäºŽ Redis çš„åˆ†å¸ƒå¼é”å®Œæˆï¼Œä½†æ˜¯ä¾ç„¶æœ‰äº›é—®é¢˜ã€‚ å¦‚åœ¨ key è¶…æ—¶ä¹‹åŽä¸šåŠ¡å¹¶æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ä½†å´è‡ªåŠ¨é‡Šæ”¾é”äº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¹¶å‘é—®é¢˜ã€‚ å°±ç®— Redis æ˜¯é›†ç¾¤éƒ¨ç½²çš„ï¼Œå¦‚æžœæ¯ä¸ªèŠ‚ç‚¹éƒ½åªæ˜¯ master æ²¡æœ‰ slaveï¼Œé‚£ä¹ˆ master å®•æœºæ—¶è¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ key åœ¨é‚£ä¸€æ—¶åˆ»éƒ½ç›¸å½“äºŽæ˜¯é‡Šæ”¾é”äº†ï¼Œè¿™æ ·ä¹Ÿä¼šå‡ºçŽ°å¹¶å‘é—®é¢˜ã€‚å°±ç®—æ˜¯æœ‰ slave èŠ‚ç‚¹ï¼Œä½†å¦‚æžœåœ¨æ•°æ®åŒæ­¥åˆ° salve ä¹‹å‰ master å®•æœºä¹Ÿæ˜¯ä¼šå‡ºçŽ°ä¸Šé¢çš„é—®é¢˜ã€‚ æ„Ÿå…´è¶£çš„æœ‹å‹è¿˜å¯ä»¥å‚è€ƒ Redisson çš„å®žçŽ°ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Distributed Tools</category>
      </categories>
      <tags>
        <tag>Distributed Lock</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Bean ç”Ÿå‘½å‘¨æœŸ]]></title>
    <url>%2F2018%2F03%2F21%2Fspring%2Fspring-bean-lifecycle%2F</url>
    <content type="text"><![CDATA[å‰è¨€Spring Bean çš„ç”Ÿå‘½å‘¨æœŸåœ¨æ•´ä¸ª Spring ä¸­å æœ‰å¾ˆé‡è¦çš„ä½ç½®ï¼ŒæŽŒæ¡è¿™äº›å¯ä»¥åŠ æ·±å¯¹ Spring çš„ç†è§£ã€‚ é¦–å…ˆçœ‹ä¸‹ç”Ÿå‘½å‘¨æœŸå›¾ï¼š å†è°ˆç”Ÿå‘½å‘¨æœŸä¹‹å‰æœ‰ä¸€ç‚¹éœ€è¦å…ˆæ˜Žç¡®ï¼š Spring åªå¸®æˆ‘ä»¬ç®¡ç†å•ä¾‹æ¨¡å¼ Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹äºŽ prototype çš„ bean ï¼ŒSpring åœ¨åˆ›å»ºå¥½äº¤ç»™ä½¿ç”¨è€…ä¹‹åŽåˆ™ä¸ä¼šå†ç®¡ç†åŽç»­çš„ç”Ÿå‘½å‘¨æœŸã€‚ æ³¨è§£æ–¹å¼åœ¨ bean åˆå§‹åŒ–æ—¶ä¼šç»åŽ†å‡ ä¸ªé˜¶æ®µï¼Œé¦–å…ˆå¯ä»¥ä½¿ç”¨æ³¨è§£ @PostConstruct, @PreDestroy æ¥åœ¨ bean çš„åˆ›å»ºå’Œé”€æ¯é˜¶æ®µè¿›è¡Œè°ƒç”¨: 1234567891011121314@Componentpublic class AnnotationBean &#123; private final static Logger LOGGER = LoggerFactory.getLogger(AnnotationBean.class); @PostConstruct public void start()&#123; LOGGER.info("AnnotationBean start"); &#125; @PreDestroy public void destroy()&#123; LOGGER.info("AnnotationBean destroy"); &#125;&#125; InitializingBean, DisposableBean æŽ¥å£è¿˜å¯ä»¥å®žçŽ° InitializingBean,DisposableBean è¿™ä¸¤ä¸ªæŽ¥å£ï¼Œä¹Ÿæ˜¯åœ¨åˆå§‹åŒ–ä»¥åŠé”€æ¯é˜¶æ®µè°ƒç”¨ï¼š 12345678910111213@Servicepublic class SpringLifeCycleService implements InitializingBean,DisposableBean&#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycleService.class); @Override public void afterPropertiesSet() throws Exception &#123; LOGGER.info("SpringLifeCycleService start"); &#125; @Override public void destroy() throws Exception &#123; LOGGER.info("SpringLifeCycleService destroy"); &#125;&#125; è‡ªå®šä¹‰åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ–¹æ³•ç”¨äºŽåœ¨åˆå§‹åŒ–ã€é”€æ¯é˜¶æ®µè°ƒç”¨: 123456789101112131415161718192021222324@Configurationpublic class LifeCycleConfig &#123; @Bean(initMethod = "start", destroyMethod = "destroy") public SpringLifeCycle create()&#123; SpringLifeCycle springLifeCycle = new SpringLifeCycle() ; return springLifeCycle ; &#125;&#125;public class SpringLifeCycle&#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycle.class); public void start()&#123; LOGGER.info("SpringLifeCycle start"); &#125; public void destroy()&#123; LOGGER.info("SpringLifeCycle destroy"); &#125;&#125; ä»¥ä¸Šæ˜¯åœ¨ SpringBoot ä¸­å¯ä»¥è¿™æ ·é…ç½®ï¼Œå¦‚æžœæ˜¯åŽŸå§‹çš„åŸºäºŽ XML ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨: 12&lt;bean class="com.crossoverjie.spring.SpringLifeCycle" init-method="start" destroy-method="destroy"&gt;&lt;/bean&gt; æ¥è¾¾åˆ°åŒæ ·çš„æ•ˆæžœã€‚ å®žçŽ° *Aware æŽ¥å£*Aware æŽ¥å£å¯ä»¥ç”¨äºŽåœ¨åˆå§‹åŒ– bean æ—¶èŽ·å¾— Spring ä¸­çš„ä¸€äº›å¯¹è±¡ï¼Œå¦‚èŽ·å– Spring ä¸Šä¸‹æ–‡ç­‰ã€‚ 123456789101112@Componentpublic class SpringLifeCycleAware implements ApplicationContextAware &#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycleAware.class); private ApplicationContext applicationContext ; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; this.applicationContext = applicationContext ; LOGGER.info("SpringLifeCycleAware start"); &#125;&#125; è¿™æ ·åœ¨ springLifeCycleAware è¿™ä¸ª bean åˆå§‹åŒ–ä¼šå°±ä¼šè°ƒç”¨ setApplicationContext æ–¹æ³•ï¼Œå¹¶å¯ä»¥èŽ·å¾— applicationContext å¯¹è±¡ã€‚ BeanPostProcessor å¢žå¼ºå¤„ç†å™¨å®žçŽ° BeanPostProcessor æŽ¥å£ï¼ŒSpring ä¸­æ‰€æœ‰ bean åœ¨åšåˆå§‹åŒ–æ—¶éƒ½ä¼šè°ƒç”¨è¯¥æŽ¥å£ä¸­çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºŽå¯¹ä¸€äº›ç‰¹æ®Šçš„ bean è¿›è¡Œå¤„ç†ï¼š 12345678910111213141516171819202122232425262728293031323334@Componentpublic class SpringLifeCycleProcessor implements BeanPostProcessor &#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycleProcessor.class); /** * é¢„åˆå§‹åŒ– åˆå§‹åŒ–ä¹‹å‰è°ƒç”¨ * @param bean * @param beanName * @return * @throws BeansException */ @Override public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException &#123; if ("annotationBean".equals(beanName))&#123; LOGGER.info("SpringLifeCycleProcessor start beanName=&#123;&#125;",beanName); &#125; return bean; &#125; /** * åŽåˆå§‹åŒ– bean åˆå§‹åŒ–å®Œæˆè°ƒç”¨ * @param bean * @param beanName * @return * @throws BeansException */ @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123; if ("annotationBean".equals(beanName))&#123; LOGGER.info("SpringLifeCycleProcessor end beanName=&#123;&#125;",beanName); &#125; return bean; &#125;&#125; æ‰§è¡Œä¹‹åŽè§‚å¯Ÿç»“æžœï¼š 123456789101112131415018-03-21 00:40:24.856 [restartedMain] INFO c.c.s.p.SpringLifeCycleProcessor - SpringLifeCycleProcessor start beanName=annotationBean2018-03-21 00:40:24.860 [restartedMain] INFO c.c.spring.annotation.AnnotationBean - AnnotationBean start2018-03-21 00:40:24.861 [restartedMain] INFO c.c.s.p.SpringLifeCycleProcessor - SpringLifeCycleProcessor end beanName=annotationBean2018-03-21 00:40:24.864 [restartedMain] INFO c.c.s.aware.SpringLifeCycleAware - SpringLifeCycleAware start2018-03-21 00:40:24.867 [restartedMain] INFO c.c.s.service.SpringLifeCycleService - SpringLifeCycleService start2018-03-21 00:40:24.887 [restartedMain] INFO c.c.spring.SpringLifeCycle - SpringLifeCycle start2018-03-21 00:40:25.062 [restartedMain] INFO o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 357292018-03-21 00:40:25.122 [restartedMain] INFO o.s.j.e.a.AnnotationMBeanExporter - Registering beans for JMX exposure on startup2018-03-21 00:40:25.140 [restartedMain] INFO com.crossoverjie.Application - Started Application in 2.309 seconds (JVM running for 3.681)2018-03-21 00:40:25.143 [restartedMain] INFO com.crossoverjie.Application - start ok!2018-03-21 00:40:25.153 [Thread-8] INFO o.s.c.a.AnnotationConfigApplicationContext - Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@3913adad: startup date [Wed Mar 21 00:40:23 CST 2018]; root of context hierarchy2018-03-21 00:40:25.155 [Thread-8] INFO o.s.j.e.a.AnnotationMBeanExporter - Unregistering JMX-exposed beans on shutdown2018-03-21 00:40:25.156 [Thread-8] INFO c.c.spring.SpringLifeCycle - SpringLifeCycle destroy2018-03-21 00:40:25.156 [Thread-8] INFO c.c.s.service.SpringLifeCycleService - SpringLifeCycleService destroy2018-03-21 00:40:25.156 [Thread-8] INFO c.c.spring.annotation.AnnotationBean - AnnotationBean destroy ç›´åˆ° Spring ä¸Šä¸‹æ–‡é”€æ¯æ—¶åˆ™ä¼šè°ƒç”¨è‡ªå®šä¹‰çš„é”€æ¯æ–¹æ³•ä»¥åŠå®žçŽ°äº† DisposableBean çš„ destroy() æ–¹æ³•ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£çº¿ç¨‹é€šä¿¡]]></title>
    <url>%2F2018%2F03%2F16%2Fjava-senior%2Fthread-communication%2F</url>
    <content type="text"><![CDATA[å‰è¨€å¼€å‘ä¸­ä¸å…ä¼šé‡åˆ°éœ€è¦æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•é€šçŸ¥ä¸»çº¿ç¨‹å¤„ç†æŸäº›é€»è¾‘çš„åœºæ™¯ã€‚ æˆ–è€…æ˜¯çº¿ç¨‹ A åœ¨æ‰§è¡Œåˆ°æŸä¸ªæ¡ä»¶é€šçŸ¥çº¿ç¨‹ B æ‰§è¡ŒæŸä¸ªæ“ä½œã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®žçŽ°ï¼š ç­‰å¾…é€šçŸ¥æœºåˆ¶ ç­‰å¾…é€šçŸ¥æ¨¡å¼æ˜¯ Java ä¸­æ¯”è¾ƒç»å…¸çš„çº¿ç¨‹é€šä¿¡æ–¹å¼ã€‚ ä¸¤ä¸ªçº¿ç¨‹é€šè¿‡å¯¹åŒä¸€å¯¹è±¡è°ƒç”¨ç­‰å¾… wait() å’Œé€šçŸ¥ notify() æ–¹æ³•æ¥è¿›è¡Œé€šè®¯ã€‚ å¦‚ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°å¥‡å¶æ•°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091public class TwoThreadWaitNotify &#123; private int start = 1; private boolean flag = false; public static void main(String[] args) &#123; TwoThreadWaitNotify twoThread = new TwoThreadWaitNotify(); Thread t1 = new Thread(new OuNum(twoThread)); t1.setName("A"); Thread t2 = new Thread(new JiNum(twoThread)); t2.setName("B"); t1.start(); t2.start(); &#125; /** * å¶æ•°çº¿ç¨‹ */ public static class OuNum implements Runnable &#123; private TwoThreadWaitNotify number; public OuNum(TwoThreadWaitNotify number) &#123; this.number = number; &#125; @Override public void run() &#123; while (number.start &lt;= 100) &#123; synchronized (TwoThreadWaitNotify.class) &#123; System.out.println("å¶æ•°çº¿ç¨‹æŠ¢åˆ°é”äº†"); if (number.flag) &#123; System.out.println(Thread.currentThread().getName() + "+-+å¶æ•°" + number.start); number.start++; number.flag = false; TwoThreadWaitNotify.class.notify(); &#125;else &#123; try &#123; TwoThreadWaitNotify.class.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125; &#125; /** * å¥‡æ•°çº¿ç¨‹ */ public static class JiNum implements Runnable &#123; private TwoThreadWaitNotify number; public JiNum(TwoThreadWaitNotify number) &#123; this.number = number; &#125; @Override public void run() &#123; while (number.start &lt;= 100) &#123; synchronized (TwoThreadWaitNotify.class) &#123; System.out.println("å¥‡æ•°çº¿ç¨‹æŠ¢åˆ°é”äº†"); if (!number.flag) &#123; System.out.println(Thread.currentThread().getName() + "+-+å¥‡æ•°" + number.start); number.start++; number.flag = true; TwoThreadWaitNotify.class.notify(); &#125;else &#123; try &#123; TwoThreadWaitNotify.class.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125; &#125;&#125; è¾“å‡ºç»“æžœï¼š 12345678t2+-+å¥‡æ•°93t1+-+å¶æ•°94t2+-+å¥‡æ•°95t1+-+å¶æ•°96t2+-+å¥‡æ•°97t1+-+å¶æ•°98t2+-+å¥‡æ•°99t1+-+å¶æ•°100 è¿™é‡Œçš„çº¿ç¨‹ A å’Œçº¿ç¨‹ B éƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡ TwoThreadWaitNotify.class èŽ·å–é”ï¼ŒA çº¿ç¨‹è°ƒç”¨äº†åŒæ­¥å¯¹è±¡çš„ wait() æ–¹æ³•é‡Šæ”¾äº†é”å¹¶è¿›å…¥ WAITING çŠ¶æ€ã€‚ B çº¿ç¨‹è°ƒç”¨äº† notify() æ–¹æ³•ï¼Œè¿™æ · A çº¿ç¨‹æ”¶åˆ°é€šçŸ¥ä¹‹åŽå°±å¯ä»¥ä»Ž wait() æ–¹æ³•ä¸­è¿”å›žã€‚ è¿™é‡Œåˆ©ç”¨äº† TwoThreadWaitNotify.class å¯¹è±¡å®Œæˆäº†é€šä¿¡ã€‚ æœ‰ä¸€äº›éœ€è¦æ³¨æ„: wait() ã€nofify() ã€nofityAll() è°ƒç”¨çš„å‰æéƒ½æ˜¯èŽ·å¾—äº†å¯¹è±¡çš„é”(ä¹Ÿå¯ç§°ä¸ºå¯¹è±¡ç›‘è§†å™¨)ã€‚ è°ƒç”¨ wait() æ–¹æ³•åŽçº¿ç¨‹ä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥ WAITING çŠ¶æ€ï¼Œè¯¥çº¿ç¨‹ä¹Ÿä¼šè¢«ç§»åŠ¨åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ è°ƒç”¨ notify() æ–¹æ³•ä¼šå°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œçº¿ç¨‹çŠ¶æ€ä¹Ÿä¼šæ›´æ–°ä¸º BLOCKED ä»Ž wait() æ–¹æ³•è¿”å›žçš„å‰ææ˜¯è°ƒç”¨ notify() æ–¹æ³•çš„çº¿ç¨‹é‡Šæ”¾é”ï¼Œwait() æ–¹æ³•çš„çº¿ç¨‹èŽ·å¾—é”ã€‚ ç­‰å¾…é€šçŸ¥æœ‰ç€ä¸€ä¸ªç»å…¸èŒƒå¼ï¼š çº¿ç¨‹ A ä½œä¸ºæ¶ˆè´¹è€…ï¼š èŽ·å–å¯¹è±¡çš„é”ã€‚ è¿›å…¥ while(åˆ¤æ–­æ¡ä»¶)ï¼Œå¹¶è°ƒç”¨ wait() æ–¹æ³•ã€‚ å½“æ¡ä»¶æ»¡è¶³è·³å‡ºå¾ªçŽ¯æ‰§è¡Œå…·ä½“å¤„ç†é€»è¾‘ã€‚ çº¿ç¨‹ B ä½œä¸ºç”Ÿäº§è€…: èŽ·å–å¯¹è±¡é”ã€‚ æ›´æ”¹ä¸Žçº¿ç¨‹ A å…±ç”¨çš„åˆ¤æ–­æ¡ä»¶ã€‚ è°ƒç”¨ notify() æ–¹æ³•ã€‚ ä¼ªä»£ç å¦‚ä¸‹: 1234567891011121314//Thread Asynchronized(Object)&#123; while(æ¡ä»¶)&#123; Object.wait(); &#125; //do something&#125;//Thread Bsynchronized(Object)&#123; æ¡ä»¶=false;//æ”¹å˜æ¡ä»¶ Object.notify();&#125; join() æ–¹æ³•1234567891011121314151617181920212223242526272829303132333435private static void join() throws InterruptedException &#123; Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running"); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;) ; Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running2"); try &#123; Thread.sleep(4000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;) ; t1.start(); t2.start(); //ç­‰å¾…çº¿ç¨‹1ç»ˆæ­¢ t1.join(); //ç­‰å¾…çº¿ç¨‹2ç»ˆæ­¢ t2.join(); LOGGER.info("main over");&#125; è¾“å‡ºç»“æžœ: 1232018-03-16 20:21:30.967 [Thread-1] INFO c.c.actual.ThreadCommunication - running22018-03-16 20:21:30.967 [Thread-0] INFO c.c.actual.ThreadCommunication - running2018-03-16 20:21:34.972 [main] INFO c.c.actual.ThreadCommunication - main over åœ¨ t1.join() æ—¶ä¼šä¸€ç›´é˜»å¡žåˆ° t1 æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥æœ€ç»ˆä¸»çº¿ç¨‹ä¼šç­‰å¾… t1 å’Œ t2 çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚ å…¶å®žä»Žæºç å¯ä»¥çœ‹å‡ºï¼Œjoin() ä¹Ÿæ˜¯åˆ©ç”¨çš„ç­‰å¾…é€šçŸ¥æœºåˆ¶ï¼š æ ¸å¿ƒé€»è¾‘: 123while (isAlive()) &#123; wait(0);&#125; åœ¨ join çº¿ç¨‹å®ŒæˆåŽä¼šè°ƒç”¨ notifyAll() æ–¹æ³•ï¼Œæ˜¯åœ¨ JVM å®žçŽ°ä¸­è°ƒç”¨ï¼Œæ‰€ä»¥è¿™é‡Œçœ‹ä¸å‡ºæ¥ã€‚ volatile å…±äº«å†…å­˜å› ä¸º Java æ˜¯é‡‡ç”¨å…±äº«å†…å­˜çš„æ–¹å¼è¿›è¡Œçº¿ç¨‹é€šä¿¡çš„ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ç”¨ä¸»çº¿ç¨‹å…³é—­ A çº¿ç¨‹: 1234567891011121314151617181920212223242526272829public class Volatile implements Runnable&#123; private static volatile boolean flag = true ; @Override public void run() &#123; while (flag)&#123; System.out.println(Thread.currentThread().getName() + "æ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚"); &#125; System.out.println(Thread.currentThread().getName() +"æ‰§è¡Œå®Œæ¯•"); &#125; public static void main(String[] args) throws InterruptedException &#123; Volatile aVolatile = new Volatile(); new Thread(aVolatile,"thread A").start(); System.out.println("main çº¿ç¨‹æ­£åœ¨è¿è¡Œ") ; TimeUnit.MILLISECONDS.sleep(100) ; aVolatile.stopThread(); &#125; private void stopThread()&#123; flag = false ; &#125;&#125; è¾“å‡ºç»“æžœï¼š12345thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ‰§è¡Œå®Œæ¯• è¿™é‡Œçš„ flag å­˜æ”¾äºŽä¸»å†…å­˜ä¸­ï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹å’Œçº¿ç¨‹ A éƒ½å¯ä»¥çœ‹åˆ°ã€‚ flag é‡‡ç”¨ volatile ä¿®é¥°ä¸»è¦æ˜¯ä¸ºäº†å†…å­˜å¯è§æ€§ï¼Œæ›´å¤šå†…å®¹å¯ä»¥æŸ¥çœ‹è¿™é‡Œã€‚ CountDownLatch å¹¶å‘å·¥å…·CountDownLatch å¯ä»¥å®žçŽ° join ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯æ›´åŠ çš„çµæ´»ã€‚ 12345678910111213141516171819202122232425private static void countDownLatch() throws Exception&#123; int thread = 3 ; long start = System.currentTimeMillis(); final CountDownLatch countDown = new CountDownLatch(thread); for (int i= 0 ;i&lt;thread ; i++)&#123; new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; Thread.sleep(2000); countDown.countDown(); LOGGER.info("thread end"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; countDown.await(); long stop = System.currentTimeMillis(); LOGGER.info("main over total time=&#123;&#125;",stop-start);&#125; è¾“å‡ºç»“æžœ: 12345672018-03-16 20:19:44.126 [Thread-0] INFO c.c.actual.ThreadCommunication - thread run2018-03-16 20:19:44.126 [Thread-2] INFO c.c.actual.ThreadCommunication - thread run2018-03-16 20:19:44.126 [Thread-1] INFO c.c.actual.ThreadCommunication - thread run2018-03-16 20:19:46.136 [Thread-2] INFO c.c.actual.ThreadCommunication - thread end2018-03-16 20:19:46.136 [Thread-1] INFO c.c.actual.ThreadCommunication - thread end2018-03-16 20:19:46.136 [Thread-0] INFO c.c.actual.ThreadCommunication - thread end2018-03-16 20:19:46.136 [main] INFO c.c.actual.ThreadCommunication - main over total time=2012 CountDownLatch ä¹Ÿæ˜¯åŸºäºŽ AQS(AbstractQueuedSynchronizer) å®žçŽ°çš„ï¼Œæ›´å¤šå®žçŽ°å‚è€ƒ ReentrantLock å®žçŽ°åŽŸç† åˆå§‹åŒ–ä¸€ä¸ª CountDownLatch æ—¶å‘Šè¯‰å¹¶å‘çš„çº¿ç¨‹ï¼Œç„¶åŽåœ¨æ¯ä¸ªçº¿ç¨‹å¤„ç†å®Œæ¯•ä¹‹åŽè°ƒç”¨ countDown() æ–¹æ³•ã€‚ è¯¥æ–¹æ³•ä¼šå°† AQS å†…ç½®çš„ä¸€ä¸ª state çŠ¶æ€ -1 ã€‚ æœ€ç»ˆåœ¨ä¸»çº¿ç¨‹è°ƒç”¨ await() æ–¹æ³•ï¼Œå®ƒä¼šé˜»å¡žç›´åˆ° state == 0 çš„æ—¶å€™è¿”å›žã€‚ CyclicBarrier å¹¶å‘å·¥å…·123456789101112131415161718192021222324252627282930313233343536373839404142434445464748private static void cyclicBarrier() throws Exception &#123; CyclicBarrier cyclicBarrier = new CyclicBarrier(3) ; new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; cyclicBarrier.await() ; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; LOGGER.info("thread end do something"); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; cyclicBarrier.await() ; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; LOGGER.info("thread end do something"); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; Thread.sleep(5000); cyclicBarrier.await() ; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; LOGGER.info("thread end do something"); &#125; &#125;).start(); LOGGER.info("main thread");&#125; CyclicBarrier ä¸­æ–‡åå«åšå±éšœæˆ–è€…æ˜¯æ …æ ï¼Œä¹Ÿå¯ä»¥ç”¨äºŽçº¿ç¨‹é—´é€šä¿¡ã€‚ å®ƒå¯ä»¥ç­‰å¾… N ä¸ªçº¿ç¨‹éƒ½è¾¾åˆ°æŸä¸ªçŠ¶æ€åŽç»§ç»­è¿è¡Œçš„æ•ˆæžœã€‚ é¦–å…ˆåˆå§‹åŒ–çº¿ç¨‹å‚ä¸Žè€…ã€‚ è°ƒç”¨ await() å°†ä¼šåœ¨æ‰€æœ‰å‚ä¸Žè€…çº¿ç¨‹éƒ½è°ƒç”¨ä¹‹å‰ç­‰å¾…ã€‚ ç›´åˆ°æ‰€æœ‰å‚ä¸Žè€…éƒ½è°ƒç”¨äº† await() åŽï¼Œæ‰€æœ‰çº¿ç¨‹ä»Ž await() è¿”å›žç»§ç»­åŽç»­é€»è¾‘ã€‚ è¿è¡Œç»“æžœ: 12345672018-03-18 22:40:00.731 [Thread-0] INFO c.c.actual.ThreadCommunication - thread run2018-03-18 22:40:00.731 [Thread-1] INFO c.c.actual.ThreadCommunication - thread run2018-03-18 22:40:00.731 [Thread-2] INFO c.c.actual.ThreadCommunication - thread run2018-03-18 22:40:00.731 [main] INFO c.c.actual.ThreadCommunication - main thread2018-03-18 22:40:05.741 [Thread-0] INFO c.c.actual.ThreadCommunication - thread end do something2018-03-18 22:40:05.741 [Thread-1] INFO c.c.actual.ThreadCommunication - thread end do something2018-03-18 22:40:05.741 [Thread-2] INFO c.c.actual.ThreadCommunication - thread end do something å¯ä»¥çœ‹å‡ºç”±äºŽå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ä¼‘çœ äº†äº”ç§’ï¼Œæ‰€æœ‰å…¶ä½™æ‰€æœ‰çš„çº¿ç¨‹éƒ½å¾—ç­‰å¾…è¿™ä¸ªçº¿ç¨‹è°ƒç”¨ await() ã€‚ è¯¥å·¥å…·å¯ä»¥å®žçŽ° CountDownLatch åŒæ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¦æ›´åŠ çµæ´»ã€‚ç”šè‡³å¯ä»¥è°ƒç”¨ reset() æ–¹æ³•é‡ç½® CyclicBarrier (éœ€è¦è‡ªè¡Œæ•èŽ· BrokenBarrierException å¤„ç†) ç„¶åŽé‡æ–°æ‰§è¡Œã€‚ çº¿ç¨‹å“åº”ä¸­æ–­12345678910111213141516171819202122232425public class StopThread implements Runnable &#123; @Override public void run() &#123; while ( !Thread.currentThread().isInterrupted()) &#123; // çº¿ç¨‹æ‰§è¡Œå…·ä½“é€»è¾‘ System.out.println(Thread.currentThread().getName() + "è¿è¡Œä¸­ã€‚ã€‚"); &#125; System.out.println(Thread.currentThread().getName() + "é€€å‡ºã€‚ã€‚"); &#125; public static void main(String[] args) throws InterruptedException &#123; Thread thread = new Thread(new StopThread(), "thread A"); thread.start(); System.out.println("main çº¿ç¨‹æ­£åœ¨è¿è¡Œ") ; TimeUnit.MILLISECONDS.sleep(10) ; thread.interrupt(); &#125;&#125; è¾“å‡ºç»“æžœ: 123thread Aè¿è¡Œä¸­ã€‚ã€‚thread Aè¿è¡Œä¸­ã€‚ã€‚thread Aé€€å‡ºã€‚ã€‚ å¯ä»¥é‡‡ç”¨ä¸­æ–­çº¿ç¨‹çš„æ–¹å¼æ¥é€šä¿¡ï¼Œè°ƒç”¨äº† thread.interrupt() æ–¹æ³•å…¶å®žå°±æ˜¯å°† thread ä¸­çš„ä¸€ä¸ªæ ‡å¿—å±žæ€§ç½®ä¸ºäº† trueã€‚ å¹¶ä¸æ˜¯è¯´è°ƒç”¨äº†è¯¥æ–¹æ³•å°±å¯ä»¥ä¸­æ–­çº¿ç¨‹ï¼Œå¦‚æžœä¸å¯¹è¿™ä¸ªæ ‡å¿—è¿›è¡Œå“åº”å…¶å®žæ˜¯æ²¡æœ‰ä»€ä¹ˆä½œç”¨(è¿™é‡Œå¯¹è¿™ä¸ªæ ‡å¿—è¿›è¡Œäº†åˆ¤æ–­)ã€‚ ä½†æ˜¯å¦‚æžœæŠ›å‡ºäº† InterruptedException å¼‚å¸¸ï¼Œè¯¥æ ‡å¿—å°±ä¼šè¢« JVM é‡ç½®ä¸º falseã€‚ çº¿ç¨‹æ±  awaitTermination() æ–¹æ³•å¦‚æžœæ˜¯ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ¥è®©ä¸»çº¿ç¨‹ç­‰å¾…çº¿ç¨‹æ± ä¸­æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•: 1234567891011121314151617181920212223242526272829303132private static void executorService() throws Exception&#123; BlockingQueue&lt;Runnable&gt; queue = new LinkedBlockingQueue&lt;&gt;(10) ; ThreadPoolExecutor poolExecutor = new ThreadPoolExecutor(5,5,1, TimeUnit.MILLISECONDS,queue) ; poolExecutor.execute(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running"); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;); poolExecutor.execute(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running2"); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;); poolExecutor.shutdown(); while (!poolExecutor.awaitTermination(1,TimeUnit.SECONDS))&#123; LOGGER.info("çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚"); &#125; LOGGER.info("main over");&#125; è¾“å‡ºç»“æžœ: 123452018-03-16 20:18:01.273 [pool-1-thread-2] INFO c.c.actual.ThreadCommunication - running22018-03-16 20:18:01.273 [pool-1-thread-1] INFO c.c.actual.ThreadCommunication - running2018-03-16 20:18:02.273 [main] INFO c.c.actual.ThreadCommunication - çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚2018-03-16 20:18:03.278 [main] INFO c.c.actual.ThreadCommunication - çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚2018-03-16 20:18:04.278 [main] INFO c.c.actual.ThreadCommunication - main over ä½¿ç”¨è¿™ä¸ª awaitTermination() æ–¹æ³•çš„å‰æéœ€è¦å…³é—­çº¿ç¨‹æ± ï¼Œå¦‚è°ƒç”¨äº† shutdown() æ–¹æ³•ã€‚ è°ƒç”¨äº† shutdown() ä¹‹åŽçº¿ç¨‹æ± ä¼šåœæ­¢æŽ¥å—æ–°ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šå¹³æ»‘çš„å…³é—­çº¿ç¨‹æ± ä¸­çŽ°æœ‰çš„ä»»åŠ¡ã€‚ ç®¡é“é€šä¿¡12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public static void piped() throws IOException &#123; //é¢å‘äºŽå­—ç¬¦ PipedInputStream é¢å‘äºŽå­—èŠ‚ PipedWriter writer = new PipedWriter(); PipedReader reader = new PipedReader(); //è¾“å…¥è¾“å‡ºæµå»ºç«‹è¿žæŽ¥ writer.connect(reader); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running"); try &#123; for (int i = 0; i &lt; 10; i++) &#123; writer.write(i+""); Thread.sleep(10); &#125; &#125; catch (Exception e) &#123; &#125; finally &#123; try &#123; writer.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running2"); int msg = 0; try &#123; while ((msg = reader.read()) != -1) &#123; LOGGER.info("msg=&#123;&#125;", (char) msg); &#125; &#125; catch (Exception e) &#123; &#125; &#125; &#125;); t1.start(); t2.start();&#125; è¾“å‡ºç»“æžœ: 1234567891011122018-03-16 19:56:43.014 [Thread-0] INFO c.c.actual.ThreadCommunication - running2018-03-16 19:56:43.014 [Thread-1] INFO c.c.actual.ThreadCommunication - running22018-03-16 19:56:43.130 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=02018-03-16 19:56:43.132 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=12018-03-16 19:56:43.132 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=22018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=32018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=42018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=52018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=62018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=72018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=82018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=9 Java è™½è¯´æ˜¯åŸºäºŽå†…å­˜é€šä¿¡çš„ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ç®¡é“é€šä¿¡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¾“å…¥æµå’Œè¾“å‡ºæµéœ€è¦é¦–å…ˆå»ºç«‹è¿žæŽ¥ã€‚è¿™æ ·çº¿ç¨‹ B å°±å¯ä»¥æ”¶åˆ°çº¿ç¨‹ A å‘å‡ºçš„æ¶ˆæ¯äº†ã€‚ å®žé™…å¼€å‘ä¸­å¯ä»¥çµæ´»æ ¹æ®éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„çº¿ç¨‹é€šä¿¡æ–¹å¼ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½ åº”è¯¥çŸ¥é“çš„ volatile å…³é”®å­—]]></title>
    <url>%2F2018%2F03%2F09%2Fvolatile%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸ç®¡æ˜¯åœ¨é¢è¯•è¿˜æ˜¯å®žé™…å¼€å‘ä¸­ volatile éƒ½æ˜¯ä¸€ä¸ªåº”è¯¥æŽŒæ¡çš„æŠ€èƒ½ã€‚ é¦–å…ˆæ¥çœ‹çœ‹ä¸ºä»€ä¹ˆä¼šå‡ºçŽ°è¿™ä¸ªå…³é”®å­—ã€‚ å†…å­˜å¯è§æ€§ç”±äºŽ Java å†…å­˜æ¨¡åž‹(JMM)è§„å®šï¼Œæ‰€æœ‰çš„å˜é‡éƒ½å­˜æ”¾åœ¨ä¸»å†…å­˜ä¸­ï¼Œè€Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç€è‡ªå·±çš„å·¥ä½œå†…å­˜(é«˜é€Ÿç¼“å­˜)ã€‚ çº¿ç¨‹åœ¨å·¥ä½œæ—¶ï¼Œéœ€è¦å°†ä¸»å†…å­˜ä¸­çš„æ•°æ®æ‹·è´åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚è¿™æ ·å¯¹æ•°æ®çš„ä»»ä½•æ“ä½œéƒ½æ˜¯åŸºäºŽå·¥ä½œå†…å­˜(æ•ˆçŽ‡æé«˜)ï¼Œå¹¶ä¸”ä¸èƒ½ç›´æŽ¥æ“ä½œä¸»å†…å­˜ä»¥åŠå…¶ä»–çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®ï¼Œä¹‹åŽå†å°†æ›´æ–°ä¹‹åŽçš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚ è¿™é‡Œæ‰€æåˆ°çš„ä¸»å†…å­˜å¯ä»¥ç®€å•è®¤ä¸ºæ˜¯å †å†…å­˜ï¼Œè€Œå·¥ä½œå†…å­˜åˆ™å¯ä»¥è®¤ä¸ºæ˜¯æ ˆå†…å­˜ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ‰€ä»¥åœ¨å¹¶å‘è¿è¡Œæ—¶å¯èƒ½ä¼šå‡ºçŽ°çº¿ç¨‹ B æ‰€è¯»å–åˆ°çš„æ•°æ®æ˜¯çº¿ç¨‹ A æ›´æ–°ä¹‹å‰çš„æ•°æ®ã€‚ æ˜¾ç„¶è¿™è‚¯å®šæ˜¯ä¼šå‡ºé—®é¢˜çš„ï¼Œå› æ­¤ volatile çš„ä½œç”¨å‡ºçŽ°äº†ï¼š å½“ä¸€ä¸ªå˜é‡è¢« volatile ä¿®é¥°æ—¶ï¼Œä»»ä½•çº¿ç¨‹å¯¹å®ƒçš„å†™æ“ä½œéƒ½ä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œå¹¶ä¸”ä¼šå¼ºåˆ¶è®©ç¼“å­˜äº†è¯¥å˜é‡çš„çº¿ç¨‹ä¸­çš„æ•°æ®æ¸…ç©ºï¼Œå¿…é¡»ä»Žä¸»å†…å­˜é‡æ–°è¯»å–æœ€æ–°æ•°æ®ã€‚ volatile ä¿®é¥°ä¹‹åŽå¹¶ä¸æ˜¯è®©çº¿ç¨‹ç›´æŽ¥ä»Žä¸»å†…å­˜ä¸­èŽ·å–æ•°æ®ï¼Œä¾ç„¶éœ€è¦å°†å˜é‡æ‹·è´åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚ å†…å­˜å¯è§æ€§çš„åº”ç”¨å½“æˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´ä¾æ®ä¸»å†…å­˜é€šä¿¡æ—¶ï¼Œé€šä¿¡çš„é‚£ä¸ªå˜é‡å°±å¿…é¡»çš„ç”¨ volatile æ¥ä¿®é¥°ï¼š 1234567891011121314151617181920212223242526272829public class Volatile implements Runnable&#123; private static volatile boolean flag = true ; @Override public void run() &#123; while (flag)&#123; System.out.println(Thread.currentThread().getName() + "æ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚"); &#125; System.out.println(Thread.currentThread().getName() +"æ‰§è¡Œå®Œæ¯•"); &#125; public static void main(String[] args) throws InterruptedException &#123; Volatile aVolatile = new Volatile(); new Thread(aVolatile,"thread A").start(); System.out.println("main çº¿ç¨‹æ­£åœ¨è¿è¡Œ") ; TimeUnit.MILLISECONDS.sleep(100) ; aVolatile.stopThread(); &#125; private void stopThread()&#123; flag = false ; &#125;&#125; ä¸»çº¿ç¨‹åœ¨ä¿®æ”¹äº†æ ‡å¿—ä½ä½¿å¾—çº¿ç¨‹ A ç«‹å³åœæ­¢ï¼Œå¦‚æžœæ²¡æœ‰ç”¨ volatile ä¿®é¥°ï¼Œå°±æœ‰å¯èƒ½å‡ºçŽ°å»¶è¿Ÿã€‚ ä½†è¿™é‡Œæœ‰ä¸ªè¯¯åŒºï¼Œè¿™æ ·çš„ä½¿ç”¨æ–¹å¼å®¹æ˜“ç»™äººçš„æ„Ÿè§‰æ˜¯ï¼š å¯¹ volatile ä¿®é¥°çš„å˜é‡è¿›è¡Œå¹¶å‘æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ è¿™é‡Œè¦é‡ç‚¹å¼ºè°ƒï¼Œvolatile å¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ï¼ å¦‚ä¸‹ç¨‹åº: 1234567891011121314151617181920212223242526272829303132public class VolatileInc implements Runnable&#123; private static volatile int count = 0 ; //ä½¿ç”¨ volatile ä¿®é¥°åŸºæœ¬æ•°æ®å†…å­˜ä¸èƒ½ä¿è¯åŽŸå­æ€§ //private static AtomicInteger count = new AtomicInteger() ; @Override public void run() &#123; for (int i=0;i&lt;10000 ;i++)&#123; count ++ ; //count.incrementAndGet() ; &#125; &#125; public static void main(String[] args) throws InterruptedException &#123; VolatileInc volatileInc = new VolatileInc() ; Thread t1 = new Thread(volatileInc,"t1") ; Thread t2 = new Thread(volatileInc,"t2") ; t1.start(); //t1.join(); t2.start(); //t2.join(); for (int i=0;i&lt;10000 ;i++)&#123; count ++ ; //count.incrementAndGet(); &#125; System.out.println("æœ€ç»ˆCount="+count); &#125;&#125; å½“æˆ‘ä»¬ä¸‰ä¸ªçº¿ç¨‹(t1,t2,main)åŒæ—¶å¯¹ä¸€ä¸ª int è¿›è¡Œç´¯åŠ æ—¶ä¼šå‘çŽ°æœ€ç»ˆçš„å€¼éƒ½ä¼šå°äºŽ 30000ã€‚ è¿™æ˜¯å› ä¸ºè™½ç„¶ volatile ä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¿åˆ°çš„å€¼éƒ½æ˜¯æœ€æ–°å€¼ï¼Œä½† count ++ è¿™ä¸ªæ“ä½œå¹¶ä¸æ˜¯åŽŸå­çš„ï¼Œè¿™é‡Œé¢æ¶‰åŠåˆ°èŽ·å–å€¼ã€è‡ªå¢žã€èµ‹å€¼çš„æ“ä½œå¹¶ä¸èƒ½åŒæ—¶å®Œæˆã€‚ æ‰€ä»¥æƒ³åˆ°è¾¾åˆ°çº¿ç¨‹å®‰å…¨å¯ä»¥ä½¿è¿™ä¸‰ä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œ(å…¶å®žå°±æ˜¯å•çº¿ç¨‹ï¼Œæ²¡æœ‰å‘æŒ¥å¤šçº¿ç¨‹çš„ä¼˜åŠ¿)ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨ synchronize æˆ–è€…æ˜¯é”çš„æ–¹å¼æ¥ä¿è¯åŽŸå­æ€§ã€‚ è¿˜å¯ä»¥ç”¨ Atomic åŒ…ä¸­ AtomicInteger æ¥æ›¿æ¢ intï¼Œå®ƒåˆ©ç”¨äº† CAS ç®—æ³•æ¥ä¿è¯äº†åŽŸå­æ€§ã€‚ æŒ‡ä»¤é‡æŽ’å†…å­˜å¯è§æ€§åªæ˜¯ volatile çš„å…¶ä¸­ä¸€ä¸ªè¯­ä¹‰ï¼Œå®ƒè¿˜å¯ä»¥é˜²æ­¢ JVM è¿›è¡ŒæŒ‡ä»¤é‡æŽ’ä¼˜åŒ–ã€‚ ä¸¾ä¸€ä¸ªä¼ªä»£ç : 123int a=10 ;//1int b=20 ;//2int c= a+b ;//3 ä¸€æ®µç‰¹åˆ«ç®€å•çš„ä»£ç ï¼Œç†æƒ³æƒ…å†µä¸‹å®ƒçš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š1&gt;2&gt;3ã€‚ä½†æœ‰å¯èƒ½ç»è¿‡ JVM ä¼˜åŒ–ä¹‹åŽçš„æ‰§è¡Œé¡ºåºå˜ä¸ºäº† 2&gt;1&gt;3ã€‚ å¯ä»¥å‘çŽ°ä¸ç®¡ JVM æ€Žä¹ˆä¼˜åŒ–ï¼Œå‰æéƒ½æ˜¯ä¿è¯å•çº¿ç¨‹ä¸­æœ€ç»ˆç»“æžœä¸å˜çš„æƒ…å†µä¸‹è¿›è¡Œçš„ã€‚ å¯èƒ½è¿™é‡Œè¿˜çœ‹ä¸å‡ºæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œé‚£çœ‹ä¸‹ä¸€æ®µä¼ªä»£ç : 12345678910111213141516171819private static Map&lt;String,String&gt; value ;private static volatile boolean flag = fasle ;//ä»¥ä¸‹æ–¹æ³•å‘ç”Ÿåœ¨çº¿ç¨‹ A ä¸­ åˆå§‹åŒ– Mappublic void initMap()&#123; //è€—æ—¶æ“ä½œ value = getMapValue() ;//1 flag = true ;//2&#125;//å‘ç”Ÿåœ¨çº¿ç¨‹ Bä¸­ ç­‰åˆ° Map åˆå§‹åŒ–æˆåŠŸè¿›è¡Œå…¶ä»–æ“ä½œpublic void doSomeThing()&#123; while(!flag)&#123; sleep() ; &#125; //dosomething doSomeThing(value);&#125; è¿™é‡Œå°±èƒ½çœ‹å‡ºé—®é¢˜äº†ï¼Œå½“ flag æ²¡æœ‰è¢« volatile ä¿®é¥°æ—¶ï¼ŒJVM å¯¹ 1 å’Œ 2 è¿›è¡Œé‡æŽ’ï¼Œå¯¼è‡´ value éƒ½è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–å°±æœ‰å¯èƒ½è¢«çº¿ç¨‹ B ä½¿ç”¨äº†ã€‚ æ‰€ä»¥åŠ ä¸Š volatile ä¹‹åŽå¯ä»¥é˜²æ­¢è¿™æ ·çš„é‡æŽ’ä¼˜åŒ–ï¼Œä¿è¯ä¸šåŠ¡çš„æ­£ç¡®æ€§ã€‚ æŒ‡ä»¤é‡æŽ’çš„çš„åº”ç”¨ä¸€ä¸ªç»å…¸çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯åŒé‡æ‡’åŠ è½½çš„å•ä¾‹æ¨¡å¼äº†: 12345678910111213141516171819public class Singleton &#123; private static volatile Singleton singleton; private Singleton() &#123; &#125; public static Singleton getInstance() &#123; if (singleton == null) &#123; synchronized (Singleton.class) &#123; if (singleton == null) &#123; //é˜²æ­¢æŒ‡ä»¤é‡æŽ’ singleton = new Singleton(); &#125; &#125; &#125; return singleton; &#125;&#125; è¿™é‡Œçš„ volatile å…³é”®å­—ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢æŒ‡ä»¤é‡æŽ’ã€‚ å¦‚æžœä¸ç”¨ ï¼Œsingleton = new Singleton();ï¼Œè¿™æ®µä»£ç å…¶å®žæ˜¯åˆ†ä¸ºä¸‰æ­¥ï¼š åˆ†é…å†…å­˜ç©ºé—´ã€‚(1) åˆå§‹åŒ–å¯¹è±¡ã€‚(2) å°† singleton å¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€ã€‚(3) åŠ ä¸Š volatile æ˜¯ä¸ºäº†è®©ä»¥ä¸Šçš„ä¸‰æ­¥æ“ä½œé¡ºåºæ‰§è¡Œï¼Œåä¹‹æœ‰å¯èƒ½ç¬¬äºŒæ­¥åœ¨ç¬¬ä¸‰æ­¥ä¹‹å‰è¢«æ‰§è¡Œå°±æœ‰å¯èƒ½æŸä¸ªçº¿ç¨‹æ‹¿åˆ°çš„å•ä¾‹å¯¹è±¡æ˜¯è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œä»¥è‡´äºŽæŠ¥é”™ã€‚ æ€»ç»“volatile åœ¨ Java å¹¶å‘ä¸­ç”¨çš„å¾ˆå¤šï¼Œæ¯”å¦‚åƒ Atomic åŒ…ä¸­çš„ valueã€ä»¥åŠ AbstractQueuedLongSynchronizer ä¸­çš„ state éƒ½æ˜¯è¢«å®šä¹‰ä¸º volatile æ¥ç”¨äºŽä¿è¯å†…å­˜å¯è§æ€§ã€‚ å°†è¿™å—ç†è§£é€å½»å¯¹æˆ‘ä»¬ç¼–å†™å¹¶å‘ç¨‹åºæ—¶å¯ä»¥æä¾›å¾ˆå¤§å¸®åŠ©ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>volatile</tag>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedHashMap åº•å±‚åˆ†æž]]></title>
    <url>%2F2018%2F02%2F06%2FLinkedHashMap%2F</url>
    <content type="text"><![CDATA[ä¼—æ‰€å‘¨çŸ¥ HashMap æ˜¯ä¸€ä¸ªæ— åºçš„ Mapï¼Œå› ä¸ºæ¯æ¬¡æ ¹æ® key çš„ hashcode æ˜ å°„åˆ° Entry æ•°ç»„ä¸Šï¼Œæ‰€ä»¥éåŽ†å‡ºæ¥çš„é¡ºåºå¹¶ä¸æ˜¯å†™å…¥çš„é¡ºåºã€‚ å› æ­¤ JDK æŽ¨å‡ºä¸€ä¸ªåŸºäºŽ HashMap ä½†å…·æœ‰é¡ºåºçš„ LinkedHashMap æ¥è§£å†³æœ‰æŽ’åºéœ€æ±‚çš„åœºæ™¯ã€‚ å®ƒçš„åº•å±‚æ˜¯ç»§æ‰¿äºŽ HashMap å®žçŽ°çš„ï¼Œç”±ä¸€ä¸ªåŒå‘é“¾è¡¨æ‰€æž„æˆã€‚ LinkedHashMap çš„æŽ’åºæ–¹å¼æœ‰ä¸¤ç§ï¼š æ ¹æ®å†™å…¥é¡ºåºæŽ’åºã€‚ æ ¹æ®è®¿é—®é¡ºåºæŽ’åºã€‚ å…¶ä¸­æ ¹æ®è®¿é—®é¡ºåºæŽ’åºæ—¶ï¼Œæ¯æ¬¡ get éƒ½ä¼šå°†è®¿é—®çš„å€¼ç§»åŠ¨åˆ°é“¾è¡¨æœ«å°¾ï¼Œè¿™æ ·é‡å¤æ“ä½œå°±èƒ½çš„åˆ°ä¸€ä¸ªæŒ‰ç…§è®¿é—®é¡ºåºæŽ’åºçš„é“¾è¡¨ã€‚ æ•°æ®ç»“æž„1234567891011@Testpublic void test()&#123; Map&lt;String, Integer&gt; map = new LinkedHashMap&lt;String, Integer&gt;(); map.put("1",1) ; map.put("2",2) ; map.put("3",3) ; map.put("4",4) ; map.put("5",5) ; System.out.println(map.toString());&#125; è°ƒè¯•å¯ä»¥çœ‹åˆ° map çš„ç»„æˆï¼š æ‰“å¼€æºç å¯ä»¥çœ‹åˆ°ï¼š 123456789101112131415161718192021/** * The head of the doubly linked list. */private transient Entry&lt;K,V&gt; header;/** * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt; * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order. * * @serial */private final boolean accessOrder;private static class Entry&lt;K,V&gt; extends HashMap.Entry&lt;K,V&gt; &#123; // These fields comprise the doubly linked list used for iteration. Entry&lt;K,V&gt; before, after; Entry(int hash, K key, V value, HashMap.Entry&lt;K,V&gt; next) &#123; super(hash, key, value, next); &#125;&#125; å…¶ä¸­ Entry ç»§æ‰¿äºŽ HashMap çš„ Entryï¼Œå¹¶æ–°å¢žäº†ä¸Šä¸‹èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä¹Ÿå°±å½¢æˆäº†åŒå‘é“¾è¡¨ã€‚ è¿˜æœ‰ä¸€ä¸ª header çš„æˆå‘˜å˜é‡ï¼Œæ˜¯è¿™ä¸ªåŒå‘é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚ ä¸Šè¾¹çš„ demo æ€»ç»“æˆä¸€å¼ å›¾å¦‚ä¸‹ï¼š ç¬¬ä¸€ä¸ªç±»ä¼¼äºŽ HashMap çš„ç»“æž„ï¼Œåˆ©ç”¨ Entry ä¸­çš„ next æŒ‡é’ˆè¿›è¡Œå…³è”ã€‚ ä¸‹è¾¹åˆ™æ˜¯ LinkedHashMap å¦‚ä½•è¾¾åˆ°æœ‰åºçš„å…³é”®ã€‚ å°±æ˜¯åˆ©ç”¨äº†å¤´èŠ‚ç‚¹å’Œå…¶ä½™çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´é€šè¿‡ Entry ä¸­çš„ after å’Œ before æŒ‡é’ˆè¿›è¡Œå…³è”ã€‚ å…¶ä¸­è¿˜æœ‰ä¸€ä¸ª accessOrder æˆå‘˜å˜é‡ï¼Œé»˜è®¤æ˜¯ falseï¼Œé»˜è®¤æŒ‰ç…§æ’å…¥é¡ºåºæŽ’åºï¼Œä¸º true æ—¶æŒ‰ç…§è®¿é—®é¡ºåºæŽ’åºï¼Œä¹Ÿå¯ä»¥è°ƒç”¨: 123456public LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder) &#123; super(initialCapacity, loadFactor); this.accessOrder = accessOrder;&#125; è¿™ä¸ªæž„é€ æ–¹æ³•å¯ä»¥æ˜¾ç¤ºçš„ä¼ å…¥ accessOrderã€‚ æž„é€ æ–¹æ³•LinkedHashMap çš„æž„é€ æ–¹æ³•: 1234public LinkedHashMap() &#123; super(); accessOrder = false;&#125; å…¶å®žå°±æ˜¯è°ƒç”¨çš„ HashMap çš„æž„é€ æ–¹æ³•: HashMap å®žçŽ°ï¼š 123456789101112131415public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); this.loadFactor = loadFactor; threshold = initialCapacity; //HashMap åªæ˜¯å®šä¹‰äº†æ”¹æ–¹æ³•ï¼Œå…·ä½“å®žçŽ°äº¤ç»™äº† LinkedHashMap init();&#125; å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€ä¸ªç©ºçš„ init()ï¼Œå…·ä½“æ˜¯ç”± LinkedHashMap æ¥å®žçŽ°çš„ï¼š 12345@Overridevoid init() &#123; header = new Entry&lt;&gt;(-1, null, null, null); header.before = header.after = header;&#125; å…¶å®žä¹Ÿå°±æ˜¯å¯¹ header è¿›è¡Œäº†åˆå§‹åŒ–ã€‚ put æ–¹æ³•çœ‹ LinkedHashMap çš„ put() æ–¹æ³•ä¹‹å‰å…ˆçœ‹çœ‹ HashMap çš„ put æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142public V put(K key, V value) &#123; if (table == EMPTY_TABLE) &#123; inflateTable(threshold); &#125; if (key == null) return putForNullKey(value); int hash = hash(key); int i = indexFor(hash, table.length); for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; //ç©ºå®žçŽ°ï¼Œäº¤ç»™ LinkedHashMap è‡ªå·±å®žçŽ° e.recordAccess(this); return oldValue; &#125; &#125; modCount++; // LinkedHashMap å¯¹å…¶é‡å†™ addEntry(hash, key, value, i); return null;&#125;// LinkedHashMap å¯¹å…¶é‡å†™void addEntry(int hash, K key, V value, int bucketIndex) &#123; if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) &#123; resize(2 * table.length); hash = (null != key) ? hash(key) : 0; bucketIndex = indexFor(hash, table.length); &#125; createEntry(hash, key, value, bucketIndex);&#125;// LinkedHashMap å¯¹å…¶é‡å†™void createEntry(int hash, K key, V value, int bucketIndex) &#123; Entry&lt;K,V&gt; e = table[bucketIndex]; table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); size++;&#125; ä¸»ä½“çš„å®žçŽ°éƒ½æ˜¯å€ŸåŠ©äºŽ HashMap æ¥å®Œæˆçš„ï¼Œåªæ˜¯å¯¹å…¶ä¸­çš„ recordAccess(), addEntry(), createEntry() è¿›è¡Œäº†é‡å†™ã€‚ LinkedHashMap çš„å®žçŽ°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738 //å°±æ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯æ ¹æ®è®¿é—®é¡ºåºæŽ’åºï¼Œå¦‚æžœæ˜¯åˆ™éœ€è¦å°†å½“å‰è¿™ä¸ª Entry ç§»åŠ¨åˆ°é“¾è¡¨çš„æœ«å°¾ void recordAccess(HashMap&lt;K,V&gt; m) &#123; LinkedHashMap&lt;K,V&gt; lm = (LinkedHashMap&lt;K,V&gt;)m; if (lm.accessOrder) &#123; lm.modCount++; remove(); addBefore(lm.header); &#125; &#125; //è°ƒç”¨äº† HashMap çš„å®žçŽ°ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ é™¤æœ€å°‘ä½¿ç”¨çš„ Entry(é»˜è®¤ä¸åˆ é™¤) void addEntry(int hash, K key, V value, int bucketIndex) &#123; super.addEntry(hash, key, value, bucketIndex); // Remove eldest entry if instructed Entry&lt;K,V&gt; eldest = header.after; if (removeEldestEntry(eldest)) &#123; removeEntryForKey(eldest.key); &#125;&#125;void createEntry(int hash, K key, V value, int bucketIndex) &#123; HashMap.Entry&lt;K,V&gt; old = table[bucketIndex]; Entry&lt;K,V&gt; e = new Entry&lt;&gt;(hash, key, value, old); //å°±å¤šäº†è¿™ä¸€æ­¥ï¼Œå°†æ–°å¢žçš„ Entry åŠ å…¥åˆ° header åŒå‘é“¾è¡¨ä¸­ table[bucketIndex] = e; e.addBefore(header); size++;&#125; //å†™å…¥åˆ°åŒå‘é“¾è¡¨ä¸­ private void addBefore(Entry&lt;K,V&gt; existingEntry) &#123; after = existingEntry; before = existingEntry.before; before.after = this; after.before = this; &#125; get æ–¹æ³•LinkedHashMap çš„ get() æ–¹æ³•ä¹Ÿé‡å†™äº†ï¼š 123456789101112131415161718192021public V get(Object key) &#123; Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)getEntry(key); if (e == null) return null; //å¤šäº†ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦æ˜¯æŒ‰ç…§è®¿é—®é¡ºåºæŽ’åºï¼Œæ˜¯åˆ™å°†å½“å‰çš„ Entry ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ã€‚ e.recordAccess(this); return e.value;&#125;void recordAccess(HashMap&lt;K,V&gt; m) &#123; LinkedHashMap&lt;K,V&gt; lm = (LinkedHashMap&lt;K,V&gt;)m; if (lm.accessOrder) &#123; lm.modCount++; //åˆ é™¤ remove(); //æ·»åŠ åˆ°å¤´éƒ¨ addBefore(lm.header); &#125;&#125; clear() æ¸…ç©ºå°±è¦æ¯”è¾ƒç®€å•äº†ï¼š 12345//åªéœ€è¦æŠŠæŒ‡é’ˆéƒ½æŒ‡å‘è‡ªå·±å³å¯ï¼ŒåŽŸæœ¬é‚£äº› Entry æ²¡æœ‰å¼•ç”¨ä¹‹åŽå°±ä¼šè¢« JVM è‡ªåŠ¨å›žæ”¶ã€‚public void clear() &#123; super.clear(); header.before = header.after = header;&#125; æ€»ç»“æ€»çš„æ¥è¯´ LinkedHashMap å…¶å®žå°±æ˜¯å¯¹ HashMap è¿›è¡Œäº†æ‹“å±•ï¼Œä½¿ç”¨äº†åŒå‘é“¾è¡¨æ¥ä¿è¯äº†é¡ºåºæ€§ã€‚ å› ä¸ºæ˜¯ç»§æ‰¿ä¸Ž HashMap çš„ï¼Œæ‰€ä»¥ä¸€äº› HashMap å­˜åœ¨çš„é—®é¢˜ LinkedHashMap ä¹Ÿä¼šå­˜åœ¨ï¼Œæ¯”å¦‚ä¸æ”¯æŒå¹¶å‘ç­‰ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>LinkedHashMap</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReentrantLock å®žçŽ°åŽŸç†]]></title>
    <url>%2F2018%2F01%2F25%2FReentrantLock%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨ synchronize æ¥åšåŒæ­¥å¤„ç†æ—¶ï¼Œé”çš„èŽ·å–å’Œé‡Šæ”¾éƒ½æ˜¯éšå¼çš„ï¼Œå®žçŽ°çš„åŽŸç†æ˜¯é€šè¿‡ç¼–è¯‘åŽåŠ ä¸Šä¸åŒçš„æœºå™¨æŒ‡ä»¤æ¥å®žçŽ°ã€‚ è€Œ ReentrantLock å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œå®ƒæ˜¯åŸºäºŽ AQS(AbstractQueuedSynchronizer)æ¥å®žçŽ°çš„ã€‚ æ˜¯ä¸€ä¸ªé‡å…¥é”ï¼šä¸€ä¸ªçº¿ç¨‹èŽ·å¾—äº†é”ä¹‹åŽä»ç„¶å¯ä»¥åå¤çš„åŠ é”ï¼Œä¸ä¼šå‡ºçŽ°è‡ªå·±é˜»å¡žè‡ªå·±çš„æƒ…å†µã€‚ AQS æ˜¯ Java å¹¶å‘åŒ…é‡Œå®žçŽ°é”ã€åŒæ­¥çš„ä¸€ä¸ªé‡è¦çš„åŸºç¡€æ¡†æž¶ã€‚ é”ç±»åž‹ReentrantLock åˆ†ä¸ºå…¬å¹³é”å’Œéžå…¬å¹³é”ï¼Œå¯ä»¥é€šè¿‡æž„é€ æ–¹æ³•æ¥æŒ‡å®šå…·ä½“ç±»åž‹ï¼š 123456789//é»˜è®¤éžå…¬å¹³é”public ReentrantLock() &#123; sync = new NonfairSync();&#125;//å…¬å¹³é”public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync();&#125; é»˜è®¤ä¸€èˆ¬ä½¿ç”¨éžå…¬å¹³é”ï¼Œå®ƒçš„æ•ˆçŽ‡å’Œåžåé‡éƒ½æ¯”å…¬å¹³é”é«˜çš„å¤š(åŽé¢ä¼šåˆ†æžå…·ä½“åŽŸå› )ã€‚ èŽ·å–é”é€šå¸¸çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹: 1234567891011private ReentrantLock lock = new ReentrantLock();public void run() &#123; lock.lock(); try &#123; //do bussiness &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock.unlock(); &#125;&#125; å…¬å¹³é”èŽ·å–é”é¦–å…ˆçœ‹ä¸‹èŽ·å–é”çš„è¿‡ç¨‹ï¼š 123public void lock() &#123; sync.lock();&#125; å¯ä»¥çœ‹åˆ°æ˜¯ä½¿ç”¨ syncçš„æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“æ˜¯ç”±å…¶å­ç±»(FairSync)æ¥å®žçŽ°çš„ï¼Œä»¥ä¸‹æ˜¯å…¬å¹³é”çš„å®žçŽ°: 12345678910 final void lock() &#123; acquire(1); &#125; //AbstractQueuedSynchronizer ä¸­çš„ acquire() public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt();&#125; ç¬¬ä¸€æ­¥æ˜¯å°è¯•èŽ·å–é”(tryAcquire(arg)),è¿™ä¸ªä¹Ÿæ˜¯ç”±å…¶å­ç±»å®žçŽ°ï¼š 1234567891011121314151617181920 protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false; &#125;&#125; é¦–å…ˆä¼šåˆ¤æ–­ AQS ä¸­çš„ state æ˜¯å¦ç­‰äºŽ 0ï¼Œ0 è¡¨ç¤ºç›®å‰æ²¡æœ‰å…¶ä»–çº¿ç¨‹èŽ·å¾—é”ï¼Œå½“å‰çº¿ç¨‹å°±å¯ä»¥å°è¯•èŽ·å–é”ã€‚ æ³¨æ„:å°è¯•ä¹‹å‰ä¼šåˆ©ç”¨ hasQueuedPredecessors() æ–¹æ³•æ¥åˆ¤æ–­ AQS çš„é˜Ÿåˆ—ä¸­ä¸­æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹ï¼Œå¦‚æžœæœ‰åˆ™ä¸ä¼šå°è¯•èŽ·å–é”(è¿™æ˜¯å…¬å¹³é”ç‰¹æœ‰çš„æƒ…å†µ)ã€‚ å¦‚æžœé˜Ÿåˆ—ä¸­æ²¡æœ‰çº¿ç¨‹å°±åˆ©ç”¨ CAS æ¥å°† AQS ä¸­çš„ state ä¿®æ”¹ä¸º1ï¼Œä¹Ÿå°±æ˜¯èŽ·å–é”ï¼ŒèŽ·å–æˆåŠŸåˆ™å°†å½“å‰çº¿ç¨‹ç½®ä¸ºèŽ·å¾—é”çš„ç‹¬å çº¿ç¨‹(setExclusiveOwnerThread(current))ã€‚ å¦‚æžœ state å¤§äºŽ 0 æ—¶ï¼Œè¯´æ˜Žé”å·²ç»è¢«èŽ·å–äº†ï¼Œåˆ™éœ€è¦åˆ¤æ–­èŽ·å–é”çš„çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹(ReentrantLock æ”¯æŒé‡å…¥)ï¼Œæ˜¯åˆ™éœ€è¦å°† state + 1ï¼Œå¹¶å°†å€¼æ›´æ–°ã€‚ å†™å…¥é˜Ÿåˆ—å¦‚æžœ tryAcquire(arg) èŽ·å–é”å¤±è´¥ï¼Œåˆ™éœ€è¦ç”¨ addWaiter(Node.EXCLUSIVE) å°†å½“å‰çº¿ç¨‹å†™å…¥é˜Ÿåˆ—ä¸­ã€‚ å†™å…¥ä¹‹å‰éœ€è¦å°†å½“å‰çº¿ç¨‹åŒ…è£…ä¸ºä¸€ä¸ª Node å¯¹è±¡(addWaiter(Node.EXCLUSIVE))ã€‚ AQS ä¸­çš„é˜Ÿåˆ—æ˜¯ç”± Node èŠ‚ç‚¹ç»„æˆçš„åŒå‘é“¾è¡¨å®žçŽ°çš„ã€‚ åŒ…è£…ä»£ç : 1234567891011121314private Node addWaiter(Node mode) &#123; Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure Node pred = tail; if (pred != null) &#123; node.prev = pred; if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; enq(node); return node;&#125; é¦–å…ˆåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºæ—¶åˆ™å°†å°è£…å¥½çš„ Node åˆ©ç”¨ CAS å†™å…¥é˜Ÿå°¾ï¼Œå¦‚æžœå‡ºçŽ°å¹¶å‘å†™å…¥å¤±è´¥å°±éœ€è¦è°ƒç”¨ enq(node); æ¥å†™å…¥äº†ã€‚ 123456789101112131415private Node enq(final Node node) &#123; for (;;) &#123; Node t = tail; if (t == null) &#123; // Must initialize if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125;&#125; è¿™ä¸ªå¤„ç†é€»è¾‘å°±ç›¸å½“äºŽè‡ªæ—‹åŠ ä¸Š CAS ä¿è¯ä¸€å®šèƒ½å†™å…¥é˜Ÿåˆ—ã€‚ æŒ‚èµ·ç­‰å¾…çº¿ç¨‹å†™å…¥é˜Ÿåˆ—ä¹‹åŽéœ€è¦å°†å½“å‰çº¿ç¨‹æŒ‚èµ·(åˆ©ç”¨acquireQueued(addWaiter(Node.EXCLUSIVE), arg))ï¼š 123456789101112131415161718192021final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; é¦–å…ˆä¼šæ ¹æ® node.predecessor() èŽ·å–åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºå¤´èŠ‚ç‚¹ï¼Œå¦‚æžœæ˜¯åˆ™å°è¯•èŽ·å–ä¸€æ¬¡é”ï¼ŒèŽ·å–æˆåŠŸå°±ä¸‡äº‹å¤§å‰äº†ã€‚ å¦‚æžœä¸æ˜¯å¤´èŠ‚ç‚¹ï¼Œæˆ–è€…èŽ·å–é”å¤±è´¥ï¼Œåˆ™ä¼šæ ¹æ®ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ waitStatus çŠ¶æ€æ¥å¤„ç†(shouldParkAfterFailedAcquire(p, node))ã€‚ waitStatus ç”¨äºŽè®°å½•å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå¦‚èŠ‚ç‚¹å–æ¶ˆã€èŠ‚ç‚¹ç­‰å¾…ç­‰ã€‚ shouldParkAfterFailedAcquire(p, node) è¿”å›žå½“å‰çº¿ç¨‹æ˜¯å¦éœ€è¦æŒ‚èµ·ï¼Œå¦‚æžœéœ€è¦åˆ™è°ƒç”¨ parkAndCheckInterrupt()ï¼š 1234private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); return Thread.interrupted();&#125; ä»–æ˜¯åˆ©ç”¨ LockSupport çš„ part æ–¹æ³•æ¥æŒ‚èµ·å½“å‰çº¿ç¨‹çš„ï¼Œç›´åˆ°è¢«å”¤é†’ã€‚ éžå…¬å¹³é”èŽ·å–é”å…¬å¹³é”ä¸Žéžå…¬å¹³é”çš„å·®å¼‚ä¸»è¦åœ¨èŽ·å–é”ï¼š å…¬å¹³é”å°±ç›¸å½“äºŽä¹°ç¥¨ï¼ŒåŽæ¥çš„äººéœ€è¦æŽ’åˆ°é˜Ÿå°¾ä¾æ¬¡ä¹°ç¥¨ï¼Œä¸èƒ½æ’é˜Ÿã€‚ è€Œéžå…¬å¹³é”åˆ™æ²¡æœ‰è¿™äº›è§„åˆ™ï¼Œæ˜¯æŠ¢å æ¨¡å¼ï¼Œæ¯æ¥ä¸€ä¸ªäººä¸ä¼šåŽ»ç®¡é˜Ÿåˆ—å¦‚ä½•ï¼Œç›´æŽ¥å°è¯•èŽ·å–é”ã€‚ éžå…¬å¹³é”:1234567final void lock() &#123; //ç›´æŽ¥å°è¯•èŽ·å–é” if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1);&#125; å…¬å¹³é”:123final void lock() &#123; acquire(1);&#125; è¿˜è¦ä¸€ä¸ªé‡è¦çš„åŒºåˆ«æ˜¯åœ¨å°è¯•èŽ·å–é”æ—¶tryAcquire(arg)ï¼Œéžå…¬å¹³é”æ˜¯ä¸éœ€è¦åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦è¿˜æœ‰å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿæ˜¯ç›´æŽ¥å°è¯•èŽ·å–é”ï¼š 12345678910111213141516171819final boolean nonfairTryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; //æ²¡æœ‰ !hasQueuedPredecessors() åˆ¤æ–­ if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false;&#125; é‡Šæ”¾é”å…¬å¹³é”å’Œéžå…¬å¹³é”çš„é‡Šæ”¾æµç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼š 12345678910111213141516171819202122232425262728public void unlock() &#123; sync.release(1);&#125;public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) //å”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ unparkSuccessor(h); return true; &#125; return false;&#125;//å°è¯•é‡Šæ”¾é”protected final boolean tryRelease(int releases) &#123; int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; free = true; setExclusiveOwnerThread(null); &#125; setState(c); return free;&#125; é¦–å…ˆä¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºèŽ·å¾—é”çš„çº¿ç¨‹ï¼Œç”±äºŽæ˜¯é‡å…¥é”æ‰€ä»¥éœ€è¦å°† state å‡åˆ° 0 æ‰è®¤ä¸ºå®Œå…¨é‡Šæ”¾é”ã€‚ é‡Šæ”¾ä¹‹åŽéœ€è¦è°ƒç”¨ unparkSuccessor(h) æ¥å”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚ æ€»ç»“ç”±äºŽå…¬å¹³é”éœ€è¦å…³å¿ƒé˜Ÿåˆ—çš„æƒ…å†µï¼Œå¾—æŒ‰ç…§é˜Ÿåˆ—é‡Œçš„å…ˆåŽé¡ºåºæ¥èŽ·å–é”(ä¼šé€ æˆå¤§é‡çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢)ï¼Œè€Œéžå…¬å¹³é”åˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚ æ‰€ä»¥ä¹Ÿå°±èƒ½è§£é‡Šéžå…¬å¹³é”çš„æ•ˆçŽ‡ä¼šè¢«å…¬å¹³é”æ›´é«˜ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ReentrantLock</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¯¹è±¡çš„åˆ›å»ºä¸Žå†…å­˜åˆ†é…]]></title>
    <url>%2F2018%2F01%2F18%2FnewObject%2F</url>
    <content type="text"><![CDATA[åˆ›å»ºå¯¹è±¡å½“ JVM æ”¶åˆ°ä¸€ä¸ª new æŒ‡ä»¤æ—¶ï¼Œä¼šæ£€æŸ¥æŒ‡ä»¤ä¸­çš„å‚æ•°åœ¨å¸¸é‡æ± æ˜¯å¦æœ‰è¿™ä¸ªç¬¦å·çš„å¼•ç”¨ï¼Œè¿˜ä¼šæ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡äº†ï¼Œå¦‚æžœæ²¡æœ‰çš„è¯åˆ™è¦è¿›è¡Œä¸€æ¬¡ç±»åŠ è½½ã€‚ æŽ¥ç€å°±æ˜¯åˆ†é…å†…å­˜äº†ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š æŒ‡é’ˆç¢°æ’ž ç©ºé—²åˆ—è¡¨ ä½¿ç”¨æŒ‡é’ˆç¢°æ’žçš„å‰ææ˜¯å †å†…å­˜æ˜¯å®Œå…¨å·¥æ•´çš„ï¼Œç”¨è¿‡çš„å†…å­˜å’Œæ²¡ç”¨çš„å†…å­˜å„åœ¨ä¸€è¾¹æ¯æ¬¡åˆ†é…çš„æ—¶å€™åªéœ€è¦å°†æŒ‡é’ˆå‘ç©ºé—²å†…å­˜ä¸€æ–¹ç§»åŠ¨ä¸€æ®µå’Œå†…å­˜å¤§å°ç›¸ç­‰åŒºåŸŸå³å¯ã€‚ å½“å †ä¸­å·²ç»ä½¿ç”¨çš„å†…å­˜å’Œæœªä½¿ç”¨çš„å†…å­˜äº’ç›¸äº¤é”™æ—¶ï¼ŒæŒ‡é’ˆç¢°æ’žçš„æ–¹å¼å°±è¡Œä¸é€šäº†ï¼Œè¿™æ—¶å°±éœ€è¦é‡‡ç”¨ç©ºé—²åˆ—è¡¨çš„æ–¹å¼ã€‚è™šæ‹Ÿæœºä¼šç»´æŠ¤ä¸€ä¸ªç©ºé—²çš„åˆ—è¡¨ï¼Œç”¨äºŽè®°å½•å“ªäº›å†…å­˜æ˜¯å¯ä»¥è¿›è¡Œåˆ†é…çš„ï¼Œåˆ†é…æ—¶ç›´æŽ¥ä»Žå¯ç”¨å†…å­˜ä¸­ç›´æŽ¥åˆ†é…å³å¯ã€‚ å †ä¸­çš„å†…å­˜æ˜¯å¦å·¥æ•´æ˜¯æœ‰åžƒåœ¾æ”¶é›†å™¨æ¥å†³å®šçš„ï¼Œå¦‚æžœå¸¦æœ‰åŽ‹ç¼©åŠŸèƒ½çš„åžƒåœ¾æ”¶é›†å™¨å°±æ˜¯é‡‡ç”¨æŒ‡é’ˆç¢°æ’žçš„æ–¹å¼æ¥è¿›è¡Œå†…å­˜åˆ†é…çš„ã€‚ åˆ†é…å†…å­˜æ—¶ä¹Ÿä¼šå‡ºçŽ°å¹¶å‘é—®é¢˜: è¿™æ ·å¯ä»¥åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä½¿ç”¨ CAS è¿™æ ·çš„ä¹è§‚é”æ¥ä¿è¯ã€‚ ä¹Ÿå¯ä»¥å°†å†…å­˜åˆ†é…å®‰æŽ’åœ¨æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„ç©ºé—´è¿›è¡Œï¼Œæ¯ä¸ªçº¿ç¨‹é¦–å…ˆåœ¨å †å†…å­˜ä¸­åˆ†é…ä¸€å°å—å†…å­˜ï¼Œç§°ä¸ºæœ¬åœ°åˆ†é…ç¼“å­˜(TLAB : Thread Local Allocation Buffer)ã€‚ åˆ†é…å†…å­˜æ—¶ï¼Œåªéœ€è¦åœ¨è‡ªå·±çš„åˆ†é…ç¼“å­˜ä¸­åˆ†é…å³å¯ï¼Œç”±äºŽè¿™ä¸ªå†…å­˜åŒºåŸŸæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºçŽ°å¹¶å‘é—®é¢˜ã€‚ å¯ä»¥ä½¿ç”¨ -XX:+/-UseTLAB å‚æ•°æ¥è®¾å®š JVM æ˜¯å¦å¼€å¯ TLAB ã€‚ å†…å­˜åˆ†é…ä¹‹åŽéœ€è¦å¯¹è¯¥å¯¹è±¡è¿›è¡Œè®¾ç½®ï¼Œå¦‚å¯¹è±¡å¤´ã€‚å¯¹è±¡å¤´çš„ä¸€äº›åº”ç”¨å¯ä»¥æŸ¥çœ‹ Synchronize å…³é”®å­—åŽŸç†ã€‚ å¯¹è±¡è®¿é—®ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºä¹‹åŽè‡ªç„¶æ˜¯ä¸ºäº†ä½¿ç”¨ï¼Œåœ¨ Java ä¸­æ˜¯é€šè¿‡æ ˆæ¥å¼•ç”¨å †å†…å­˜ä¸­çš„å¯¹è±¡æ¥è¿›è¡Œæ“ä½œçš„ã€‚ å¯¹äºŽæˆ‘ä»¬å¸¸ç”¨çš„ HotSpot è™šæ‹Ÿæœºæ¥è¯´ï¼Œè¿™æ ·å¼•ç”¨å…³ç³»æ˜¯é€šè¿‡ç›´æŽ¥æŒ‡é’ˆæ¥å…³è”çš„ã€‚ å¦‚å›¾: è¿™æ ·çš„å¥½å¤„å°±æ˜¯ï¼šåœ¨ Java é‡Œè¿›è¡Œé¢‘ç¹çš„å¯¹è±¡è®¿é—®å¯ä»¥æå‡è®¿é—®é€Ÿåº¦(ç›¸å¯¹äºŽä½¿ç”¨å¥æŸ„æ± æ¥è¯´)ã€‚ å†…å­˜åˆ†é…Eden åŒºåˆ†é…ç®€å•çš„æ¥è¯´å¯¹è±¡éƒ½æ˜¯åœ¨å †å†…å­˜ä¸­åˆ†é…çš„ï¼Œå¾€ç»†ä¸€ç‚¹çœ‹åˆ™æ˜¯ä¼˜å…ˆåœ¨ Eden åŒºåˆ†é…ã€‚ è¿™é‡Œå°±æ¶‰åŠåˆ°å †å†…å­˜çš„åˆ’åˆ†äº†ï¼Œä¸ºäº†æ–¹ä¾¿åžƒåœ¾å›žæ”¶ï¼ŒJVM å°†å¯¹å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ è€Œæ–°ç”Ÿä»£ä¸­åˆä¼šåˆ’åˆ†ä¸º Eden åŒºï¼Œfrom Survivorã€to Survivor åŒºã€‚ å…¶ä¸­ Eden å’Œ Survivor åŒºçš„æ¯”ä¾‹é»˜è®¤æ˜¯ 8:1:1ï¼Œå½“ç„¶ä¹Ÿæ”¯æŒå‚æ•°è°ƒæ•´ -XX:SurvivorRatio=8ã€‚ å½“åœ¨ Eden åŒºåˆ†é…å†…å­˜ä¸è¶³æ—¶ï¼Œåˆ™ä¼šå‘ç”Ÿ minorGC ï¼Œç”±äºŽ Java å¯¹è±¡å¤šæ•°æ˜¯æœç”Ÿå¤•ç­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ minorGC é€šå¸¸ä¼šæ¯”è¾ƒé¢‘ç¹ï¼Œæ•ˆçŽ‡ä¹Ÿæ¯”è¾ƒé«˜ã€‚ å½“å‘ç”Ÿ minorGC æ—¶ï¼ŒJVM ä¼šæ ¹æ®å¤åˆ¶ç®—æ³•å°†å­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°å¦ä¸€ä¸ªæœªä½¿ç”¨çš„ Survivor åŒºï¼Œå¦‚æžœ Survivor åŒºå†…å­˜ä¸è¶³æ—¶ï¼Œåˆ™ä¼šä½¿ç”¨åˆ†é…æ‹…ä¿ç­–ç•¥å°†å¯¹è±¡ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚ è°ˆåˆ° minorGC æ—¶ï¼Œå°±ä¸å¾—ä¸æåˆ° fullGC(majorGC) ï¼Œè¿™æ˜¯æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GC ï¼Œä¸è®ºæ˜¯æ•ˆçŽ‡è¿˜æ˜¯é€Ÿåº¦éƒ½æ¯” minorGC æ…¢çš„å¤šï¼Œå›žæ”¶æ—¶è¿˜ä¼šå‘ç”Ÿ stop the world ä½¿ç¨‹åºå‘ç”Ÿåœé¡¿ï¼Œæ‰€ä»¥åº”å½“å°½é‡é¿å…å‘ç”Ÿ fullGC ã€‚ è€å¹´ä»£åˆ†é…ä¹Ÿæœ‰ä¸€äº›æƒ…å†µä¼šå¯¼è‡´å¯¹è±¡ç›´æŽ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œæ¯”å¦‚å½“åˆ†é…ä¸€ä¸ªå¤§å¯¹è±¡æ—¶(å¤§çš„æ•°ç»„ï¼Œå¾ˆé•¿çš„å­—ç¬¦ä¸²)ï¼Œç”±äºŽ Eden åŒºæ²¡æœ‰è¶³å¤Ÿå¤§çš„è¿žç»­ç©ºé—´æ¥åˆ†é…æ—¶ï¼Œä¼šå¯¼è‡´æå‰è§¦å‘ä¸€æ¬¡ GCï¼Œæ‰€ä»¥å°½é‡åˆ«é¢‘ç¹çš„åˆ›å»ºå¤§å¯¹è±¡ã€‚ å› æ­¤ JVM ä¼šæ ¹æ®ä¸€ä¸ªé˜ˆå€¼æ¥åˆ¤æ–­å¤§äºŽè¯¥é˜ˆå€¼å¯¹è±¡ç›´æŽ¥åˆ†é…åˆ°è€å¹´ä»£ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨æ–°ç”Ÿä»£é¢‘ç¹çš„å‘ç”Ÿ GCã€‚ å¯¹äºŽä¸€äº›åœ¨æ–°ç”Ÿä»£çš„è€å¯¹è±¡ JVM ä¹Ÿä¼šæ ¹æ®æŸç§æœºåˆ¶ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚ JVM æ˜¯æ ¹æ®è®°å½•å¯¹è±¡å¹´é¾„çš„æ–¹å¼æ¥åˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦åº”è¯¥ç§»åŠ¨åˆ°è€å¹´ä»£ï¼Œæ ¹æ®æ–°ç”Ÿä»£çš„å¤åˆ¶ç®—æ³•ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«ç§»åŠ¨åˆ° Survivor åŒºä¹‹åŽ JVM å°±ç»™è¯¥å¯¹è±¡çš„å¹´é¾„è®°ä¸º1ï¼Œæ¯å½“ç†¬è¿‡ä¸€æ¬¡ minorGC åŽå¯¹è±¡çš„å¹´é¾„å°± +1 ï¼Œç›´åˆ°è¾¾åˆ°é˜ˆå€¼(é»˜è®¤ä¸º15)å°±ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚ å¯ä»¥ä½¿ç”¨ -XX:MaxTenuringThreshold=15 æ¥é…ç½®è¿™ä¸ªé˜ˆå€¼ã€‚ æ€»ç»“è™½è¯´è¿™äº›å†…å®¹ç•¥æ˜¾æž¯ç‡¥ï¼Œä½†å½“åº”ç”¨å‘ç”Ÿä¸æ­£å¸¸çš„ GC æ—¶ï¼Œå¯ä»¥æ–¹ä¾¿æ›´å¿«çš„å®šä½é—®é¢˜ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[synchronized å…³é”®å­—åŽŸç†]]></title>
    <url>%2F2018%2F01%2F14%2FSynchronize%2F</url>
    <content type="text"><![CDATA[ä¼—æ‰€å‘¨çŸ¥ synchronized å…³é”®å­—æ˜¯è§£å†³å¹¶å‘é—®é¢˜å¸¸ç”¨è§£å†³æ–¹æ¡ˆï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§ä½¿ç”¨æ–¹å¼: åŒæ­¥æ™®é€šæ–¹æ³•ï¼Œé”çš„æ˜¯å½“å‰å¯¹è±¡ã€‚ åŒæ­¥é™æ€æ–¹æ³•ï¼Œé”çš„æ˜¯å½“å‰ Class å¯¹è±¡ã€‚ åŒæ­¥å—ï¼Œé”çš„æ˜¯ () ä¸­çš„å¯¹è±¡ã€‚ å®žçŽ°åŽŸç†ï¼šJVM æ˜¯é€šè¿‡è¿›å…¥ã€é€€å‡ºå¯¹è±¡ç›‘è§†å™¨( Monitor )æ¥å®žçŽ°å¯¹æ–¹æ³•ã€åŒæ­¥å—çš„åŒæ­¥çš„ã€‚ å…·ä½“å®žçŽ°æ˜¯åœ¨ç¼–è¯‘ä¹‹åŽåœ¨åŒæ­¥æ–¹æ³•è°ƒç”¨å‰åŠ å…¥ä¸€ä¸ª monitor.enter æŒ‡ä»¤ï¼Œåœ¨é€€å‡ºæ–¹æ³•å’Œå¼‚å¸¸å¤„æ’å…¥ monitor.exit çš„æŒ‡ä»¤ã€‚ å…¶æœ¬è´¨å°±æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡ç›‘è§†å™¨( Monitor )è¿›è¡ŒèŽ·å–ï¼Œè€Œè¿™ä¸ªèŽ·å–è¿‡ç¨‹å…·æœ‰æŽ’ä»–æ€§ä»Žè€Œè¾¾åˆ°äº†åŒä¸€æ—¶åˆ»åªèƒ½ä¸€ä¸ªçº¿ç¨‹è®¿é—®çš„ç›®çš„ã€‚ è€Œå¯¹äºŽæ²¡æœ‰èŽ·å–åˆ°é”çš„çº¿ç¨‹å°†ä¼šé˜»å¡žåˆ°æ–¹æ³•å…¥å£å¤„ï¼Œç›´åˆ°èŽ·å–é”çš„çº¿ç¨‹ monitor.exit ä¹‹åŽæ‰èƒ½å°è¯•ç»§ç»­èŽ·å–é”ã€‚ æµç¨‹å›¾å¦‚ä¸‹: é€šè¿‡ä¸€æ®µä»£ç æ¥æ¼”ç¤º: 12345public static void main(String[] args) &#123; synchronized (Synchronize.class)&#123; System.out.println("Synchronize"); &#125;&#125; ä½¿ç”¨ javap -c Synchronize å¯ä»¥æŸ¥çœ‹ç¼–è¯‘ä¹‹åŽçš„å…·ä½“ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324252627282930public class com.crossoverjie.synchronize.Synchronize &#123; public com.crossoverjie.synchronize.Synchronize(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return public static void main(java.lang.String[]); Code: 0: ldc #2 // class com/crossoverjie/synchronize/Synchronize 2: dup 3: astore_1 **4: monitorenter** 5: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 8: ldc #4 // String Synchronize 10: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 13: aload_1 **14: monitorexit** 15: goto 23 18: astore_2 19: aload_1 20: monitorexit 21: aload_2 22: athrow 23: return Exception table: from to target type 5 15 18 any 18 21 18 any&#125; å¯ä»¥çœ‹åˆ°åœ¨åŒæ­¥å—çš„å…¥å£å’Œå‡ºå£åˆ†åˆ«æœ‰ monitorenter,monitorexitæŒ‡ä»¤ã€‚ é”ä¼˜åŒ–synchronized å¾ˆå¤šéƒ½ç§°ä¹‹ä¸ºé‡é‡é”ï¼ŒJDK1.6 ä¸­å¯¹ synchronized è¿›è¡Œäº†å„ç§ä¼˜åŒ–ï¼Œä¸ºäº†èƒ½å‡å°‘èŽ·å–å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ¶ˆè€—å¼•å…¥äº†åå‘é”å’Œè½»é‡é”ã€‚ è½»é‡é”å½“ä»£ç è¿›å…¥åŒæ­¥å—æ—¶ï¼Œå¦‚æžœåŒæ­¥å¯¹è±¡ä¸ºæ— é”çŠ¶æ€æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šåœ¨æ ˆå¸§ä¸­åˆ›å»ºä¸€ä¸ªé”è®°å½•(Lock Record)åŒºåŸŸï¼ŒåŒæ—¶å°†é”å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­ Mark Word æ‹·è´åˆ°é”è®°å½•ä¸­ï¼Œå†å°è¯•ä½¿ç”¨ CAS å°† Mark Word æ›´æ–°ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚ å¦‚æžœæ›´æ–°æˆåŠŸï¼Œå½“å‰çº¿ç¨‹å°±èŽ·å¾—äº†é”ã€‚ å¦‚æžœæ›´æ–°å¤±è´¥ JVM ä¼šå…ˆæ£€æŸ¥é”å¯¹è±¡çš„ Mark Word æ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„é”è®°å½•ã€‚ å¦‚æžœæ˜¯åˆ™è¯´æ˜Žå½“å‰çº¿ç¨‹æ‹¥æœ‰é”å¯¹è±¡çš„é”ï¼Œå¯ä»¥ç›´æŽ¥è¿›å…¥åŒæ­¥å—ã€‚ ä¸æ˜¯åˆ™è¯´æ˜Žæœ‰å…¶ä»–çº¿ç¨‹æŠ¢å äº†é”ï¼Œå¦‚æžœå­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶ç«žäº‰ä¸€æŠŠé”ï¼Œè½»é‡é”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡é”ã€‚ è§£é”è½»é‡é”çš„è§£é”è¿‡ç¨‹ä¹Ÿæ˜¯åˆ©ç”¨ CAS æ¥å®žçŽ°çš„ï¼Œä¼šå°è¯•é”è®°å½•æ›¿æ¢å›žé”å¯¹è±¡çš„ Mark Word ã€‚å¦‚æžœæ›¿æ¢æˆåŠŸåˆ™è¯´æ˜Žæ•´ä¸ªåŒæ­¥æ“ä½œå®Œæˆï¼Œå¤±è´¥åˆ™è¯´æ˜Žæœ‰å…¶ä»–çº¿ç¨‹å°è¯•èŽ·å–é”ï¼Œè¿™æ—¶å°±ä¼šå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹(æ­¤æ—¶å·²ç»è†¨èƒ€ä¸ºé‡é‡é”) è½»é‡é”èƒ½æå‡æ€§èƒ½çš„åŽŸå› ï¼š è®¤ä¸ºå¤§å¤šæ•°é”åœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸéƒ½ä¸å­˜åœ¨ç«žäº‰ï¼Œæ‰€ä»¥ä½¿ç”¨ CAS æ¯”ä½¿ç”¨äº’æ–¥å¼€é”€æ›´å°‘ã€‚ä½†å¦‚æžœé”ç«žäº‰æ¿€çƒˆï¼Œè½»é‡é”å°±ä¸ä½†æœ‰äº’æ–¥çš„å¼€é”€ï¼Œè¿˜æœ‰ CAS çš„å¼€é”€ï¼Œç”šè‡³æ¯”é‡é‡é”æ›´æ…¢ã€‚ åå‘é”ä¸ºäº†è¿›ä¸€æ­¥çš„é™ä½ŽèŽ·å–é”çš„ä»£ä»·ï¼ŒJDK1.6 ä¹‹åŽè¿˜å¼•å…¥äº†åå‘é”ã€‚ åå‘é”çš„ç‰¹å¾æ˜¯:é”ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«žäº‰ï¼Œå¹¶ä¸”åº”ç”±ä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡èŽ·å¾—é”ã€‚ å½“çº¿ç¨‹è®¿é—®åŒæ­¥å—æ—¶ï¼Œä¼šä½¿ç”¨ CAS å°†çº¿ç¨‹ ID æ›´æ–°åˆ°é”å¯¹è±¡çš„ Mark Word ä¸­ï¼Œå¦‚æžœæ›´æ–°æˆåŠŸåˆ™èŽ·å¾—åå‘é”ï¼Œå¹¶ä¸”ä¹‹åŽæ¯æ¬¡è¿›å…¥è¿™ä¸ªå¯¹è±¡é”ç›¸å…³çš„åŒæ­¥å—æ—¶éƒ½ä¸éœ€è¦å†æ¬¡èŽ·å–é”äº†ã€‚ é‡Šæ”¾é”å½“æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹èŽ·å–è¿™ä¸ªé”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹å°±ä¼šé‡Šæ”¾é”ï¼Œé‡Šæ”¾æ—¶ä¼šç­‰å¾…å…¨å±€å®‰å…¨ç‚¹(è¿™ä¸€æ—¶åˆ»æ²¡æœ‰å­—èŠ‚ç è¿è¡Œ)ï¼ŒæŽ¥ç€ä¼šæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œæ ¹æ®é”å¯¹è±¡ç›®å‰æ˜¯å¦è¢«é”æ¥åˆ¤å®šå°†å¯¹è±¡å¤´ä¸­çš„ Mark Word è®¾ç½®ä¸ºæ— é”æˆ–è€…æ˜¯è½»é‡é”çŠ¶æ€ã€‚ åå‘é”å¯ä»¥æé«˜å¸¦æœ‰åŒæ­¥å´æ²¡æœ‰ç«žäº‰çš„ç¨‹åºæ€§èƒ½ï¼Œä½†å¦‚æžœç¨‹åºä¸­å¤§å¤šæ•°é”éƒ½å­˜åœ¨ç«žäº‰æ—¶ï¼Œé‚£åå‘é”å°±èµ·ä¸åˆ°å¤ªå¤§ä½œç”¨ã€‚å¯ä»¥ä½¿ç”¨ -XX:-userBiasedLocking=false æ¥å…³é—­åå‘é”ï¼Œå¹¶é»˜è®¤è¿›å…¥è½»é‡é”ã€‚ å…¶ä»–ä¼˜åŒ–é€‚åº”æ€§è‡ªæ—‹åœ¨ä½¿ç”¨ CAS æ—¶ï¼Œå¦‚æžœæ“ä½œå¤±è´¥ï¼ŒCAS ä¼šè‡ªæ—‹å†æ¬¡å°è¯•ã€‚ç”±äºŽè‡ªæ—‹æ˜¯éœ€è¦æ¶ˆè€— CPU èµ„æºçš„ï¼Œæ‰€ä»¥å¦‚æžœé•¿æœŸè‡ªæ—‹å°±ç™½ç™½æµªè´¹äº† CPUã€‚JDK1.6åŠ å…¥äº†é€‚åº”æ€§è‡ªæ—‹: å¦‚æžœæŸä¸ªé”è‡ªæ—‹å¾ˆå°‘æˆåŠŸèŽ·å¾—ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å°±ä¼šå‡å°‘è‡ªæ—‹ã€‚ æ€»ç»“synchronized çŽ°åœ¨å·²ç»ä¸åƒä»¥å‰é‚£ä¹ˆé‡äº†ï¼Œæ‹¿ 1.8 ä¸­çš„ ConcurrentHashMap å°±å¯ä»¥çœ‹å‡ºï¼Œé‡Œé¢å¤§é‡çš„ä½¿ç”¨äº† synchronized æ¥è¿›è¡ŒåŒæ­¥ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>synchronize</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€è‡´ Hash ç®—æ³•åˆ†æž]]></title>
    <url>%2F2018%2F01%2F08%2FConsistent-Hash%2F</url>
    <content type="text"><![CDATA[å½“æˆ‘ä»¬åœ¨åšæ•°æ®åº“åˆ†åº“åˆ†è¡¨æˆ–è€…æ˜¯åˆ†å¸ƒå¼ç¼“å­˜æ—¶ï¼Œä¸å¯é¿å…çš„éƒ½ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜: å¦‚ä½•å°†æ•°æ®å‡åŒ€çš„åˆ†æ•£åˆ°å„ä¸ªèŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”å°½é‡çš„åœ¨åŠ å‡èŠ‚ç‚¹æ—¶èƒ½ä½¿å—å½±å“çš„æ•°æ®æœ€å°‘ã€‚ Hash å–æ¨¡éšæœºæ”¾ç½®å°±ä¸è¯´äº†ï¼Œä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ã€‚é€šå¸¸æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ¡ˆå°±æ˜¯ hash å–æ¨¡äº†ã€‚ å¯ä»¥å°†ä¼ å…¥çš„ Key æŒ‰ç…§ index = hash(key) % N è¿™æ ·æ¥è®¡ç®—å‡ºéœ€è¦å­˜æ”¾çš„èŠ‚ç‚¹ã€‚å…¶ä¸­ hash å‡½æ•°æ˜¯ä¸€ä¸ªå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ­£æ•´æ•°çš„å“ˆå¸Œæ˜ å°„æ–¹æ³•ï¼ŒN å°±æ˜¯èŠ‚ç‚¹çš„æ•°é‡ã€‚ è¿™æ ·å¯ä»¥æ»¡è¶³æ•°æ®çš„å‡åŒ€åˆ†é…ï¼Œä½†æ˜¯è¿™ä¸ªç®—æ³•çš„å®¹é”™æ€§å’Œæ‰©å±•æ€§éƒ½è¾ƒå·®ã€‚ æ¯”å¦‚å¢žåŠ æˆ–åˆ é™¤äº†ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œæ‰€æœ‰çš„ Key éƒ½éœ€è¦é‡æ–°è®¡ç®—ï¼Œæ˜¾ç„¶è¿™æ ·æˆæœ¬è¾ƒé«˜ï¼Œä¸ºæ­¤éœ€è¦ä¸€ä¸ªç®—æ³•æ»¡è¶³åˆ†å¸ƒå‡åŒ€åŒæ—¶ä¹Ÿè¦æœ‰è‰¯å¥½çš„å®¹é”™æ€§å’Œæ‹“å±•æ€§ã€‚ ä¸€è‡´ Hash ç®—æ³•ä¸€è‡´ Hash ç®—æ³•æ˜¯å°†æ‰€æœ‰çš„å“ˆå¸Œå€¼æž„æˆäº†ä¸€ä¸ªçŽ¯ï¼Œå…¶èŒƒå›´åœ¨ 0 ~ 2^32-1ã€‚å¦‚ä¸‹å›¾ï¼š ä¹‹åŽå°†å„ä¸ªèŠ‚ç‚¹æ•£åˆ—åˆ°è¿™ä¸ªçŽ¯ä¸Šï¼Œå¯ä»¥ç”¨èŠ‚ç‚¹çš„ IPã€hostname è¿™æ ·çš„å”¯ä¸€æ€§å­—æ®µä½œä¸º Key è¿›è¡Œ hash(key)ï¼Œæ•£åˆ—ä¹‹åŽå¦‚ä¸‹ï¼š ä¹‹åŽéœ€è¦å°†æ•°æ®å®šä½åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šï¼Œä½¿ç”¨åŒæ ·çš„ hash å‡½æ•° å°† Key ä¹Ÿæ˜ å°„åˆ°è¿™ä¸ªçŽ¯ä¸Šã€‚ è¿™æ ·æŒ‰ç…§é¡ºæ—¶é’ˆæ–¹å‘å°±å¯ä»¥æŠŠ k1 å®šä½åˆ° N1èŠ‚ç‚¹ï¼Œk2 å®šä½åˆ° N3èŠ‚ç‚¹ï¼Œk3 å®šä½åˆ° N2èŠ‚ç‚¹ã€‚ å®¹é”™æ€§è¿™æ—¶å‡è®¾ N1 å®•æœºäº†ï¼š ä¾ç„¶æ ¹æ®é¡ºæ—¶é’ˆæ–¹å‘ï¼Œk2 å’Œ k3 ä¿æŒä¸å˜ï¼Œåªæœ‰ k1 è¢«é‡æ–°æ˜ å°„åˆ°äº† N3ã€‚è¿™æ ·å°±å¾ˆå¥½çš„ä¿è¯äº†å®¹é”™æ€§ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹å®•æœºæ—¶åªä¼šå½±å“åˆ°å°‘å°‘éƒ¨åˆ†çš„æ•°æ®ã€‚ æ‹“å±•æ€§å½“æ–°å¢žä¸€ä¸ªèŠ‚ç‚¹æ—¶: åœ¨ N2 å’Œ N3 ä¹‹é—´æ–°å¢žäº†ä¸€ä¸ªèŠ‚ç‚¹ N4 ï¼Œè¿™æ—¶ä¼šå‘çŽ°å—å°è±¡çš„æ•°æ®åªæœ‰ k3ï¼Œå…¶ä½™æ•°æ®ä¹Ÿæ˜¯ä¿æŒä¸å˜ï¼Œæ‰€ä»¥è¿™æ ·ä¹Ÿå¾ˆå¥½çš„ä¿è¯äº†æ‹“å±•æ€§ã€‚ è™šæ‹ŸèŠ‚ç‚¹åˆ°ç›®å‰ä¸ºæ­¢è¯¥ç®—æ³•ä¾ç„¶ä¹Ÿæœ‰ç‚¹é—®é¢˜: å½“èŠ‚ç‚¹è¾ƒå°‘æ—¶ä¼šå‡ºçŽ°æ•°æ®åˆ†å¸ƒä¸å‡åŒ€çš„æƒ…å†µï¼š è¿™æ ·ä¼šå¯¼è‡´å¤§éƒ¨åˆ†æ•°æ®éƒ½åœ¨ N1 èŠ‚ç‚¹ï¼Œåªæœ‰å°‘é‡çš„æ•°æ®åœ¨ N2 èŠ‚ç‚¹ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€è‡´å“ˆå¸Œç®—æ³•å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹ã€‚å°†æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è¿›è¡Œå¤šæ¬¡ hashï¼Œç”Ÿæˆå¤šä¸ªèŠ‚ç‚¹æ”¾ç½®åœ¨çŽ¯ä¸Šç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹: è®¡ç®—æ—¶å¯ä»¥åœ¨ IP åŽåŠ ä¸Šç¼–å·æ¥ç”Ÿæˆå“ˆå¸Œå€¼ã€‚ è¿™æ ·åªéœ€è¦åœ¨åŽŸæœ‰çš„åŸºç¡€ä¸Šå¤šä¸€æ­¥ç”±è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°å®žé™…èŠ‚ç‚¹çš„æ­¥éª¤å³å¯è®©å°‘é‡èŠ‚ç‚¹ä¹Ÿèƒ½æ»¡è¶³å‡åŒ€æ€§ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[sbc(å…­) Zuul GateWay ç½‘å…³åº”ç”¨]]></title>
    <url>%2F2017%2F11%2F28%2Fsbc6%2F</url>
    <content type="text"><![CDATA[å‰è¨€çœ‹è¿‡ä¹‹å‰SBCç³»åˆ—çš„å°ä¼™ä¼´åº”è¯¥éƒ½å¯ä»¥æ­å»ºä¸€ä¸ªé«˜å¯ç”¨ã€åˆ†å¸ƒå¼çš„å¾®æœåŠ¡äº†ã€‚ ç›®å‰çš„ç»“æž„å›¾åº”è¯¥å¦‚ä¸‹æ‰€ç¤º: å„ä¸ªå¾®æœåŠ¡ä¹‹é—´éƒ½ä¸å­˜åœ¨å•ç‚¹ï¼Œå¹¶ä¸”éƒ½æ³¨å†ŒäºŽ Eureka ï¼ŒåŸºäºŽæ­¤è¿›è¡ŒæœåŠ¡çš„æ³¨å†ŒäºŽå‘çŽ°ï¼Œå†é€šè¿‡ Ribbon è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼Œå¹¶å…·æœ‰å®¢æˆ·ç«¯è´Ÿè½½åŠŸèƒ½ã€‚ ä¸€åˆ‡çœ‹èµ·æ¥éƒ½æ¯”è¾ƒç¾Žå¥½ï¼Œä½†è¿™é‡Œå´å¿˜äº†ä¸€ä¸ªé‡è¦çš„ç»†èŠ‚ï¼š å½“æˆ‘ä»¬éœ€è¦å¯¹å¤–æä¾›æœåŠ¡æ—¶æ€Žä¹ˆå¤„ç†ï¼Ÿ è¿™å½“ç„¶ä¹Ÿèƒ½å®žçŽ°ï¼Œæ— éžå°±æ˜¯å°†æˆ‘ä»¬å…·ä½“çš„å¾®æœåŠ¡åœ°å€åŠ ç«¯å£æš´éœ²å‡ºåŽ»å³å¯ã€‚ é‚£åˆå¦‚ä½•æ¥å®žçŽ°è´Ÿè½½å‘¢ï¼Ÿ ç®€å•ï¼å¯ä»¥é€šè¿‡ Nginx F5 ä¹‹ç±»çš„å·¥å…·è¿›è¡Œè´Ÿè½½ã€‚ ä½†æ˜¯å¦‚æžœç³»ç»Ÿåºžå¤§ï¼ŒæœåŠ¡æ‹†åˆ†çš„è¶³å¤Ÿå¤šé‚£åˆæœ‰è°æ¥ç»´æŠ¤è¿™äº›è·¯ç”±å…³ç³»å‘¢ï¼Ÿ å½“ç„¶è¿™æ˜¯è¿ç»´çš„æ´»ï¼Œä¸è¿‡è¿™æ—¶å€™è¿ç»´å¯èƒ½å°±è¦å‘é£™äº†ï¼ å¹¶ä¸”è¿˜æœ‰ä¸€ç³»åˆ—çš„é—®é¢˜: æœåŠ¡è°ƒç”¨ä¹‹é—´çš„ä¸€äº›é‰´æƒã€ç­¾åæ ¡éªŒæ€Žä¹ˆåšï¼Ÿ ç”±äºŽæœåŠ¡ç«¯åœ°å€è¾ƒå¤šï¼Œå®¢æˆ·ç«¯è¯·æ±‚éš¾ä»¥ç»´æŠ¤ã€‚ é’ˆå¯¹äºŽè¿™ä¸€äº›é—®é¢˜ SpringCloud å…¨å®¶æ¡¶è‡ªç„¶ä¹Ÿæœ‰å¯¹åº”çš„è§£å†³æ–¹æ¡ˆ: Zuulã€‚å½“æˆ‘ä»¬ç³»ç»Ÿæ•´åˆ Zuul ç½‘å…³ä¹‹åŽæž¶æž„å›¾åº”è¯¥å¦‚ä¸‹æ‰€ç¤º: æˆ‘ä»¬åœ¨æ‰€æœ‰çš„è¯·æ±‚è¿›æ¥ä¹‹å‰æŠ½å‡ºä¸€å±‚ç½‘å…³åº”ç”¨ï¼Œå°†æœåŠ¡æä¾›çš„æ‰€æœ‰ç»†èŠ‚éƒ½è¿›è¡Œäº†åŒ…è£…ï¼Œè¿™æ ·æ‰€æœ‰çš„å®¢æˆ·ç«¯éƒ½æ˜¯å’Œç½‘å…³è¿›è¡Œäº¤äº’ï¼Œç®€åŒ–äº†å®¢æˆ·ç«¯å¼€å‘ã€‚ åŒæ—¶å…·æœ‰å¦‚ä¸‹åŠŸèƒ½: Zuul æ³¨å†ŒäºŽ Eureka å¹¶é›†æˆäº† Ribbon æ‰€ä»¥è‡ªç„¶ä¹Ÿæ˜¯å¯ä»¥ä»Žæ³¨å†Œä¸­å¿ƒèŽ·å–åˆ°æœåŠ¡åˆ—è¡¨è¿›è¡Œå®¢æˆ·ç«¯è´Ÿè½½ã€‚ åŠŸèƒ½ä¸°å¯Œçš„è·¯ç”±åŠŸèƒ½ï¼Œè§£æ”¾è¿ç»´ã€‚ å…·æœ‰è¿‡æ»¤å™¨ï¼Œæ‰€ä»¥é‰´æƒã€éªŒç­¾éƒ½å¯ä»¥é›†æˆã€‚ åŸºäºŽæ­¤æˆ‘ä»¬æ¥çœ‹çœ‹ä¹‹å‰çš„æž¶æž„ä¸­å¦‚ä½•é›†æˆ Zuul ã€‚ é›†æˆ Zuulä¸ºæ­¤æˆ‘æ–°å»ºäº†ä¸€ä¸ªé¡¹ç›® sbc-gateway-zuul å°±æ˜¯ä¸€ä¸ªåŸºç¡€çš„ SpringBoot ç»“æž„ã€‚å…¶ä¸­åŠ å…¥äº† Zuul çš„ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zuul&lt;/artifactId&gt;&lt;/dependency&gt; ç”±äºŽéœ€è¦å°†ç½‘å…³ä¹Ÿæ³¨å†Œåˆ° Eureka ä¸­ï¼Œæ‰€ä»¥è‡ªç„¶ä¹Ÿéœ€è¦: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;&lt;/dependency&gt; ç´§æŽ¥ç€é…ç½®ä¸€äº›é¡¹ç›®åŸºæœ¬ä¿¡æ¯: 12345678# é¡¹ç›®é…ç½®spring.application.name=sbc-gateway-zuulserver.context-path=/server.port=8383# eurekaåœ°å€eureka.client.serviceUrl.defaultZone=http://node1:8888/eureka/eureka.instance.prefer-ip-address=true åœ¨å¯åŠ¨ç±»ä¸­åŠ å…¥å¼€å¯ Zuul çš„æ³¨è§£ï¼Œä¸€ä¸ªç½‘å…³åº”ç”¨å°±ç®—æ˜¯æ­å¥½äº†ã€‚ 123456@SpringBootApplication//å¼€å¯zuulä»£ç†@EnableZuulProxypublic class SbcGateWayZuulApplication &#123;&#125; å¯åŠ¨ Eureka å’Œç½‘å…³çœ‹åˆ°å·²ç»æ³¨å†ŒæˆåŠŸé‚£å°±å¤§åŠŸå‘Šæˆäº†: è·¯ç”±è·¯ç”±æ˜¯ç½‘å…³çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œå¯ä»¥ä½¿ç³»ç»Ÿæœ‰ä¸€ä¸ªç»Ÿä¸€çš„å¯¹å¤–æŽ¥å£ï¼Œä¸‹é¢æ¥çœ‹çœ‹å…·ä½“çš„åº”ç”¨ã€‚ ä¼ ç»Ÿè·¯ç”±ä¼ ç»Ÿè·¯ç”±éžå¸¸ç®€å•ï¼Œå’Œ Nginx ç±»ä¼¼ï¼Œç”±å¼€å‘ã€è¿ç»´äººå‘˜æ¥ç»´æŠ¤è¯·æ±‚åœ°å€å’Œå¯¹åº”æœåŠ¡çš„æ˜ å°„å…³ç³»ï¼Œç±»ä¼¼äºŽ: 12zuul.routes.user-service.path=/user-service/**zuul.routes.user-sercice.url=http://localhost:8080/ è¿™æ ·å½“æˆ‘ä»¬è®¿é—® http://localhost:8383/user-service/getUserInfo/1 ç½‘å…³å°±ä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬è·¯ç”±åˆ° http://localhost:8080/getUserInfo/1 ä¸Šã€‚ å¯è§åªè¦æˆ‘ä»¬ç»´æŠ¤å¥½è¿™ä¸ªæ˜ å°„å…³ç³»å³å¯è‡ªç”±çš„é…ç½®è·¯ç”±ä¿¡æ¯(user-sercice å¯è‡ªå®šä¹‰)ï¼Œä½†æ˜¯å¾ˆæ˜Žæ˜¾è¿™ç§æ–¹å¼ä¸ç®¡æ˜¯å¯¹è¿ç»´è¿˜æ˜¯å¼€å‘éƒ½ä¸å‹å¥½ã€‚ç”±äºŽå®žé™…è¿™ç§æ–¹å¼ç”¨çš„ä¸å¤šå°±å†è¿‡å¤šå±•å¼€ã€‚ æœåŠ¡è·¯ç”±å¯¹æ­¤ Zuul æä¾›äº†ä¸€ç§åŸºäºŽæœåŠ¡çš„è·¯ç”±æ–¹å¼ã€‚æˆ‘ä»¬åªéœ€è¦ç»´æŠ¤è¯·æ±‚åœ°å€ä¸ŽæœåŠ¡ ID ä¹‹é—´çš„æ˜ å°„å…³ç³»å³å¯ï¼Œå¹¶ä¸”ç”±äºŽé›†æˆäº† Ribbon , Zuul è¿˜å¯ä»¥åœ¨è·¯ç”±çš„æ—¶å€™é€šè¿‡ Eureka å®žçŽ°è´Ÿè½½è°ƒç”¨ã€‚ å…·ä½“é…ç½®ï¼š 12zuul.routes.sbc-user.path=/api/user/**zuul.routes.sbc-user.serviceId=sbc-user è¿™æ ·å½“è¾“å…¥ http://localhost:8383/api/user/getUserInfo/1 æ—¶å°±ä¼šè·¯ç”±åˆ°æ³¨å†Œåˆ° Eureka ä¸­æœåŠ¡ ID ä¸º sbc-user çš„æœåŠ¡èŠ‚ç‚¹ï¼Œå¦‚æžœæœ‰å¤šèŠ‚ç‚¹å°±ä¼šæŒ‰ç…§ Ribbon çš„è´Ÿè½½ç®—æ³•è·¯ç”±åˆ°å…¶ä¸­ä¸€å°ä¸Šã€‚ ä»¥ä¸Šé…ç½®è¿˜å¯ä»¥ç®€å†™ä¸º: 12# æœåŠ¡è·¯ç”± ç®€åŒ–é…ç½®zuul.routes.sbc-user=/api/user/** è¿™æ ·è®©æˆ‘ä»¬è®¿é—® http://127.0.0.1:8383/api/user/userService/getUserByHystrix æ—¶å€™å°±ä¼šæ ¹æ®è´Ÿè½½ç®—æ³•å¸®æˆ‘ä»¬è·¯ç”±åˆ° sbc-user åº”ç”¨ä¸Šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º: å¯åŠ¨äº†ä¸¤ä¸ª sbc-user æœåŠ¡ã€‚ è¯·æ±‚ç»“æžœ: ä¸€æ¬¡è·¯ç”±å°±ç®—å®Œæˆäº†ã€‚ åœ¨ä¸Šé¢çš„é…ç½®ä¸­æœ‰çœ‹åˆ° /api/user/** è¿™æ ·çš„é€šé…ç¬¦é…ç½®ï¼Œå…·ä½“æœ‰ä»¥ä¸‹ä¸‰ç§é…ç½®éœ€è¦äº†è§£: ? åªèƒ½åŒ¹é…ä»»æ„çš„å•ä¸ªå­—ç¬¦ï¼Œå¦‚ /api/user/? å°±åªèƒ½åŒ¹é… /api/user/x /api/user/y /api/user/z è¿™æ ·çš„è·¯å¾„ã€‚ * åªèƒ½åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œå¦‚ /api/user/* å°±åªèƒ½åŒ¹é… /api/user/x /api/user/xy /api/user/xyzã€‚ ** å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦ã€ä»»æ„å±‚çº§ã€‚ç»“åˆäº†ä»¥ä¸Šä¸¤ç§é€šé…ç¬¦çš„ç‰¹ç‚¹ï¼Œå¦‚ /api/user/** åˆ™å¯ä»¥åŒ¹é… /api/user/x /api/user/x/y /api/user/x/y/zzzè¿™æ ·çš„è·¯å¾„ï¼Œæœ€ç®€å•ç²—æš´ï¼ è°ˆåˆ°é€šé…ç¬¦åŒ¹é…å°±ä¸å¾—ä¸æåˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸Šé¢çš„ sbc-user æœåŠ¡ç”±äºŽåŽæœŸè¿­ä»£æ›´æ–°ï¼Œå°† sbc-user ä¸­çš„ä¸€éƒ¨åˆ†é€»è¾‘æŠ½æˆäº†å¦ä¸€ä¸ªæœåŠ¡ sbc-user-proã€‚æ–°åº”ç”¨çš„è·¯ç”±è§„åˆ™æ˜¯ /api/user/pro/**,å¦‚æžœæˆ‘ä»¬æŒ‰ç…§: 12zuul.routes.sbc-user=/api/user/**zuul.routes.sbc-user-pro=/api/user/pro/** è¿›è¡Œé…ç½®çš„è¯ï¼Œæˆ‘ä»¬æƒ³é€šè¿‡ /api/user/pro/ æ¥è®¿é—® sbc-user-pro åº”ç”¨ï¼Œå´ç”±äºŽæ»¡è¶³ç¬¬ä¸€ä¸ªè·¯ç”±è§„åˆ™ï¼Œæ‰€ä»¥ä¼šè¢« Zuul è·¯ç”±åˆ° sbc-user è¿™ä¸ªåº”ç”¨ä¸Šï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ã€‚è¯¥æ€Žä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ ç¿»çœ‹è·¯ç”±æºç  org.springframework.cloud.netflix.zuul.filters.SimpleRouteLocator ä¸­çš„ locateRoutes() æ–¹æ³•: 1234567891011/** * Compute a map of path pattern to route. The default is just a static map from the * &#123;@link ZuulProperties&#125;, but subclasses can add dynamic calculations. */protected Map&lt;String, ZuulRoute&gt; locateRoutes() &#123; LinkedHashMap&lt;String, ZuulRoute&gt; routesMap = new LinkedHashMap&lt;String, ZuulRoute&gt;(); for (ZuulRoute route : this.properties.getRoutes().values()) &#123; routesMap.put(route.getPath(), route); &#125; return routesMap;&#125; å‘çŽ°è·¯ç”±è§„åˆ™æ˜¯éåŽ†é…ç½®æ–‡ä»¶å¹¶æ”¾å…¥ LinkedHashMap ä¸­ï¼Œç”±äºŽ LinkedHashMap æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ä¸ºäº†è¾¾åˆ°ä¸Šæ–‡çš„æ•ˆæžœï¼Œé…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåºéžå¸¸é‡è¦ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å°†ä¼˜å…ˆåŒ¹é…çš„è·¯ç”±è§„åˆ™æ”¾å‰å³å¯è§£å†³ã€‚ è¿‡æ»¤å™¨è¿‡æ»¤å™¨å¯ä»¥è¯´æ˜¯æ•´ä¸ª Zuul æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸Šæ–‡æåˆ°è·¯ç”±åŠŸèƒ½ä¹Ÿæ˜¯ç”±è¿‡æ»¤å™¨æ¥å®žçŽ°çš„ã€‚ æ‘˜æŠ„å®˜æ–¹çš„è§£é‡Š: Zuul çš„æ ¸å¿ƒå°±æ˜¯ä¸€ç³»åˆ—çš„è¿‡æ»¤å™¨ï¼Œä»–èƒ½å¤Ÿåœ¨æ•´ä¸ª HTTP è¯·æ±‚ã€å“åº”è¿‡ç¨‹ä¸­æ‰§è¡Œå„æ ·çš„æ“ä½œã€‚ å…¶å®žæ€»ç»“ä¸‹æ¥å°±æ˜¯å››ä¸ªç‰¹å¾: è¿‡æ»¤ç±»åž‹ è¿‡æ»¤é¡ºåº æ‰§è¡Œæ¡ä»¶ å…·ä½“å®žçŽ° å…¶å®žå°±æ˜¯ ZuulFilter æŽ¥å£ä¸­æ‰€å®šä¹‰çš„å››ä¸ªæŽ¥å£: 1234567String filterType();int filterOrder();boolean shouldFilter();Object run(); å®˜æ–¹æµç¨‹å›¾(ç”Ÿå‘½å‘¨æœŸ): ç®€å•ç†è§£ä¸‹å°±æ˜¯: å½“ä¸€ä¸ªè¯·æ±‚è¿›æ¥æ—¶ï¼Œé¦–å…ˆæ˜¯è¿›å…¥ pre è¿‡æ»¤å™¨ï¼Œå¯ä»¥åšä¸€äº›é‰´æƒï¼Œè®°å½•è°ƒè¯•æ—¥å¿—ç­‰æ“ä½œã€‚ä¹‹åŽè¿›å…¥ routing è¿‡æ»¤å™¨è¿›è¡Œè·¯ç”±è½¬å‘ï¼Œè½¬å‘å¯ä»¥ä½¿ç”¨ Apache HttpClient æˆ–è€…æ˜¯ Ribbon ã€‚post è¿‡æ»¤å™¨å‘¢åˆ™æ˜¯å¤„ç†æœåŠ¡å“åº”ä¹‹åŽçš„æ•°æ®ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›åŒ…è£…æ¥è¿”å›žå®¢æˆ·ç«¯ã€‚ error åˆ™æ˜¯åœ¨æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶æ‰ä¼šè°ƒç”¨ï¼Œç›¸å½“äºŽæ˜¯å…¨å±€å¼‚å¸¸æ‹¦æˆªå™¨ã€‚ è‡ªå®šä¹‰è¿‡æ»¤å™¨æŽ¥ä¸‹æ¥å®žçŽ°ä¸€ä¸ªæ–‡åˆæ‰€æåˆ°çš„é‰´æƒæ“ä½œ: æ–°å»ºä¸€ä¸ª RequestFilter ç±»ç»§æ‰¿ä¸Ž ZuulFilter æŽ¥å£ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546/** * Function: è¯·æ±‚æ‹¦æˆª * * @author crossoverJie * Date: 2017/11/20 00:33 * @since JDK 1.8 */public class RequestFilter extends ZuulFilter &#123; private Logger logger = LoggerFactory.getLogger(RequestFilter.class) ; /** * è¯·æ±‚è·¯ç”±ä¹‹å‰è¢«æ‹¦æˆª å®žçŽ° pre æ‹¦æˆªå™¨ * @return */ @Override public String filterType() &#123; return "pre"; &#125; @Override public int filterOrder() &#123; return 0; &#125; @Override public boolean shouldFilter() &#123; return true; &#125; @Override public Object run() &#123; RequestContext currentContext = RequestContext.getCurrentContext(); HttpServletRequest request = currentContext.getRequest(); String token = request.getParameter("token"); if (StringUtil.isEmpty(token))&#123; logger.warn("need token"); //è¿‡æ»¤è¯·æ±‚ currentContext.setSendZuulResponse(false); currentContext.setResponseStatusCode(400); return null ; &#125; logger.info("token =&#123;&#125;",token) ; return null; &#125;&#125; éžå¸¸ easyï¼Œå°±ç®€å•æ ¡éªŒä¸‹è¯·æ±‚ä¸­æ˜¯å¦åŒ…å« tokenï¼Œä¸åŒ…å«å°±è¿”å›ž 401 codeã€‚ ä¸ä½†å¦‚æ­¤ï¼Œè¿˜éœ€è¦å°†è¯¥ç±»åŠ å…¥åˆ° Spring è¿›è¡Œç®¡ç†: æ–°å»ºäº† FilterConf ç±»: 123456789@Configuration@Componentpublic class FilterConf &#123; @Bean public RequestFilter filter()&#123; return new RequestFilter() ; &#125;&#125; è¿™æ ·é‡å¯ä¹‹åŽå°±å¯ä»¥çœ‹åˆ°æ•ˆæžœäº†: ä¸ä¼  token æ—¶ï¼š ä¼ å…¥ token æ—¶ï¼š å¯è§ä¸€äº›é‰´æƒæ“ä½œæ˜¯å¯ä»¥æ”¾åˆ°è¿™é‡Œæ¥è¿›è¡Œç»Ÿä¸€å¤„ç†çš„ã€‚ å…¶ä½™å‡ ä¸ªè¿‡æ»¤å™¨ä¹Ÿæ˜¯å¤§åŒå°å¼‚ï¼Œå¯ä»¥æ ¹æ®å®žé™…åœºæ™¯æ¥è‡ªå®šä¹‰ã€‚ Zuul é«˜å¯ç”¨Zuul çŽ°åœ¨æ—¢ç„¶ä½œä¸ºäº†å¯¹å¤–çš„ç¬¬ä¸€å…¥å£ï¼Œé‚£è‚¯å®šä¸èƒ½æ˜¯å•èŠ‚ç‚¹ï¼Œå¯¹äºŽ Zuul çš„é«˜å¯ç”¨æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®žçŽ°ã€‚ Eureka é«˜å¯ç”¨ç¬¬ä¸€ç§æœ€å®¹æ˜“æƒ³åˆ°å’Œå®žçŽ°:æˆ‘ä»¬å¯ä»¥éƒ¨ç½²å¤šä¸ª Zuul èŠ‚ç‚¹ï¼Œå¹¶ä¸”éƒ½æ³¨å†ŒäºŽ Eureka ï¼Œå¦‚ä¸‹å›¾ï¼š è¿™æ ·è™½ç„¶ç®€å•æ˜“ç»´æŠ¤ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªä¸¥é‡çš„ç¼ºç‚¹ï¼šé‚£å°±æ˜¯å®¢æˆ·ç«¯ä¹Ÿå¾—æ³¨å†Œåˆ° Eureka ä¸Šæ‰èƒ½å¯¹ Zuul çš„è°ƒç”¨åšåˆ°è´Ÿè½½ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸çŽ°å®žçš„ã€‚ æ‰€ä»¥ä¸‹é¢è¿™ç§åšæ³•æ›´ä¸ºå¸¸è§ã€‚ åŸºäºŽ Nginx é«˜å¯ç”¨åœ¨è°ƒç”¨ Zuul ä¹‹å‰ä½¿ç”¨ Nginx ä¹‹ç±»çš„è´Ÿè½½å‡è¡¡å·¥å…·è¿›è¡Œè´Ÿè½½ï¼Œè¿™æ · Zuul æ—¢èƒ½æ³¨å†Œåˆ° Eureka ï¼Œå®¢æˆ·ç«¯ä¹Ÿèƒ½å®žçŽ°å¯¹ Zuul çš„è´Ÿè½½ï¼Œå¦‚ä¸‹å›¾ï¼š æ€»ç»“è¿™æ ·åœ¨åŽŸæœ‰çš„å¾®æœåŠ¡æž¶æž„çš„åŸºç¡€ä¸ŠåŠ ä¸Šç½‘å…³ä¹‹åŽå¦æ•´ä¸ªç³»ç»Ÿæ›´åŠ å®Œå–„äº†ï¼Œä»Žç½‘å…³çš„è®¾è®¡æ¥çœ‹ï¼šå¤§å¤šæ•°ç³»ç»Ÿæž¶æž„éƒ½æœ‰åˆ†å±‚çš„æ¦‚å¿µï¼Œä¸èƒ½è§£å†³é—®é¢˜é‚£å°±å¤šåˆ†å‡ å±‚ðŸ¤“ã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
        <tag>Zuul</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€è¯‘ã€‘ä½ å¯ä»¥ç”¨GitHubåšçš„12ä»¶ Cool äº‹æƒ…]]></title>
    <url>%2F2017%2F11%2F05%2Ftranslation1-12%20cool%20things%20you%20can%20do%20with%20GitHub%2F</url>
    <content type="text"><![CDATA[åŽŸæ–‡é“¾æŽ¥1 åœ¨ GitHub.com ç¼–è¾‘ä»£ç æˆ‘å°†ä»Žæˆ‘è®¤ä¸ºå¤§å®¶éƒ½çŸ¥é“çš„ä¸€ä»¶äº‹æƒ…å¼€å§‹(å°½ç®¡æˆ‘æ˜¯ç›´åˆ°ä¸€å‘¨å‰æ‰çŸ¥é“)ã€‚ å½“ä½ åœ¨ GitHub æŸ¥çœ‹æ–‡ä»¶æ—¶(ä»»ä½•æ–‡æœ¬æ–‡ä»¶ï¼Œä»»ä½•ä»“åº“ä¸­)ï¼Œå³ä¸Šè§’ä¼šæœ‰ä¸€ä¸ªå°é“…ç¬”å›¾æ ‡ï¼Œç‚¹å‡»å®ƒå°±å¯ä»¥ç¼–è¾‘æ–‡ä»¶äº†ã€‚å®Œæˆä¹‹åŽç‚¹å‡» Propose file change æŒ‰é’® GitHub å°†ä¼šè‡ªåŠ¨å¸®ä½  fork è¯¥é¡¹ç›®å¹¶ä¸”åˆ›å»ºä¸€ä¸ª pull request ã€‚ å¾ˆåŽ‰å®³å§ï¼ä»–è‡ªåŠ¨å¸®ä½  fork äº†è¯¥ repoã€‚ ä¸å†éœ€è¦ fork , pull ,æœ¬åœ°ç¼–è¾‘å† push ä»¥åŠåˆ›å»ºä¸€ä¸ª PR è¿™æ ·çš„æµç¨‹äº†ã€‚ è¿™éžå¸¸é€‚åˆä¿®å¤ç¼–å†™ä»£ç ä¸­å‡ºçŽ°çš„æ‹¼å†™é”™è¯¯å’Œä¿®æ­£ä¸€ä¸ªä¸å¤ªç†æƒ³çš„æƒ³æ³•ã€‚ 2 ç²˜è´´å›¾ç‰‡ä½ ä¸ä»…ä»…å—é™äºŽè¾“å…¥æ–‡æœ¬å’Œæè¿°é—®é¢˜ï¼Œä½ çŸ¥é“ä½ å¯ä»¥ç›´æŽ¥ä»Žç²˜è´´æ¿ä¸­ç²˜è´´å›¾ç‰‡å—ï¼Ÿå½“ä½ ç²˜è´´æ—¶ï¼Œä½ ä¼šçœ‹åˆ°å›¾ç‰‡å·²ç»è¢«ä¸Šä¼ äº†(æ¯«æ— ç–‘é—®è¢«ä¸Šä¼ åˆ°äº‘ç«¯)ä¹‹åŽä¼šå˜æˆ Markdown è¯­æ³•æ¥æ˜¾ç¤ºå›¾ç‰‡ã€‚ 3 æ ¼å¼åŒ–ä»£ç å¦‚æžœä½ æƒ³å†™ä¸€æ®µä»£ç ï¼Œä½ å¯ä»¥ä¸‰ä¸ªåå¼•å·å¼€å§‹ â€”â€” å°±åƒä½ åœ¨ç ”ç©¶MarkDownæ—¶æ‰€å­¦åˆ°çš„ â€”â€” ä¹‹åŽ GitHub ä¼šè¯•ç€çŒœæµ‹ä½ å†™çš„è¯­è¨€ã€‚ ä½†å¦‚æžœä½ å†™äº†ä¸€äº›ç±»ä¼¼äºŽ Vue, Typescript, JSX è¿™æ ·çš„è¯­è¨€ï¼Œä½ å¯ä»¥æ˜Žç¡®æŒ‡å®šå¾—åˆ°æ­£ç¡®çš„é«˜äº®ã€‚ æ³¨æ„ç¬¬ä¸€è¡Œä¸­çš„1```jsx è¿™æ„å‘³ç€ä»£ç æ®µå°†ä¼šå‘ˆçŽ°å‡º: (è¿™ä¸ªæ‰©å±•äºŽ gists ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æžœä½ ä½¿ç”¨ .jsx åŽç¼€ï¼Œå°±ä¼šå¾—åˆ°JSXçš„è¯­æ³•é«˜äº®) è¿™æ˜¯ä¸€ä¸ªæ‰€æœ‰å—æ”¯æŒçš„è¯­æ³•åˆ—è¡¨ã€‚ 4 åœ¨ PR ä¸­ç”¨å…³é”®è¯å…³é—­ Issueså‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªç”¨äºŽä¿®å¤ Issues #234 çš„ PR ,ä½ å¯ä»¥åœ¨ä½  PR çš„æè¿°ä¸­å¡«å†™ fixes #234 (æˆ–æ˜¯åœ¨ä½  PR ä»»æ„è¯„è®ºä¸­å¡«å†™éƒ½æ˜¯å¯ä»¥çš„)ã€‚ä¹‹åŽåˆå¹¶è¿™ä¸ª PR æ—¶å°†ä¼šè‡ªåŠ¨å…³é—­å¡«å†™çš„ Issuesã€‚æ€Žä¹ˆæ ·,å¾ˆ cool å§ã€‚ äº†è§£æ˜¯æ›´å¤šç›¸å…³çš„å†…å®¹ã€‚ 5 é“¾æŽ¥åˆ°è¯„è®ºä½ æ˜¯å¦æœ‰è¿‡æƒ³è¦é“¾æŽ¥åˆ°ç‰¹æ®Š comment çš„æƒ³æ³•ä½†å´æ— æ³•å®žçŽ°ï¼Ÿé‚£æ˜¯å› ä¸ºä½ ä¸çŸ¥é“æ€Žä¹ˆåšã€‚æœ‹å‹é‚£éƒ½æ˜¯è¿‡åŽ»å¼äº†ï¼ŒçŽ°åœ¨æˆ‘å°±å‘Šè¯‰ä½ ï¼Œç‚¹å‡»ç”¨æˆ·åæ—è¾¹çš„æ—¥æœŸ/æ—¶é—´å³å¯é“¾æŽ¥åˆ°è¯¥ comment ã€‚ 6 é“¾æŽ¥åˆ°ä»£ç æˆ‘çŸ¥é“ä½ æƒ³é“¾æŽ¥åˆ°å…·ä½“çš„ä»£ç è¡Œä¸Šã€‚ å°è¯•:æŸ¥çœ‹æ–‡ä»¶æ—¶ï¼Œç‚¹å‡»ä»£ç æ—è¾¹çš„è¡Œå·ã€‚ çœ‹åˆ°äº†å§ï¼Œæµè§ˆå™¨çš„ URL å·²ç»è¢«æ›´æ–°ä¸ºè¡Œå·äº†ã€‚å¦‚æžœä½ æŒ‰ä½ shift,åŒæ—¶ç‚¹å‡»å…¶ä»–è¡Œå·ï¼ŒURL å†æ¬¡è¢«æ›´æ–°ï¼Œå¹¶ä¸”ä½ ä¹Ÿé«˜äº®æ˜¾ç¤ºé¡µé¢ä¸­çš„ä¸€æ®µä»£ç ã€‚ åˆ†äº«è¿™ä¸ª URL ï¼Œè®¿é—®æ—¶å°†ä¼šé“¾æŽ¥åˆ°è¯¥æ–‡ä»¶å·²ç»é€‰ä¸­çš„é‚£äº›ä»£ç æ®µã€‚ ä½†ç­‰ä¸€ä¸‹ï¼Œé‚£æŒ‡å‘çš„æ˜¯å½“å‰çš„åˆ†æ”¯ï¼Œå¦‚æžœæ–‡ä»¶å‘ç”Ÿäº†æ”¹å˜å‘¢ï¼Ÿä¹Ÿè®¸ä¸€ä¸ªåœ¨å½“å‰çŠ¶æ€è¿žæŽ¥åˆ°æ–‡ä»¶çš„æ°¸ä¹…è¿žæŽ¥æ­£æ˜¯ä½ æƒ³è¦çš„ã€‚ æˆ‘å¾ˆæ‡’ï¼Œæ‰€ä»¥ç”¨ä¸€å¼ æˆªå›¾å±•ç¤ºä»¥ä¸Šçš„æ‰€æœ‰æ“ä½œã€‚ è°ˆåˆ°ç½‘å€ã€‚ã€‚ã€‚ 7 åƒå‘½ä»¤è¡Œä¸€æ ·ä½¿ç”¨ GitHub é“¾æŽ¥ä½¿ç”¨ GitHub è‡ªå¸¦çš„ UI æµè§ˆä¹Ÿè¿˜ä¸é”™ï¼Œä½†æœ‰æ—¶ç›´æŽ¥åœ¨ URL ä¸­è¾“å…¥æ˜¯æœ€å¿«çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œæˆ‘æƒ³è·³è½¬åˆ°æˆ‘æ­£åœ¨ç¼–è¾‘çš„åˆ†æ”¯å¹¶å’Œ master è¿›è¡Œå¯¹æ¯”ï¼Œå°±å¯ä»¥åœ¨é¡¹ç›®åç§°åŽé¢æŽ¥ä¸Š /compare/branch-name ã€‚ ä¸Žé€‰ä¸­åˆ†æ”¯çš„å¯¹æ¯”é¡µå°†ä¼šæ˜¾ç¤ºå‡ºæ¥: ä»¥ä¸Šå°±æ˜¯å’Œ master åˆ†æ”¯çš„å·®å¼‚ï¼Œå¦‚æžœæƒ³è¦åˆå¹¶åˆ†æ”¯çš„è¯ï¼Œåªéœ€è¦è¾“å…¥ /compare/integration-branch...my-branch å³å¯ã€‚ ä½ è¿˜å¯ä»¥åˆ©ç”¨å¿«æ·é”®è¾¾åˆ°åŒæ ·çš„æ•ˆæžœï¼Œä½¿ç”¨ ctrl + L æˆ–è€… cmd + L å¯ä»¥å°†å…‰æ ‡ç§»åŠ¨åˆ° URL ä¸Š(è‡³å°‘åœ¨ Chrome ä¸­å¯ä»¥)ã€‚ åŠ ä¸Šæµè§ˆå™¨çš„è‡ªåŠ¨è¡¥å…¨ â€”â€” ä½ å°±å¯ä»¥åœ¨ä¸¤ä¸ªåˆ†æ”¯ä¹‹é—´è½»æ¾åˆ‡æ¢äº†ã€‚ 8 åœ¨Issuesåˆ›å»ºåˆ—è¡¨ä½ æƒ³åœ¨ä½ çš„ issue ä¸­çœ‹åˆ°å¤é€‰æ¡†åˆ—è¡¨å—? ä½ æƒ³åœ¨æŸ¥çœ‹ issue åˆ—è¡¨æ˜¯å®ƒä»¬ä»¥å¥½çœ‹çš„ 2 of 5 è¿›åº¦æ¡å‘ˆçŽ°å—ï¼Ÿ å¤ªå¥½äº†ï¼ä½ å¯ä»¥ç”¨ä»¥ä¸‹è¯­æ³•æ¥åˆ›å»ºä¸€ä¸ªäº¤äº’æ€§çš„å¤é€‰æ¡†: 12345- [ ] Screen width (integer)- [x] Service worker support- [x] Fetch support- [ ] CSS flexbox support- [ ] Custom elements æ˜¯ç”±ä¸€ä¸ªç©ºæ ¼ã€ä¸­æ¨ªçº¿ã€ç©ºæ ¼ã€å·¦æ‹¬å·ã€ç©ºæ ¼(æˆ–è€…æ˜¯ X )ã€å³æ‹¬å·ã€ç©ºæ ¼ä»¥åŠä¸€äº›æ–‡æœ¬ç»„æˆã€‚ ä½ ç”šè‡³å¯ä»¥çœŸæ­£çš„ é€‰ä¸­/å–æ¶ˆ è¿™äº›å¤é€‰æ¡†ï¼åŸºäºŽæŸäº›åŽŸå› ï¼Œå¯¹äºŽæˆ‘æ¥è¯´ä½ çœ‹èµ·æ¥åƒæ˜¯æŠ€æœ¯é­”åŠ›ã€‚æ˜¯çœŸçš„èƒ½å¤Ÿé€‰ä¸­è¿™äº›å¤é€‰æ¡†ï¼ç”šè‡³å®ƒè¿˜æ›´æ–°äº†åº•å±‚æºç ã€‚ psï¼šä»¥ä¸‹åŒ…æ‹¬ç¬¬ä¹ç‚¹ åŸºäºŽGitHubçš„é¡¹ç›®é¢æ¿ ç”±äºŽç”¨çš„ä¸å¤šå°±æ²¡æœ‰ç¿»è¯‘ã€‚ 10 GitHub wikiä½œä¸ºä¸€ä¸ªåƒç»´åŸºç™¾ç§‘é‚£æ ·çš„éžç»“æž„åŒ–çš„é¡µé¢é›†åˆï¼Œ GitHub Wikiçš„ä¾›ç»™(æˆ‘æŠŠå®ƒç§°ä¹‹ä¸º Gwiki ) æ˜¯ä¸€ä¸ªéžå¸¸æ£’çš„åŠŸèƒ½ã€‚ å¯¹äºŽç»“æž„åŒ–çš„é¡µé¢æ¥è¯´ â€”â€” ä¾‹å¦‚ä½ çš„æ–‡æ¡£ï¼šä¸èƒ½è¯´è¿™ä¸ªé¡µé¢æ˜¯å…¶ä»–é¡µé¢çš„å­é¡µé¢ï¼Œæˆ–åˆ™æ˜¯æœ‰ â€œä¸‹ä¸€èŠ‚â€ï¼Œâ€œä¸Šä¸€èŠ‚â€ è¿™æ ·çš„ä¾¿æ·æŒ‰é’®ã€‚å¹¶ä¸” Hansel å’Œ Gretel ä¹Ÿæ²¡æœ‰ï¼Œå› ä¸ºç»“æž„åŒ–é¡µé¢å¹¶æ²¡æœ‰ breadcrumbs è¿™æ ·çš„è®¾è®¡ã€‚ æˆ‘ä»¬ç»§ç»­ï¼Œè®© Gwiki åŠ¨èµ·æ¥ï¼Œæˆ‘ä»Ž NodeJS çš„æ–‡æ¡£ä¸­å¤åˆ¶äº†å‡ é¡µæ¥ä½œä¸º wiki é¡µé¢ã€‚ç„¶åŽåˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰ä¾§è¾¹æ ï¼Œå¸®åŠ©æˆ‘æ›´å¥½åœ°æ¨¡æ‹Ÿä¸€äº›å®žé™…çš„ç›®å½•ç»“æž„ã€‚å°½ç®¡å®ƒä¸ä¼šçªå‡ºæ˜¾ç¤ºä½ å½“å‰çš„é¡µé¢ä½ç½®ï¼Œä½†ä¾§è¾¹æ ä¼šä¸€ç›´å­˜åœ¨ã€‚ è¿™äº›é“¾æŽ¥éœ€è¦ä½ æ‰‹åŠ¨ç»´æŠ¤ï¼Œä½†æ€»çš„æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºå®ƒå¯ä»¥åšå¾—å¾ˆå¥½ã€‚ å¦‚æžœéœ€è¦çš„è¯å¯ä»¥çœ‹çœ‹ã€‚ è™½ç„¶å®ƒä¸Ž GitBook ( Redux æ–‡æ¡£æ‰€ä½¿ç”¨çš„)æˆ–è€…æ˜¯å®šåˆ¶ç½‘ç«™ç›¸æ¯”ä»æœ‰å·®è·ã€‚ä½†åœ¨ä½ çš„ repo ä¸­å®ƒæœ‰ 80% å®Œå…¨å€¼å¾—ä¿¡èµ–çš„ã€‚ æˆ‘çš„å»ºè®®æ˜¯: å¦‚æžœä½ å·²ç»æœ‰å¤šä¸ª README.md æ–‡ä»¶ï¼Œå¹¶ä¸”æƒ³è¦ä¸€äº›å…³äºŽç”¨æˆ·æŒ‡å—æˆ–æ›´è¯¦ç»†çš„æ–‡æ¡£çš„ä¸åŒçš„é¡µé¢ï¼Œé‚£ä¹ˆä½ åº”è¯¥é€‰æ‹© Gwikiã€‚ å¦‚æžœç¼ºä¹ç»“æž„åŒ–/å¯¼èˆªå¼€å§‹è®©ä½ ä¸çˆ½çš„è¯ï¼Œé‚£å°±è¯•è¯•å…¶ä»–çš„å§ã€‚ 11 GitHub Pagesä½ å¯èƒ½å·²ç»çŸ¥é“ä½¿ç”¨ GitHub Pages æ¥æ‰˜ç®¡ä¸€ä¸ªé™æ€ç½‘ç«™ã€‚å¦‚æžœä½ ä¸çŸ¥é“ï¼ŒçŽ°åœ¨å°±æ¥å­¦ä¹ ï¼Œè¿™ä¸€èŠ‚æ˜¯ä¸“é—¨ç”¨äºŽè®¨è®ºä½¿ç”¨ Jekyll æ¥æž„å»ºä¸€ä¸ªç«™ç‚¹çš„ã€‚ æœ€ç®€å•çš„å°±æ˜¯ï¼š GitHub Pages + Jekyllä¼šé€šè¿‡ä¸€ä¸ªæ¼‚äº®çš„ä¸»é¢˜æ¥æ¸²æŸ“ä½ çš„ README.md æ–‡ä»¶ã€‚ä¾‹å¦‚:é€šè¿‡ about-github æ¥æŸ¥çœ‹çš„æˆ‘çš„ README é¡µé¢ã€‚ å¦‚æžœæˆ‘åœ¨ GitHub ä¸­ç‚¹å‡»äº† settingsé€‰é¡¹ï¼Œåˆ‡æ¢åˆ° Github Pages è®¾ç½®ï¼Œç„¶åŽé€‰æ‹©ä¸€ä¸ª Jekyll themeã€‚ã€‚ã€‚ æˆ‘å°±å¯ä»¥å¾—åˆ° Jekyll-themed é¡µé¢ã€‚ ä»Žè¿™ç‚¹ä¸Šæˆ‘å¯ä»¥ä¸»è¦ä¾æ®æ˜“ç¼–è¾‘çš„ Markdown æ–‡ä»¶æ¥æž„å»ºä¸€ä¸ªå®Œæ•´çš„é™æ€ç«™ç‚¹ã€‚æœ¬è´¨ä¸Šæ˜¯æŠŠ GitHub å˜æˆäº† CMSã€‚ è™½ç„¶æˆ‘æ²¡æœ‰å®žé™…ä½¿ç”¨è¿‡ï¼Œä½†æ˜¯ React Bootstrap çš„ç½‘ç«™éƒ½æ˜¯ä½¿ç”¨å®ƒæ¥æž„å»ºçš„ã€‚æ‰€ä»¥å®ƒä¸ä¼šç³Ÿç³•ã€‚ æ³¨æ„:å®ƒè¦æ±‚ Ruby è¿è¡Œæœ¬åœ°çŽ¯å¢ƒ( Windows è‡ªè¡Œå®‰è£…ï¼Œ macOS è‡ªå¸¦)ã€‚ 12 æŠŠ GitHub å½“åš CRM ä½¿ç”¨å‡è®¾ä½ æœ‰ä¸€ä¸ªå­˜æœ‰ä¸€äº›æ–‡æœ¬å†…å®¹çš„ç½‘ç«™ï¼Œä½ ä¸æƒ³å°†æ–‡æœ¬å†…å®¹å­˜å‚¨äºŽçœŸæ­£çš„ HTML æºç ä¸­ã€‚ ç›¸åçš„ï¼Œä½ æƒ³è¦å°†è¿™äº›æ–‡æœ¬å—å­˜å‚¨äºŽéžå¼€å‘äººå‘˜èƒ½è½»æ¾çš„è¿›è¡Œç¼–è¾‘çš„åœ°æ–¹ã€‚å¯èƒ½æ˜¯ä¸€ä¸ªç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿï¼Œç”šè‡³æ˜¯ä¸€ä¸ªå®¡æ ¸æµç¨‹ã€‚ æˆ‘çš„å»ºè®®æ˜¯:ä½¿ç”¨ GitHub åŽ‚åº“ä¸­çš„ Markdown æ–‡ä»¶æ¥å­˜å‚¨è¿™äº›æ–‡æœ¬å†…å®¹ï¼Œç„¶åŽä½¿ç”¨å‰ç«¯ç»„ä»¶æ¥æ‹‰å–è¿™äº›æ–‡æœ¬å—å¹¶å±•ç¤ºåœ¨é¡µé¢ä¸Šã€‚ æˆ‘æ˜¯æž React çš„ï¼Œæ‰€ä»¥è¿™æœ‰ä¸€ä¸ª è§£æž Markdown çš„ç»„ä»¶ä¾‹å­ï¼Œç»™å®šä¸€äº› Markdown æ–‡ä»¶è·¯å¾„ï¼Œå®ƒå°†ä¼šè‡ªåŠ¨æ‹‰å–å¹¶ä½œä¸º HTML æ˜¾ç¤ºå‡ºæ¥ã€‚ 1234567891011121314151617181920212223242526class Markdown extends React.Component &#123; constructor(props) &#123; super(props); // replace with your URL, obviously this.baseUrl = &apos;https://raw.githubusercontent.com/davidgilbertson/about-github/master/text-snippets&apos;; this.state = &#123; markdown: &apos;&apos;, &#125;; &#125; componentDidMount() &#123; fetch(`$&#123;this.baseUrl&#125;/$&#123;this.props.url&#125;`) .then(response =&gt; response.text()) .then((markdown) =&gt; &#123; this.setState(&#123;markdown&#125;); &#125;); &#125; render() &#123; return ( &lt;div dangerouslySetInnerHTML=&#123;&#123;__html: marked(this.state.markdown)&#125;&#125; /&gt; ); &#125;&#125; å¥–åŠ±çŽ¯èŠ‚ â€”â€” GitHub å·¥å…·æˆ‘å·²ç»ä½¿ç”¨äº† Octotree Chrome extension æœ‰æ®µæ—¶é—´äº†ï¼ŒçŽ°åœ¨æˆ‘å‘å¤§å®¶æŽ¨èå®ƒï¼æ— è®ºä½ æ˜¯åœ¨æŸ¥çœ‹å“ªä¸ª repo å®ƒéƒ½ä¼šåœ¨å·¦ä¾§ç»™ä½ ä¸€ä¸ªæ ‘çŠ¶é¢æ¿ã€‚ é€šè¿‡è¿™ä¸ªè§†é¢‘æˆ‘äº†è§£åˆ°äº† octoboxï¼Œå®ƒæ˜¯ç”¨äºŽç®¡ç†ä½ çš„ GitHub Issues æ”¶ä»¶ç®±ï¼Œçœ‹èµ·æ¥ç›¸å½“ä¸é”™ï¼ä»¥ä¸Šå°±æ˜¯æˆ‘é’ˆå¯¹äºŽoctoboxçš„å…¨éƒ¨æƒ³æ³•ã€‚ å…¶ä»–å°±æ˜¯è¿™æ ·äº†ï¼æˆ‘å¸Œæœ›è¿™é‡Œè‡³å°‘æœ‰ä¸‰ä»¶äº‹æ˜¯ä½ è¿˜ä¸çŸ¥é“çš„ã€‚ æœ€åŽ: hava a nice dayï¼]]></content>
      <categories>
        <category>ç¿»è¯‘</category>
      </categories>
      <tags>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åä¸ƒ) MQåº”ç”¨]]></title>
    <url>%2F2017%2F10%2F20%2FSSM17%2F</url>
    <content type="text"><![CDATA[å‰è¨€å†™è¿™ç¯‡æ–‡ç« çš„èµ·å› æ˜¯ç”±äºŽä¹‹å‰çš„ä¸€ç¯‡å…³äºŽKafkaå¼‚å¸¸æ¶ˆè´¹ï¼Œå½“æ—¶ä¸ºäº†è§£å†³é—®é¢˜ä¸å¾—ä¸ä½¿ç”¨ä¸´æ—¶çš„æ–¹æ¡ˆã€‚ æ€»ç»“èµ·æ¥å½’æ ¹ç»“åº•è¿˜æ˜¯å¯¹Kafkaä¸ç†Ÿæ‚‰å¯¼è‡´çš„ï¼ŒåŠ ä¸Šå¹³æ—¶å·¥ä½œçš„éœ€è¦ï¼Œä¹‹åŽå°±èŠ±äº›æ—¶é—´çœ‹äº†Kafkaç›¸å…³çš„èµ„æ–™ã€‚ ä½•æ—¶ä½¿ç”¨MQè°ˆåˆ°Kafkaå°±ä¸å¾—ä¸æåˆ°MQï¼Œæ˜¯å±žäºŽæ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€ç§ã€‚ä½œä¸ºä¸€ç§åŸºç¡€ä¸­é—´ä»¶åœ¨äº’è”ç½‘é¡¹ç›®ä¸­æœ‰ç€å¤§é‡çš„ä½¿ç”¨ã€‚ ä¸€ç§æŠ€æœ¯çš„äº§ç”Ÿè‡ªç„¶æ˜¯ä¸ºäº†è§£å†³æŸç§éœ€æ±‚ï¼Œé€šå¸¸æ¥è¯´æ˜¯ä»¥ä¸‹åœºæ™¯ï¼š éœ€è¦è·¨è¿›ç¨‹é€šä¿¡ï¼šBç³»ç»Ÿéœ€è¦Aç³»ç»Ÿçš„è¾“å‡ºä½œä¸ºè¾“å…¥å‚æ•°ã€‚ å½“Aç³»ç»Ÿçš„è¾“å‡ºèƒ½åŠ›è¿œè¿œå¤§äºŽBç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚ é’ˆå¯¹äºŽç¬¬ä¸€ç§æƒ…å†µæœ‰ä¸¤ç§æ–¹æ¡ˆ: ä½¿ç”¨RPCè¿œç¨‹è°ƒç”¨,Aç›´æŽ¥è°ƒç”¨Bã€‚ ä½¿ç”¨MQ,Aå‘å¸ƒæ¶ˆæ¯åˆ°MQ,Bè®¢é˜…è¯¥æ¶ˆæ¯ã€‚ å½“æˆ‘ä»¬çš„éœ€æ±‚æ˜¯:Aè°ƒç”¨Bå®žæ—¶å“åº”ï¼Œå¹¶ä¸”å®žæ—¶å…³å¿ƒå“åº”ç»“æžœåˆ™ä½¿ç”¨RPCï¼Œè¿™ç§æƒ…å†µå°±å¾—ä½¿ç”¨åŒæ­¥è°ƒç”¨ã€‚ åä¹‹å½“æˆ‘ä»¬å¹¶ä¸å…³å¿ƒè°ƒç”¨ä¹‹åŽçš„æ‰§è¡Œç»“æžœï¼Œå¹¶ä¸”æœ‰å¯èƒ½è¢«è°ƒç”¨æ–¹çš„æ‰§è¡Œéžå¸¸è€—æ—¶ï¼Œè¿™ç§æƒ…å†µå°±éžå¸¸é€‚åˆç”¨MQæ¥è¾¾åˆ°å¼‚æ­¥è°ƒç”¨ç›®çš„ã€‚ æ¯”å¦‚å¸¸è§çš„ç™»å½•åœºæ™¯å°±åªèƒ½ç”¨åŒæ­¥è°ƒç”¨çš„æ–¹å¼ï¼Œå› ä¸ºè¿™ä¸ªè¿‡ç¨‹éœ€è¦å®žæ—¶çš„å“åº”ç»“æžœï¼Œæ€»ä¸èƒ½åœ¨ç”¨æˆ·ç‚¹äº†ç™»å½•ä¹‹åŽæŽ’é™¤ç½‘ç»œåŽŸå› ä¹‹å¤–å†é¢å¤–çš„ç­‰å‡ ç§’å§ã€‚ ä½†ç±»ä¼¼äºŽç”¨æˆ·ç™»å½•éœ€è¦å¥–åŠ±ç§¯åˆ†çš„æƒ…å†µåˆ™ä½¿ç”¨MQä¼šæ›´å¥½ï¼Œå› ä¸ºç™»å½•å¹¶ä¸å…³ç³»ç§¯åˆ†çš„æƒ…å†µï¼Œåªéœ€è¦å‘ä¸ªæ¶ˆæ¯åˆ°MQ,å¤„ç†ç§¯åˆ†çš„æœåŠ¡è®¢é˜…å¤„ç†å³å¯ï¼Œè¿™æ ·è¿˜å¯ä»¥è§£å†³ç§¯åˆ†ç³»ç»Ÿæ•…éšœå¸¦æ¥çš„é›ªå´©æ•ˆåº”ã€‚ MQè¿˜æœ‰ä¸€ä¸ªåŸºç¡€åŠŸèƒ½åˆ™æ˜¯é™æµå‰Šå³°ï¼Œè¿™å¯¹äºŽå¤§æµé‡çš„åœºæ™¯å¦‚æžœå°†è¯·æ±‚ç›´æŽ¥è°ƒç”¨åˆ°Bç³»ç»Ÿåˆ™éžå¸¸æœ‰å¯èƒ½ä½¿Bç³»ç»Ÿå‡ºçŽ°ä¸å¯ç”¨çš„æƒ…å†µã€‚è¿™ç§åœºæ™¯å°±éžå¸¸é€‚åˆå°†è¯·æ±‚æ”¾å…¥MQï¼Œä¸ä½†å¯ä»¥åˆ©ç”¨MQå‰Šå³°è¿˜å°½å¯èƒ½çš„ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨ã€‚ Kafkaç®€ä»‹æœ¬æ¬¡é‡ç‚¹è®¨è®ºä¸‹Kafkaã€‚ç®€å•æ¥è¯´Kafkaæ˜¯ä¸€ä¸ªæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œé«˜åžåçŽ‡çš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿã€‚ Kafkaçš„å¸¸ç”¨çŸ¥è¯†: Topic:ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„äº¤äº’éƒ½æ˜¯å›´ç»•ç€ä¸€ä¸ªTopicè¿›è¡Œçš„ï¼Œé€šå¸¸æ¥è¯´æ˜¯ç”±ä¸šåŠ¡æ¥è¿›è¡ŒåŒºåˆ†ï¼Œç”±ç”Ÿäº§æ¶ˆè´¹è€…åå•†ä¹‹åŽè¿›è¡Œåˆ›å»ºã€‚ Partition(åˆ†åŒº):æ˜¯Topicä¸‹çš„ç»„æˆï¼Œé€šå¸¸ä¸€ä¸ªTopicä¸‹æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºï¼Œæ¶ˆæ¯ç”Ÿäº§ä¹‹åŽä¼šæŒ‰ç…§ä¸€å®šçš„ç®—æ³•è´Ÿè½½åˆ°æ¯ä¸ªåˆ†åŒºï¼Œæ‰€ä»¥åˆ†åŒºä¹Ÿæ˜¯Kafkaæ€§èƒ½çš„å…³é”®ã€‚å½“å‘çŽ°æ€§èƒ½ä¸é«˜æ—¶ä¾¿å¯è€ƒè™‘æ–°å¢žåˆ†åŒºã€‚ ç»“æž„å›¾å¦‚ä¸‹: åˆ›å»ºTopicKafkaçš„å®‰è£…å®˜ç½‘æœ‰éžå¸¸è¯¦ç»†çš„è®²è§£ã€‚è¿™é‡Œè°ˆä¸€ä¸‹åœ¨æ—¥å¸¸å¼€å‘ä¸­å¸¸è§çš„ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºTopicï¼š 1sh bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 3 --topic `test` åˆ›å»ºäº†ä¸‰ä¸ªåˆ†åŒºçš„testä¸»é¢˜ã€‚ ä½¿ç”¨ 1sh bin/kafka-topics.sh --list --zookeeper localhost:2181 å¯ä»¥åˆ—å‡ºæ‰€æœ‰çš„Topicã€‚ Kafkaç”Ÿäº§è€…ä½¿ç”¨kafkaå®˜æ–¹æ‰€æä¾›çš„Java APIæ¥è¿›è¡Œæ¶ˆæ¯ç”Ÿäº§ï¼Œå®žé™…ä½¿ç”¨ä¸­ç¼–ç å®žçŽ°æ›´ä¸ºå¸¸ç”¨: 12345678910111213141516171819202122232425262728293031323334353637383940/** Kafkaç”Ÿäº§è€… * @author crossoverJie */public class Producer &#123; private static final Logger LOGGER = LoggerFactory.getLogger(Producer.class); /** * æ¶ˆè´¹é…ç½®æ–‡ä»¶ */ private static String consumerProPath; public static void main(String[] args) throws IOException &#123; // set up the producer consumerProPath = System.getProperty("product_path"); KafkaProducer&lt;String, String&gt; producer = null; try &#123; FileInputStream inputStream = new FileInputStream(new File(consumerProPath)); Properties properties = new Properties(); properties.load(inputStream); producer = new KafkaProducer&lt;String, String&gt;(properties); &#125; catch (IOException e) &#123; LOGGER.error("load config error", e); &#125; try &#123; // send lots of messages for (int i=0 ;i&lt;100 ; i++)&#123; producer.send(new ProducerRecord&lt;String, String&gt;( "topic_optimization", i+"", i+"")); &#125; &#125; catch (Throwable throwable) &#123; System.out.printf("%s", throwable.getStackTrace()); &#125; finally &#123; producer.close(); &#125; &#125;&#125; å†é…åˆä»¥ä¸‹å¯åŠ¨å‚æ•°å³å¯å‘é€æ¶ˆæ¯:1-Dproduct_path=/xxx/producer.properties ä»¥åŠç”Ÿäº§è€…çš„é…ç½®æ–‡ä»¶:12345678910#é›†ç¾¤åœ°å€ï¼Œå¯ä»¥å¤šä¸ªbootstrap.servers=10.19.13.51:9094acks=allretries=0batch.size=16384auto.commit.interval.ms=1000linger.ms=0key.serializer=org.apache.kafka.common.serialization.StringSerializervalue.serializer=org.apache.kafka.common.serialization.StringSerializerblock.on.buffer.full=true å…·ä½“çš„é…ç½®è¯´æ˜Žè¯¦è§æ­¤å¤„:https://kafka.apache.org/0100/documentation.html#theproducer æµç¨‹éžå¸¸ç®€å•ï¼Œå…¶å®žå°±æ˜¯ä¸€äº›APIçš„è°ƒç”¨ã€‚ æ¶ˆæ¯å‘å®Œä¹‹åŽå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹é˜Ÿåˆ—å†…çš„æƒ…å†µ:1sh kafka-consumer-groups.sh --bootstrap-server localhost:9094 --describe --group group1 å…¶ä¸­çš„lagä¾¿æ˜¯é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯æ•°é‡ã€‚ Kafkaæ¶ˆè´¹è€…æœ‰äº†ç”Ÿäº§è€…è‡ªç„¶ä¹Ÿå°‘ä¸äº†æ¶ˆè´¹è€…ï¼Œè¿™é‡Œé¦–å…ˆé’ˆå¯¹å•çº¿ç¨‹æ¶ˆè´¹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106/** * Function:kafkaå®˜æ–¹æ¶ˆè´¹ * * @author crossoverJie * Date: 2017/10/19 01:11 * @since JDK 1.8 */public class KafkaOfficialConsumer &#123; private static final Logger LOGGER = LoggerFactory.getLogger(KafkaOfficialConsumer.class); /** * æ—¥å¿—æ–‡ä»¶åœ°å€ */ private static String logPath; /** * ä¸»é¢˜åç§° */ private static String topic; /** * æ¶ˆè´¹é…ç½®æ–‡ä»¶ */ private static String consumerProPath ; /** * åˆå§‹åŒ–å‚æ•°æ ¡éªŒ * @return */ private static boolean initCheck() &#123; topic = System.getProperty("topic") ; logPath = System.getProperty("log_path") ; consumerProPath = System.getProperty("consumer_pro_path") ; if (StringUtil.isEmpty(topic) || logPath.isEmpty()) &#123; LOGGER.error("system property topic ,consumer_pro_path, log_path is required !"); return true; &#125; return false; &#125; /** * åˆå§‹åŒ–kafkaé…ç½® * @return */ private static KafkaConsumer&lt;String, String&gt; initKafkaConsumer() &#123; KafkaConsumer&lt;String, String&gt; consumer = null; try &#123; FileInputStream inputStream = new FileInputStream(new File(consumerProPath)) ; Properties properties = new Properties(); properties.load(inputStream); consumer = new KafkaConsumer&lt;String, String&gt;(properties); consumer.subscribe(Arrays.asList(topic)); &#125; catch (IOException e) &#123; LOGGER.error("åŠ è½½consumer.propsæ–‡ä»¶å‡ºé”™", e); &#125; return consumer; &#125; public static void main(String[] args) &#123; if (initCheck())&#123; return; &#125; int totalCount = 0 ; long totalMin = 0L ; int count = 0; KafkaConsumer&lt;String, String&gt; consumer = initKafkaConsumer(); long startTime = System.currentTimeMillis() ; //æ¶ˆè´¹æ¶ˆæ¯ while (true) &#123; ConsumerRecords&lt;String, String&gt; records = consumer.poll(200); if (records.count() &lt;= 0)&#123; continue ; &#125; LOGGER.debug("æœ¬æ¬¡èŽ·å–:"+records.count()); count += records.count() ; long endTime = System.currentTimeMillis() ; LOGGER.debug("count=" +count) ; if (count &gt;= 10000 )&#123; totalCount += count ; LOGGER.info("this consumer &#123;&#125; recordï¼Œuse &#123;&#125; milliseconds",count,endTime-startTime); totalMin += (endTime-startTime) ; startTime = System.currentTimeMillis() ; count = 0 ; &#125; LOGGER.debug("end totalCount=&#123;&#125;,min=&#123;&#125;",totalCount,totalMin); /*for (ConsumerRecord&lt;String, String&gt; record : records) &#123; record.value() ; JsonNode msg = null; try &#123; msg = mapper.readTree(record.value()); &#125; catch (IOException e) &#123; LOGGER.error("æ¶ˆè´¹æ¶ˆæ¯å‡ºé”™", e); &#125; LOGGER.info("kafka receive = "+msg.toString()); &#125;*/ &#125; &#125;&#125; é…åˆä»¥ä¸‹å¯åŠ¨å‚æ•°:1-Dlog_path=/log/consumer.log -Dtopic=test -Dconsumer_pro_path=consumer.properties å…¶ä¸­é‡‡ç”¨äº†è½®è¯¢çš„æ–¹å¼èŽ·å–æ¶ˆæ¯ï¼Œå¹¶ä¸”è®°å½•äº†æ¶ˆè´¹è¿‡ç¨‹ä¸­çš„æ•°æ®ã€‚ æ¶ˆè´¹è€…é‡‡ç”¨çš„é…ç½®:1234567891011121314151617bootstrap.servers=192.168.1.2:9094group.id=group1# è‡ªåŠ¨æäº¤enable.auto.commit=truekey.deserializer=org.apache.kafka.common.serialization.StringDeserializervalue.deserializer=org.apache.kafka.common.serialization.StringDeserializer# fast session timeout makes it more fun to play with failoversession.timeout.ms=10000# These buffer sizes seem to be needed to avoid consumer switching to# a mode where it processes one bufferful every 5 seconds with multiple# timeouts along the way. No idea why this happens.fetch.min.bytes=50000receive.buffer.bytes=262144max.partition.fetch.bytes=2097152 ä¸ºäº†ç®€ä¾¿æˆ‘é‡‡ç”¨çš„æ˜¯è‡ªåŠ¨æäº¤offsetã€‚ æ¶ˆæ¯å­˜æ”¾æœºåˆ¶è°ˆåˆ°offsetå°±å¿…é¡»å¾—è°ˆè°ˆKafkaçš„æ¶ˆæ¯å­˜æ”¾æœºåˆ¶. Kafkaçš„æ¶ˆæ¯ä¸ä¼šå› ä¸ºæ¶ˆè´¹äº†å°±ä¼šç«‹å³åˆ é™¤ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¼šæŒä¹…åŒ–åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶é…ç½®æœ‰è¿‡æœŸæ—¶é—´ï¼Œåˆ°äº†æ—¶é—´ä¼šè‡ªåŠ¨åˆ é™¤è¿‡æœŸæ•°æ®ï¼Œå¹¶ä¸”ä¸ä¼šç®¡å…¶ä¸­çš„æ•°æ®æ˜¯å¦è¢«æ¶ˆè´¹è¿‡ã€‚ ç”±äºŽè¿™æ ·çš„æœºåˆ¶å°±å¿…é¡»çš„æœ‰ä¸€ä¸ªæ ‡å¿—æ¥è¡¨æ˜Žå“ªäº›æ•°æ®å·²ç»è¢«æ¶ˆè´¹è¿‡äº†ï¼Œoffset(åç§»é‡)å°±æ˜¯è¿™æ ·çš„ä½œç”¨ï¼Œå®ƒç±»ä¼¼äºŽæŒ‡é’ˆæŒ‡å‘æŸä¸ªæ•°æ®ï¼Œå½“æ¶ˆè´¹ä¹‹åŽoffsetå°±ä¼šçº¿æ€§çš„å‘å‰ç§»åŠ¨ï¼Œè¿™æ ·ä¸€æ¥çš„è¯æ¶ˆæ¯æ˜¯å¯ä»¥è¢«ä»»æ„æ¶ˆè´¹çš„ï¼Œåªè¦æˆ‘ä»¬ä¿®æ”¹offsetçš„å€¼å³å¯ã€‚ æ¶ˆè´¹è¿‡ç¨‹ä¸­è¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ˜¯: åŒä¸€ä¸ªconsumer group(group.idç›¸ç­‰)ä¸‹åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹ï¼Œè¿™ä¸ªåˆšå¼€å§‹ç¡®å®žä¼šè®©å¾ˆå¤šäººè¸©å‘ã€‚ å¤šçº¿ç¨‹æ¶ˆè´¹é’ˆå¯¹äºŽå•çº¿ç¨‹æ¶ˆè´¹å®žçŽ°èµ·æ¥è‡ªç„¶æ˜¯æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ•ˆçŽ‡ä¹Ÿæ˜¯è¦å¤§æ‰“æŠ˜æ‰£çš„ã€‚ ä¸ºæ­¤æˆ‘åšäº†ä¸€ä¸ªæµ‹è¯•ï¼Œä½¿ç”¨ä¹‹å‰çš„å•çº¿ç¨‹æ¶ˆè´¹120009æ¡æ•°æ®çš„ç»“æžœå¦‚ä¸‹: æ€»å…±èŠ±äº†12450æ¯«ç§’ã€‚ é‚£ä¹ˆæ¢æˆå¤šçº¿ç¨‹æ¶ˆè´¹æ€Žä¹ˆå®žçŽ°å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨partitionçš„åˆ†åŒºç‰¹æ€§æ¥æé«˜æ¶ˆè´¹èƒ½åŠ›ï¼Œå•çº¿ç¨‹çš„æ—¶å€™ç­‰äºŽæ˜¯ä¸€ä¸ªçº¿ç¨‹è¦æŠŠæ‰€æœ‰åˆ†åŒºé‡Œçš„æ•°æ®éƒ½æ¶ˆè´¹ä¸€éï¼Œå¦‚æžœæ¢æˆå¤šçº¿ç¨‹å°±å¯ä»¥è®©ä¸€ä¸ªçº¿ç¨‹åªæ¶ˆè´¹ä¸€ä¸ªåˆ†åŒº,è¿™æ ·æ•ˆçŽ‡è‡ªç„¶å°±æé«˜äº†ï¼Œæ‰€ä»¥çº¿ç¨‹æ•°coreSize&lt;=partitionã€‚ é¦–å…ˆæ¥çœ‹ä¸‹å…¥å£: 1234567891011121314151617public class ConsumerThreadMain &#123; private static String brokerList = &quot;localhost:9094&quot;; private static String groupId = &quot;group1&quot;; private static String topic = &quot;test&quot;; /** * çº¿ç¨‹æ•°é‡ */ private static int threadNum = 3; public static void main(String[] args) &#123; ConsumerGroup consumerGroup = new ConsumerGroup(threadNum, groupId, topic, brokerList); consumerGroup.execute(); &#125;&#125; å…¶ä¸­çš„ConsumerGroupç±»:12345678910111213141516171819202122232425262728293031323334353637383940public class ConsumerGroup &#123; private static Logger LOGGER = LoggerFactory.getLogger(ConsumerGroup.class); /** * çº¿ç¨‹æ±  */ private ExecutorService threadPool; private List&lt;ConsumerCallable&gt; consumers ; public ConsumerGroup(int threadNum, String groupId, String topic, String brokerList) &#123; ThreadFactory namedThreadFactory = new ThreadFactoryBuilder() .setNameFormat(&quot;consumer-pool-%d&quot;).build(); threadPool = new ThreadPoolExecutor(threadNum, threadNum, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(1024), namedThreadFactory, new ThreadPoolExecutor.AbortPolicy()); consumers = new ArrayList&lt;ConsumerCallable&gt;(threadNum); for (int i = 0; i &lt; threadNum; i++) &#123; ConsumerCallable consumerThread = new ConsumerCallable(brokerList, groupId, topic); consumers.add(consumerThread); &#125; &#125; /** * æ‰§è¡Œä»»åŠ¡ */ public void execute() &#123; long startTime = System.currentTimeMillis() ; for (ConsumerCallable runnable : consumers) &#123; Future&lt;ConsumerFuture&gt; future = threadPool.submit(runnable) ; &#125; if (threadPool.isShutdown())&#123; long endTime = System.currentTimeMillis() ; LOGGER.info(&quot;main thread use &#123;&#125; Millis&quot; ,endTime -startTime) ; &#125; threadPool.shutdown(); &#125;&#125; æœ€åŽçœŸæ­£çš„æ‰§è¡Œé€»è¾‘ConsumerCallable:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980public class ConsumerCallable implements Callable&lt;ConsumerFuture&gt; &#123; private static Logger LOGGER = LoggerFactory.getLogger(ConsumerCallable.class); private AtomicInteger totalCount = new AtomicInteger() ; private AtomicLong totalTime = new AtomicLong() ; private AtomicInteger count = new AtomicInteger() ; /** * æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤KafkaConsumerå®žä¾‹ */ private final KafkaConsumer&lt;String, String&gt; consumer; public ConsumerCallable(String brokerList, String groupId, String topic) &#123; Properties props = new Properties(); props.put(&quot;bootstrap.servers&quot;, brokerList); props.put(&quot;group.id&quot;, groupId); //è‡ªåŠ¨æäº¤ä½ç§» props.put(&quot;enable.auto.commit&quot;, &quot;true&quot;); props.put(&quot;auto.commit.interval.ms&quot;, &quot;1000&quot;); props.put(&quot;session.timeout.ms&quot;, &quot;30000&quot;); props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;); props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;); this.consumer = new KafkaConsumer&lt;&gt;(props); consumer.subscribe(Arrays.asList(topic)); &#125; /** * Computes a result, or throws an exception if unable to do so. * * @return computed result * @throws Exception if unable to compute a result */ @Override public ConsumerFuture call() throws Exception &#123; boolean flag = true; int failPollTimes = 0 ; long startTime = System.currentTimeMillis() ; while (flag) &#123; // ä½¿ç”¨200msä½œä¸ºèŽ·å–è¶…æ—¶æ—¶é—´ ConsumerRecords&lt;String, String&gt; records = consumer.poll(200); if (records.count() &lt;= 0)&#123; failPollTimes ++ ; if (failPollTimes &gt;= 20)&#123; LOGGER.debug(&quot;è¾¾åˆ°&#123;&#125;æ¬¡æ•°ï¼Œé€€å‡º &quot;,failPollTimes); flag = false ; &#125; continue ; &#125; //èŽ·å–åˆ°ä¹‹åŽåˆ™æ¸…é›¶ failPollTimes = 0 ; LOGGER.debug(&quot;æœ¬æ¬¡èŽ·å–:&quot;+records.count()); count.addAndGet(records.count()) ; totalCount.addAndGet(count.get()) ; long endTime = System.currentTimeMillis() ; if (count.get() &gt;= 10000 )&#123; LOGGER.info(&quot;this consumer &#123;&#125; recordï¼Œuse &#123;&#125; milliseconds&quot;,count,endTime-startTime); totalTime.addAndGet(endTime-startTime) ; startTime = System.currentTimeMillis() ; count = new AtomicInteger(); &#125; LOGGER.debug(&quot;end totalCount=&#123;&#125;,min=&#123;&#125;&quot;,totalCount,totalTime); /*for (ConsumerRecord&lt;String, String&gt; record : records) &#123; // ç®€å•åœ°æ‰“å°æ¶ˆæ¯ LOGGER.debug(record.value() + &quot; consumed &quot; + record.partition() + &quot; message with offset: &quot; + record.offset()); &#125;*/ &#125; ConsumerFuture consumerFuture = new ConsumerFuture(totalCount.get(),totalTime.get()) ; return consumerFuture ; &#125;&#125; ç†ä¸€ä¸‹é€»è¾‘: å…¶å®žå°±æ˜¯åˆå§‹åŒ–å‡ºä¸‰ä¸ªæ¶ˆè´¹è€…å®žä¾‹ï¼Œç”¨äºŽä¸‰ä¸ªçº¿ç¨‹æ¶ˆè´¹ã€‚å…¶ä¸­åŠ å…¥äº†ä¸€äº›ç»Ÿè®¡ï¼Œæœ€åŽä¹Ÿæ˜¯æ¶ˆè´¹120009æ¡æ•°æ®ç»“æžœå¦‚ä¸‹ã€‚ ç”±äºŽæ˜¯å¹¶è¡Œè¿è¡Œï¼Œå¯è§æ¶ˆè´¹120009æ¡æ•°æ®å¯ä»¥æé«˜2ç§’å·¦å³ï¼Œå½“æ•°æ®ä»¥æ›´é«˜çš„æ•°é‡çº§æå‡åŽæ•ˆæžœä¼šæ›´åŠ æ˜Žæ˜¾ã€‚ ä½†è¿™ä¹Ÿæœ‰ä¸€äº›å¼Šç«¯: çµæ´»åº¦ä¸é«˜ï¼Œå½“åˆ†åŒºæ•°é‡å˜æ›´ä¹‹åŽä¸èƒ½è‡ªé€‚åº”è°ƒæ•´ã€‚ æ¶ˆè´¹é€»è¾‘å’Œå¤„ç†é€»è¾‘åœ¨åŒä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æžœå¤„ç†é€»è¾‘è¾ƒä¸ºå¤æ‚ä¼šå½±å“æ•ˆçŽ‡ï¼Œè€¦åˆä¹Ÿè¾ƒé«˜ã€‚å½“ç„¶è¿™ä¸ªå¤„ç†é€»è¾‘å¯ä»¥å†é€šè¿‡ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ—å‘å‡ºåŽ»ç”±å¦å¤–çš„ç¨‹åºæ¥å¤„ç†ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ æ€»ç»“Kafkaçš„çŸ¥è¯†ç‚¹è¿˜æ˜¯è¾ƒå¤šï¼ŒKafkaçš„ä½¿ç”¨ä¹Ÿè¿œä¸è¿™äº›ã€‚ä¹‹åŽä¼šç»§ç»­åˆ†äº«ä¸€äº›å…³äºŽKafkaç›‘æŽ§ç­‰ç›¸å…³å†…å®¹ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Kafka</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(äº”)Hystrix-æœåŠ¡å®¹é”™ä¸Žä¿æŠ¤]]></title>
    <url>%2F2017%2F09%2F20%2Fsbc5%2F</url>
    <content type="text"><![CDATA[å‰è¨€çœ‹è¿‡ åº”ç”¨é™æµçš„æœ‹å‹åº”è¯¥çŸ¥é“ï¼Œé™æµçš„æ ¹æœ¬ç›®çš„å°±æ˜¯ä¸ºäº†ä¿éšœæœåŠ¡çš„é«˜å¯ç”¨ã€‚ æœ¬æ¬¡å†å€ŸåŠ©SpringCloudä¸­çš„é›†æˆçš„Hystrixç»„ä»¶æ¥è°ˆè°ˆæœåŠ¡å®¹é”™ã€‚ å…¶å®žäº§ç”ŸæŸé¡¹éœ€æ±‚çš„åŽŸå› éƒ½æ˜¯ä¸ºäº†è§£å†³æŸä¸ªéœ€æ±‚ã€‚å½“æˆ‘ä»¬å°†åº”ç”¨è¿›è¡Œåˆ†å¸ƒå¼æ¨¡å—éƒ¨ç½²ä¹‹åŽ,å„ä¸ªæ¨¡å—ä¹‹é—´é€šè¿‡è¿œç¨‹è°ƒç”¨çš„æ–¹å¼è¿›è¡Œäº¤äº’(RPC)ã€‚æ‹¿æˆ‘ä»¬å¹³æ—¶æœ€å¸¸è§çš„ä¸‹å•ä¹°å•†å“æ¥è¯´ï¼Œç‚¹å‡»ä¸‹å•æŒ‰é’®çš„ä¸€çž¬é—´å¯èƒ½ä¼šå‘å‘é€çš„è¯·æ±‚åŒ…å«ï¼š è¯·æ±‚è®¢å•ç³»ç»Ÿåˆ›å»ºè®¢å•ã€‚ è¯·æ±‚åº“å­˜ç³»ç»Ÿæ‰£é™¤åº“å­˜ã€‚ è¯·æ±‚ç”¨æˆ·ç³»ç»Ÿæ›´æ–°ç”¨æˆ·äº¤æ˜“è®°å½•ã€‚ è¿™å…¶ä¸­çš„æ¯ä¸€æ­¥éƒ½æœ‰å¯èƒ½å› ä¸ºç½‘ç»œã€èµ„æºã€æœåŠ¡å™¨ç­‰åŽŸå› é€ æˆå»¶è¿Ÿå“åº”ç”šè‡³æ˜¯è°ƒç”¨å¤±è´¥ã€‚å½“åŽé¢çš„è¯·æ±‚æºæºä¸æ–­çš„è¿‡æ¥æ—¶å»¶è¿Ÿçš„èµ„æºä¹Ÿæ²¡æœ‰çš„åˆ°é‡Šæ”¾ï¼Œè¿™æ ·çš„å †ç§¯å¾ˆæœ‰å¯èƒ½æŠŠå…¶ä¸­ä¸€ä¸ªæ¨¡å—æ‹–åž®ï¼Œå…¶ä¸­çš„ä¾èµ–å…³ç³»åˆæœ‰å¯èƒ½æŠŠæ•´ä¸ªè°ƒç”¨é“¾ä¸­çš„åº”ç”¨Overæœ€åŽå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯èƒ½ã€‚è¿™æ ·å°±ä¼šäº§ç”Ÿä¸€ç§çŽ°è±¡:é›ªå´©æ•ˆåº”ã€‚ ä¹‹å‰è®²åˆ°çš„é™æµä¹Ÿèƒ½èµ·åˆ°ä¸€å®šçš„ä¿æŠ¤ä½œç”¨ï¼Œä½†è¿˜è¿œè¿œä¸å¤Ÿã€‚æˆ‘ä»¬éœ€è¦ä»Žå„ä¸ªæ–¹é¢æ¥ä¿éšœæœåŠ¡çš„é«˜å¯ç”¨ã€‚ æ¯”å¦‚ï¼š è¶…æ—¶é‡è¯•ã€‚ æ–­è·¯å™¨æ¨¡å¼ã€‚ æœåŠ¡é™çº§ã€‚ç­‰å„ä¸ªæ–¹é¢æ¥ä¿éšœã€‚ ä½¿ç”¨HystrixSpringCloudä¸­å·²ç»ä¸ºæˆ‘ä»¬é›†æˆäº†Netflixå¼€æºçš„Hystrixæ¡†æž¶ï¼Œä½¿ç”¨è¯¥æ¡†æž¶å¯ä»¥å¾ˆå¥½çš„å¸®æˆ‘ä»¬åšåˆ°æœåŠ¡å®¹é”™ã€‚ Hystrixç®€ä»‹ä¸‹é¢æ˜¯ä¸€å¼ å®˜æ–¹çš„æµç¨‹å›¾: ç®€å•ä»‹ç»ä¸‹: åœ¨è¿œç¨‹è°ƒç”¨æ—¶ï¼Œå°†è¯·æ±‚å°è£…åˆ°HystrixCommandè¿›è¡ŒåŒæ­¥æˆ–æ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­åˆ¤æ–­ç†”æ–­å™¨æ˜¯å¦æ‰“å¼€ã€çº¿ç¨‹æ± æˆ–æ˜¯ä¿¡å·é‡æ˜¯å¦é¥±å’Œã€æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æžœæ˜¯çš„è¯å°±ä¼šè¿›å…¥å›žé€€é€»è¾‘ã€‚å¹¶ä¸”æ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½ä¼šæ”¶é›†è¿è¡ŒçŠ¶æ€æ¥æŽ§åˆ¶æ–­è·¯å™¨çš„çŠ¶æ€ã€‚ ä¸ä½†å¦‚æ­¤è¯¥æ¡†æž¶è¿˜æ‹¥æœ‰è‡ªæˆ‘æ¢å¤åŠŸèƒ½ï¼Œå½“æ–­è·¯å™¨æ‰“å¼€åŽï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šè¿›å…¥å›žé€€é€»è¾‘ã€‚å½“æˆ‘ä»¬çš„åº”ç”¨æ¢å¤æ­£å¸¸åŽä¹Ÿä¸èƒ½å†è¿›å…¥å›žé€€é€»è¾‘å§ã€‚ æ‰€ä»¥hystrixä¼šåœ¨æ–­è·¯å™¨æ‰“å¼€åŽçš„ä¸€å®šæ—¶é—´å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡æä¾›è€…ï¼Œå¦‚æžœæ­£å¸¸å“åº”å°±å…³é—­æ–­è·¯å™¨ï¼Œåä¹‹åˆ™ç»§ç»­æ‰“å¼€ï¼Œè¿™æ ·å°±èƒ½å¾ˆçµæ´»çš„è‡ªæˆ‘ä¿®å¤äº†ã€‚ Feignæ•´åˆHystrixåœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­å·²ç»ä½¿ç”¨Feignæ¥è¿›è¡Œå£°æ˜Žå¼è°ƒç”¨äº†ï¼Œå¹¶ä¸”åœ¨å®žé™…å¼€å‘ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬å°±ç›´æŽ¥ç”¨Feignæ¥æ•´åˆHystrixã€‚ ä½¿ç”¨äº†é¡¹ç›®åŽŸæœ‰çš„sbc-user,sbc-orderæ¥è¿›è¡Œæ¼”ç¤ºï¼Œè°ƒç”¨å…³ç³»å¦‚ä¸‹å›¾: Useråº”ç”¨é€šè¿‡Orderæä¾›å‡ºæ¥çš„order-clientä¾èµ–è°ƒç”¨äº†Orderä¸­çš„åˆ›å»ºè®¢å•æœåŠ¡ã€‚ å…¶ä¸­ä¸»è¦ä¿®æ”¹çš„å°±æ˜¯order-clientï¼Œåœ¨ä¹‹å‰çš„OrderServiceClientæŽ¥å£ä¸­å¢žåŠ äº†ä»¥ä¸‹æ³¨è§£: 12345678910111213@RequestMapping(value="/orderService")@FeignClient(name="sbc-order", // fallbackFactory = OrderServiceFallbackFactory.class, // FIXME: 2017/9/4 å¦‚æžœé…ç½®äº†fallback é‚£ä¹ˆfallbackFactoryå°†ä¼šæ— æ•ˆ fallback = OrderServiceFallBack.class, configuration = OrderConfig.class)@RibbonClientpublic interface OrderServiceClient extends OrderService&#123; @ApiOperation("èŽ·å–è®¢å•å·") @RequestMapping(value = "/getOrderNo", method = RequestMethod.POST) BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) ;&#125; ç”±äºŽFeignå·²ç»é»˜è®¤æ•´åˆäº†Hystrixæ‰€ä»¥ä¸éœ€è¦å†é¢å¤–åŠ å…¥ä¾èµ–ã€‚ æœåŠ¡é™çº§å¯¹åº”çš„@FeignClientä¸­çš„fallbackå±žæ€§åˆ™æ˜¯æœåŠ¡å®¹é”™ä¸­å¾ˆå…³é”®çš„æœåŠ¡é™çº§çš„å…·ä½“å®žçŽ°ï¼Œæ¥çœ‹çœ‹OrderServiceFallBackç±»: 123456789101112public class OrderServiceFallBack implements OrderServiceClient &#123; @Override public BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) &#123; BaseResponse&lt;OrderNoResVO&gt; baseResponse = new BaseResponse&lt;&gt;() ; OrderNoResVO vo = new OrderNoResVO() ; vo.setOrderId(123456L); baseResponse.setDataBody(vo); baseResponse.setMessage(StatusEnum.FALLBACK.getMessage()); baseResponse.setCode(StatusEnum.FALLBACK.getCode()); return baseResponse; &#125;&#125; è¯¥ç±»å®žçŽ°äº†OrderServiceClientæŽ¥å£ï¼Œå¯ä»¥å¾ˆæ˜Žæ˜¾çš„çœ‹å‡ºå…¶ä¸­çš„getOrderNo()æ–¹æ³•å°±æ˜¯æœåŠ¡é™çº§æ—¶æ‰€è§¦å‘çš„é€»è¾‘ã€‚ å…‰æœ‰å®žçŽ°è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬éœ€è¦å°†æ”¹ç±»åŠ å…¥åˆ°Springä¸­ç®¡ç†èµ·æ¥ã€‚è¿™æ ·ä¸Šæ–‡ä¸­@FeignClientçš„configurationå±žæ€§å°±èµ·åˆ°ä½œç”¨äº†ï¼Œæ¥çœ‹çœ‹å¯¹åº”çš„OrderConfigçš„ä»£ç : 123456789101112@Configurationpublic class OrderConfig &#123; @Bean public OrderServiceFallBack fallBack()&#123; return new OrderServiceFallBack(); &#125; @Bean public OrderServiceFallbackFactory factory()&#123; return new OrderServiceFallbackFactory(); &#125;&#125; å…¶ä¸­new OrderServiceFallBack()å¹¶ç”¨äº†@Beanæ³¨è§£ï¼Œç­‰åŒäºŽ: 12&lt;bean id=&quot;orderServiceFallBack&quot; class=&quot;com.crossoverJie.order.feign.config.OrderServiceFallBack&quot;&gt;&lt;/bean&gt; è¿™æ ·æ¯å½“è¯·æ±‚å¤±è´¥å°±ä¼šæ‰§è¡Œå›žé€€é€»è¾‘ï¼Œå¦‚ä¸‹å›¾: å€¼å¾—æ³¨æ„çš„æ˜¯å³ä¾¿æ˜¯æ‰§è¡Œäº†å›žé€€é€»è¾‘æ–­è·¯å™¨ä¹Ÿä¸ä¸€å®šæ‰“å¼€äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åº”ç”¨çš„healthç«¯ç‚¹æ¥æŸ¥çœ‹Hystrixçš„çŠ¶æ€ã€‚ ps:æƒ³è¦æŸ¥çœ‹è¯¥ç«¯ç‚¹éœ€è¦åŠ å…¥ä»¥ä¸‹ä¾èµ–: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; å°±æ‹¿åˆšæ‰çš„ä¾‹å­æ¥è¯´ï¼Œå…ˆå…³é—­Orderåº”ç”¨ï¼Œåœ¨Swaggerè®¿é—®ä¸‹é¢è¿™ä¸ªæŽ¥å£ï¼Œè‚¯å®šæ˜¯ä¼šè¿›å…¥å›žé€€é€»è¾‘: 12345678910@RestController@Api("ç”¨æˆ·æœåŠ¡API")@RequestMapping(value = "/userService")@Validatedpublic interface UserService &#123; @ApiOperation("hystrixå®¹é”™è°ƒç”¨") @RequestMapping(value = "/getUserByHystrix", method = RequestMethod.POST) BaseResponse&lt;OrderNoResVO&gt; getUserByHystrix(@RequestBody UserReqVO userReqVO) ;&#125; æŸ¥çœ‹healthç«¯ç‚¹: å‘çŽ°Hystrixçš„çŠ¶æ€ä¾ç„¶æ˜¯UPçŠ¶æ€ï¼Œè¡¨æ˜Žå½“å‰æ–­è·¯å™¨å¹¶æ²¡æœ‰æ‰“å¼€ã€‚ åå¤è°ƒç”¨å¤šæ¬¡æŽ¥å£ä¹‹åŽå†æ¬¡æŸ¥çœ‹healthç«¯ç‚¹: å‘çŽ°è¿™ä¸ªæ—¶å€™æ–­è·¯å™¨å·²ç»æ‰“å¼€äº†ã€‚ è¿™æ˜¯å› ä¸ºæ–­è·¯å™¨åªæœ‰åœ¨è¾¾åˆ°äº†ä¸€å®šçš„å¤±è´¥é˜ˆå€¼ä¹‹åŽæ‰ä¼šæ‰“å¼€ã€‚ è¾“å‡ºå¼‚å¸¸è¿›å…¥å›žé€€é€»è¾‘ä¹‹åŽè¿˜ä¸ç®—å®Œï¼Œå¤§éƒ¨åˆ†åœºæ™¯æˆ‘ä»¬éƒ½éœ€è¦è®°å½•ä¸ºä»€ä¹ˆå›žé€€ï¼Œä¹Ÿå°±æ˜¯å…·ä½“çš„å¼‚å¸¸ã€‚è¿™äº›ä¿¡æ¯å¯¹æˆ‘ä»¬åŽç»­çš„ç³»ç»Ÿç›‘æŽ§ï¼Œåº”ç”¨è°ƒä¼˜ä¹Ÿæœ‰å¾ˆå¤§å¸®åŠ©ã€‚ å®žçŽ°èµ·æ¥ä¹Ÿå¾ˆç®€å•:ä¸Šæ–‡ä¸­åœ¨@FeignClientæ³¨è§£ä¸­åŠ å…¥çš„fallbackFactory = OrderServiceFallbackFactory.classå±žæ€§åˆ™æ˜¯ç”¨äºŽå¤„ç†å›žé€€é€»è¾‘ä»¥åŠåŒ…å«å¼‚å¸¸ä¿¡æ¯ï¼š 123456789101112131415161718192021222324252627282930/** * Function:æŸ¥çœ‹fallbackåŽŸå›  * * @author crossoverJie * Date: 2017/9/4 00:45 * @since JDK 1.8 */public class OrderServiceFallbackFactory implements FallbackFactory&lt;OrderServiceClient&gt;&#123; private final static Logger LOGGER = LoggerFactory.getLogger(OrderServiceFallbackFactory.class); @Override public OrderServiceClient create(Throwable throwable) &#123; return new OrderServiceClient() &#123; @Override public BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) &#123; LOGGER.error("fallback:" + throwable); BaseResponse&lt;OrderNoResVO&gt; baseResponse = new BaseResponse&lt;&gt;() ; OrderNoResVO vo = new OrderNoResVO() ; vo.setOrderId(123456L); baseResponse.setDataBody(vo); baseResponse.setMessage(StatusEnum.FALLBACK.getMessage()); baseResponse.setCode(StatusEnum.FALLBACK.getCode()); return baseResponse; &#125; &#125;; &#125;&#125; ä»£ç å¾ˆç®€å•ï¼Œå®žçŽ°äº†FallbackFactoryæŽ¥å£ä¸­çš„create()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å…¥å‚å°±æ˜¯å¼‚å¸¸ä¿¡æ¯ï¼Œå¯ä»¥æŒ‰ç…§æˆ‘ä»¬çš„éœ€è¦è‡ªè¡Œå¤„ç†ï¼ŒåŽé¢åˆ™æ˜¯å’Œä¹‹å‰ä¸€æ ·çš„å›žé€€å¤„ç†ã€‚ 2017-09-21 13:22:30.307 ERROR 27838 --- [rix-sbc-order-1] c.c.o.f.f.OrderServiceFallbackFactory : fallback:java.lang.RuntimeException: com.netflix.client.ClientException: Load balancer does not have available server for client: sbc-orderã€‚ Note: fallbackFactoryå’Œfallbackå±žæ€§ä¸å¯å…±ç”¨ã€‚ Hystrixç›‘æŽ§Hystrixè¿˜è‡ªå¸¦äº†ä¸€å¥—ç›‘æŽ§ç»„ä»¶ï¼Œåªè¦ä¾èµ–äº†spring-boot-starter-actuatorå³å¯é€šè¿‡/hystrix.streamç«¯ç‚¹æ¥èŽ·å¾—ç›‘æŽ§ä¿¡æ¯ã€‚ å†°å†·çš„æ•°æ®è‚¯å®šæ²¡æœ‰å®žæ—¶çš„å›¾è¡¨æ¥çš„ç›´è§‚ï¼Œæ‰€ä»¥Hystrixä¹Ÿè‡ªå¸¦Dashboardã€‚ Hystrixä¸ŽTurbineèšåˆç›‘æŽ§ä¸ºæ­¤æˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªåº”ç”¨sbc-hystrix-turbineæ¥æ˜¾ç¤ºhystrix-dashboardã€‚ç›®å½•ç»“æž„å’Œæ™®é€šçš„springbootåº”ç”¨æ²¡æœ‰å·®å¼‚ï¼Œçœ‹çœ‹ä¸»ç±»: 1234567891011//å¼€å¯EnableTurbine@EnableTurbine@SpringBootApplication@EnableHystrixDashboardpublic class SbcHystrixTurbineApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SbcHystrixTurbineApplication.class, args); &#125;&#125; å…¶ä¸­ä½¿ç”¨@EnableHystrixDashboardå¼€å¯Dashboard @EnableTurbineå¼€å¯Turbineæ”¯æŒã€‚ ä»¥ä¸Šè¿™äº›æ³¨è§£éœ€è¦ä»¥ä¸‹è¿™äº›ä¾èµ–:12345678910111213141516&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-turbine&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-netflix-turbine&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-hystrix-dashboard&lt;/artifactId&gt;&lt;/dependency&gt; å®žé™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬çš„åº”ç”¨éƒ½æ˜¯å¤šèŠ‚ç‚¹éƒ¨ç½²ä»¥è¾¾åˆ°é«˜å¯ç”¨çš„ç›®çš„ï¼Œå•ä¸ªç›‘æŽ§æ˜¾ç„¶ä¸çŽ°å®žï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨Turbineæ¥è¿›è¡Œèšåˆç›‘æŽ§ã€‚ å…³é”®çš„application.propertiesé…ç½®æ–‡ä»¶: 123456789101112# é¡¹ç›®é…ç½®spring.application.name=sbc-hystrix-trubineserver.context-path=/server.port=8282# eurekaåœ°å€eureka.client.serviceUrl.defaultZone=http://node1:8888/eureka/eureka.instance.prefer-ip-address=true# éœ€è¦åŠ å…¥çš„å®žä¾‹turbine.appConfig=sbc-user,sbc-orderturbine.cluster-name-expression=&quot;default&quot; å…¶ä¸­turbine.appConfigé…ç½®æˆ‘ä»¬éœ€è¦ç›‘æŽ§çš„åº”ç”¨ï¼Œè¿™æ ·å½“å¤šèŠ‚ç‚¹éƒ¨ç½²çš„æ—¶å€™å°±éžå¸¸æ–¹ä¾¿äº†(åŒä¸€ä¸ªåº”ç”¨çš„å¤šä¸ªèŠ‚ç‚¹spring.application.nameå€¼æ˜¯ç›¸åŒçš„)ã€‚ å°†è¯¥åº”ç”¨å¯åŠ¨è®¿é—®http://ip:port/hystrix.streamï¼š ç”±äºŽæˆ‘ä»¬çš„turbineå’ŒDashboardæ˜¯ä¸€ä¸ªåº”ç”¨æ‰€ä»¥è¾“å…¥http://localhost:8282/turbine.streamå³å¯ã€‚ è¯¦ç»†æŒ‡æ ‡å¦‚å®˜æ–¹æè¿°: é€šè¿‡è¯¥é¢æ¿æˆ‘ä»¬å°±å¯ä»¥åŠæ—¶çš„äº†è§£åˆ°åº”ç”¨å½“å‰çš„å„ä¸ªçŠ¶æ€ï¼Œå¦‚æžœå†åŠ ä¸Šä¸€äº›æŠ¥è­¦æŽªæ–½å°±èƒ½å¸®æˆ‘ä»¬åŠæ—¶çš„å“åº”ç”Ÿäº§é—®é¢˜ã€‚ æ€»ç»“æœåŠ¡å®¹é”™çš„æ•´ä¸ªè¿˜æ˜¯æ¯”è¾ƒå¤§çš„,åšä¸»ä¹Ÿæ˜¯æ‘¸ç€çŸ³å¤´è¿‡æ²³ï¼Œå…³äºŽæœ¬æ¬¡çš„Hystrixåªæ˜¯ä¸€ä¸ªå…¥é—¨ç‰ˆï¼ŒåŽé¢ä¼šæŒç»­åˆ†æžå®ƒçš„çº¿ç¨‹éš”ç¦»ã€ä¿¡å·é‡éš”ç¦»ç­‰åŽŸç†ã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
        <tag>Hystrix</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åå…­) æ›²çº¿æ•‘å›½-Kafkaæ¶ˆè´¹å¼‚å¸¸]]></title>
    <url>%2F2017%2F09%2F05%2FSSM16%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘çº¿ä¸Šé‡åˆ°ä¸€ä¸ªé—®é¢˜:åœ¨æ¶ˆè´¹kafkaæ¶ˆæ¯çš„æ—¶å€™å¦‚æžœé•¿æ—¶é—´(å¤§æ¦‚åŠå¤©åˆ°ä¸€å¤©çš„æ—¶é—´)é˜Ÿåˆ—é‡Œæ²¡æœ‰æ¶ˆæ¯å°±å¯èƒ½å†ä¹Ÿæ¶ˆè´¹ä¸äº†ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜æˆ‘ä»¬åå¤è°ƒè¯•å¤šæ¬¡ã€‚çº¿ä¸‹æ¨¡æ‹Ÿï¼Œè°ƒæ•´ä»£ç ï¼Œä½†è²Œä¼¼è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°åŽŸå› ã€‚ä½†æ˜¯åªè¦é‡å¯æ¶ˆè´¹è¿›ç¨‹å°±åˆå¯ä»¥ç»§ç»­æ¶ˆè´¹ã€‚ è§£å†³æ–¹æ¡ˆç”±äºŽçº¿ä¸Šä¸šåŠ¡éžå¸¸ä¾èµ–kafkaçš„æ¶ˆè´¹ï¼Œä½†ä¸€æ—¶åŠä¼šä¹Ÿæ²¡æœ‰æ‰¾åˆ°åŽŸå› ï¼Œæ‰€ä»¥æœ€åŽåªèƒ½æƒ³ä¸€ä¸ªä¸´æ—¶çš„æ›¿æ¢æ–¹æ¡ˆï¼š åŸºäºŽé‡å¯å°±å¯ä»¥æ¶ˆè´¹è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡æ¶ˆè´¹çš„æ—¶å€™éƒ½è®°ä¸‹å½“å‰çš„æ—¶é—´ç‚¹ï¼Œå½“è¿™ä¸ªæ—¶é—´ç‚¹åœ¨ååˆ†é’Ÿä¹‹å†…éƒ½æ²¡æœ‰æ›´æ–°æˆ‘ä»¬å°±è®¤ä¸ºå½“å‰é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯äº†ï¼Œå°±éœ€è¦é‡å¯ä¸‹æ¶ˆè´¹è¿›ç¨‹ã€‚ æ—¢ç„¶æ˜¯éœ€è¦é‡å¯ï¼Œç”±äºŽç›®å‰è¿˜æ²¡æœ‰ä¸Šåˆ†å¸ƒå¼è°ƒåº¦ä¸­å¿ƒæ‰€ä»¥éœ€è¦crontabæ¥é…åˆè°ƒåº¦ï¼šæ¯éš”ä¸€åˆ†é’Ÿä¼šè°ƒç”¨ä¸€ä¸ªshellè„šæœ¬ï¼Œè¯¥è„šæœ¬ä¼šåˆ¤æ–­å½“å‰è¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æžœå­˜åœ¨åˆ™ä»€ä¹ˆéƒ½ä¸ä½œï¼Œä¸å­˜åœ¨åˆ™å¯åŠ¨æ¶ˆè´¹è¿›ç¨‹ã€‚ å…·ä½“å®žçŽ°æ¶ˆè´¹ç¨‹åº:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106/** * kafkaæ¶ˆè´¹ * * @author crossoverJie * @date 2017å¹´6æœˆ19æ—¥ ä¸‹åˆ3:15:16 */public class KafkaMsgConsumer &#123; private static final Logger LOGGER = LoggerFactory.getLogger(KafkaMsgConsumer.class); private static final int CORE_POOL_SIZE = 4; private static final int MAXIMUM_POOL_SIZE = 4; private static final int BLOCKING_QUEUE_CAPACITY = 4000; private static final String KAFKA_CONFIG = "kafkaConfig"; private static final ExecutorService fixedThreadPool = new ThreadPoolExecutor(CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, 0L, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(BLOCKING_QUEUE_CAPACITY)); //æœ€åŽæ›´æ–°æ—¶é—´ private static AtomicLong LAST_MESSAGE_TIME = new AtomicLong(DateUtil.getLongTime()); private static MsgIterator iter = null; private static String topic;//ä¸»é¢˜åç§° static &#123; Properties properties = new Properties(); String path = System.getProperty(KAFKA_CONFIG); checkArguments(!StringUtils.isBlank(path), "å¯åŠ¨å‚æ•°ä¸­æ²¡æœ‰é…ç½®kafka_easyframe_msgå‚æ•°æ¥æŒ‡å®škafkaå¯åŠ¨å‚æ•°ï¼Œè¯·ä½¿ç”¨-DkafkaConfig=/path/fileName/easyframe-msg.properties"); try &#123; properties.load(new FileInputStream(new File(path))); &#125; catch (IOException e) &#123; LOGGER.error("IOException" ,e); &#125; EasyMsgConfig.setProperties(properties); &#125; private static void iteratorTopic() &#123; if (iter == null) &#123; iter = MsgUtil.consume(topic); &#125; long i = 0L; while (iter.hasNext()) &#123; i++; if (i % 10000 == 0) &#123; LOGGER.info("consume i:" + i); &#125; try &#123; String message = iter.next(); if (StringUtils.isEmpty(message)) &#123; continue; &#125; LAST_MESSAGE_TIME = new AtomicLong(DateUtil.getLongTime()); //å¤„ç†æ¶ˆæ¯ LOGGER.debug("msg = " + JSON.toJSONString(message)); &#125; catch (Exception e) &#123; LOGGER.error("KafkaMsgConsumer err:", e); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e1) &#123; LOGGER.error("Thread InterruptedException", e1); &#125; break; &#125; &#125; &#125; public static void main(String[] args) &#123; topic = System.getProperty("topic"); checkArguments(!StringUtils.isBlank(topic), "system property topic or log_path is must!"); while (true) &#123; try &#123; iteratorTopic(); &#125; catch (Exception e) &#123; MsgUtil.shutdownConsummer(); iter = null; LOGGER.error("KafkaMsgConsumer err:", e); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e1) &#123; LOGGER.error("Thread InterruptedException", e1); &#125; &#125; finally &#123; //æ­¤å¤„å…³é—­ä¹‹åŽï¼Œç”±crontabæ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼ŒæŒ‚æŽ‰çš„è¯ä¼šé‡æ–°æ‹‰èµ·æ¥ if (DateUtil.getLongTime() - LAST_MESSAGE_TIME.get() &gt; 10 * 60) &#123; //10åˆ†é’Ÿ fixedThreadPool.shutdown(); LOGGER.info("çº¿ç¨‹æ± æ˜¯å¦å…³é—­ï¼š" + fixedThreadPool.isShutdown()); try &#123; //å½“å‰çº¿ç¨‹é˜»å¡ž10msåŽï¼ŒåŽ»æ£€æµ‹çº¿ç¨‹æ± æ˜¯å¦ç»ˆæ­¢ï¼Œç»ˆæ­¢åˆ™è¿”å›žtrue while (!fixedThreadPool.awaitTermination(10, TimeUnit.MILLISECONDS)) &#123; LOGGER.info("æ£€æµ‹çº¿ç¨‹æ± æ˜¯å¦ç»ˆæ­¢ï¼š" + fixedThreadPool.isTerminated()); &#125; &#125; catch (InterruptedException e) &#123; LOGGER.error("ç­‰å¾…çº¿ç¨‹æ± å…³é—­é”™è¯¯", e); &#125; LOGGER.info("çº¿ç¨‹æ± æ˜¯å¦ç»ˆæ­¢ï¼š" + fixedThreadPool.isTerminated()); LOGGER.info("in 10 min dont have data break"); break; &#125; &#125; &#125; LOGGER.info("app shutdown"); System.exit(0); &#125;&#125; åœ¨çº¿ä»£ç  éœ€è¦é…åˆä»¥ä¸‹è¿™ä¸ªshellè„šæœ¬è¿è¡Œ: 1234567891011121314151617181920#!/bin/sh#crontab# * * * * * sh /data/schedule/kafka/run-kafka-consumer.sh &gt;&gt;/data/schedule/kafka/run-sms-log.log# å¦‚æžœè¿›ç¨‹å­˜åœ¨å°±ä¸å¯åŠ¨a1=`ps -ef|grep &apos;KafkaMsgConsumer&apos;|grep -v grep|wc -l`if [ $a1 -gt 0 ];then echo &quot;======= `date +&apos;%Y-%m-%d %H:%M:%S&apos;` KafkaMsgConsumer is EXIT...======= &quot; exitfiLANG=&quot;zh_CN.UTF-8&quot;nohup /opt/java/jdk1.7.0_80/bin/java -d64 -Djava.security.egd=file:/dev/./urandom-Djava.ext.dirs=/opt/tomcat/webapps/ROOT/WEB-INF/lib-Dtopic=TOPIC_A-Dlogback.configurationFile=/data/schedule/kafka/logback.xml-DkafkaConfig=/opt/tomcat/iopconf/easyframe-msg.properties-classpath /opt/tomcat/webapps/ROOT/WEB-INF/classes com.crossoverJie.kafka.SMSMsgConsumer &gt;&gt; /data/schedule/kafka/smslog/kafka.log 2&gt;&amp;1 &amp;echo &quot;`date +&apos;%Y-%m-%d %H:%M:%S&apos;` KafkaMsgConsumer running....&quot; åœ¨çº¿ä»£ç  å†é…åˆcrontabçš„è°ƒåº¦:1* * * * * sh /data/schedule/kafka/run-kafka-consumer.sh &gt;&gt;/data/schedule/kafka/run-sms-log.log å³å¯ã€‚ æ€»ç»“è™½è¯´å¤„ç†èµ·æ¥å¾ˆç®€å•ï¼Œä½†ä¾ç„¶æ˜¯æ²»æ ‡ä¸æ²»æœ¬ï¼Œä¾èµ–çš„ä¸œè¥¿æ¯”è¾ƒå¤š(shellè„šæœ¬ï¼Œè°ƒåº¦)ã€‚æ‰€ä»¥ä¹Ÿé—®é—®å„ä½æœ‰æ²¡æœ‰ä»€ä¹ˆæ€è·¯ï¼š æ¶ˆè´¹ç¨‹åºç”¨çš„:https://github.com/linzhaoming/easyframe-msg ç”Ÿäº§é…ç½®: ä¸‰å°kafkaã€ZKç»„æˆçš„é›†ç¾¤ã€‚ å…¶ä¸­ä¹Ÿæœ‰å…¶ä»–å›¢é˜Ÿçš„æ¶ˆè´¹ç¨‹åºåœ¨æ­£å¸¸è¿è¡Œï¼Œåº”è¯¥å’Œkafkaçš„é…ç½®æ²¡æœ‰å…³ç³»ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Kafka</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(å››)åº”ç”¨é™æµ]]></title>
    <url>%2F2017%2F08%2F11%2Fsbc4%2F</url>
    <content type="text"><![CDATA[å‰è¨€ åœ¨ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿä¸­å¯¹æµé‡çš„æŠŠæŽ§æ˜¯éžå¸¸é‡è¦çš„ï¼Œå½“å·¨å¤§çš„æµé‡ç›´æŽ¥è¯·æ±‚åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šæ²¡å¤šä¹…å°±å¯èƒ½é€ æˆæŽ¥å£ä¸å¯ç”¨ï¼Œä¸å¤„ç†çš„è¯ç”šè‡³ä¼šé€ æˆæ•´ä¸ªåº”ç”¨ä¸å¯ç”¨ã€‚ æ¯”å¦‚æœ€è¿‘å°±æœ‰ä¸ªè¿™æ ·çš„éœ€æ±‚ï¼Œæˆ‘ä½œä¸ºå®¢æˆ·ç«¯è¦å‘kafkaç”Ÿäº§æ•°æ®ï¼Œè€Œkafkaçš„æ¶ˆè´¹è€…åˆ™å†æºæºä¸æ–­çš„æ¶ˆè´¹æ•°æ®ï¼Œå¹¶å°†æ¶ˆè´¹çš„æ•°æ®å…¨éƒ¨è¯·æ±‚åˆ°webæœåŠ¡å™¨ï¼Œè™½è¯´åšäº†è´Ÿè½½(æœ‰4å°webæœåŠ¡å™¨)ä½†ä¸šåŠ¡æ•°æ®çš„é‡ä¹Ÿæ˜¯å·¨å¤§çš„ï¼Œæ¯ç§’é’Ÿå¯èƒ½æœ‰ä¸Šä¸‡æ¡æ•°æ®äº§ç”Ÿã€‚å¦‚æžœç”Ÿäº§è€…ç›´æŽ¥ç”Ÿäº§æ•°æ®çš„è¯æžæœ‰å¯èƒ½æŠŠwebæœåŠ¡å™¨æ‹–åž®ã€‚ å¯¹æ­¤å°±å¿…é¡»è¦åšé™æµå¤„ç†ï¼Œæ¯ç§’é’Ÿç”Ÿäº§ä¸€å®šé™é¢çš„æ•°æ®åˆ°kafkaï¼Œè¿™æ ·å°±èƒ½æžå¤§ç¨‹åº¦çš„ä¿è¯webçš„æ­£å¸¸è¿è½¬ã€‚ å…¶å®žä¸ç®¡å¤„ç†ä½•ç§åœºæ™¯ï¼Œæœ¬è´¨éƒ½æ˜¯é™ä½Žæµé‡ä¿è¯åº”ç”¨çš„é«˜å¯ç”¨ã€‚ å¸¸è§ç®—æ³•å¯¹äºŽé™æµå¸¸è§æœ‰ä¸¤ç§ç®—æ³•: æ¼æ¡¶ç®—æ³• ä»¤ç‰Œæ¡¶ç®—æ³• æ¼æ¡¶ç®—æ³•æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†æµé‡æ”¾å…¥æ¡¶ä¸­ï¼Œæ¼æ¡¶åŒæ—¶ä¹ŸæŒ‰ç…§ä¸€å®šçš„é€ŸçŽ‡æµå‡ºï¼Œå¦‚æžœæµé‡è¿‡å¿«çš„è¯å°±ä¼šæº¢å‡º(æ¼æ¡¶å¹¶ä¸ä¼šæé«˜æµå‡ºé€ŸçŽ‡)ã€‚æº¢å‡ºçš„æµé‡åˆ™ç›´æŽ¥ä¸¢å¼ƒã€‚ å¦‚ä¸‹å›¾æ‰€ç¤º: è¿™ç§åšæ³•ç®€å•ç²—æš´ã€‚ æ¼æ¡¶ç®—æ³•è™½è¯´ç®€å•ï¼Œä½†å´ä¸èƒ½åº”å¯¹å®žé™…åœºæ™¯ï¼Œæ¯”å¦‚çªç„¶æš´å¢žçš„æµé‡ã€‚ è¿™æ—¶å°±éœ€è¦ç”¨åˆ°ä»¤ç‰Œæ¡¶ç®—æ³•: ä»¤ç‰Œæ¡¶ä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€ŸçŽ‡å‘å›ºå®šå®¹é‡å¤§å°æ¡¶ä¸­æ”¾å…¥ä»¤ç‰Œï¼Œå½“æœ‰æµé‡æ¥æ—¶åˆ™å–èµ°ä¸€ä¸ªæˆ–å¤šä¸ªä»¤ç‰Œã€‚å½“æ¡¶ä¸­æ²¡æœ‰ä»¤ç‰Œåˆ™å°†å½“å‰è¯·æ±‚ä¸¢å¼ƒæˆ–é˜»å¡žã€‚ ç›¸æ¯”ä¹‹ä¸‹ä»¤ç‰Œæ¡¶å¯ä»¥åº”å¯¹ä¸€å®šçš„çªå‘æµé‡. RateLimiterå®žçŽ°å¯¹äºŽä»¤ç‰Œæ¡¶çš„ä»£ç å®žçŽ°ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨GuavaåŒ…ä¸­çš„RateLimiterã€‚ 12345678910111213141516171819202122232425@Overridepublic BaseResponse&lt;UserResVO&gt; getUserByFeignBatch(@RequestBody UserReqVO userReqVO) &#123; //è°ƒç”¨è¿œç¨‹æœåŠ¡ OrderNoReqVO vo = new OrderNoReqVO() ; vo.setReqNo(userReqVO.getReqNo()); RateLimiter limiter = RateLimiter.create(2.0) ; //æ‰¹é‡è°ƒç”¨ for (int i = 0 ;i&lt; 10 ; i++)&#123; double acquire = limiter.acquire(); logger.debug("èŽ·å–ä»¤ç‰ŒæˆåŠŸ!,æ¶ˆè€—=" + acquire); BaseResponse&lt;OrderNoResVO&gt; orderNo = orderServiceClient.getOrderNo(vo); logger.debug("è¿œç¨‹è¿”å›ž:"+JSON.toJSONString(orderNo)); &#125; UserRes userRes = new UserRes() ; userRes.setUserId(123); userRes.setUserName("å¼ ä¸‰"); userRes.setReqNo(userReqVO.getReqNo()); userRes.setCode(StatusEnum.SUCCESS.getCode()); userRes.setMessage("æˆåŠŸ"); return userRes ;&#125; è¯¦è§æ­¤ã€‚ è°ƒç”¨ç»“æžœå¦‚ä¸‹: ä»£ç å¯ä»¥çœ‹å‡ºä»¥æ¯ç§’å‘æ¡¶ä¸­æ”¾å…¥ä¸¤ä¸ªä»¤ç‰Œï¼Œè¯·æ±‚ä¸€æ¬¡æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œã€‚æ‰€ä»¥æ¯ç§’é’Ÿåªèƒ½å‘é€ä¸¤ä¸ªè¯·æ±‚ã€‚æŒ‰ç…§å›¾ä¸­çš„æ—¶é—´æ¥çœ‹ä¹Ÿç¡®å®žå¦‚æ­¤(è¿”å›žå€¼æ˜¯èŽ·å–æ­¤ä»¤ç‰Œæ‰€æ¶ˆè€—çš„æ—¶é—´ï¼Œå·®ä¸å¤šä¹Ÿæ˜¯æ¯500msä¸€ä¸ª)ã€‚ ä½¿ç”¨RateLimiteræœ‰å‡ ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹: å…è®¸å…ˆæ¶ˆè´¹ï¼ŒåŽä»˜æ¬¾ï¼Œæ„æ€å°±æ˜¯å®ƒå¯ä»¥æ¥ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ä¸€æ¬¡æ€§å–èµ°å‡ ä¸ªæˆ–è€…æ˜¯å‰©ä¸‹æ‰€æœ‰çš„ä»¤ç‰Œç”šè‡³å¤šå–ï¼Œä½†æ˜¯åŽé¢çš„è¯·æ±‚å°±å¾—ä¸ºä¸Šä¸€æ¬¡è¯·æ±‚ä¹°å•ï¼Œå®ƒéœ€è¦ç­‰å¾…æ¡¶ä¸­çš„ä»¤ç‰Œè¡¥é½ä¹‹åŽæ‰èƒ½ç»§ç»­èŽ·å–ä»¤ç‰Œã€‚ æ€»ç»“é’ˆå¯¹äºŽå•ä¸ªåº”ç”¨çš„é™æµ RateLimiter å¤Ÿç”¨äº†ï¼Œå¦‚æžœæ˜¯åˆ†å¸ƒå¼çŽ¯å¢ƒå¯ä»¥å€ŸåŠ© Redis æ¥å®Œæˆã€‚ æœ€è¿‘ä¹Ÿæ€¼äº†ä¸€ä¸ªï¼Œå¯ä»¥å‚è€ƒã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
        <tag>RateLimiter</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(ä¸‰)è‡ªå®šä¹‰Starter-SpringBooté‡æž„åŽ»é‡æ’ä»¶]]></title>
    <url>%2F2017%2F08%2F01%2Fsbc3%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰çœ‹è¿‡SSM(åå››) åŸºäºŽannotationçš„httpé˜²é‡æ’ä»¶çš„æœ‹å‹åº”è¯¥è®°å¾—æˆ‘åŽæ–‡è¯´è¿‡ä¹‹åŽè¦ç”¨SpringBootæ¥è¿›è¡Œé‡æž„ã€‚ è¿™æ¬¡é‡‡ç”¨è‡ªå®šä¹‰çš„starterçš„æ–¹å¼æ¥è¿›è¡Œé‡æž„ã€‚ å…³äºŽstarter(èµ·æ­¥ä¾èµ–)å…¶å®žåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨SpringBootçš„æ—¶å€™å°±å·²ç»ç”¨åˆ°äº†ï¼Œæ¯”å¦‚å…¶ä¸­çš„: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; æˆ‘ä»¬åªéœ€è¦å¼•å…¥è¿™ä¸€ä¸ªä¾èµ–SpringBootå°±ä¼šæŠŠç›¸å…³çš„ä¾èµ–éƒ½åŠ å…¥è¿›æ¥ï¼Œè‡ªå·±ä¹Ÿä¸éœ€è¦å†åŽ»æ‹…å¿ƒå„ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å…¼å®¹é—®é¢˜(å…·ä½“ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ç”±ä½¿ç”¨çš„spring-boot-starter-parentç‰ˆæœ¬å†³å®š)ï¼Œè¿™äº›SpringBootéƒ½å·²ç»å¸®æˆ‘ä»¬åšå¥½äº†ã€‚ Springè‡ªåŠ¨åŒ–é…ç½®å…ˆåŠ å…¥éœ€è¦çš„ä¸€äº›ä¾èµ–: 123456789101112131415161718192021222324252627282930&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--aopç›¸å…³--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--redisç›¸å…³--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--é…ç½®ç›¸å…³--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;!--é€šç”¨ä¾èµ–--&gt;&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;sbc-common&lt;/artifactId&gt; &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; åˆ›å»ºäº†CheckReqConfé…ç½®ç±»ç”¨äºŽåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨é…ç½®ã€‚å½“ç„¶å‰æè¿˜å¾—åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºMETA-INF/spring.factoriesé…ç½®æ–‡ä»¶ç”¨äºŽæŒ‡å‘å½“å‰ç±»ï¼Œæ‰èƒ½åœ¨åº”ç”¨å¯åŠ¨æ—¶è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚ spring.factories: 12org.springframework.boot.autoconfigure.EnableAutoConfiguration=\com.crossoverJie.request.check.conf.CheckReqConf ä½¿ç”¨æ¡ä»¶åŒ–é…ç½®è¯•ç€è€ƒè™‘ä¸‹å¦‚ä¸‹æƒ…å†µ: å› ä¸ºè¯¥æ’ä»¶æ˜¯ä½¿ç”¨redisæ¥å­˜å‚¨è¯·æ±‚ä¿¡æ¯çš„ï¼Œå¤–éƒ¨å°±ä¾èµ–äº†redisã€‚å¦‚æžœä½¿ç”¨äº†è¯¥æ’ä»¶çš„åº”ç”¨æ²¡æœ‰é…ç½®æˆ–è€…å¿˜äº†é…ç½®redisçš„ä¸€äº›ç›¸å…³è¿žæŽ¥ï¼Œé‚£ä¹ˆåœ¨åº”ç”¨ä½¿ç”¨è¿‡ç¨‹ä¸­è‚¯å®šä¼šå‡ºçŽ°å†™å…¥rediså¼‚å¸¸ã€‚ å¦‚æžœå¼‚å¸¸æ²¡æœ‰æŽ§åˆ¶å¥½çš„è¯è¿˜æœ‰å¯èƒ½å½±å“é¡¹ç›®çš„æ­£å¸¸è¿è¡Œã€‚ é‚£ä¹ˆæ€Žä¹ˆè§£å†³è¿™ä¸ªæƒ…å†µå‘¢ï¼Œå¯ä»¥ä½¿ç”¨Spring4.0æ–°å¢žçš„æ¡ä»¶åŒ–é…ç½®æ¥è§£å†³ã€‚ è§£å†³æ€è·¯æ˜¯:å¯ä»¥ç®€å•çš„é€šè¿‡åˆ¤æ–­åº”ç”¨ä¸­æ˜¯å¦é…ç½®æœ‰spring.redis.hostredisè¿žæŽ¥ï¼Œå¦‚æžœæ²¡æœ‰æˆ‘ä»¬çš„è¿™ä¸ªé…ç½®å°±ä¼šè¢«å¿½ç•¥æŽ‰ã€‚ å®žçŽ°ä»£ç : 1234567891011import org.springframework.context.annotation.ComponentScan;import org.springframework.context.annotation.Conditional;import org.springframework.context.annotation.Configuration;@Configuration@ComponentScan("com.crossoverJie.request.check.interceptor,com.crossoverJie.request.check.properties")//æ˜¯å¦æœ‰redisé…ç½®çš„æ ¡éªŒï¼Œå¦‚æžœæ²¡æœ‰é…ç½®åˆ™ä¸ä¼šåŠ è½½æ”¹é…ç½®ï¼Œä¹Ÿå°±æ˜¯å½“å‰æ’ä»¶å¹¶ä¸ä¼šç”Ÿæ•ˆ@Conditional(CheckReqCondition.class)public class CheckReqConf &#123;&#125; å…·ä½“æ ¡éªŒçš„ä»£ç CheckReqCondition: 12345678910111213141516171819public class CheckReqCondition implements Condition &#123; private static Logger logger = LoggerFactory.getLogger(CheckReqCondition.class); @Override public boolean matches(ConditionContext context, AnnotatedTypeMetadata annotatedTypeMetadata) &#123; //å¦‚æžœæ²¡æœ‰åŠ å…¥redisé…ç½®çš„å°±è¿”å›žfalse String property = context.getEnvironment().getProperty("spring.redis.host"); if (StringUtils.isEmpty(property))&#123; logger.warn("Need to configure redis!"); return false ; &#125;else &#123; return true; &#125; &#125;&#125; åªéœ€è¦å®žçŽ°org.springframework.context.annotation.Conditionå¹¶é‡å†™matches()æ–¹æ³•,å³å¯å®žçŽ°ä¸ªäººé€»è¾‘ã€‚ å¯ä»¥åœ¨ä½¿ç”¨äº†è¯¥ä¾èµ–çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®æˆ–è€…æ˜¯ä¸é…ç½®spring.redis.hostè¿™ä¸ªé…ç½®,æ¥çœ‹æˆ‘ä»¬çš„åˆ‡é¢ç±»(ReqNoDrcAspect)ä¸­53è¡Œçš„æ—¥å¿—æ˜¯å¦æœ‰æ‰“å°æ¥åˆ¤æ–­æ˜¯å¦ç”Ÿæ•ˆã€‚ è¿™æ ·åªæœ‰åœ¨å­˜åœ¨è¯¥keyçš„æƒ…å†µä¸‹æ‰ä¼šåº”ç”¨è¿™ä¸ªé…ç½®ã€‚ å½“ç„¶æœ€å¥½çš„åšæ³•æ˜¯ç›´æŽ¥å°è¯•è¯»ã€å†™redis,çœ‹æ˜¯å¦è¿žæŽ¥ç•…é€šæ¥è¿›è¡Œåˆ¤æ–­ã€‚ AOPåˆ‡é¢æœ€æ ¸å¿ƒçš„å…¶å®žå°±æ˜¯è¿™ä¸ªåˆ‡é¢ç±»ï¼Œé‡Œè¾¹ä¸»è¦é€»è¾‘å’Œä¹‹å‰æ˜¯ä¸€æ¨¡ä¸€æ ·çš„å°±ä¸åœ¨å¤šè¯´,åªæ˜¯è¿™é‡Œåº”ç”¨åˆ°äº†è‡ªå®šä¹‰é…ç½®ã€‚ åˆ‡é¢ç±»ReqNoDrcAspect: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172//åˆ‡é¢æ³¨è§£@Aspect//æ‰«æ@Component//å¼€å¯cglibä»£ç†@EnableAspectJAutoProxy(proxyTargetClass = true)public class ReqNoDrcAspect &#123; private static Logger logger = LoggerFactory.getLogger(ReqNoDrcAspect.class); @Autowired private CheckReqProperties properties ; private String prefixReq ; private long day ; @Autowired private RedisTemplate&lt;String, String&gt; redisTemplate; @PostConstruct public void init() throws Exception &#123; prefixReq = properties.getRedisKey() == null ? "reqNo" : properties.getRedisKey() ; day = properties.getRedisTimeout() == null ? 1L : properties.getRedisTimeout() ; logger.info("sbc-request-check init......"); logger.info(String.format("redis prefix is [%s],timeout is [%s]", prefixReq, day)); &#125; /** * åˆ‡é¢è¯¥æ³¨è§£ */ @Pointcut("@annotation(com.crossoverJie.request.check.anotation.CheckReqNo)") public void checkRepeat()&#123; &#125; @Before("checkRepeat()") public void before(JoinPoint joinPoint) throws Exception &#123; BaseRequest request = getBaseRequest(joinPoint); if(request != null)&#123; final String reqNo = request.getReqNo(); if(StringUtil.isEmpty(reqNo))&#123; throw new SBCException(StatusEnum.REPEAT_REQUEST); &#125;else&#123; try &#123; String tempReqNo = redisTemplate.opsForValue().get(prefixReq +reqNo); logger.debug("tempReqNo=" + tempReqNo); if((StringUtil.isEmpty(tempReqNo)))&#123; redisTemplate.opsForValue().set(prefixReq + reqNo, reqNo, day, TimeUnit.DAYS); &#125;else&#123; throw new SBCException("è¯·æ±‚å·é‡å¤,"+ prefixReq +"=" + reqNo); &#125; &#125; catch (RedisConnectionFailureException e)&#123; logger.error("redisæ“ä½œå¼‚å¸¸",e); throw new SBCException("need redisService") ; &#125; &#125; &#125; &#125; public static BaseRequest getBaseRequest(JoinPoint joinPoint) throws Exception &#123; BaseRequest returnRequest = null; Object[] arguments = joinPoint.getArgs(); if(arguments != null &amp;&amp; arguments.length &gt; 0)&#123; returnRequest = (BaseRequest) arguments[0]; &#125; return returnRequest; &#125;&#125; è¿™é‡Œæˆ‘ä»¬çš„å†™å…¥rediskeyçš„å‰ç¼€å’Œè¿‡æœŸæ—¶é—´æ”¹ä¸ºä»ŽCheckReqPropertiesç±»ä¸­è¯»å–: 12345678910111213141516171819202122232425262728293031@Component//å®šä¹‰é…ç½®å‰ç¼€@ConfigurationProperties(prefix = "sbc.request.check")public class CheckReqProperties &#123; private String redisKey ;//å†™å…¥redisä¸­çš„å‰ç¼€ private Long redisTimeout ;//redisçš„è¿‡æœŸæ—¶é—´ é»˜è®¤æ˜¯å¤© public String getRedisKey() &#123; return redisKey; &#125; public void setRedisKey(String redisKey) &#123; this.redisKey = redisKey; &#125; public Long getRedisTimeout() &#123; return redisTimeout; &#125; public void setRedisTimeout(Long redisTimeout) &#123; this.redisTimeout = redisTimeout; &#125; @Override public String toString() &#123; return "CheckReqProperties&#123;" + "redisKey='" + redisKey + '\'' + ", redisTimeout=" + redisTimeout + '&#125;'; &#125;&#125; è¿™æ ·å¦‚æžœæ˜¯éœ€è¦å¾ˆå¤šé…ç½®çš„æƒ…å†µä¸‹å°±å¯ä»¥å°†å†…å®¹å°è£…åˆ°è¯¥å¯¹è±¡ä¸­ï¼Œæ–¹ä¾¿ç»´æŠ¤å’Œè¯»å–ã€‚ ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦åœ¨è‡ªå·±åº”ç”¨çš„application.propertiesä¸­åŠ å…¥ 123# åŽ»é‡é…ç½®sbc.request.check.redis-key = reqsbc.request.check.redis-timeout= 2 åº”ç”¨æ’ä»¶ä½¿ç”¨æ–¹æ³•ä¹Ÿå’Œä¹‹å‰å·®ä¸å¤š(åœ¨sbc-orderåº”ç”¨)ï¼š åŠ å…¥ä¾èµ–ï¼š 123456&lt;!--é˜²é‡æ’ä»¶--&gt;&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie.request.check&lt;/groupId&gt; &lt;artifactId&gt;request-check&lt;/artifactId&gt; &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; åœ¨æŽ¥å£ä¸ŠåŠ ä¸Šæ³¨è§£: 12345678910111213141516171819202122@RestController@Api(value = "orderApi", description = "è®¢å•API", tags = &#123;"è®¢å•æœåŠ¡"&#125;)public class OrderController implements OrderService&#123; private final static Logger logger = LoggerFactory.getLogger(OrderController.class); @Override @CheckReqNo public BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) &#123; BaseResponse&lt;OrderNoResVO&gt; res = new BaseResponse(); res.setReqNo(orderNoReq.getReqNo()); if (null == orderNoReq.getAppId())&#123; throw new SBCException(StatusEnum.FAIL); &#125; OrderNoResVO orderNoRes = new OrderNoResVO() ; orderNoRes.setOrderId(DateUtil.getLongTime()); res.setCode(StatusEnum.SUCCESS.getCode()); res.setMessage(StatusEnum.SUCCESS.getMessage()); res.setDataBody(orderNoRes); return res ; &#125;&#125; ä½¿ç”¨æ•ˆæžœå¦‚ä¸‹: æ€»ç»“æ³¨æ„ä¸€ç‚¹æ˜¯spring.factoriesçš„è·¯å¾„ä¸è¦æžé”™äº†,ä¹‹å‰å°±æ˜¯å› ä¸ºè·¯å¾„å†™é”™äº†ï¼Œå¯¼è‡´è‡ªåŠ¨é…ç½®æ²¡æœ‰åŠ è½½ï¼ŒAOPä¹Ÿå°±æ²¡æœ‰ç”Ÿæ•ˆï¼ŒæŽ’æŸ¥äº†å¥½ä¹…ã€‚ã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>é‡æž„</tag>
        <tag>AOP</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(äºŒ)é«˜å¯ç”¨Eureka+å£°æ˜Žå¼æœåŠ¡è°ƒç”¨]]></title>
    <url>%2F2017%2F07%2F19%2Fsbc2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ä¸Šä¸€ç¯‡ç®€å•å…¥é—¨äº†SpringBoot+SpringCloud æž„å»ºå¾®æœåŠ¡ã€‚ä½†åªèƒ½ç®—æ˜¯ä¸€ä¸ªdemoçº§åˆ«çš„åº”ç”¨ã€‚è¿™æ¬¡ä¼šæŒ‰ç…§å®žé™…ç”Ÿäº§è¦æ±‚æ¥æ­å»ºè¿™å¥—æœåŠ¡ã€‚ Swaggeråº”ç”¨ä¸Šæ¬¡æåˆ°æˆ‘ä»¬è°ƒç”¨è‡ªå·±çš„httpæŽ¥å£çš„æ—¶å€™é‡‡ç”¨çš„æ˜¯PostManæ¥æ¨¡æ‹Ÿè¯·æ±‚ï¼Œè¿™ä¸ªåœ¨å¹³æ—¶è°ƒè¯•æ—¶è‡ªç„¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†å½“æˆ‘ä»¬éœ€è¦å’Œå‰ç«¯è”è°ƒå¼€å‘çš„æ—¶å€™æ•ˆçŽ‡å°±æ¯”è¾ƒä½Žäº†ã€‚ é€šå¸¸æ¥è¯´çŽ°åœ¨å‰åŽç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸€èˆ¬éƒ½æ˜¯åŽç«¯æŽ¥å£å…ˆè¡Œã€‚ åŽç«¯å¤§å¤§ä»¬å…ˆæŠŠæŽ¥å£å®šä¹‰å¥½(å…¥å‚å’Œå‡ºå‚),å‰ç«¯å¤§å¤§ä»¬æ¥ç¡®å®šæ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œå¯ä»¥äº†ä¹‹åŽåŽç«¯æ‰å¼€å§‹ç€æ‰‹å†™å®žçŽ°ï¼Œè¿™æ ·æ•´ä½“æ•ˆçŽ‡è¦é«˜ä¸Šè®¸å¤šã€‚ ä½†ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜:åœ¨æŽ¥å£å®šä¹‰é˜¶æ®µé¢‘ç¹å˜æ›´æŽ¥å£å®šä¹‰è€Œæ²¡æœ‰ä¸€ä¸ªæ–‡æ¡£æˆ–ç±»ä¼¼çš„ä¸œè¥¿æ¥è®°å½•ï¼Œé‚£ä¹ˆåŒæ–¹çš„æ²Ÿé€šåŠ ä¸Šå‰ç«¯çš„è°ƒè¯•éƒ½æ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚ åŸºäºŽè¿™ä¸ªéœ€æ±‚ç½‘ä¸Šæœ‰å„ç§è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚é˜¿é‡Œçš„rapå°±æ˜¯ä¸€ä¸ªä¸é”™çš„ä¾‹å­ã€‚ ä½†æ˜¯springCouldä¸ºæˆ‘ä»¬åœ¨æä¾›äº†ä¸€ç§åœ¨å¼€å‘springCloudé¡¹ç›®ä¸‹æ›´æ–¹ä¾¿çš„å·¥å…·swaggerã€‚ å®žé™…æ•ˆæžœå¦‚ä¸‹: é…ç½®swaggerä»¥sbc-orderä¸ºä¾‹æˆ‘å°†é¡¹ç›®åˆ†ä¸ºäº†ä¸‰ä¸ªæ¨¡å—: 123456789â”œâ”€â”€ order // OrderæœåŠ¡å®žçŽ° â”‚ â”œâ”€â”€ src/mainâ”œâ”€â”€ order-api // å¯¹å†…APIâ”‚ â”œâ”€â”€ src/mainâ”œâ”€â”€ order-client // å¯¹å¤–çš„clientAPIâ”‚ â”œâ”€â”€ src/mainâ”œâ”€â”€ .gitignore â”œâ”€â”€ LICENSE â”œâ”€â”€ README.md å› ä¸ºå®žçŽ°éƒ½å†™åœ¨orderæ¨¡å—ä¸­ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨è¯¥æ¨¡å—ä¸­é…ç½®å³å¯ã€‚ é¦–å…ˆéœ€è¦åŠ å…¥ä¾èµ–ï¼Œç”±äºŽæˆ‘åœ¨orderæ¨¡å—ä¸­ä¾èµ–äº†: 12345&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;order-api&lt;/artifactId&gt; &lt;version&gt;$&#123;target.version&#125;&lt;/version&gt;&lt;/dependency&gt; order-apiåˆä¾èµ–äº†ï¼š 12345678910&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt; æŽ¥ç€éœ€è¦é…ç½®ä¸€ä¸ªSwaggerConfig 12345678910111213141516171819202122232425262728@Configuration@EnableSwagger2/** æ˜¯å¦æ‰“å¼€swagger **/@ConditionalOnExpression(&quot;&apos;$&#123;swagger.enable&#125;&apos; == &apos;true&apos;&quot;)public class SwaggerConfig &#123; @Bean public Docket createRestApi() &#123; return new Docket(DocumentationType.SWAGGER_2) .apiInfo(apiInfo()) .select() .apis(RequestHandlerSelectors.basePackage(&quot;com.crossoverJie.sbcorder.controller&quot;)) .paths(PathSelectors.any()) .build(); &#125; private ApiInfo apiInfo() &#123; return new ApiInfoBuilder() .title(&quot;sbc order api&quot;) .description(&quot;sbc order api&quot;) .termsOfServiceUrl(&quot;http://crossoverJie.top&quot;) .contact(&quot;crossoverJie&quot;) .version(&quot;1.0.0&quot;) .build(); &#125; &#125; å…¶å®žå°±æ˜¯é…ç½®swaggerçš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ã€‚ä¹‹åŽå¯åŠ¨é¡¹ç›®ï¼Œåœ¨åœ°å€æ è¾“å…¥http://ip:port/swagger-ui.html#/å³å¯è¿›å…¥ã€‚å¯ä»¥çœ‹åˆ°å¦‚ä¸Šå›¾æ‰€ç¤ºçš„æŽ¥å£åˆ—è¡¨,ç‚¹å‡»å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å‚æ•°ä¾‹å­å³å¯è¿›è¡ŒæŽ¥å£è°ƒç”¨ã€‚ è‡ªå®šä¹‰å¼€å…³Swagger swaggerçš„ä¾¿åˆ©èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤šå¥½å¤„ï¼Œä½†ç¨æœ‰ä¸æ…Žä¹Ÿå¯èƒ½å‡ºçŽ°é—®é¢˜ã€‚ æ¯”å¦‚å¦‚æžœåœ¨ç”Ÿäº§çŽ¯å¢ƒè¿˜èƒ½é€šè¿‡IPè®¿é—®swaggerçš„è¯é‚£åŽæžœå¯æ˜¯ä¸å ªè®¾æƒ³çš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦çµæ´»æŽ§åˆ¶swaggerçš„å¼€å…³ã€‚ è¿™ç‚¹å¯ä»¥åˆ©ç”¨springçš„æ¡ä»¶åŒ–é…ç½®(æ¡ä»¶åŒ–é…ç½®å¯ä»¥é…ç½®å­˜åœ¨äºŽåº”ç”¨ä¸­,ä¸€æ—¦æ»¡è¶³ä¸€äº›ç‰¹å®šçš„æ¡ä»¶æ—¶å°±å–æ¶ˆè¿™äº›é…ç½®)æ¥å®žçŽ°è¿™ä¸€åŠŸèƒ½: 1@ConditionalOnExpression("'$&#123;swagger.enable&#125;' == 'true'") è¯¥æ³¨è§£çš„æ„æ€æ˜¯ç»™å®šçš„SpELè¡¨è¾¾å¼è®¡ç®—ç»“æžœä¸ºtrueæ—¶æ‰ä¼šåˆ›å»ºswaggerçš„beanã€‚ swagger.enableè¿™ä¸ªé…ç½®åˆ™æ˜¯é…ç½®åœ¨application.propertiesä¸­: 12# æ˜¯å¦æ‰“å¼€swaggerswagger.enable = true è¿™æ ·å½“æˆ‘ä»¬åœ¨ç”Ÿäº§çŽ¯å¢ƒæ—¶åªéœ€è¦å°†è¯¥é…ç½®æ”¹ä¸ºfalseå³å¯ã€‚ ps:æ›´å¤šspringæ¡ä»¶åŒ–é…ç½®: 123456789101112@ConditionalOnBean //é…ç½®äº†æŸä¸ªç‰¹å®šBean@ConditionalOnMissingBean //æ²¡æœ‰é…ç½®ç‰¹å®šçš„Bean@ConditionalOnClass //Classpathé‡Œæœ‰æŒ‡å®šçš„ç±»@ConditionalOnMissingClass //Classpathé‡Œç¼ºå°‘æŒ‡å®šçš„ç±»@ConditionalOnExpression //ç»™å®šçš„Spring Expression Language(SpEL)è¡¨è¾¾å¼è®¡ç®—ç»“æžœä¸ºtrue@ConditionalOnJava //Javaçš„ç‰ˆæœ¬åŒ¹é…ç‰¹å®šå€¼æˆ–è€…ä¸€ä¸ªèŒƒå›´å€¼@ConditionalOnJndi //å‚æ•°ä¸­ç»™å®šçš„JNDIä½ç½®å¿…é¡»å­˜åœ¨ä¸€ä¸ªï¼Œå¦‚æžœæ²¡æœ‰ç»™å‚æ•°ï¼Œåˆ™è¦æœ‰JNDI InitialContext@ConditionalOnProperty //æŒ‡å®šçš„é…ç½®å±žæ€§è¦æœ‰ä¸€ä¸ªæ˜Žç¡®çš„å€¼@ConditionalOnResource //Classpathé‡Œæœ‰æŒ‡å®šçš„èµ„æº@ConditionalOnWebApplication //è¿™æ˜¯ä¸€ä¸ªWebåº”ç”¨ç¨‹åº@ConditionalOnNotWebApplication //è¿™ä¸æ˜¯ä¸€ä¸ªWebåº”ç”¨ç¨‹åº(å‚è€ƒSpringBootå®žæˆ˜) é«˜å¯ç”¨Eurekaåœ¨ä¸Šä¸€ç¯‡ä¸­æ˜¯ç”¨Eurekaæ¥åšäº†æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œæ‰€æœ‰çš„ç”Ÿäº§è€…éƒ½å¾€å®ƒæ³¨å†ŒæœåŠ¡ï¼Œæ¶ˆè´¹è€…åˆé€šè¿‡å®ƒæ¥èŽ·å–æœåŠ¡ã€‚ ä½†æ˜¯ä¹‹å‰è®²åˆ°çš„éƒ½æ˜¯å•èŠ‚ç‚¹ï¼Œè¿™åœ¨ç”Ÿäº§çŽ¯å¢ƒé£Žé™©å·¨å¤§ï¼Œæˆ‘ä»¬å¿…é¡»åšåˆ°æ³¨å†Œä¸­å¿ƒçš„é«˜å¯ç”¨ï¼Œæ­å»ºEurekaé›†ç¾¤ã€‚ è¿™é‡Œç®€å•èµ·è§å°±æ­å»ºä¸¤ä¸ªEureka,æ€è·¯åˆ™æ˜¯è¿™ä¸¤ä¸ªEurekaéƒ½æŠŠè‡ªå·±å½“æˆåº”ç”¨å‘å¯¹æ–¹æ³¨å†Œï¼Œè¿™æ ·å°±å¯ä»¥æž„æˆä¸€ä¸ªé«˜å¯ç”¨çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚ åœ¨å®žé™…ç”Ÿäº§çŽ¯èŠ‚ä¸­ä¼šæ˜¯æ¯ä¸ªæ³¨å†Œä¸­å¿ƒä¸€å°æœåŠ¡å™¨ï¼Œä¸ºäº†æ¼”ç¤ºèµ·è§ï¼Œæˆ‘å°±åœ¨æœ¬åœ°å¯åŠ¨ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œä½†æ˜¯ç«¯å£ä¸ä¸€æ ·ã€‚ é¦–å…ˆéœ€è¦åœ¨æœ¬åœ°é…ç½®ä¸€ä¸ªhost: 1127.0.0.1 node1 node2 è¿™æ ·ä¸è®ºæ˜¯è®¿é—®node1è¿˜æ˜¯node2éƒ½å¯ä»¥åœ¨æœ¬æœºè°ƒç”¨çš„åˆ°(å½“ç„¶ä¸é…ç½®hostä¹Ÿå¯ä»¥ï¼Œåªæ˜¯éœ€è¦é€šè¿‡IPæ¥è®¿é—®ï¼Œè¿™æ ·çœ‹èµ·æ¥ä¸æ˜¯é‚£ä¹ˆæ˜Žæ˜¾)ã€‚ å¹¶ç»™sbc-serviceæ–°å¢žäº†ä¸¤ä¸ªé…ç½®æ–‡ä»¶: application-node1.properties: 12345678910spring.application.name=sbc-serviceserver.port=8888eureka.instance.hostname=node1## ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±#eureka.client.register-with-eureka=false### ä¸éœ€è¦æ£€ç´¢æœåŠ¡#eureka.client.fetch-registry=falseeureka.client.serviceUrl.defaultZone=http://node2:9999/eureka/ application-node2.properties: 12345678910spring.application.name=sbc-serviceserver.port=9999eureka.instance.hostname=node2## ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±#eureka.client.register-with-eureka=false### ä¸éœ€è¦æ£€ç´¢æœåŠ¡#eureka.client.fetch-registry=falseeureka.client.serviceUrl.defaultZone=http://node1:8888/eureka/ å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯: 12eureka.client.serviceUrl.defaultZone=http://node2:9999/eureka/eureka.client.serviceUrl.defaultZone=http://node1:8888/eureka/ ä¸¤ä¸ªåº”ç”¨äº’ç›¸æ³¨å†Œã€‚ å¯åŠ¨çš„æ—¶å€™æˆ‘ä»¬æŒ‰ç…§:java -jar sbc-service-1.0.0-SNAPSHOT.jar --spring.profiles.active=node1å¯åŠ¨ï¼Œå°±ä¼šæŒ‰ç…§ä¼ å…¥çš„node1æˆ–è€…æ˜¯node2åŽ»è¯»å–application-node1.properties,application-node2.propertiesè¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶(é…ç½®æ–‡ä»¶å¿…é¡»æŒ‰ç…§application-{name}.propertiesçš„æ–¹å¼å‘½å)ã€‚ åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒå¯ä»¥çœ‹åˆ°ä»¥ä¸‹: å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒä»¥åŠäº’ç›¸æ³¨å†Œäº†ã€‚åœ¨æœåŠ¡æ³¨å†Œçš„æ—¶å€™åªéœ€è¦å°†ä¸¤ä¸ªåœ°å€éƒ½åŠ ä¸Šå³å¯:eureka.client.serviceUrl.defaultZone=http://node1:8888/eureka/,http://node2:9999/eureka/ åœ¨æœåŠ¡è°ƒç”¨çš„æ—¶å€™å¯ä»¥å°è¯•å…³é—­å…¶ä¸­ä¸€ä¸ªï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¾ç„¶æ˜¯å¯ä»¥è°ƒç”¨åˆ°æœåŠ¡çš„ã€‚ Feignå£°æ˜Žå¼è°ƒç”¨æŽ¥ä¸‹æ¥è°ˆè°ˆæœåŠ¡è°ƒç”¨ï¼Œä¸Šæ¬¡æåˆ°å¯ä»¥ç”¨ribbonæ¥è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼Œä½†æ˜¯æ˜Žæ˜¾å¾ˆä¸æ–¹ä¾¿ï¼Œä¸å¦‚åƒä¹‹å‰rpcè°ƒç”¨é‚£æ ·ç®€å•ç›´æŽ¥ã€‚ ä¸ºæ­¤è¿™æ¬¡ä½¿ç”¨Feignæ¥è¿›è¡Œå£°æ˜Žå¼è°ƒç”¨ï¼Œå°±åƒè°ƒç”¨ä¸€ä¸ªæ™®é€šæ–¹æ³•é‚£æ ·ç®€å•ã€‚ order-clientç‰‡å¤´è¯´åˆ°æˆ‘å°†åº”ç”¨åˆ†æˆäº†ä¸‰ä¸ªæ¨¡å—orderã€order-apiã€order-clientï¼Œå…¶ä¸­çš„clientæ¨¡å—å°±æ˜¯å…³é”®ã€‚ æ¥çœ‹çœ‹å…¶ä¸­çš„å†…å®¹,åªæœ‰ä¸€ä¸ªæŽ¥å£: 12345678910@RequestMapping(value="/orderService")@FeignClient(name="sbc-order")@RibbonClientpublic interface OrderServiceClient extends OrderService&#123; @ApiOperation("èŽ·å–è®¢å•å·") @RequestMapping(value = "/getOrderNo", method = RequestMethod.POST) BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) ;&#125; @FeignClientè¿™ä¸ªæ³¨è§£è¦æ³¨æ„ä¸‹ï¼Œå…¶ä¸­çš„nameçš„æ˜¯è‡ªå·±åº”ç”¨çš„åº”ç”¨åç§°ï¼Œåœ¨application.propertiesä¸­çš„spring.application.nameé…ç½®ã€‚ å…¶ä¸­ç»§æ‰¿äº†ä¸€ä¸ªOrderServiceåœ¨order-apiæ¨¡å—ä¸­ï¼Œæ¥çœ‹çœ‹order-apiä¸­çš„å†…å®¹ã€‚ order-apiå…¶ä¸­ä¹Ÿåªæœ‰ä¸€ä¸ªæŽ¥å£: 12345678910@RestController@Api("è®¢å•æœåŠ¡API")@RequestMapping(value = "/orderService")@Validatedpublic interface OrderService &#123; @ApiOperation("èŽ·å–è®¢å•å·") @RequestMapping(value = "/getOrderNo", method = RequestMethod.POST) BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) ;&#125; è¿™ä¸ªæŽ¥å£æœ‰ä¸¤ä¸ªç›®çš„ã€‚ ç»™çœŸæ­£çš„controlleræ¥è¿›è¡Œå®žçŽ°ã€‚ ç»™clientæŽ¥å£è¿›è¡Œç»§æ‰¿ã€‚ ç±»å…³ç³»å¦‚ä¸‹: æ³¨è§£è¿™äº›éƒ½æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¸€çœ‹å°±æ‡‚ã€‚ orderorderåˆ™æ˜¯å…·ä½“æŽ¥å£å®žçŽ°çš„æ¨¡å—ï¼Œå°±å’Œå¹³æ—¶å†™controllerä¸€æ ·ã€‚æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨clientè¿›è¡Œå£°æ˜Žå¼è°ƒç”¨: è¿™æ¬¡çœ‹çœ‹sbc-userè¿™ä¸ªé¡¹ç›®ï¼Œåœ¨é‡Œè¾¹è°ƒç”¨äº†sbc-orderçš„æœåŠ¡ã€‚å…¶ä¸­çš„useræ¨¡å—ä¾èµ–äº†order-client: 1234&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;order-client&lt;/artifactId&gt;&lt;/dependency&gt; å…·ä½“è°ƒç”¨: 12345678910111213141516171819202122@Autowiredprivate OrderServiceClient orderServiceClient ;@Overridepublic BaseResponse&lt;UserResVO&gt; getUserByFeign(@RequestBody UserReqVO userReq) &#123; //è°ƒç”¨è¿œç¨‹æœåŠ¡ OrderNoReqVO vo = new OrderNoReqVO() ; vo.setReqNo(userReq.getReqNo()); BaseResponse&lt;OrderNoResVO&gt; orderNo = orderServiceClient.getOrderNo(vo); logger.info("è¿œç¨‹è¿”å›ž:"+JSON.toJSONString(orderNo)); UserRes userRes = new UserRes() ; userRes.setUserId(123); userRes.setUserName("å¼ ä¸‰"); userRes.setReqNo(userReq.getReqNo()); userRes.setCode(StatusEnum.SUCCESS.getCode()); userRes.setMessage("æˆåŠŸ"); return userRes ;&#125; å¯ä»¥çœ‹åˆ°åªéœ€è¦å°†order-clientåŒ…ä¸­çš„OrderæœåŠ¡æ³¨å…¥è¿›æ¥å³å¯ã€‚ åœ¨sbc-clientçš„swaggerä¸­è¿›è¡Œè°ƒç”¨: ç”±äºŽæˆ‘å¹¶æ²¡ä¼ appIdæ‰€ä»¥orderæœåŠ¡è¿”å›žçš„é”™è¯¯ã€‚ æ€»ç»“ å½“ä¸€ä¸ªåº”ç”¨éœ€è¦å¯¹å¤–æš´éœ²æŽ¥å£æ—¶ç€éœ€è¦æŒ‰ç…§ä»¥ä¸Šæ–¹å¼æä¾›ä¸€ä¸ªclientåŒ…æ›´æ¶ˆè´¹è€…ä½¿ç”¨ã€‚ å…¶å®žåº”ç”¨æœ¬èº«ä¹Ÿæ˜¯éœ€è¦åšé«˜å¯ç”¨çš„ï¼Œå’ŒEurekaé«˜å¯ç”¨ä¸€æ ·ï¼Œå†ä¸åŒçš„æœåŠ¡å™¨ä¸Šå†å¯ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å¹¶æ³¨å†Œåˆ°Eurekaé›†ç¾¤ä¸­å³å¯ã€‚ åŽç»­è¿˜ä¼šç»§ç»­è°ˆåˆ°zuulç½‘å…³ï¼Œå®¹é”™ï¼Œæ–­è·¯å™¨ç­‰å†…å®¹ï¼Œæ¬¢è¿Žæ‹ç –è®¨è®ºã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
        <tag>swagger</tag>
        <tag>Eureka</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åäº”) ä¹è§‚é”ä¸Žæ‚²è§‚é”çš„å®žé™…åº”ç”¨]]></title>
    <url>%2F2017%2F07%2F09%2FSSM15%2F</url>
    <content type="text"><![CDATA[å‰è¨€éšç€äº’è”ç½‘çš„å…´èµ·ï¼ŒçŽ°åœ¨ä¸‰é«˜(é«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€é«˜å¹¶å‘)é¡¹ç›®æ˜¯è¶Šæ¥è¶Šæµè¡Œã€‚ æœ¬æ¬¡æ¥è°ˆè°ˆé«˜å¹¶å‘ã€‚é¦–å…ˆå‡è®¾ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼šæ•°æ®åº“ä¸­æœ‰ä¸€æ¡æ•°æ®ï¼Œéœ€è¦èŽ·å–åˆ°å½“å‰çš„å€¼ï¼Œåœ¨å½“å‰å€¼çš„åŸºç¡€ä¸Š+10ï¼Œç„¶åŽå†æ›´æ–°å›žåŽ»ã€‚å¦‚æžœæ­¤æ—¶æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¹¶å‘å¤„ç†ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æ‹¿åˆ°æ•°æ®æ˜¯10ï¼Œ+10=20æ›´æ–°å›žåŽ»ã€‚ç¬¬äºŒä¸ªçº¿ç¨‹åŽŸæœ¬æ˜¯è¦åœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹çš„åŸºç¡€ä¸Šå†+20=40,ç»“æžœç”±äºŽå¹¶å‘è®¿é—®å–åˆ°æ›´æ–°å‰çš„æ•°æ®ä¸º10ï¼Œ+20=30ã€‚ è¿™å°±æ˜¯å…¸åž‹çš„å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¯¼è‡´æ•°æ®ä¸æ­£ç¡®ã€‚æ¥çœ‹ä»¥ä¸‹çš„ä¾‹å­ï¼š å¹¶å‘æ‰€å¸¦æ¥çš„é—®é¢˜å’Œä¸Šæ–‡æåˆ°çš„ç±»ä¼¼ï¼Œè¿™é‡Œæœ‰ä¸€å¼ priceè¡¨ï¼Œè¡¨ç»“æž„å¦‚ä¸‹ï¼š 1234567CREATE TABLE `price` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &apos;ä¸»é”®&apos;, `total` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ€»å€¼&apos;, `front` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ¶ˆè´¹å‰&apos;, `end` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ¶ˆè´¹åŽ&apos;, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=1268 DEFAULT CHARSET=utf8 æˆ‘è¿™é‡Œå†™äº†ä¸€ä¸ªå•æµ‹ï¼šå°±ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œå¾ªçŽ¯100æ¬¡ï¼Œæ¯æ¬¡æŠŠfrontçš„å€¼å‡åŽ»10ï¼Œå†å†™å…¥ä¸€æ¬¡æµæ°´è®°å½•ï¼Œæ­£å¸¸æƒ…å†µæ˜¯å†™å…¥çš„æ¯æ¡è®°å½•éƒ½ä¼šæ¯æ¬¡å‡åŽ»10ã€‚ 12345678910111213141516171819/** * å•çº¿ç¨‹æ¶ˆè´¹ */@Testpublic void singleCounsumerTest1()&#123; for (int i=0 ;i&lt;100 ;i++)&#123; Price price = priceMapper.selectByPrimaryKey(1); int ron = 10 ; price.setFront(price.getFront().subtract(new BigDecimal(ron))); price.setEnd(price.getEnd().add(new BigDecimal(ron))); price.setTotal(price.getFront().add(price.getEnd())); priceMapper.updateByPrimaryKey(price) ; price.setId(null); priceMapper.insertSelective(price) ; &#125;&#125; æ‰§è¡Œç»“æžœå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ç¡®å®žæ˜¯æ¯æ¬¡éƒ½é€’å‡10ã€‚ ä½†æ˜¯å¦‚æžœæ˜¯å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä¼šæ˜¯å¦‚ä½•å‘¢ï¼š æˆ‘è¿™é‡Œæ–°å»ºäº†ä¸€ä¸ªPriceController 1234567891011121314151617181920212223242526272829303132333435363738394041424344 /** * çº¿ç¨‹æ±  æ— é” * @param redisContentReq * @return */@RequestMapping(value = "/threadPrice",method = RequestMethod.POST)@ResponseBodypublic BaseResponse&lt;NULLBody&gt; threadPrice(@RequestBody RedisContentReq redisContentReq)&#123; BaseResponse&lt;NULLBody&gt; response = new BaseResponse&lt;NULLBody&gt;() ; try &#123; for (int i=0 ;i&lt;10 ;i++)&#123; Thread t = new Thread(new Runnable() &#123; @Override public void run() &#123; Price price = priceMapper.selectByPrimaryKey(1); int ron = 10 ; price.setFront(price.getFront().subtract(new BigDecimal(ron))); price.setEnd(price.getEnd().add(new BigDecimal(ron))); priceMapper.updateByPrimaryKey(price) ; price.setId(null); priceMapper.insertSelective(price) ; &#125; &#125;); config.submit(t); &#125; response.setReqNo(redisContentReq.getReqNo()); response.setCode(StatusEnum.SUCCESS.getCode()); response.setMessage(StatusEnum.SUCCESS.getMessage()); &#125;catch (Exception e)&#123; logger.error("system error",e); response.setReqNo(response.getReqNo()); response.setCode(StatusEnum.FAIL.getCode()); response.setMessage(StatusEnum.FAIL.getMessage()); &#125; return response ;&#125; å…¶ä¸­ä¸ºäº†èŠ‚çœèµ„æºä½¿ç”¨äº†ä¸€ä¸ªçº¿ç¨‹æ± : 1234567891011121314151617@Componentpublic class ThreadPoolConfig &#123; private static final int MAX_SIZE = 10 ; private static final int CORE_SIZE = 5; private static final int SECOND = 1000; private ThreadPoolExecutor executor ; public ThreadPoolConfig()&#123; executor = new ThreadPoolExecutor(CORE_SIZE,MAX_SIZE,SECOND, TimeUnit.MICROSECONDS,new LinkedBlockingQueue&lt;Runnable&gt;()) ; &#125; public void submit(Thread thread)&#123; executor.submit(thread) ; &#125;&#125; å…³äºŽçº¿ç¨‹æ± çš„ä½¿ç”¨ä»ŠåŽä¼šä»”ç»†æŽ¢è®¨ã€‚è¿™é‡Œå°±ç®€å•ç†è§£ä¸ºæœ‰10ä¸ªçº¿ç¨‹å¹¶å‘åŽ»å¤„ç†ä¸Šé¢å•çº¿ç¨‹çš„é€»è¾‘ï¼Œæ¥çœ‹çœ‹ç»“æžœæ€Žä¹ˆæ ·ï¼š ä¼šçœ‹åˆ°æ˜Žæ˜¾çš„æ•°æ®é”™è¯¯ï¼Œå¯¼è‡´é”™è¯¯çš„åŽŸå› è‡ªç„¶å°±æ˜¯æœ‰çº¿ç¨‹è¯»å–åˆ°äº†ä¸­é—´çŠ¶æ€è¿›è¡Œäº†é”™è¯¯çš„æ›´æ–°ã€‚ è¿›è€Œæœ‰äº†ä»¥ä¸‹ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šæ‚²è§‚é”å’Œä¹è§‚é”ã€‚ æ‚²è§‚é”ç®€å•ç†è§£ä¸‹æ‚²è§‚é”ï¼šå½“ä¸€ä¸ªäº‹åŠ¡é”å®šäº†ä¸€äº›æ•°æ®ä¹‹åŽï¼Œåªæœ‰å½“å½“å‰é”æäº¤äº†äº‹åŠ¡ï¼Œé‡Šæ”¾äº†é”ï¼Œå…¶ä»–äº‹åŠ¡æ‰èƒ½èŽ·å¾—é”å¹¶æ‰§è¡Œæ“ä½œã€‚ ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼šé¦–å…ˆè¦å…³é—­MySQLçš„è‡ªåŠ¨æäº¤ï¼šset autocommit = 0; 123456bigen --å¼€å¯äº‹åŠ¡select id, total, front, end from price where id=1 for update insert into price values(?,?,?,?,?)commit --æäº¤äº‹åŠ¡ è¿™é‡Œä½¿ç”¨select for updateçš„æ–¹å¼åˆ©ç”¨æ•°æ®åº“å¼€å¯äº†æ‚²è§‚é”ï¼Œé”å®šäº†id=1çš„è¿™æ¡æ•°æ®(æ³¨æ„:è¿™é‡Œé™¤éžæ˜¯ä½¿ç”¨äº†ç´¢å¼•ä¼šå¯ç”¨è¡Œçº§é”ï¼Œä¸ç„¶æ˜¯ä¼šä½¿ç”¨è¡¨é”ï¼Œå°†æ•´å¼ è¡¨éƒ½é”ä½ã€‚)ã€‚ä¹‹åŽä½¿ç”¨commitæäº¤äº‹åŠ¡å¹¶é‡Šæ”¾é”ï¼Œè¿™æ ·ä¸‹ä¸€ä¸ªçº¿ç¨‹è¿‡æ¥æ‹¿åˆ°çš„å°±æ˜¯æ­£ç¡®çš„æ•°æ®ã€‚ æ‚²è§‚é”ä¸€èˆ¬æ˜¯ç”¨äºŽå¹¶å‘ä¸æ˜¯å¾ˆé«˜ï¼Œå¹¶ä¸”ä¸å…è®¸è„è¯»ç­‰æƒ…å†µã€‚ä½†æ˜¯å¯¹æ•°æ®åº“èµ„æºæ¶ˆè€—è¾ƒå¤§ã€‚ ä¹è§‚é”é‚£ä¹ˆæœ‰æ²¡æœ‰æ€§èƒ½å¥½ï¼Œæ”¯æŒçš„å¹¶å‘ä¹Ÿæ›´å¤šçš„æ–¹å¼å‘¢ï¼Ÿ é‚£å°±æ˜¯ä¹è§‚é”ã€‚ ä¹è§‚é”æ˜¯é¦–å…ˆå‡è®¾æ•°æ®å†²çªå¾ˆå°‘ï¼Œåªæœ‰åœ¨æ•°æ®æäº¤ä¿®æ”¹çš„æ—¶å€™æ‰è¿›è¡Œæ ¡éªŒï¼Œå¦‚æžœå†²çªäº†åˆ™ä¸ä¼šè¿›è¡Œæ›´æ–°ã€‚ é€šå¸¸çš„å®žçŽ°æ–¹å¼å¢žåŠ ä¸€ä¸ªversionå­—æ®µï¼Œä¸ºæ¯ä¸€æ¡æ•°æ®åŠ ä¸Šç‰ˆæœ¬ã€‚æ¯æ¬¡æ›´æ–°çš„æ—¶å€™version+1ï¼Œå¹¶ä¸”æ›´æ–°æ—¶å€™å¸¦ä¸Šç‰ˆæœ¬å·ã€‚å®žçŽ°æ–¹å¼å¦‚ä¸‹ï¼š æ–°å»ºäº†ä¸€å¼ price_versionè¡¨ï¼š 12345678CREATE TABLE `price_version` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &apos;ä¸»é”®&apos;, `total` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ€»å€¼&apos;, `front` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ¶ˆè´¹å‰&apos;, `end` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ¶ˆè´¹åŽ&apos;, `version` int(11) DEFAULT &apos;0&apos; COMMENT &apos;å¹¶å‘ç‰ˆæœ¬æŽ§åˆ¶&apos;, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=1268 DEFAULT CHARSET=utf8 æ›´æ–°æ•°æ®çš„SQLï¼š 1234567&lt;update id="updateByVersion" parameterType="com.crossoverJie.pojo.PriceVersion"&gt; UPDATE price_version SET front = #&#123;front,jdbcType=DECIMAL&#125;, version= version + 1 WHERE id = #&#123;id,jdbcType=INTEGER&#125; AND version = #&#123;version,jdbcType=INTEGER&#125; &lt;/update&gt; è°ƒç”¨æ–¹å¼ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647/** * çº¿ç¨‹æ± ï¼Œä¹è§‚é” * @param redisContentReq * @return */@RequestMapping(value = "/threadPriceVersion",method = RequestMethod.POST)@ResponseBodypublic BaseResponse&lt;NULLBody&gt; threadPriceVersion(@RequestBody RedisContentReq redisContentReq)&#123; BaseResponse&lt;NULLBody&gt; response = new BaseResponse&lt;NULLBody&gt;() ; try &#123; for (int i=0 ;i&lt;3 ;i++)&#123; Thread t = new Thread(new Runnable() &#123; @Override public void run() &#123; PriceVersion priceVersion = priceVersionMapper.selectByPrimaryKey(1); int ron = new Random().nextInt(20); logger.info("æœ¬æ¬¡æ¶ˆè´¹="+ron); priceVersion.setFront(new BigDecimal(ron)); int count = priceVersionMapper.updateByVersion(priceVersion); if (count == 0)&#123; logger.error("æ›´æ–°å¤±è´¥"); &#125;else &#123; logger.info("æ›´æ–°æˆåŠŸ"); &#125; &#125; &#125;); config.submit(t); &#125; response.setReqNo(redisContentReq.getReqNo()); response.setCode(StatusEnum.SUCCESS.getCode()); response.setMessage(StatusEnum.SUCCESS.getMessage()); &#125;catch (Exception e)&#123; logger.error("system error",e); response.setReqNo(response.getReqNo()); response.setCode(StatusEnum.FAIL.getCode()); response.setMessage(StatusEnum.FAIL.getMessage()); &#125; return response ;&#125; å¤„ç†é€»è¾‘ï¼šå¼€äº†ä¸‰ä¸ªçº¿ç¨‹ç”Ÿæˆäº†20ä»¥å†…çš„éšæœºæ•°æ›´æ–°åˆ°frontå­—æ®µã€‚ å½“è°ƒç”¨è¯¥æŽ¥å£æ—¶æ—¥å¿—å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°çº¿ç¨‹1ã€4ã€5åˆ†åˆ«ç”Ÿæˆäº†15ï¼Œ2ï¼Œ11ä¸‰ä¸ªéšæœºæ•°ã€‚æœ€åŽçº¿ç¨‹4ã€5éƒ½æ›´æ–°å¤±è´¥äº†ï¼Œåªæœ‰çº¿ç¨‹1æ›´æ–°æˆåŠŸäº†ã€‚ æŸ¥çœ‹æ•°æ®åº“ï¼š å‘çŽ°ä¹Ÿç¡®å®žæ˜¯æ›´æ–°çš„15ã€‚ ä¹è§‚é”åœ¨å®žé™…åº”ç”¨ç›¸å¯¹è¾ƒå¤šï¼Œå®ƒå¯ä»¥æä¾›æ›´å¥½çš„å¹¶å‘è®¿é—®ï¼Œå¹¶ä¸”æ•°æ®åº“å¼€é”€è¾ƒå°‘ï¼Œä½†æ˜¯æœ‰å¯èƒ½å­˜åœ¨è„è¯»çš„æƒ…å†µã€‚ æ€»ç»“ä»¥ä¸Šä¸¤ç§å„æœ‰ä¼˜åŠ£ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯æ¥åˆ¤æ–­å…·ä½“ä½¿ç”¨å“ªç§æ–¹å¼æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>lock</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(ä¸€)SpringBoot+SpringCloudåˆæŽ¢]]></title>
    <url>%2F2017%2F06%2F15%2Fsbc1%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ‰çœ‹è¿‡æˆ‘ä¹‹å‰çš„SSMç³»åˆ—çš„æœ‹å‹åº”è¯¥æœ‰ä¸€ç‚¹å°è±¡æ˜¯éžå¸¸æ·±åˆ»çš„ã€‚ é‚£å°±æ˜¯éœ€è¦é…ç½®çš„é…ç½®æ–‡ä»¶éžå¸¸å¤šï¼Œä»€ä¹ˆSpringã€mybatisã€redisã€mqä¹‹ç±»çš„é…ç½®æ–‡ä»¶éžå¸¸å¤šï¼Œå¹¶ä¸”è¿˜å­˜åœ¨å„ç§ç‰ˆæœ¬ï¼Œç”šè‡³æœ‰äº›ç‰ˆæœ¬è¿˜äº’ä¸å…¼å®¹ã€‚å…¶ä¸­æœ‰å¾ˆå¤šå¯èƒ½å°±æ˜¯åˆšå¼€å§‹æ•´åˆçš„æ—¶å€™éœ€è¦é…ç½®ï¼Œä¹‹åŽåŽ‹æ ¹å°±ä¸ä¼šå†åŠ¨äº†ã€‚ é‰´äºŽæ­¤ï¼ŒSpringåˆæŽ¨å‡ºäº†åˆä¸€ç¥žå™¨SpringBoot. å®ƒå¯ä»¥è®©æˆ‘ä»¬æ›´åŠ å¿«é€Ÿçš„å¼€å‘Springåº”ç”¨ï¼Œç”šè‡³åšåˆ°äº†å¼€ç®±å³ç”¨ã€‚ç”±äºŽåœ¨å®žé™…å¼€å‘ä¸­æˆ‘ä»¬ä½¿ç”¨SpringBoot+SpringCloudè¿›è¡Œäº†ä¸€æ®µæ—¶é—´çš„æŒç»­äº¤ä»˜ï¼Œå¹¶åœ¨ç”Ÿäº§çŽ¯å¢ƒå¾—åˆ°äº†éªŒè¯ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸å°‘è¸©å‘çš„åœ°æ–¹ï¼Œå€Ÿæ­¤æœºä¼šå’Œå¤§å®¶åˆ†äº«äº¤æµä¸€ä¸‹ã€‚ æœ¬ç¯‡æˆ‘ä»¬é¦–å…ˆä¼šç”¨åˆ©ç”¨SpringBootæž„å»ºå‡ºä¸€ä¸ªç®€å•çš„REST API.æŽ¥ç€ä¼šåˆ›å»ºå¦ä¸€ä¸ªSpringBooté¡¹ç›®ï¼ŒåŸºäºŽSpringCloudéƒ¨ç½²ï¼Œå¹¶åœ¨ä¸¤ä¸ªåº”ç”¨ä¹‹é—´è¿›è¡Œè°ƒç”¨ã€‚ ä½¿ç”¨SpringBootæž„å»ºREST APIæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Springå®˜æ–¹æä¾›çš„åˆå§‹åŒ–å·¥å…·å¸®æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªåŸºç¡€é¡¹ç›®ï¼šhttp://start.spring.io/,å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¡«å…¥ç›¸åº”ä¿¡æ¯å³å¯ã€‚ç”±äºŽåªæ˜¯è¦å®žçŽ°REST APIæ‰€ä»¥è¿™é‡Œåªéœ€è¦å¼•ç”¨webä¾èµ–å³å¯ã€‚ å°†ç”Ÿæˆå¥½çš„é¡¹ç›®å¯¼å…¥IDE(æˆ‘ä½¿ç”¨çš„æ˜¯idea)ä¸­,ç›®å½•ç»“æž„å¦‚ä¸‹; å…¶ä¸­çš„SbcUserApplicationæ˜¯æ•´ä¸ªåº”ç”¨çš„å…¥å£ã€‚ resource/application.propertiesè¿™é‡Œæ˜¯å­˜æ”¾æ•´ä¸ªåº”ç”¨çš„é…ç½®æ–‡ä»¶ã€‚ å…¶ä¸­çš„staticå’Œtemplatesæ˜¯å­˜æ”¾é™æ€èµ„æºä»¥åŠå‰ç«¯æ¨¡æ¿çš„åœ°æ–¹ï¼Œç”±äºŽæˆ‘ä»¬é‡‡ç”¨äº†å‰åŽç«¯åˆ†ç¦»ï¼Œæ‰€ä»¥è¿™äº›ç›®å½•åŸºæœ¬ä¸Šç”¨ä¸ä¸Šäº†ã€‚ é€šè¿‡è¿è¡ŒSbcUserApplicationç±»çš„mainæ–¹æ³•å¯ä»¥å¯åŠ¨SpringBooté¡¹ç›®ã€‚ æŽ¥ç€åœ¨PostManä¸­è¿›è¡Œè°ƒç”¨ï¼Œçœ‹åˆ°ä»¥ä¸‹ç»“æžœè¡¨æ˜Žå¯åŠ¨æˆåŠŸäº†ï¼š è¿™æ ·ä¸€çœ‹æ˜¯ä¸æ˜¯è¦æ¯”ä¹‹å‰ç”¨Spring+SpringMVCæ¥æ•´åˆè¦æ–¹ä¾¿å¿«æ·å¾ˆå¤šã€‚ åˆ›å»ºå¦ä¸€ä¸ªSpringBooté¡¹ç›®å½“æˆ‘ä»¬çš„é¡¹ç›®é‡‡ç”¨å¾®æœåŠ¡æž„å»ºä¹‹åŽè‡ªç„¶å°±ä¼šè¢«æ‹†åˆ†æˆNå¤šä¸ªç‹¬ç«‹çš„åº”ç”¨ã€‚æ¯”å¦‚ä¸Šæ–‡ä¸­çš„sbc-userç”¨äºŽç”¨æˆ·ç®¡ç†ã€‚è¿™é‡Œå†åˆ›å»ºä¸€ä¸ªsbc-orderç”¨æˆ·ç”Ÿæˆè®¢å•ã€‚ ä¸ºäº†æ–¹ä¾¿ä¹‹åŽçš„ä»£ç å¤ç”¨ï¼Œæˆ‘å°†commonåŒ…ä¸­çš„ä¸€äº›æžšä¸¾å€¼ã€å·¥å…·ç±»å•ç‹¬æåˆ°sbc-commonåº”ç”¨ä¸­äº†ï¼Œè¿™æ ·æœ‰å…¶ä»–åº”ç”¨è¦ä½¿ç”¨è¿™äº›åŸºç¡€ç±»ç›´æŽ¥å¼•å…¥è¿™ä¸ªä¾èµ–å³å¯ã€‚ 12345&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;sbc-common&lt;/artifactId&gt; &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; åˆ›å»ºæ­¥éª¤å’Œä¸Šæ–‡å·®ä¸å¤šï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªorder/getOrderNoçš„æœåŠ¡ï¼Œè°ƒç”¨ç»“æžœå¦‚ä¸‹ï¼š ä¹‹åŽä¼šåˆ©ç”¨SpringCloudæ¥å°†ä¸¤ä¸ªæœåŠ¡å…³è”èµ·æ¥ï¼Œå¹¶å¯ä»¥äº’ç›¸è°ƒç”¨ã€‚ ä½¿ç”¨SpringCloudè¿›è¡Œåˆ†å¸ƒå¼è°ƒç”¨æ­å»ºeurekaæ³¨å†Œä¸­å¿ƒæ—¢ç„¶æ˜¯è¦æ­å»ºå¾®æœåŠ¡é‚£è‡ªç„¶å°‘ä¸äº†æ³¨å†Œä¸­å¿ƒäº†ï¼Œä¹‹å‰è®²çš„dubboé‡‡ç”¨çš„æ˜¯zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼ŒSpringCloudåˆ™é‡‡ç”¨çš„æ˜¯Netflix Eurekaæ¥åšæœåŠ¡çš„æ³¨å†Œä¸Žå‘çŽ°ã€‚ æ–°å»ºä¸€ä¸ªé¡¹ç›®sbc-service,ç›®å½•ç»“æž„å¦‚ä¸‹ï¼š æ ¸å¿ƒçš„pom.xml 123456789101112131415161718192021222324&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-classic&lt;/artifactId&gt; &lt;version&gt;1.2.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt;&lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;Brixton.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/dependencyManagement&gt; éžå¸¸easyï¼Œåªéœ€è¦å¼•å…¥eurekaçš„ä¾èµ–å³å¯ã€‚ç„¶åŽåœ¨å…¥å£ç±»åŠ å…¥ä¸€ä¸ªæ³¨è§£@EnableEurekaServerï¼Œå³å¯å°†è¯¥é¡¹ç›®ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼š 12345678910111213141516171819package com.crossoverJie.service;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;@EnableEurekaServer@SpringBootApplicationpublic class EurekaApplication &#123; private final static Logger logger = LoggerFactory.getLogger(EurekaApplication.class); public static void main(String[] args) &#123; SpringApplication.run(EurekaApplication.class, args); logger.info("SpringBoot Start Success"); &#125;&#125; æŽ¥ç€ä¿®æ”¹é…ç½®æ–‡ä»¶application.properties: 123456789server.port=8888# ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±eureka.client.register-with-eureka=false# ä¸éœ€è¦æ£€ç´¢æœåŠ¡eureka.client.fetch-registry=falseeureka.client.serviceUrl.defaultZone=http://localhost:$&#123;server.port&#125;/eureka/ é…ç½®ä¸€ä¸‹ç«¯å£ä»¥åŠæ³¨å†Œä¸­å¿ƒçš„åœ°å€å³å¯ã€‚ç„¶åŽæŒ‰ç…§æ­£å¸¸å¯åŠ¨springBooté¡¹ç›®ä¸€æ ·å¯åŠ¨å³å¯ã€‚ åœ¨åœ°å€æ è¾“å…¥http://localhost:8888çœ‹åˆ°ä¸€ä¸‹ç•Œé¢ï¼š å½“ç„¶çŽ°åœ¨åœ¨æ³¨å†Œä¸­å¿ƒè¿˜çœ‹ä¸åˆ°ä»»ä½•ä¸€ä¸ªåº”ç”¨ï¼Œä¸‹é¢éœ€è¦å°†ä¸Šæ–‡çš„sbc-user,sbc-orderæ³¨å†Œè¿›æ¥ã€‚ å‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡æä¾›è€…åªéœ€è¦åœ¨application.propertiesé…ç½®æ–‡ä»¶ä¸­åŠ ä¸Šæ³¨å†Œä¸­å¿ƒçš„é…ç½®ï¼š 1eureka.client.serviceUrl.defaultZone=http://localhost:8888/eureka/ å¹¶åœ¨sbc-orderçš„ä¸»ç±»ä¸­åŠ å…¥@EnableDiscoveryClientæ³¨è§£å³å¯å®Œæˆæ³¨å†ŒæœåŠ¡ã€‚ å¯åŠ¨æ³¨å†Œä¸­å¿ƒä»¥åŠåº”ç”¨ï¼Œåœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°ä¸€ä¸‹ç•Œé¢åˆ™æˆåŠŸæ³¨å†Œ: æ¶ˆè´¹æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡æœåŠ¡æ˜¯æ³¨å†Œä¸ŠåŽ»äº†ï¼Œè‡ªç„¶æ˜¯éœ€è¦æ¶ˆè´¹äº†ï¼Œè¿™é‡Œå°±ç®€å•æ¨¡æ‹Ÿäº†åœ¨è°ƒç”¨http://localhost:8080/user/getUserè¿™ä¸ªæŽ¥å£çš„æ—¶å€™getUseræŽ¥å£ä¼šåŽ»è°ƒç”¨orderçš„getOrderæœåŠ¡ã€‚ è¿™é‡Œä¼šç”¨åˆ°å¦ä¸€ä¸ªä¾èµ–: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-ribbon&lt;/artifactId&gt;&lt;/dependency&gt; ä»–å¯ä»¥å¸®æˆ‘ä»¬åšåˆ°å®¢æˆ·ç«¯è´Ÿè½½ï¼Œå…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼š åŠ å…¥ribbonä¾èµ–ã€‚ åœ¨ä¸»ç±»ä¸­å¼€å¯@LoadBalancedå®¢æˆ·ç«¯è´Ÿè½½ã€‚ åˆ›å»ºrestTemplateç±»çš„å®žä¾‹ 12345@Bean @LoadBalanced public RestTemplate restTemplate() &#123; return new RestTemplate(); &#125; ä½¿ç”¨restTemplateè°ƒç”¨è¿œç¨‹æœåŠ¡: 123456789101112131415161718192021222324@Autowired private RestTemplate restTemplate; @RequestMapping(value = "/getUser",method = RequestMethod.POST) public UserRes getUser(@RequestBody UserReq userReq)&#123; OrderNoReq req = new OrderNoReq() ; req.setReqNo("1213"); //è°ƒç”¨è¿œç¨‹æœåŠ¡ ResponseEntity&lt;Object&gt; res = restTemplate.postForEntity("http://sbc-order/order/getOrderNo", req, Object.class); logger.info("res="+JSON.toJSONString(res)); logger.debug("å…¥å‚="+ JSON.toJSONString(userReq)); UserRes userRes = new UserRes() ; userRes.setUserId(123); userRes.setUserName("å¼ ä¸‰"); userRes.setReqNo(userReq.getReqNo()); userRes.setCode(StatusEnum.SUCCESS.getCode()); userRes.setMessage("æˆåŠŸ"); return userRes ; &#125; ç”±äºŽæˆ‘çš„è¿œç¨‹æŽ¥å£æ˜¯post,æ‰€ä»¥ä½¿ç”¨äº†postForEntity()æ–¹æ³•ï¼Œå¦‚æžœæ˜¯getå°±æ¢æˆgetForEntity()å³å¯ã€‚ æ³¨æ„è¿™é‡Œæ˜¯ä½¿ç”¨åº”ç”¨åsbc-order(é…ç½®äºŽsbc-orderçš„application.propertiesä¸­)æ¥è¿›è¡Œè°ƒç”¨çš„ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªIPåœ°å€ã€‚ å¯åŠ¨æ³¨å†Œä¸­å¿ƒã€ä¸¤ä¸ªåº”ç”¨ã€‚ç”¨PostManè°ƒç”¨getUseræŽ¥å£æ—¶æŽ§åˆ¶å°æ‰“å°: 12017-06-27 00:18:04.534 INFO 63252 --- [nio-8080-exec-3] c.c.sbcuser.controller.UserController : res=&#123;&quot;body&quot;:&#123;&quot;code&quot;:&quot;4000&quot;,&quot;message&quot;:&quot;appIDä¸èƒ½ä¸ºç©º&quot;,&quot;reqNo&quot;:&quot;1213&quot;&#125;,&quot;headers&quot;:&#123;&quot;X-Application-Context&quot;:[&quot;sbc-order:8181&quot;],&quot;Content-Type&quot;:[&quot;application/xml;charset=UTF-8&quot;],&quot;Transfer-Encoding&quot;:[&quot;chunked&quot;],&quot;Date&quot;:[&quot;Mon, 26 Jun 2017 16:18:04 GMT&quot;]&#125;,&quot;statusCode&quot;:&quot;OK&quot;,&quot;statusCodeValue&quot;:200&#125; ç”±äºŽå¹¶æ²¡æœ‰ä¼ é€’appIdæ‰€ä»¥orderæœåŠ¡è¿”å›žäº†ä¸€ä¸ªé”™è¯¯ï¼Œä¹Ÿæ­£è¯´æ˜Žæ˜¯è¿œç¨‹è°ƒç”¨åˆ°äº†è¯¥æœåŠ¡ã€‚ æ€»ç»“ ps:è¿™é‡Œåªæ˜¯ç®€å•ä½¿ç”¨äº†ribbonæ¥è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼Œä½†åœ¨å®žé™…çš„å¼€å‘ä¸­è¿˜æ˜¯æ¯”è¾ƒå°‘çš„ä½¿ç”¨è¿™ç§æ–¹å¼æ¥è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œè€Œæ˜¯ä½¿ç”¨Feignè¿›è¡Œå£°æ˜Žå¼è°ƒç”¨ï¼Œå¯ä»¥ç®€åŒ–å®¢æˆ·ç«¯ä»£ç ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼è¯·æŒç»­å…³æ³¨ã€‚ æœ¬æ¬¡ç®—æ˜¯springBoot+springCloudçš„å…¥é—¨ï¼Œè¿˜æœ‰å¾ˆå¤šä¸œè¥¿æ²¡æœ‰è®²åˆ°ï¼Œä¹‹åŽæˆ‘å°†ä¼šæ ¹æ®å®žé™…ä½¿ç”¨çš„ä¸€äº›ç»éªŒç»§ç»­åˆ†äº«SpringCloudè¿™ä¸ªæ–°å…´æ¡†æž¶ã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åå››) åŸºäºŽannotationçš„httpé˜²é‡æ’ä»¶]]></title>
    <url>%2F2017%2F05%2F24%2FSSM14%2F</url>
    <content type="text"><![CDATA[å‰è¨€é’ˆå¯¹äºŽæˆ‘ä»¬çŽ°åœ¨å¸¸ç”¨çš„RESTful APIé€šå¸¸æˆ‘ä»¬éœ€è¦å¯¹è¯·æ±‚è¿›è¡Œå”¯ä¸€æ ‡è¯†ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡éƒ½è¦å¸¦ä¸Šä¸€ä¸ªè¯·æ±‚å·,å¦‚reqNOã€‚ å¯¹äºŽå…¥åº“è¿™ç§æ“ä½œæ•°æ®åº“çš„è¯·æ±‚æˆ‘ä»¬ä¸€èˆ¬è¦ä¿è¯ä»–çš„å”¯ä¸€æ€§ï¼Œä¸€ä¸ªè¯·æ±‚å·é€šå¸¸åªèƒ½ç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬å¯¹è¿™ç§è¯·æ±‚åŠ ä¸Šæ ¡éªŒæœºåˆ¶ã€‚ è¯¥éœ€æ±‚çš„å®žçŽ°æ€è·¯æ˜¯é€šè¿‡è‡ªå®šä¹‰annotationï¼Œåªç»™éœ€è¦è¿›è¡Œæ ¡éªŒçš„æŽ¥å£åŠ ä¸Šæ³¨è§£ã€‚ç„¶åŽé€šè¿‡åˆ‡é¢ä½¿ç”¨äº†æ³¨è§£çš„æŽ¥å£å°†æ¯æ¬¡è¯·æ±‚å·å­˜è¿›Redisï¼Œæ¯æ¬¡éƒ½è¿›è¡Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªè¯·æ±‚å·å³å¯ã€‚ æ¥çœ‹ä¸‹åŠ ä¸Šæœ¬æ¬¡æ’ä»¶çš„å®žé™…æ•ˆæžœï¼š è‡ªå®šä¹‰æ³¨è§£é¦–å…ˆæˆ‘ä»¬è¦è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼š 1234567@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface CheckReqNo &#123; String desc() default "";&#125; (ps:è¿™é‡Œå¹¶ä¸è¿‡å¤šçš„è®²è§£æ³¨è§£ç›¸å…³çš„çŸ¥è¯†)ã€‚ é¦–å…ˆä½¿ç”¨@interfaceæ¥å£°æ˜Žä¸€ä¸ªæ³¨è§£ã€‚æŽ¥ç€åˆ©ç”¨Javaä¸ºæˆ‘ä»¬æä¾›çš„ä¸‰ä¸ªå…ƒæ³¨è§£æ¥å®šä¹‰CheckReqNoæ³¨è§£ã€‚ å…¶ä¸­@Targetè¡¨æ˜Žè¿™ä¸ªæ³¨è§£è¢«ç”¨äºŽä»€ä¹ˆåœ°æ–¹ï¼Œä½¿ç”¨ElementType.METHODè¡¨æ˜Žè¢«åº”ç”¨åˆ°æ–¹æ³•ä¸Šï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–å€¼å¯ä»¥æŸ¥çœ‹java.lang.annotation.ElementTypeè¿™ä¸ªæžšä¸¾ç±»åž‹ã€‚ @Retentionæ³¨è§£è¡¨æ˜Žæˆ‘ä»¬çš„æ³¨è§£åœ¨ä»€ä¹ˆèŒƒå›´å†…æœ‰æ•ˆï¼Œè¿™é‡Œé…ç½®çš„RetentionPolicy.RUNTIMEè¡¨æ˜Žåœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡åå°„æ¥èŽ·å–ã€‚ @Documentedçœ‹å­—é¢æ„æ€åº”è¯¥ä¹Ÿèƒ½çŒœåˆ°æ˜¯ç”¨äºŽç”ŸæˆJavaDocæ–‡æ¡£çš„ã€‚ å…¶ä¸­å®šä¹‰äº†ä¸€ä¸ªdesc()çš„æ–¹æ³•å…¶å®žå¹¶æ²¡æœ‰ç”¨åˆ°ï¼Œä½†å¦‚æžœéœ€è¦åœ¨ä½¿ç”¨æ³¨è§£çš„æ—¶å€™éœ€è¦è‡ªå®šä¹‰ä¸€äº›filed(åŸŸ)çš„éœ€æ±‚å¯ä»¥æŒ‰ç…§è¿™æ ·çš„æ–¹å¼å†™åˆ°è¿™é‡Œï¼Œé€šè¿‡åå°„éƒ½å¯ä»¥èŽ·å–åˆ°å…·ä½“çš„å€¼ã€‚å¦‚ï¼š@CheckReqNo(desc = &quot;abc&quot;)å°±å¯ä»¥èŽ·å–åˆ°&quot;abc&quot;çš„å€¼ã€‚ åˆ‡é¢æ³¨è§£æŒ‰ç…§ä¹‹å‰çš„æƒ³æ³•æ˜¯åœ¨å¯¹æ‰€æœ‰ä½¿ç”¨äº†è¯¥æ³¨è§£çš„æ–¹æ³•è¿›è¡Œåˆ‡é¢ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364@Aspect@Componentpublic class ReqNoDrcAspect &#123; private static Logger logger = LoggerFactory.getLogger(ReqNoDrcAspect.class); @Value("$&#123;redis.prefixReq:reqNo&#125;") private String prefixReq ; @Value("$&#123;redis.day:1&#125;") private long day ; @Autowired private RedisTemplate&lt;String, String&gt; redisTemplate; @PostConstruct public void init() throws Exception &#123; logger.info("SSM-REQUEST-CHECK init......"); &#125; @Pointcut("@annotation(com.crossoverJie.request.anotation.CheckReqNo)") public void checkRepeat()&#123; &#125; @Before("checkRepeat()") public void before(JoinPoint joinPoint) throws Exception &#123; BaseRequest request; request = getBaseRequest(joinPoint); if(request != null)&#123; final String reqNo = request.getReqNo(); if(StringUtil.isEmpty(reqNo))&#123; throw new RuntimeException("reqNoä¸èƒ½ä¸ºç©º"); &#125;else&#123; try &#123; String tempReqNo = redisTemplate.opsForValue().get(prefixReq +reqNo); logger.debug("tempReqNo="+tempReqNo); if((StringUtil.isEmpty(tempReqNo)))&#123; redisTemplate.opsForValue().set(prefixReq + reqNo, reqNo, day, TimeUnit.DAYS); &#125;else&#123; throw new RuntimeException("è¯·æ±‚å·é‡å¤,reqNo="+reqNo); &#125; &#125; catch (RedisConnectionFailureException e)&#123; logger.error("redisæ“ä½œå¼‚å¸¸",e); throw new RuntimeException("need redisService") ; &#125; &#125; &#125; &#125; public static BaseRequest getBaseRequest(JoinPoint joinPoint) throws Exception &#123; BaseRequest returnRequest = null; Object[] arguments = joinPoint.getArgs(); if(arguments != null &amp;&amp; arguments.length &gt; 0)&#123; returnRequest = (BaseRequest) arguments[0]; &#125; return returnRequest; &#125;&#125; ä½¿ç”¨@Aspectæ¥å®šä¹‰äº†ä¸€ä¸ªåˆ‡é¢ã€‚å…¶ä¸­prefixReq,dayåŸŸå¯ä»¥è‡ªå®šä¹‰ç¼“å­˜è¯·æ±‚å·æ—¶çš„keyå‰ç¼€ä»¥åŠç¼“å­˜çš„æ—¶é—´ã€‚ æœ€å…³é”®çš„ä¸€ç‚¹æ˜¯ç”¨@Pointcut(&quot;@annotation(com.crossoverJie.request.anotation.CheckReqNo)&quot;)å®šä¹‰äº†ä¸€ä¸ªåˆ‡å…¥ç‚¹ï¼Œè¿™æ ·æ‰€æœ‰ä½¿ç”¨@CheckReqNoçš„æ³¨è§£éƒ½ä¼šè¢«æ‹¦æˆªã€‚ æŽ¥ä¸‹æ¥çš„é€»è¾‘å°±æ¯”è¾ƒç®€å•äº†ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚ä¹‹å‰è¿›è¡Œæ‹¦æˆªã€‚ å…ˆåŽ»Redisä¸­æŸ¥çœ‹è¿™ä¸ªè¯·æ±‚å·(ps:åå°„èŽ·å–)æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æžœä¸å­˜åœ¨åˆ™é€šè¿‡å¹¶å°†æœ¬æ¬¡çš„è¯·æ±‚å·ç¼“å­˜èµ·æ¥ã€‚å¦‚æžœå­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ ä½¿ç”¨æ³¨è§£å¯ä»¥åœ¨jdbc.propertiesé…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰å‰ç¼€å’Œç¼“å­˜æ—¶é—´ 1234#rediså‰ç¼€redis.prefixReq=reqNo#redisç¼“å­˜æ—¶é—´ é»˜è®¤å•ä½ä¸ºå¤©redis.day=1 ä¸å®šä¹‰ä¹Ÿå¯ä»¥ï¼Œä¼šä½¿ç”¨é»˜è®¤å€¼ã€‚ ç”±äºŽè¯¥æ³¨è§£æ˜¯éœ€è¦åŠ åˆ°controllerå±‚,å› æ­¤æˆ‘ä»¬å¾—ä½¿ç”¨CGLIBä»£ç†ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå‘ï¼Œéœ€è¦å°†å¼€å¯CGLIBçš„é…ç½®é…ç½®åˆ°æˆ‘ä»¬web.xmlä¸­çš„ 1234567891011&lt;!-- Spring MVC servlet --&gt; &lt;servlet&gt; &lt;servlet-name&gt;SpringMVC&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:spring-mvc.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;async-supported&gt;true&lt;/async-supported&gt; &lt;/servlet&gt; è¿™é‡Œæ‰€å®šä¹‰çš„spring-mvc.xmlæ–‡ä»¶ä¸­ï¼Œä¸ç„¶springMVCæ‰€åœ¨çš„å­å®¹å™¨æ˜¯æ— æ³•è¢«çˆ¶å®¹å™¨æ‰€åŠ è½½çš„ã€‚ ä½¿ç”¨å®žä¾‹ï¼š 1234567891011121314151617181920212223@CheckReqNo@RequestMapping(value = "/createRedisContent",method = RequestMethod.POST)@ResponseBodypublic BaseResponse&lt;NULLBody&gt; createRedisContent(@RequestBody RedisContentReq redisContentReq)&#123; BaseResponse&lt;NULLBody&gt; response = new BaseResponse&lt;NULLBody&gt;() ; Rediscontent rediscontent = new Rediscontent() ; try &#123; CommonUtil.setLogValueModelToModel(redisContentReq,rediscontent); rediscontentMapper.insertSelective(rediscontent) ; response.setReqNo(redisContentReq.getReqNo()); response.setCode(StatusEnum.SUCCESS.getCode()); response.setMessage(StatusEnum.SUCCESS.getMessage()); &#125;catch (Exception e)&#123; logger.error("system error",e); response.setReqNo(response.getReqNo()); response.setCode(StatusEnum.FAIL.getCode()); response.setMessage(StatusEnum.FAIL.getMessage()); &#125; return response ;&#125; ç»Ÿä¸€å¼‚å¸¸controller1234567891011121314151617181920212223242526272829/** * * ClassName: ErrorController &lt;br/&gt; * Function: é”™è¯¯å¼‚å¸¸ç»Ÿä¸€å¤„ç†. &lt;br/&gt; * @author crossoverJie * @version * @since JDK 1.7 */@ControllerAdvicepublic class ErrorController &#123; private Logger logger = LoggerFactory.getLogger(this.getClass()); @ExceptionHandler(Exception.class) @ResponseStatus(HttpStatus.OK) @ResponseBody public Object processUnauthenticatedException(NativeWebRequest request, Exception e) &#123; logger.error("è¯·æ±‚å‡ºçŽ°å¼‚å¸¸:", e); BaseResponse&lt;NULLBody&gt; response = new BaseResponse&lt;NULLBody&gt;(); response.setCode(StatusEnum.FAIL.getCode()); if (e instanceof RuntimeException)&#123; response.setMessage(e.getMessage()); &#125; else &#123; response.setMessage(StatusEnum.FAIL.getMessage()); &#125; return response ; &#125;&#125; è¿™æ ·å½“controllerå±‚å‡ºçŽ°å¼‚å¸¸ä¹‹åŽéƒ½ä¼šè¿›å…¥è¿™é‡Œè¿›è¡Œç»Ÿä¸€çš„è¿”å›žã€‚ æ€»ç»“è‡³æ­¤æ•´ä¸ªæ’ä»¶çš„æµç¨‹å·²ç»å…¨éƒ¨OKï¼Œä»Žä¸­å¯ä»¥çœ‹å‡ºSpring AOPåœ¨å®žé™…å¼€å‘ä¸­çš„å„ç§å¥½å¤„ã€‚ä¹‹å‰çš„å‡ ç¯‡æ–‡ç« ä¹Ÿæœ‰åº”ç”¨åˆ°ï¼š åœ¨JavaWebåº”ç”¨ä¸­ä½¿ç”¨Redis åŠ¨æ€åˆ‡æ¢æ•°æ®æº ä¸çŸ¥ä¸è§‰è¿™ä¸ªå°ç™½å…¥é—¨çš„SSMç³»åˆ—å·²ç»æ›´æ–°äº†14ç¯‡äº†ï¼Œåœ¨GitHubä¹Ÿæœ‰äº†500å¤šé¢—æ˜Ÿäº†ï¼ŒæœŸé—´ä¹Ÿå’Œä¸å°‘æœ‹å‹æœ‰è¿‡äº¤æµã€æŽ¢è®¨ï¼Œæ„Ÿè°¢å¤§å®¶çš„æ”¯æŒã€‚ æŽ¥ä¸‹æ¥å¯èƒ½ä¸å¤ªä¼šæ›´æ–°è¿™ä¸ªç³»åˆ—äº†ï¼Œç”±äºŽåšä¸»çŽ°åœ¨æ‰€åœ¨çš„é¡¹ç›®ç»„é‡‡ç”¨çš„æ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„SpringBoot+SpringCloudå’ŒDockerçš„æ–¹å¼æ¥è¿›è¡Œæž¶æž„çš„ï¼Œæ‰€ä»¥ä¹‹åŽçš„é‡å¿ƒè‚¯å®šä¼šç§»åˆ°è¿™æ–¹é¢ï¼Œç”¨è¿‡SpringBootä¹‹åŽç›¸ä¿¡å¤§å®¶è‚¯å®šä¹Ÿå›žä¸åŽ»äº†ã€‚ æ‰€ä»¥ä¹‹åŽæˆ‘ä¼šç»§ç»­æ›´æ–°SpringBoot+SpringCloudç›¸å…³çš„æ–‡ç« ï¼Œæ¬¢è¿ŽæŒç»­å…³æ³¨ï¼ŒæŒç»­æ‹ç –(ps:è¿™ä¸ªæ’ä»¶ä¹Ÿä¼šç”¨springBooté‡å†™ä¸€é) æ’ä»¶åœ°å€ï¼šhttps://github.com/crossoverJie/SSM-REQUEST-CHECK.git é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
        <tag>annotation</tag>
        <tag>AOP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åä¸‰) å°†dubboæš´éœ²å‡ºHTTPæœåŠ¡]]></title>
    <url>%2F2017%2F05%2F07%2FSSM13%2F</url>
    <content type="text"><![CDATA[å‰è¨€é€šå¸¸æ¥è¯´ä¸€ä¸ªdubboæœåŠ¡éƒ½æ˜¯å¯¹å†…ç»™å†…éƒ¨è°ƒç”¨çš„ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½ä¸€ä¸ªæœåŠ¡å°±æ˜¯éœ€è¦æä¾›ç»™å¤–éƒ¨ä½¿ç”¨ï¼Œå¹¶ä¸”è¿˜ä¸èƒ½æœ‰ä½¿ç”¨è¯­è¨€çš„å±€é™æ€§ã€‚ æ¯”è¾ƒæ ‡å‡†çš„åšæ³•æ˜¯å¯¹å¤–çš„æœåŠ¡æˆ‘ä»¬ç»Ÿä¸€æä¾›ä¸€ä¸ªopenAPIï¼Œè¿™æ ·çš„è°ƒç”¨æ–¹éœ€è¦æŒ‰ç…§æ ‡å‡†æä¾›ç›¸åº”çš„appIDä»¥åŠå¯†é’¥æ¥è¿›è¡ŒéªŒç­¾æ‰èƒ½ä½¿ç”¨ã€‚è¿™æ ·å›ºç„¶æ˜¯æ¯”è¾ƒè§„èŒƒå’Œå®‰å…¨ï¼Œä½†å¤æ‚åº¦ä¹Ÿä¸äºšäºŽå¼€å‘ä¸€ä¸ªå•ç‹¬çš„ç³»ç»Ÿäº†ã€‚ è¿™é‡Œæ‰€è®²åˆ°çš„æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œå°±åªæ˜¯æŠŠä¸€ä¸ªä¸éœ€è¦å„ç§æƒé™æ£€éªŒçš„dubboæœåŠ¡å¯¹å¤–æä¾›ä¸ºHTTPæœåŠ¡ã€‚ è°ƒç”¨ç¤ºä¾‹: å‡†å¤‡å·¥ä½œä»¥ä¸‹æ˜¯æœ¬æ–‡æ‰€æ¶‰åŠåˆ°çš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼š Springç›¸å…³çŸ¥è¯†ã€‚ Javaåå°„ç›¸å…³çŸ¥è¯†ã€‚ SpringMVCç›¸å…³çŸ¥è¯†ã€‚ å…¶å®žæ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨SpringMVCæä¾›ä¸€ä¸ªHTTPæŽ¥å£ã€‚åœ¨è¯¥æŽ¥å£ä¸­é€šè¿‡å…¥å‚è¿›è¡Œåå°„æ‰¾åˆ°å…·ä½“çš„dubboæœåŠ¡å®žçŽ°è¿›è¡Œè°ƒç”¨ã€‚ HttpProviderConfé…ç½®ç±»é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªHttpProviderConfç±»ç”¨äºŽä¿å­˜å£°æ˜Žéœ€è¦å¯¹å¤–æä¾›æœåŠ¡çš„åŒ…åï¼Œæ¯•ç«Ÿæˆ‘ä»¬åå°„æ—¶éœ€è¦ç”¨åˆ°ä¸€ä¸ªç±»çš„å…¨é™å®šåï¼š 12345678public class HttpProviderConf &#123; /** * æä¾›httpè®¿é—®çš„åŒ… */ private List&lt;String&gt; usePackage ; //çœç•¥getter setteræ–¹æ³•&#125; å°±åªæœ‰ä¸€ä¸ªusePackageæˆå‘˜å˜é‡ï¼Œç”¨äºŽå­˜æ”¾éœ€è¦åŒ…åã€‚è‡³äºŽç”¨Listçš„åŽŸå› æ˜¯å…è®¸æœ‰å¤šä¸ªã€‚ è¯·æ±‚å“åº”å…¥å‚ã€å‡ºå‚HttpRequestå…¥å‚123456public class HttpRequest &#123; private String param ;//å…¥å‚ private String service ;//è¯·æ±‚service private String method ;//è¯·æ±‚æ–¹æ³• //çœç•¥getter setteræ–¹æ³•&#125; å…¶ä¸­paramæ˜¯ç”¨äºŽå­˜æ”¾çœŸæ­£è°ƒç”¨dubboæœåŠ¡æ—¶çš„å…¥å‚ï¼Œä¼ å…¥jsonåœ¨è°ƒç”¨çš„æ—¶å€™è§£æžæˆå…·ä½“çš„å‚æ•°å¯¹è±¡ã€‚ serviceå­˜æ”¾dubboæœåŠ¡å£°æ˜Žçš„interface APIçš„åŒ…åã€‚ methodåˆ™æ˜¯çœŸæ­£è°ƒç”¨çš„æ–¹æ³•åç§°ã€‚ HttpResponse å“åº”1234567891011public class HttpResponse implements Serializable&#123; private static final long serialVersionUID = -552828440320737814L; private boolean success;//æˆåŠŸæ ‡å¿— private String code;//ä¿¡æ¯ç  private String description;//æè¿° //çœç•¥getter setteræ–¹æ³•&#125; è¿™é‡Œåªæ˜¯å°è£…äº†å¸¸ç”¨çš„HTTPæœåŠ¡çš„å“åº”æ•°æ®ã€‚ æš´éœ²æœåŠ¡controlleræœ€é‡è¦çš„åˆ™æ˜¯controlleré‡Œçš„å®žçŽ°ä»£ç äº†ã€‚ å…ˆè´´ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155@Controller@RequestMapping("/dubboAPI")public class DubboController implements ApplicationContextAware&#123; private final static Logger logger = LoggerFactory.getLogger(DubboController.class); @Autowired private HttpProviderConf httpProviderConf; //ç¼“å­˜ä½œç”¨çš„map private final Map&lt;String, Class&lt;?&gt;&gt; cacheMap = new HashMap&lt;String, Class&lt;?&gt;&gt;(); protected ApplicationContext applicationContext; @ResponseBody @RequestMapping(value = "/&#123;service&#125;/&#123;method&#125;",method = RequestMethod.POST) public String api(HttpRequest httpRequest, HttpServletRequest request, @PathVariable String service, @PathVariable String method) &#123; logger.debug("ip:&#123;&#125;-httpRequest:&#123;&#125;",getIP(request), JSON.toJSONString(httpRequest)); String invoke = invoke(httpRequest, service, method); logger.debug("callback :"+invoke) ; return invoke ; &#125; private String invoke(HttpRequest httpRequest,String service,String method)&#123; httpRequest.setService(service); httpRequest.setMethod(method); HttpResponse response = new HttpResponse() ; logger.debug("input param:"+JSON.toJSONString(httpRequest)); if (!CollectionUtils.isEmpty(httpProviderConf.getUsePackage()))&#123; boolean isPac = false ; for (String pac : httpProviderConf.getUsePackage()) &#123; if (service.startsWith(pac))&#123; isPac = true ; break ; &#125; &#125; if (!isPac)&#123; //è°ƒç”¨çš„æ˜¯æœªç»é…ç½®çš„åŒ… logger.error("service is not correct,service="+service); response.setCode("2"); response.setSuccess(false); response.setDescription("service is not correct,service="+service); &#125; &#125; try &#123; Class&lt;?&gt; serviceCla = cacheMap.get(service); if (serviceCla == null)&#123; serviceCla = Class.forName(service) ; logger.debug("serviceCla:"+JSON.toJSONString(serviceCla)); //è®¾ç½®ç¼“å­˜ cacheMap.put(service,serviceCla) ; &#125; Method[] methods = serviceCla.getMethods(); Method targetMethod = null ; for (Method m : methods) &#123; if (m.getName().equals(method))&#123; targetMethod = m ; break ; &#125; &#125; if (method == null)&#123; logger.error("method is not correct,method="+method); response.setCode("2"); response.setSuccess(false); response.setDescription("method is not correct,method="+method); &#125; Object bean = this.applicationContext.getBean(serviceCla); Object result = null ; Class&lt;?&gt;[] parameterTypes = targetMethod.getParameterTypes(); if (parameterTypes.length == 0)&#123; //æ²¡æœ‰å‚æ•° result = targetMethod.invoke(bean); &#125;else if (parameterTypes.length == 1)&#123; Object json = JSON.parseObject(httpRequest.getParam(), parameterTypes[0]); result = targetMethod.invoke(bean,json) ; &#125;else &#123; logger.error("Can only have one parameter"); response.setSuccess(false); response.setCode("2"); response.setDescription("Can only have one parameter"); &#125; return JSON.toJSONString(result) ; &#125;catch (ClassNotFoundException e)&#123; logger.error("class not found",e); response.setSuccess(false); response.setCode("2"); response.setDescription("class not found"); &#125; catch (InvocationTargetException e) &#123; logger.error("InvocationTargetException",e); response.setSuccess(false); response.setCode("2"); response.setDescription("InvocationTargetException"); &#125; catch (IllegalAccessException e) &#123; logger.error("IllegalAccessException",e); response.setSuccess(false); response.setCode("2"); response.setDescription("IllegalAccessException"); &#125; return JSON.toJSONString(response) ; &#125; /** * èŽ·å–IP * @param request * @return */ private String getIP(HttpServletRequest request) &#123; if (request == null) return null; String s = request.getHeader("X-Forwarded-For"); if (s == null || s.length() == 0 || "unknown".equalsIgnoreCase(s)) &#123; s = request.getHeader("Proxy-Client-IP"); &#125; if (s == null || s.length() == 0 || "unknown".equalsIgnoreCase(s)) &#123; s = request.getHeader("WL-Proxy-Client-IP"); &#125; if (s == null || s.length() == 0 || "unknown".equalsIgnoreCase(s)) &#123; s = request.getHeader("HTTP_CLIENT_IP"); &#125; if (s == null || s.length() == 0 || "unknown".equalsIgnoreCase(s)) &#123; s = request.getHeader("HTTP_X_FORWARDED_FOR"); &#125; if (s == null || s.length() == 0 || "unknown".equalsIgnoreCase(s)) &#123; s = request.getRemoteAddr(); &#125; if ("127.0.0.1".equals(s) || "0:0:0:0:0:0:0:1".equals(s)) try &#123; s = InetAddress.getLocalHost().getHostAddress(); &#125; catch (UnknownHostException unknownhostexception) &#123; return ""; &#125; return s; &#125; public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; this.applicationContext = applicationContext; &#125; å…ˆä¸€æ­¥ä¸€æ­¥çš„çœ‹ï¼š é¦–å…ˆæ˜¯å®šä¹‰äº†ä¸€ä¸ªDubboController,å¹¶ä½¿ç”¨äº†SpringMVCçš„æ³¨è§£å¯¹å¤–æš´éœ²HTTPæœåŠ¡ã€‚ å®žçŽ°äº†org.springframework.context.ApplicationContextAwareç±»ï¼Œå®žçŽ°äº†setApplicationContext()æ–¹æ³•ç”¨äºŽåˆå§‹åŒ–Springä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œåœ¨ä¹‹åŽå¯ä»¥èŽ·å–åˆ°å®¹å™¨é‡Œçš„ç›¸åº”å¯¹è±¡ã€‚ æ ¸å¿ƒçš„invoke()æ–¹æ³•ã€‚ è°ƒç”¨æ—¶ï¼šhttp://127.0.0.1:8080/SSM-SERVICE/dubboAPI/com.crossoverJie.api.UserInfoApi/getUserInfoã€‚ å…·ä½“å¦‚ä¸Šæ–‡çš„è°ƒç”¨å®žä¾‹ã€‚å…ˆå°†com.crossoverJie.api.UserInfoApiã€getUserInfoèµ‹å€¼åˆ°httpRequestå…¥å‚ä¸­ã€‚ åˆ¤æ–­ä¼ å…¥çš„åŒ…æ˜¯å¦æ˜¯å¯¹å¤–æä¾›çš„ã€‚å¦‚ä¸‹é…ç½®ï¼š1234567891011&lt;!--dubboæœåŠ¡æš´éœ²ä¸ºhttpæœåŠ¡--&gt;&lt;bean class="com.crossoverJie.dubbo.http.conf.HttpProviderConf"&gt; &lt;property name="usePackage"&gt; &lt;list&gt; &lt;!--éœ€è¦æš´éœ²æœåŠ¡çš„æŽ¥å£åŒ…åï¼Œå¯å¤šä¸ª--&gt; &lt;value&gt;com.crossoverJie.api&lt;/value&gt; &lt;/list&gt; &lt;/property&gt;&lt;/bean&gt;&lt;!--æ‰«ææš´éœ²åŒ…--&gt;&lt;context:component-scan base-package="com.crossoverJie.dubbo.http"/&gt; å…¶ä¸­çš„com.crossoverJie.apiå°±æ˜¯è‡ªå·±éœ€è¦æš´éœ²çš„åŒ…åï¼Œå¯ä»¥å¤šä¸ªã€‚ æŽ¥ç€åœ¨ç¼“å­˜mapä¸­å–å‡ºåå°„èŽ·å–åˆ°çš„æŽ¥å£ç±»ç±»åž‹ï¼Œå¦‚æžœèŽ·å–ä¸åˆ°åˆ™é€šè¿‡åå°„èŽ·å–ï¼Œå¹¶å°†å€¼è®¾ç½®åˆ°ç¼“å­˜mapä¸­ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡éƒ½åå°„èŽ·å–ï¼Œå¯ä»¥èŠ‚çœç³»ç»Ÿå¼€é”€(åå°„å¾ˆè€—ç³»ç»Ÿèµ„æº)ã€‚ æŽ¥ç€ä¹Ÿæ˜¯åˆ¤æ–­è¯¥æŽ¥å£ä¸­æ˜¯å¦æœ‰ä¼ å…¥çš„getUserInfoæ–¹æ³•ã€‚ å–å‡ºè¯¥æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼Œå¦‚æžœæ²¡æœ‰å‚æ•°åˆ™ç›´æŽ¥è°ƒç”¨ã€‚ å¦‚æžœæœ‰å‚æ•°ï¼Œåˆ¤æ–­ä¸ªæ•°ã€‚è¿™é‡Œæœ€å¤šåªè¿è¡Œä¸€ä¸ªå‚æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨çœŸæ­£çš„dubboè°ƒç”¨çš„æ—¶å€™åªèƒ½ä¼ é€’ä¸€ä¸ªBOç±»åž‹ï¼Œå…·ä½“çš„å‚æ•°åˆ—è¡¨å¯ä»¥å†™åˆ°BOä¸­ã€‚å› ä¸ºå¦‚æžœæœ‰å¤šä¸ªåœ¨è¿›è¡Œjsonè§£æžçš„æ—¶å€™æ˜¯æ— æ³•èµ‹å€¼åˆ°ä¸¤ä¸ªå‚æ•°å¯¹è±¡ä¸­åŽ»çš„ã€‚ ä¹‹åŽè¿›è¡Œè°ƒç”¨ï¼Œå°†è°ƒç”¨è¿”å›žçš„æ•°æ®è¿›è¡Œè¿”å›žå³å¯ã€‚ æ€»ç»“é€šå¸¸æ¥è¯´è¿™æ ·æä¾›çš„HTTPæŽ¥å£å†å®žé™…ä¸­ç”¨çš„ä¸å¤šï¼Œä½†æ˜¯å¾ˆæ–¹ä¾¿è°ƒè¯•ã€‚ æ¯”å¦‚å†™äº†ä¸€ä¸ªdubboçš„æŸ¥è¯¢æŽ¥å£ï¼Œåœ¨æµ‹è¯•çŽ¯å¢ƒæˆ–è€…æ˜¯é¢„å‘å¸ƒçŽ¯å¢ƒä¸­å°±å¯ä»¥ç›´æŽ¥é€šè¿‡HTTPè¯·æ±‚çš„æ–¹å¼è¿›è¡Œç®€å•çš„æµ‹è¯•ï¼Œæˆ–è€…å°±æ˜¯æŸ¥è¯¢æ•°æ®ã€‚æ¯”åœ¨Javaä¸­å†™å•æµ‹æ¥æµ‹è¯•æˆ–æŸ¥è¯¢å¿«çš„å¾ˆå¤šã€‚ å®‰è£…1git clone https://github.com/crossoverJie/SSM-DUBBO-HTTP.git 1cd SSM-DUBBO-HTTP 1mvn clean 1mvn install ä½¿ç”¨12345&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM-HTTP-PROVIDER&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;/dependency&gt; springé…ç½®1234567891011&lt;!--dubboæœåŠ¡æš´éœ²ä¸ºhttpæœåŠ¡--&gt;&lt;bean class="com.crossoverJie.dubbo.http.conf.HttpProviderConf"&gt; &lt;property name="usePackage"&gt; &lt;list&gt; &lt;!--éœ€è¦æš´éœ²æœåŠ¡çš„æŽ¥å£åŒ…åï¼Œå¯å¤šä¸ª--&gt; &lt;value&gt;com.crossoverJie.api&lt;/value&gt; &lt;/list&gt; &lt;/property&gt;&lt;/bean&gt;&lt;!--æ‰«ææš´éœ²åŒ…--&gt;&lt;context:component-scan base-package="com.crossoverJie.dubbo.http"/&gt; æ’ä»¶åœ°å€ï¼šhttps://github.com/crossoverJie/SSM-DUBBO-HTTP é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>dubbo</tag>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç§‘æ™®-ä¸ºè‡ªå·±çš„åšå®¢å…è´¹åŠ ä¸Šå°ç»¿é”]]></title>
    <url>%2F2017%2F05%2F07%2Fhttps%2F</url>
    <content type="text"><![CDATA[åœ¨å¦‚ä»Šçš„HTTPSå¤§å½“å…¶é“çš„æƒ…å†µä¸‹è‡ªå·±çš„åšå®¢è¦æ˜¯è¿˜æ²¡æœ‰ç”¨ä¸Šã€‚ä½œä¸ºäº’è”ç½‘çš„èžºä¸é’‰(ç å†œ)å²‚ä¸æ˜¯å¾ˆæ²¡é¢å­ã€‚ ä½¿ç”¨CLOUDFLAREè¿™é‡Œä½¿ç”¨CLOUDFLAREæ¥æä¾›HTTPSæœåŠ¡ã€‚ åœ¨å…¶å®˜ç½‘è¿›è¡Œæ³¨å†Œï¼ŒæŒ‰ç…§æç¤ºæ·»åŠ å¥½è‡ªå·±çš„åŸŸåå³å¯ã€‚ ä¹‹åŽéœ€è¦åœ¨è‡ªå·±åŸŸåçš„æä¾›å•†å¤„ä¿®æ”¹DNSæœåŠ¡å™¨ï¼Œæˆ‘æ˜¯åœ¨ä¸‡ç½‘è´­ä¹°çš„ä¿®æ”¹åŽå¦‚ä¸‹å›¾ï¼šå…¶ä¸­çš„DNSæœåŠ¡å™¨åœ°å€ç”±CLOUDFLAREæ˜¯æä¾›çš„ã€‚ä¿®æ”¹å®Œæˆä¹‹åŽé€šå¸¸éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½ç”Ÿæ•ˆã€‚ æŽ¥ç€åœ¨CLOUDFLAREé…ç½®DNSè§£æžï¼šç‚¹å‡»CLOUDFLAREé¡¶éƒ¨çš„DNSè¿›è¡Œå¦‚æˆ‘ä¸Šå›¾ä¸­çš„é…ç½®ï¼Œå’Œä¹‹å‰çš„é…ç½®æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ ç­‰å¾…ä¸€æ®µæ—¶é—´ä¹‹åŽå‘çŽ°ä½¿ç”¨HTTP,HTTPSéƒ½èƒ½è®¿é—®ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯èƒ½åœ¨è®¿é—®HTTPçš„æ—¶å€™èƒ½å¼ºåˆ¶è·³è½¬åˆ°HTTPS. åœ¨CLOUDFLAREèœå•æ ç‚¹å‡»page-rulesä¹‹åŽæ–°å»ºä¸€ä¸ªpage ruleï¼šè¿™æ ·æ•´ä¸ªç½‘ç«™çš„è¯·æ±‚éƒ½ä¼šå¼ºåˆ¶åˆ°è¯·æ±‚åˆ°HTTPS. ä¸»é¢˜é…ç½®ç”±äºŽæˆ‘æ‰ç”¨çš„æ˜¯Hexoä¸­çš„Nextä¸»é¢˜ï¼Œå…¶ä¸­é…ç½®äº†CNZZç«™é•¿ç»Ÿè®¡ã€‚å…¶ä¸­é…ç½®çš„CNZZç»Ÿè®¡JSæ˜¯æ‰ç”¨çš„HTTPã€‚å¯¼è‡´åœ¨é¦–é¡µçš„æ—¶å€™chromeä¸€ç›´æç¤ºæ„Ÿå¹å·ã€‚ä¿®æ”¹ç«™ç‚¹themes/next/layout/_scripts/third-party/analyticsç›®å½•ä¸‹çš„cnzz-analytics.swigæ–‡ä»¶1234567&#123;% if theme.cnzz_siteid %&#125; &lt;div style=&quot;display: none;&quot;&gt; &lt;script src=&quot;https://s6.cnzz.com/stat.php?id=&#123;&#123; theme.cnzz_siteid &#125;&#125;&amp;web_id=&#123;&#123; theme.cnzz_siteid &#125;&#125;&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt; &lt;/div&gt;&#123;% endif %&#125; ä¹‹åŽå†è¿›è¡Œæž„å»ºçš„æ—¶å€™å°±ä¼šä½¿ç”¨HTTPS. å€¼å¾—æ³¨æ„ä¸€ç‚¹çš„æ˜¯ä¹‹åŽæ–‡ç« ä¸­æ‰€ä½¿ç”¨çš„å›¾ç‰‡éƒ½è¦ç”¨HTTPSçš„åœ°å€äº†ï¼Œä¸ç„¶chromeä¼šæç¤ºæ„Ÿå¹å·ã€‚ ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>ç§‘æ™®</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
        <tag>HTTPS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åäºŒ) dubboæ—¥å¿—æ’ä»¶]]></title>
    <url>%2F2017%2F04%2F25%2FSSM12%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨ä¹‹å‰dubboåˆ†å¸ƒå¼æ¡†æž¶ä¸­è®²åˆ°äº†å¦‚ä½•åˆ©ç”¨dubboæ¥æ­å»ºä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®ã€‚å…¶ä¸­è¿˜æœ‰ä¸€äº›å€¼å¾—ä¼˜åŒ–æé«˜å¼€å‘æ•ˆçŽ‡çš„åœ°æ–¹ï¼Œæ¯”å¦‚æ—¥å¿—ï¼š å½“æˆ‘ä»¬ä¸€ä¸ªé¡¹ç›®æ‹†åˆ†ä¸ºNå¤šä¸ªå¾®æœåŠ¡ä¹‹åŽï¼Œå½“å…¶ä¸­ä¸€ä¸ªè°ƒç”¨å¦ä¸€ä¸ªæœåŠ¡å‡ºçŽ°äº†é—®é¢˜ï¼Œé¦–å…ˆç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯æŸ¥çœ‹æ—¥å¿—ã€‚ å‡ºçŽ°é—®é¢˜çš„æœ‰å¾ˆå¤šæƒ…å†µï¼Œå¦‚æä¾›æ–¹è‡ªèº«ä»£ç çš„é—®é¢˜ï¼Œè°ƒç”¨æ–¹çš„å§¿åŠ¿ä¸å¯¹ç­‰ã€‚ è‡ªèº«çš„é—®é¢˜è¿™ä¸ªç®¡ä¸äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸€ä¸ªå…¥å‚ã€è¿”å›žéƒ½åŠ ä¸Šæ—¥å¿—ï¼Œè¿™æ ·é¦–å…ˆå°±å¯ä»¥åˆ¤æ–­è°ƒç”¨æ–¹æ˜¯å¦å§¿åŠ¿ä¸å¯¹äº†ã€‚ ä¸ºäº†è§„èŒƒæ—¥å¿—å·²ç»åŽç»­çš„å¯æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥å•ç‹¬æä¾›ä¸€ä¸ªæ’ä»¶ç»™æ¯ä¸ªé¡¹ç›®ä½¿ç”¨å³å¯ã€‚ æ•ˆæžœå¦‚ä¸‹ï¼š 123456789101112132017-04-25 15:15:38,968 DEBUG [com.alibaba.dubbo.remoting.transport.DecodeHandler] - [DUBBO] Decode decodeable message com.alibaba.dubbo.rpc.protocol.dubbo.DecodeableRpcInvocation, dubbo version: 2.5.3, current host: 127.0.0.12017-04-25 15:15:39,484 DEBUG [com.crossoverJie.dubbo.filter.DubboTraceFilter] - dubboè¯·æ±‚æ•°æ®:&#123;&quot;args&quot;:[1],&quot;interfaceName&quot;:&quot;com.crossoverJie.api.UserInfoApi&quot;,&quot;methodName&quot;:&quot;getUserInfo&quot;&#125;2017-04-25 15:15:39,484 INFO [com.crossoverJie.api.impl.UserInfoApiImpl] - ç”¨æˆ·æŸ¥è¯¢Id=12017-04-25 15:15:39,505 DEBUG [org.mybatis.spring.SqlSessionUtils] - Creating a new SqlSession2017-04-25 15:15:39,525 DEBUG [org.mybatis.spring.SqlSessionUtils] - SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6f56b29] was not registered for synchronization because synchronization is not active2017-04-25 15:15:39,549 DEBUG [org.mybatis.spring.transaction.SpringManagedTransaction] - JDBC Connection [com.alibaba.druid.proxy.jdbc.ConnectionProxyImpl@778b3121] will not be managed by Spring2017-04-25 15:15:39,555 DEBUG [com.crossoverJie.api.dubbo.dao.T_userDao.selectByPrimaryKey] - ==&gt; Preparing: select id, username, password,roleId from t_user where id = ? 2017-04-25 15:15:39,591 DEBUG [com.crossoverJie.api.dubbo.dao.T_userDao.selectByPrimaryKey] - ==&gt; Parameters: 1(Integer)2017-04-25 15:15:39,616 DEBUG [com.crossoverJie.api.dubbo.dao.T_userDao.selectByPrimaryKey] - &lt;== Total: 12017-04-25 15:15:39,616 DEBUG [com.alibaba.druid.pool.PreparedStatementPool] - &#123;conn-10003, pstmt-20000&#125; enter cache2017-04-25 15:15:39,617 DEBUG [org.mybatis.spring.SqlSessionUtils] - Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6f56b29]2017-04-25 15:15:45,473 INFO [com.crossoverJie.dubbo.filter.DubboTraceFilter] - dubboæ‰§è¡ŒæˆåŠŸ2017-04-25 15:15:45,476 DEBUG [com.crossoverJie.dubbo.filter.DubboTraceFilter] - dubboè¿”å›žæ•°æ®&#123;&quot;args&quot;:[&#123;&quot;id&quot;:1,&quot;password&quot;:&quot;123456&quot;,&quot;roleId&quot;:1,&quot;userName&quot;:&quot;crossoverJie&quot;&#125;],&quot;interfaceName&quot;:&quot;com.crossoverJie.api.UserInfoApi&quot;,&quot;methodName&quot;:&quot;getUserInfo&quot;&#125; dubbo filteræ‹“å±•å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡1234567891011## å®šä¹‰å®žä½“é¦–å…ˆå®šä¹‰ä¸€ä¸ªå®žä½“ç±»ç”¨äºŽä¿å­˜è°ƒç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›æ•°æ®ï¼š```javapublic class FilterDesc &#123; private String interfaceName ;//æŽ¥å£å private String methodName ;//æ–¹æ³•å private Object[] args ;//å‚æ•° //çœç•¥getter setter&#125; DubboTraceFilterå…·ä½“æ‹¦æˆªé€»è¾‘1234567891011121314151617181920212223242526272829303132333435363738@Activate(group = Constants.PROVIDER, order = -999)public class DubboTraceFilter implements Filter&#123; private static final Logger logger = LoggerFactory.getLogger(DubboTraceFilter.class); public Result invoke(Invoker&lt;?&gt; invoker, Invocation invocation) throws RpcException &#123; try &#123; FilterDesc filterReq = new FilterDesc() ; filterReq.setInterfaceName(invocation.getInvoker().getInterface().getName()); filterReq.setMethodName(invocation.getMethodName()) ; filterReq.setArgs(invocation.getArguments()); logger.debug("dubboè¯·æ±‚æ•°æ®:"+JSON.toJSONString(filterReq)); Result result = invoker.invoke(invocation); if (result.hasException() &amp;&amp; invoker.getInterface() != GenericService.class)&#123; logger.error("dubboæ‰§è¡Œå¼‚å¸¸",result.getException()); &#125;else &#123; logger.info("dubboæ‰§è¡ŒæˆåŠŸ"); FilterDesc filterRsp = new FilterDesc() ; filterRsp.setMethodName(invocation.getMethodName()); filterRsp.setInterfaceName(invocation.getInvoker().getInterface().getName()); filterRsp.setArgs(new Object[]&#123;result.getValue()&#125;); logger.debug("dubboè¿”å›žæ•°æ®"+JSON.toJSONString(filterRsp)); &#125; return result ; &#125;catch (RuntimeException e)&#123; logger.error("dubboæœªçŸ¥å¼‚å¸¸" + RpcContext.getContext().getRemoteHost() + ". service: " + invoker.getInterface().getName() + ", method: " + invocation.getMethodName() + ", exception: " + e.getClass().getName() + ": " + e.getMessage(), e); throw e ; &#125; &#125;&#125; é€»è¾‘éžå¸¸ç®€å•ï¼Œåªæ˜¯å¯¹è°ƒç”¨è¿‡ç¨‹ã€å¼‚å¸¸ã€æˆåŠŸä¹‹åŽæ‰“å°ç›¸åº”çš„æ—¥å¿—è€Œå·²ã€‚ ä½†æ˜¯æœ‰ä¸ªåœ°æ–¹è¦æ³¨æ„ä¸€ä¸‹ï¼šéœ€è¦åœ¨resourceç›®å½•ä¸‹åŠ ä¸ŠMETA-INF.dubbo/com.alibaba.dubbo.rpc.Filteræ–‡ä»¶ã€‚1dubboTraceFilter=com.crossoverJie.dubbo.filter.DubboTraceFilter ç›®å½•ç»“æž„å¦‚ä¸‹ï¼š12345678910src |-main |-java |-com |-xxx |-XxxFilter.java (å®žçŽ°FilteræŽ¥å£) |-resources |-META-INF |-dubbo |-com.alibaba.dubbo.rpc.Filter (çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼šxxx=com.xxx.XxxFilter) æ€»ç»“è¯¥é¡¹ç›®å·²ç»æ‰˜ç®¡åˆ°GitHubï¼šhttps://github.com/crossoverJie/SSM-DUBBO-FILTER ä½¿ç”¨æ–¹æ³•å®‰è£…1cd /SSM-DUBBO-FILTER 1mvn clean 1mvn install ä½¿ç”¨åœ¨æœåŠ¡æä¾›çš„é¡¹ç›®ä¸­åŠ ä¸Šä¾èµ–ï¼Œè¿™æ ·æ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ‰“ä¸Šæ—¥å¿—ã€‚12345&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM-TRACE-FILTER&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;/dependency&gt; åœ¨æ‹¦æˆªå™¨ä¸­æœ€å¥½ä¸è¦åŠ ä¸Šä¸€äº›è€—æ—¶ä»»åŠ¡ï¼Œéœ€è¦è€ƒè™‘åˆ°æ€§èƒ½é—®é¢˜ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>dubbo</tag>
        <tag>æ—¥å¿—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åä¸€) åŸºäºŽdubboçš„åˆ†å¸ƒå¼æž¶æž„]]></title>
    <url>%2F2017%2F04%2F07%2FSSM11%2F</url>
    <content type="text"><![CDATA[å‰è¨€çŽ°åœ¨è¶Šæ¥è¶Šå¤šçš„äº’è”ç½‘å…¬å¸è¿˜æ˜¯å°†è‡ªå·±å…¬å¸çš„é¡¹ç›®è¿›è¡ŒæœåŠ¡åŒ–ï¼Œè¿™ç¡®å®žæ˜¯ä»ŠåŽé¡¹ç›®å¼€å‘çš„ä¸€ä¸ªè¶‹åŠ¿ï¼Œå°±è¿™ä¸ªç‚¹å†å‡­å€Ÿä¹‹å‰çš„SSMé¡¹ç›®æ¥è®©ç¬¬ä¸€æ¬¡æŽ¥è§¦çš„åŒå­¦èƒ½å¿«é€Ÿä¸Šæ‰‹ã€‚ æµ…è°ˆåˆ†å¸ƒå¼æž¶æž„åˆ†å¸ƒå¼æž¶æž„å•çœ‹è¿™ä¸ªåå­—ç»™äººçš„æ„Ÿè§‰å°±æ˜¯é«˜é€¼æ ¼ï¼Œä½†å…¶å®žä»ŽåŽ†å²çš„è§’åº¦æ¥åˆ†æžä¸€ä¸‹å°±æ¯”è¾ƒæ˜Žäº†äº†ã€‚ æˆ‘ä»¬æ‹¿ä¸€ä¸ªç”µå•†ç³»ç»Ÿæ¥è¯´ï¼š å•ç³»ç»Ÿå¯¹äºŽä¸€ä¸ªåˆšèµ·æ­¥çš„åˆ›ä¸šå…¬å¸é¡¹ç›®è‚¯å®šæ˜¯è¿½æ±‚è¶Šå¿«å®ŒæˆåŠŸèƒ½è¶Šå¥½ï¼Œå¹¶ä¸”ç”¨æˆ·é‡ä¹Ÿä¸å¤§ã€‚ è¿™æ—¶å€™æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘éƒ½æ˜¯åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å°±å¯ä»¥æ»¡è¶³ã€‚ åž‚ç›´æ‹†åˆ†-å¤šåº”ç”¨å½“ä¸šåŠ¡é‡å’Œç”¨æˆ·é‡å‘å±•åˆ°ä¸€å®šåœ°æ­¥çš„æ—¶å€™ï¼Œè¿™æ—¶ä¸€èˆ¬ä¼šå°†åº”ç”¨åŒæ—¶éƒ¨ç½²åˆ°å‡ å°æœåŠ¡å™¨ä¸Šï¼Œåœ¨ç”¨æˆ·è®¿é—®çš„æ—¶å€™ä½¿ç”¨Nginxè¿›è¡Œåå‘ä»£ç†å’Œç®€å•çš„è´Ÿè½½å‡è¡¡ã€‚ SOAæœåŠ¡åŒ–å½“æ•´ä¸ªç³»ç»Ÿä»¥åŠå‘å±•çš„è¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸€ä¸ªç”µå•†ç³»ç»Ÿä¸­å­˜åœ¨æœ‰ï¼š ç”¨æˆ·ç³»ç»Ÿ è®¢å•ç³»ç»Ÿ æ”¯ä»˜ç³»ç»Ÿ ç‰©æµç³»ç»Ÿ ç­‰ç³»ç»Ÿã€‚å¦‚æžœæ¯æ¬¡ä¿®æ”¹äº†å…¶ä¸­ä¸€ä¸ªç³»ç»Ÿå°±è¦é‡æ–°å‘å¸ƒä¸Šçº¿çš„è¯é‚£ä¹ˆè€¦åˆå°±å¤ªä¸¥é‡äº†ã€‚ æ‰€ä»¥éœ€è¦å°†æ•´ä¸ªé¡¹ç›®æ‹†åˆ†æˆè‹¥å¹²ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œå¯ä»¥è¿›è¡Œç‹¬ç«‹çš„å¼€å‘ä¸Šçº¿å®žçŽ°å¿«é€Ÿè¿­ä»£ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºæ¯ä¸ªåº”ç”¨ä¹‹é—´ç›¸äº’ç‹¬ç«‹,æ¯ä¸ªåº”ç”¨å¯ä»¥æ¶ˆè´¹å…¶ä»–åº”ç”¨æš´éœ²å‡ºæ¥çš„æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿå¯¹å¤–æä¾›æœåŠ¡ã€‚ ä»Žæž¶æž„çš„å±‚é¢ç®€å•çš„ç†è§£äº†ï¼ŒæŽ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•ç¼–ç å®žçŽ°ã€‚ åŸºäºŽdubboçš„å®žçŽ°dubboåº”è¯¥ç®—æ˜¯å›½å†…ä½¿ç”¨æœ€å¤šçš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶ï¼ŒåŸºäºŽæ­¤æ¥å®žçŽ°å¯¹æ–°å…¥é—¨çš„åŒå­¦åº”è¯¥å¾ˆæœ‰å¸®åŠ©ã€‚ å…¶ä¸­æœ‰æ¶‰åŠåˆ°å®‰è£…dubboæœåŠ¡çš„æ³¨å†Œä¸­å¿ƒzookeeperç­‰ç›¸å…³çŸ¥è¯†ç‚¹å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œå°±ä¸å•ç‹¬è®²äº†ã€‚ å¯¹å¤–æä¾›æœåŠ¡é¦–å…ˆç¬¬ä¸€æ­¥éœ€è¦åœ¨SSM-APIæ¨¡å—ä¸­å®šä¹‰ä¸€ä¸ªæŽ¥å£ï¼Œè¿™é‡Œå°±æžäº†ä¸€ä¸ªç”¨æˆ·æŸ¥è¯¢çš„æŽ¥å£12345678910111213141516/** * Function:ç”¨æˆ·API * @author chenjiec * Date: 2017/4/4 ä¸‹åˆ9:46 * @since JDK 1.7 */public interface UserInfoApi &#123; /** * èŽ·å–ç”¨æˆ·ä¿¡æ¯ * @param userId * @return * @throws Exception */ public UserInfoRsp getUserInfo(int userId) throws Exception;&#125; æŽ¥ç€åœ¨SSM-SERVICEæ¨¡å—ä¸­è¿›è¡Œå®žçŽ°ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import com.alibaba.dubbo.config.annotation.Service;/** * Function: * @author chenjiec * Date: 2017/4/4 ä¸‹åˆ9:51 * @since JDK 1.7 */@Servicepublic class UserInfoApiImpl implements UserInfoApi &#123; private static Logger logger = LoggerFactory.getLogger(UserInfoApiImpl.class); @Autowired private T_userService t_userService ; /** * èŽ·å–ç”¨æˆ·ä¿¡æ¯ * * @param userId * @return * @throws Exception */ @Override public UserInfoRsp getUserInfo(int userId) throws Exception &#123; logger.info("ç”¨æˆ·æŸ¥è¯¢Id="+userId); //è¿”å›žå¯¹è±¡ UserInfoRsp userInfoRsp = new UserInfoRsp() ; T_user t_user = t_userService.selectByPrimaryKey(userId) ; //æž„å»º buildUserInfoRsp(userInfoRsp,t_user) ; return userInfoRsp; &#125; /** * æž„å»ºè¿”å›ž * @param userInfoRsp * @param t_user */ private void buildUserInfoRsp(UserInfoRsp userInfoRsp, T_user t_user) &#123; if (t_user == null)&#123; t_user = new T_user() ; &#125; CommonUtil.setLogValueModelToModel(t_user,userInfoRsp); &#125;&#125; è¿™äº›éƒ½æ˜¯é€šç”¨çš„ä»£ç ï¼Œä½†å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯è¿™é‡Œä½¿ç”¨çš„dubboæ¡†æž¶æ‰€æä¾›çš„@serviceæ³¨è§£ã€‚ä½œç”¨æ˜¯å£°æ˜Žéœ€è¦æš´éœ²çš„æœåŠ¡æŽ¥å£ã€‚ å†ä¹‹åŽå°±æ˜¯å‡ ä¸ªdubboç›¸å…³çš„é…ç½®æ–‡ä»¶äº†ã€‚ spring-dubbo-config.xml12345678910111213&lt;dubbo:application name="ssm-service" owner="crossoverJie" organization="ssm-crossoverJie" logger="slf4j"/&gt;&lt;dubbo:registry id="dubbo-registry" address="zookeeper://192.168.0.188:2181" file="/tmp/dubbo.cachr" /&gt;&lt;dubbo:monitor protocol="registry" /&gt;&lt;dubbo:protocol name="dubbo" port="20880" /&gt;&lt;dubbo:provider timeout="15000" retries="0" delay="-1" /&gt;&lt;dubbo:consumer check="false" timeout="15000" /&gt; å…¶å®žå°±æ˜¯é…ç½®æˆ‘ä»¬æœåŠ¡æ³¨å†Œçš„zkåœ°å€ï¼Œä»¥åŠæœåŠ¡åç§°ã€è¶…æ—¶æ—¶é—´ç­‰é…ç½®ã€‚ spring-dubbo-provider.xml1&lt;dubbo:annotation package="com.crossoverJie.api.impl" /&gt; è¿™ä¸ªé…ç½®æ‰«ææ³¨è§£åŒ…çš„ä½ç½®ï¼Œä¸€èˆ¬é…ç½®åˆ°æŽ¥å£å®žçŽ°åŒ…å³å¯ã€‚ spring-dubbo-consumer.xmlè¿™ä¸ªæ˜¯æ¶ˆè´¹è€…é…ç½®é¡¹ï¼Œè¡¨æ˜Žæˆ‘ä»¬éœ€è¦ä¾èµ–çš„å…¶ä»–åº”ç”¨ã€‚è¿™é‡Œæˆ‘ä»¬åœ¨SSM-BOOTé¡¹ç›®ä¸­è¿›è¡Œé…ç½®ï¼š12&lt;dubbo:reference id="userInfoApi" interface="com.crossoverJie.api.UserInfoApi" /&gt; ç›´æŽ¥å°±æ˜¯é…ç½®çš„åˆšæ‰æˆ‘ä»¬æä¾›çš„é‚£ä¸ªç”¨æˆ·æŸ¥è¯¢çš„æŽ¥å£ï¼Œè¿™æ ·å½“æˆ‘ä»¬è‡ªå·±çš„å†…éƒ¨é¡¹ç›®éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªæœåŠ¡åªéœ€è¦ä¾èµ–SSM-BOOTå³å¯ï¼Œä¸éœ€è¦å•ç‹¬çš„å†åŽ»é…ç½®consumerã€‚è¿™ä¸ªæˆ‘æœ‰åœ¨ä¸Šä¸€ç¯‡SSM(å) é¡¹ç›®é‡æž„-äº’è”ç½‘é¡¹ç›®çš„Mavenç»“æž„ä¸­ä¹Ÿæœ‰æåˆ°ã€‚ å®‰è£…ç®¡ç†æŽ§åˆ¶å°è¿˜æœ‰ä¸€ä¸ªéœ€è¦åšçš„å°±æ˜¯å®‰è£…ç®¡ç†æŽ§åˆ¶å°ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æœ‰å¤šå°‘æœåŠ¡ã€è°ƒç”¨æƒ…å†µæ˜¯æ€Žä¹ˆæ ·ç­‰ä½œç”¨ã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥å°†dubboçš„å®˜æ–¹æºç ä¸‹è½½ä¸‹æ¥ï¼Œå¯¹å…¶ä¸­çš„dubbo-adminæ¨¡å—è¿›è¡Œæ‰“åŒ…ï¼Œå°†ç”Ÿæˆçš„WARåŒ…æ”¾åˆ°Tomcatä¸­è¿è¡Œèµ·æ¥å³å¯ã€‚ ä½†æ˜¯éœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼šéœ€è¦å°†å…¶ä¸­çš„dubbo.propertiesçš„zkåœ°å€ä¿®æ”¹ä¸ºè‡ªå·±çš„å³å¯ã€‚123dubbo.registry.address=zookeeper://127.0.0.1:2181dubbo.admin.root.password=rootdubbo.admin.guest.password=guest åˆ°æ—¶å€™ç™»é™†çš„è¯ä½¿ç”¨rootï¼Œå¯†ç ä¹Ÿæ˜¯rootã€‚ä½¿ç”¨guestï¼Œå¯†ç ä¹Ÿæ˜¯guestã€‚ ç™»é™†ç•Œé¢å¦‚ä¸‹å›¾ï¼š å…¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªæœåŠ¡ä»¥åŠæ³¨å†Œä¸ŠåŽ»äº†ï¼Œä½†æ˜¯æ²¡æœ‰æ¶ˆè´¹è€…ã€‚ æ¶ˆè´¹æœåŠ¡ä¸ºäº†èƒ½å¤Ÿæ›´ç›´è§‚çš„ä½“éªŒåˆ°æ¶ˆè´¹æœåŠ¡ï¼Œæˆ‘æ–°å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼šhttps://github.com/crossoverJie/SSM-CONSUMERã€‚ å…¶ä¸­åœ¨SSM-CONSUMER-APIä¸­æˆ‘ä¹Ÿå®šä¹‰äº†ä¸€ä¸ªæŽ¥å£ï¼š12345678910111213141516/** * Function:è–ªèµ„API * @author chenjiec * Date: 2017/4/4 ä¸‹åˆ9:46 * @since JDK 1.7 */public interface SalaryInfoApi &#123; /** * èŽ·å–è–ªèµ„ * @param userId * @return * @throws Exception */ public SalaryInfoRsp getSalaryInfo(int userId) throws Exception;&#125; å› ä¸ºä½œä¸ºæ¶ˆè´¹è€…çš„åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯¹å¤–æä¾›äº†ä¸€ä¸ªèŽ·å–è–ªèµ„çš„ä¸€ä¸ªæœåŠ¡ã€‚ åœ¨SSM-CONSUMER-SERVICEæ¨¡å—ä¸­è¿›è¡Œäº†å®žçŽ°ï¼š12345678910111213141516171819202122232425262728293031323334353637/** * Function: * @author chenjiec * Date: 2017/4/4 ä¸‹åˆ9:51 * @since JDK 1.7 */@Servicepublic class SalaryInfoApiImpl implements SalaryInfoApi &#123; private static Logger logger = LoggerFactory.getLogger(SalaryInfoApiImpl.class); @Autowired UserInfoApi userInfoApi ; /** * èŽ·å–ç”¨æˆ·ä¿¡æ¯ * * @param userId * @return * @throws Exception */ @Override public SalaryInfoRsp getSalaryInfo(int userId) throws Exception &#123; logger.info("è–ªèµ„æŸ¥è¯¢Id="+userId); //è¿”å›žå¯¹è±¡ SalaryInfoRsp salaryInfoRsp = new SalaryInfoRsp() ; //è°ƒç”¨è¿œç¨‹æœåŠ¡ UserInfoRsp userInfo = userInfoApi.getUserInfo(userId); salaryInfoRsp.setUsername(userInfo.getUserName()); return salaryInfoRsp; &#125;&#125; å…¶ä¸­å°±å¯ä»¥ç›´æŽ¥ä½¿ç”¨userInfoApiè°ƒç”¨ä¹‹å‰çš„ä¸ªäººä¿¡æ¯æœåŠ¡ã€‚ å†è°ƒç”¨ä¹‹å‰éœ€è¦æ³¨æ„çš„æœ‰ç‚¹æ˜¯ï¼Œæˆ‘ä»¬åªéœ€è¦ä¾èµ–SSM-BOOTè¿™ä¸ªæ¨¡å—å³å¯è¿›è¡Œè°ƒç”¨ï¼Œå› ä¸ºSSM-BOOTæ¨¡å—å·²ç»ä¸ºæˆ‘ä»¬é…ç½®äº†æ¶ˆè´¹è€…ä¹‹ç±»çš„æ“ä½œäº†ï¼š1234&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM-BOOT&lt;/artifactId&gt;&lt;/dependency&gt; è¿˜æœ‰ä¸€ç‚¹æ˜¯åœ¨é…ç½®SSM-BOOTä¸­çš„spring-dubbo-cosumer.xmlé…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œè·¯å¾„è¦å’Œæˆ‘ä»¬åˆå§‹åŒ–springé…ç½®æ–‡ä»¶æ—¶çš„è·¯å¾„ä¸€è‡´ï¼š12345&lt;!-- Springå’Œmybatisçš„é…ç½®æ–‡ä»¶ --&gt;&lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath*:spring/*.xml&lt;/param-value&gt;&lt;/context-param&gt; æŽ¥ä¸‹æ¥è·‘ä¸ªå•æµ‹è¯•ä¸€ä¸‹èƒ½å¦è°ƒé€šï¼š123456789101112131415161718192021/** * Function: * * @author chenjiec * Date: 2017/4/5 ä¸‹åˆ10:41 * @since JDK 1.7 */@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations = &#123; "classpath*:/spring/*.xml" &#125;)public class SalaryInfoApiImplTest &#123; @Autowired private SalaryInfoApi salaryInfoApi ; @Test public void getSalaryInfo() throws Exception &#123; SalaryInfoRsp salaryInfo = salaryInfoApi.getSalaryInfo(1); System.out.println(JSON.toJSONString(salaryInfo)); &#125;&#125; æ¶ˆè´¹è€… æä¾›è€…å¯ä»¥çœ‹åˆ°ç¡®å®žæ˜¯è°ƒç”¨æˆåŠŸäº†çš„ã€‚ æŽ¥ä¸‹æ¥å°†æ¶ˆè´¹è€…é¡¹ç›®ä¹ŸåŒæ—¶å¯åŠ¨åœ¨æ¥è§‚å¯Ÿç®¡ç†æŽ§åˆ¶å°æœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼šä¼šçœ‹åˆ°å¤šäº†ä¸€ä¸ªæ¶ˆè´¹è€…æ‰€æä¾›çš„æœåŠ¡com.crossoverjie.consumer.api.SalaryInfoApi,åŒæ—¶com.crossoverJie.api.UserInfoApiæœåŠ¡å·²ç»æ­£å¸¸ï¼Œè¯´æ˜Žå·²ç»æœ‰æ¶ˆè´¹è€…äº†ã€‚ ç‚¹è¿›åŽ»ä¾¿å¯æŸ¥çœ‹å…·ä½“çš„æ¶ˆè´¹è€…ã€‚ æ€»ç»“è¿™æ ·ä¸€ä¸ªåŸºäºŽdubboçš„åˆ†å¸ƒå¼æœåŠ¡å·²ç»è®²çš„å·®ä¸å¤šäº†ï¼Œåœ¨å®žé™…çš„å¼€å‘ä¸­æˆ‘ä»¬ä¾¿ä¼šå¼€å‘ä¸€ä¸ªå¤§ç³»ç»Ÿä¸­çš„æŸä¸€ä¸ªå­åº”ç”¨ï¼Œè¿™æ ·å°±ç®—ä¸€ä¸ªå­åº”ç”¨å‡ºé—®é¢˜äº†ä¹Ÿä¸ä¼šå½±å“åˆ°æ•´ä¸ªå¤§çš„é¡¹ç›®ã€‚ å†æä¸€ç‚¹ï¼šåœ¨å®žé™…çš„ç”Ÿäº§çŽ¯å¢ƒä¸€èˆ¬åŒä¸€ä¸ªæœåŠ¡æˆ‘ä»¬éƒ½ä¼šæœ‰ä¸€ä¸ªmaster,slaveçš„ä¸»ä»ŽæœåŠ¡ï¼Œè¿™æ ·åœ¨ä¸Šçº¿çš„è¿‡ç¨‹ä¸­ä¸è‡³äºŽæ•´ä¸ªåº”ç”¨å‡ºçŽ°æ— æ³•ä½¿ç”¨çš„å°´å°¬æƒ…å†µã€‚ è°ˆåˆ°äº†SOAçš„å¥½å¤„ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿæœ‰ç›¸å¯¹äºŽä¼ ç»Ÿæ¨¡å¼çš„ä¸æ–¹ä¾¿ä¹‹å¤„ï¼š æ‹†åˆ†ä¸€ä¸ªå¤§çš„é¡¹ç›®ä¸ºæˆç™¾ä¸Šåƒçš„å­åº”ç”¨å°±ä¸å¯èƒ½æ‰‹åŠ¨ä¸Šçº¿äº†ï¼Œå³éœ€è¦è‡ªåŠ¨åŒ–çš„éƒ¨ç½²ä¸Šçº¿ï¼Œå¦‚Jenkinsã€‚ è¿˜æœ‰ä¸€ä¸ªéœ€è¦åšåˆ°çš„å°±æ˜¯ç›‘æŽ§ï¼Œéœ€è¦ä¸€ä¸ªå•ç‹¬çš„ç›‘æŽ§å¹³å°æ¥å¸®æˆ‘ä»¬å®žæ—¶æŸ¥çœ‹å„ä¸ªæœåŠ¡çš„è¿è¡Œæƒ…å†µä»¥ä¾¿äºŽåŠæ—¶å®šä½å’Œè§£å†³é—®é¢˜ã€‚ æ—¥å¿—æŸ¥çœ‹åˆ†æžï¼Œæ‹†åˆ†ä¹‹åŽä¸å¯èƒ½å†åŽ»æ¯å°æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹æ—¥å¿—ï¼Œéœ€è¦ä¸€ä¸ªå•ç‹¬çš„æ—¥å¿—æŸ¥çœ‹åˆ†æžå·¥å…·å¦‚elkã€‚ ä»¥ä¸Šå°±æ˜¯æˆ‘ç†è§£çš„ï¼Œå¦‚æœ‰å·®é”™æ¬¢è¿ŽæŒ‡æ­£ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>dubbo</tag>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(å) é¡¹ç›®é‡æž„-äº’è”ç½‘é¡¹ç›®çš„Mavenç»“æž„]]></title>
    <url>%2F2017%2F03%2F04%2FSSM10%2F</url>
    <content type="text"><![CDATA[å‰è¨€å¾ˆä¹…æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œä¹‹å‰å®šä¸‹å‘¨æ›´é€æ¸æˆäº†æœˆæ›´ã€‚æ€Žä¹ˆæ„Ÿè§‰åƒæˆ‘è¿½è¿‡çš„ä¸€éƒ¨åŠ¨æ¼«ã€‚è¿™ä¸ªåšæ–‡å…¶å®žå¾ˆæ—©å°±æƒ³å†™äº†ã€‚ä¹‹å‰æ‰€æœ‰çš„ä»£ç éƒ½æ˜¯åœ¨ä¸€ä¸ªæ¨¡å—é‡Œé¢è¿›è¡Œå¼€å‘ï¼Œè¿™å’Œmavençš„ç†å¿µæ˜¯å®Œå…¨ä¸ç›¸ç¬¦çš„ï¼Œæœ€è¿‘ç¡¬æ˜¯æŠ½äº†ä¸€ä¸ªæ—¶é—´æ¥å¯¹é¡¹ç›®çš„ç»“æž„è¿›è¡Œäº†ä¸€æ¬¡é‡æž„ã€‚ å…ˆæ¥çœ‹çœ‹è¿™æ¬¡é‡æž„ä¹‹åŽçš„ç›®å½•ç»“æž„ ä¸ºä»€ä¹ˆéœ€è¦åˆ†æ¨¡å— è‡³äºŽä¸ºä»€ä¹ˆè¦åˆ†æ¨¡å—å‘¢ï¼Ÿ æˆ‘ä»¬è®¾æƒ³ä¸€ä¸ªè¿™æ ·çš„åœºæ™¯ï¼šåœ¨çŽ°åœ¨çš„äº’è”ç½‘å¼€å‘ä¸­ï¼Œä¼šæŠŠä¸€ä¸ªå¾ˆå¤§çš„ç³»ç»Ÿæ‹†åˆ†æˆå„ä¸ªå­ç³»ç»Ÿç”¨äºŽé™ä½Žä»–ä»¬ä¹‹é—´çš„è€¦åˆåº¦ã€‚ åœ¨ä¸€ä¸ªå­é¡¹ç›®ä¸­é€šå¸¸éƒ½ä¼šä¸ºAPIã€WEBã€Serviceç­‰æ¨¡å—ã€‚è€Œä¸”å½“é¡¹ç›®å¤Ÿå¤§æ—¶ï¼Œè¿™äº›é€šå¸¸éƒ½ä¸æ˜¯ä¸€ä¸ªäººèƒ½å®Œæˆçš„å·¥ä½œï¼Œéœ€è¦ä¸€ä¸ªå›¢é˜Ÿæ¥å„å¸å…¶èŒã€‚ æƒ³è±¡ä¸€ä¸‹ï¼šå½“ä¹‹å‰æ‰€æœ‰çš„é¡¹ç›®éƒ½åœ¨ä¸€ä¸ªæ¨¡å—çš„æ—¶å€™ï¼ŒAæ”¹åŠ¨äº†APIï¼Œéœ€è¦Deployä»£ç ã€‚è€ŒBä¹Ÿæ”¹åŠ¨äº†serviceçš„ä»£ç ï¼Œä½†å¹¶æ²¡æœ‰å®Œå…¨åšå®Œã€‚æ‰€ä»¥Aåœ¨æäº¤buildçš„æ—¶å€™å°±ä¼šæŠ¥é”™ è€Œä¸”åœ¨æ•´ä¸ªé¡¹ç›®è¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œè¿™ä¸ªbuildçš„æ—¶é—´ä¹Ÿæ˜¯å¾ˆå½±å“æ•ˆçŽ‡çš„ã€‚ ä½†è®©æˆ‘å°†å„ä¸ªæ¨¡å—ä¹‹é—´åˆ†å¼€ä¹‹åŽæ•ˆæžœå°±ä¸ä¸€æ ·äº†ã€‚æˆ‘ä¿®æ”¹äº†APIæˆ‘å°±åªéœ€è¦ç®¡æˆ‘çš„å°±è¡Œï¼Œä¸éœ€è¦æ•´ä¸ªé¡¹ç›®è¿›è¡Œbuildã€‚ è€Œä¸”å½“æœ‰å…¶ä»–é¡¹ç›®éœ€è¦ä¾èµ–æˆ‘è¿™ä¸ªAPIçš„æ—¶å€™ä¹Ÿåªéœ€è¦ä¾èµ–APIå³å¯ï¼Œä¸ç”¨æ•´ä¸ªé¡¹ç›®éƒ½ä¾èµ–è¿‡åŽ»ã€‚ å„ä¸ªæ¨¡å—çš„ä½œç”¨æ¥çœ‹ä¸‹è¿™æ¬¡æˆ‘æ‰€åˆ†çš„æ¨¡å—ã€‚ ROOTè¿™æ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¹èŠ‚ç‚¹ã€‚å…ˆçœ‹ä¸€ä¸‹å…¶ä¸­çš„pom.xmlï¼š 123456789101112131415161718192021222324252627282930&lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM&lt;/artifactId&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;modules&gt; &lt;module&gt;SSM-API&lt;/module&gt; &lt;module&gt;SSM-BOOT&lt;/module&gt; &lt;module&gt;SSM-SERVICE&lt;/module&gt; &lt;module&gt;SSM-WEB&lt;/module&gt; &lt;/modules&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;spring.version&gt;4.1.4.RELEASE&lt;/spring.version&gt; &lt;jackson.version&gt;2.5.0&lt;/jackson.version&gt; &lt;lucene.version&gt;6.0.1&lt;/lucene.version&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM-API&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; æˆ‘æˆªå–äº†å…¶ä¸­æ¯”è¾ƒé‡ç‚¹çš„é…ç½®ã€‚ ç”±äºŽè¿™æ˜¯çˆ¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘çš„packagç±»åž‹ä½¿ç”¨çš„æ˜¯pomã€‚å…¶ä¸­åˆ†åˆ«æœ‰ç€å››ä¸ªå­æ¨¡å—ã€‚ å…¶ä¸­é‡ç‚¹çœ‹ä¸‹&lt;dependencyManagement&gt;è¿™ä¸ªæ ‡ç­¾ã€‚å¦‚æžœä½¿ç”¨çš„æ˜¯IDEAè¿™ä¸ªå¼€å‘å·¥å…·çš„è¯æ˜¯å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾ï¼š æ ‡çº¢çš„æœ‰ä¸€ä¸ªå‘ä¸‹çš„ç®­å¤´ï¼Œç‚¹ä¸€ä¸‹å°±å¯ä»¥è¿›å…¥å­æ¨¡å—ä¸­ç›¸åŒçš„ä¾èµ–ã€‚è¿™æ ·å­æ¨¡å—å°±ä¸éœ€è¦é…ç½®å…·ä½“çš„ç‰ˆæœ¬äº†ï¼Œç»Ÿä¸€ç”±çˆ¶æ¨¡å—æ¥è¿›è¡Œç»´æŠ¤ï¼Œå¯¹ä¹‹åŽçš„ç‰ˆæœ¬å‡çº§ä¹Ÿå¸¦æ¥äº†å¥½å¤„ã€‚ SSM-APIæŽ¥ä¸‹æ¥çœ‹ä¸‹APIè¿™ä¸ªæ¨¡å—ï¼š é€šå¸¸è¿™ä¸ªæ¨¡å—éƒ½æ˜¯ç”¨äºŽå®šä¹‰å¤–éƒ¨æŽ¥å£çš„ï¼Œä»¥åŠæ”¹æŽ¥å£æ‰€ä¾èµ–çš„ä¸€äº›DTOç±»ã€‚ä¸€èˆ¬è¿™ä¸ªæ¨¡å—éƒ½æ˜¯æ‹¿æ¥ç»™å…¶ä»–é¡¹ç›®è¿›è¡Œä¾èµ–ï¼Œå¹¶å’Œæœ¬é¡¹ç›®è¿›è¡Œæ•°æ®äº¤äº’çš„ã€‚ SSM-BOOTBOOTè¿™ä¸ªæ¨¡å—æ¯”è¾ƒç‰¹æ®Šã€‚å¯ä»¥çœ‹åˆ°è¿™é‡Œæ²¡æœ‰ä»»ä½•ä»£ç ï¼Œåªæœ‰ä¸€ä¸ªrpcçš„é…ç½®æ–‡ä»¶ã€‚é€šå¸¸è¿™ä¸ªæ¨¡å—æ˜¯ç”¨äºŽç»™æˆ‘ä»¬å†…éƒ¨é¡¹ç›®è¿›è¡Œä¾èµ–çš„ï¼Œå¹¶ä¸åƒä¸Šé¢çš„APIæ¨¡å—ä¸€æ ·ç»™å…¶ä»–éƒ¨é—¨æˆ–è€…æ˜¯é¡¹ç›®è¿›è¡Œä¾èµ–çš„ã€‚ å› ä¸ºåœ¨æˆ‘ä»¬çš„RPCè°ƒç”¨çš„æ—¶å€™ï¼Œç”¨dubboæ¥ä¸¾ä¾‹ï¼Œæ˜¯éœ€è¦é…ç½®æ‰€ä¾èµ–çš„consumerã€‚ ä½†å¦‚æžœæ˜¯æˆ‘ä»¬è‡ªå·±å†…éƒ¨è°ƒç”¨çš„è¯æˆ‘ä»¬å°±å¯ä»¥æŠŠéœ€è¦è°ƒç”¨è‡ªå·±çš„dubboæœåŠ¡æä¾›è€…é…ç½®åœ¨è¿™é‡Œï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬è‡ªå·±è°ƒç”¨å°±åªéœ€è¦ä¾èµ–è¿™ä¸ªBOOTå°±å¯ä»¥è¿›è¡Œè°ƒç”¨äº†ã€‚ å“¦å¯¹äº†ï¼ŒBOOTåŒæ—¶è¿˜ä¼šä¾èµ–APIï¼Œè¿™æ ·æ‰å®žçŽ°äº†åªä¾èµ–BOOTå°±å¯ä»¥è°ƒç”¨è‡ªå·±å†…éƒ¨çš„dubboæœåŠ¡äº†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š12345678910111213&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM-API&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; SSM-SERVICESERVICEæ¨¡å—å°±æ¯”è¾ƒå¥½ç†è§£äº†ã€‚æ˜¯å¤„ç†å…·ä½“ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å¯¹ä¹‹å‰çš„APIçš„å®žçŽ°ã€‚ é€šå¸¸è¿™ä¹Ÿæ˜¯ä¸€ä¸ªwebæ¨¡å—ï¼Œæ‰€ä»¥æˆ‘çš„pomç±»åž‹æ˜¯WARã€‚ SSM-WEBå…¶å®žWEBæ¨¡å—å’ŒSERVICEæ¨¡å—æœ‰ç‚¹é‡åˆäº†ã€‚é€šå¸¸æ¥è¯´è¿™ä¸ªæ¨¡å—ä¸€èˆ¬åœ¨ä¸€ä¸ªå¯¹å¤–æä¾›httpè®¿é—®æŽ¥å£çš„é¡¹ç›®ä¸­ã€‚ è¿™é‡Œåªæ˜¯ä¸ºäº†å±•ç¤ºé¡¹ç›®ç»“æž„ï¼Œæ‰€ä»¥ä¹Ÿå†™åœ¨äº†è¿™é‡Œã€‚ ä»–çš„ä½œç”¨å’Œserviceå·®ä¸å¤šï¼Œéƒ½æ˜¯WARçš„ç±»åž‹ã€‚ æ€»ç»“è¿™æ¬¡æ²¡æœ‰å®žçŽ°ä»€ä¹ˆç‰¹åˆ«çš„åŠŸèƒ½ï¼Œåªæ˜¯å¯¹ä¸€äº›è¿˜æ²¡æœ‰æŽ¥è§¦è¿‡è¿™ç§é¡¹ç›®ç»“æž„å¼€å‘çš„ç«¥éž‹èƒ½èµ·åˆ°ä¸€äº›å¼•å¯¼ä½œç”¨ã€‚ å…·ä½“æºç è¿˜è¯·å…³æ³¨æˆ‘çš„githubã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Maven</tag>
        <tag>é‡æž„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(ä¹) åå°„çš„å®žé™…åº”ç”¨ - æž„å»ºæ—¥å¿—å¯¹è±¡]]></title>
    <url>%2F2017%2F01%2F19%2FSSM9%2F</url>
    <content type="text"><![CDATA[å‰è¨€ç›¸ä¿¡åšJavaçš„ç«¥éž‹æˆ–å¤šæˆ–å°‘éƒ½å¬è¿‡åå°„ï¼Œè¿™ä¹Ÿåº”è¯¥æ˜¯Javaä»Žå…¥é—¨åˆ°è¿›é˜¶çš„å¿…ç»ä¹‹è·¯ã€‚ ä½†æ˜¯åœ¨æˆ‘ä»¬çš„å®žé™…å¼€å‘ä¸­ç›´æŽ¥ä½¿ç”¨å®ƒä»¬çš„å‡ çŽ‡è²Œä¼¼è¿˜æ˜¯æ¯”è¾ƒå°‘çš„ï¼Œï¼ˆé™¤äº†é€ è½®å­æˆ–è€…æ˜¯Spring Mybatisè¿™äº›æ¡†æž¶å¤–ï¼‰ã€‚ æ‰€ä»¥è¿™é‡Œä»‹ç»ä¸€ä¸ªåœ¨å®žé™…å¼€å‘ä¸­è¿˜æ˜¯å°æœ‰ç”¨å¤„çš„åå°„å®žä¾‹ã€‚ ä¼ ç»Ÿæ—¥å¿—æœ‰å…³åå°„çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†å°±ä¸è¯´äº†ï¼Œå¯ä»¥è‡ªè¡ŒGoogleï¼Œä¹Ÿå¯ä»¥çœ‹ä¸‹åå°„å…¥é—¨ã€‚ æ—¥å¿—ç›¸ä¿¡å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œåœ¨å®žé™…å¼€å‘ä¸­ä¸€äº›æ¯”è¾ƒæ•æ„Ÿçš„æ•°æ®è¡¨æˆ‘ä»¬éœ€è¦å¯¹å®ƒçš„æ¯ä¸€æ¬¡æ“ä½œéƒ½è®°å½•ä¸‹æ¥ã€‚ å…ˆæ¥çœ‹çœ‹ä¼ ç»Ÿçš„å†™æ³•ï¼š1234567891011121314@Testpublic void insertSelective() throws Exception &#123; Content content = new Content() ; content.setContent("asdsf"); content.setCreatedate("2016-12-09"); contentService.insertSelective(content) ; ContentLog log = new ContentLog(); log.setContentid(content.getContentid()); log.setContent("asdsf"); log.setCreatedate("2016-12-09"); contentLogService.insertSelective(log);&#125; éžå¸¸ç®€å•ï¼Œå°±æ˜¯åœ¨ä¿å­˜å®Œæ•°æ®è¡¨ä¹‹åŽå†æŠŠç›¸åŒçš„æ•°æ®ä¿å­˜åˆ°æ—¥å¿—è¡¨ä¸­ã€‚ä½†æ˜¯è¿™æ ·æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š å¦‚æžœæ•°æ®è¡¨çš„å­—æ®µè¾ƒå¤šçš„è¯ï¼Œæ¯”å¦‚å‡ ç™¾ä¸ªã€‚é‚£ä¹ˆæ—¥å¿—è¡¨çš„setter()æ–¹æ³•å°±å¾—å†™å‡ ç™¾æ¬¡ï¼Œè¿˜å¾—æ˜¯éƒ½å†™å¯¹çš„æƒ…å†µä¸‹ã€‚ å¦‚æžœå“ªå¤©æ•°æ®è¡¨çš„å­—æ®µå‘ç”Ÿäº†å¢žåŠ ï¼Œé‚£ä¹ˆæ¯ä¸ªå†™æ—¥å¿—çš„åœ°æ–¹éƒ½å¾—å¢žåŠ è¯¥å­—æ®µï¼Œæé«˜äº†ç»´æŠ¤çš„æˆæœ¬ã€‚ é’ˆå¯¹ä»¥ä¸Šçš„æƒ…å†µå°±å¾—éœ€è¦åå°„è¿™ä¸ªä¸»è§’æ¥è§£å†³äº†ã€‚ åˆ©ç”¨åå°„æž„å»ºæ—¥å¿—æˆ‘ä»¬å…ˆæ¥å…ˆæ¥çœ‹ä¸‹ä½¿ç”¨åå°„ä¹‹åŽå¯¹ä»£ç æ‰€å¸¦æ¥çš„æ”¹å˜ï¼š12345678910111213@Testpublic void insertSelective2() throws Exception &#123; Content content = new Content(); content.setContent("ä½ å¥½"); content.setContentname("1"); content.setCreatedate("2016-09-23"); contentService.insertSelective(content); ContentLog log = new ContentLog(); CommonUtil.setLogValueModelToModel(content, log); contentLogService.insertSelective(log);&#125; åŒæ ·çš„ä¿å­˜æ—¥å¿—ï¼Œä¸ç®¡å¤šå°‘å­—æ®µï¼Œåªéœ€è¦ä¸‰è¡Œä»£ç å³å¯è§£å†³ã€‚è€Œä¸”å°±ç®—ä¹‹åŽå­—æ®µå‘ç”Ÿæ”¹å˜å†™æ—¥å¿—è¿™æ®µä»£ç ä»ç„¶ä¸éœ€è¦æ”¹åŠ¨ã€‚ å…¶å®žè¿™é‡Œæœ€ä¸»è¦çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯CommonUtil.setLogValueModelToModel(content, log); æ¥çœ‹ä¸‹æ˜¯å¦‚ä½•å®žçŽ°çš„;12345678910111213141516171819202122232425262728293031323334353637/** * ç”Ÿæˆæ—¥å¿—å®žä½“å·¥å…· * * @param objectFrom * @param objectTo */ public static void setLogValueModelToModel(Object objectFrom, Object objectTo) &#123; Class&lt;? extends Object&gt; clazzFrom = objectFrom.getClass(); Class&lt;? extends Object&gt; clazzTo = objectTo.getClass(); for (Method toSetMethod : clazzTo.getMethods()) &#123; String mName = toSetMethod.getName(); if (mName.startsWith("set")) &#123; //å­—æ®µå String field = mName.substring(3); //èŽ·å–from å€¼ Object value; try &#123; if ("LogId".equals(field)) &#123; continue; &#125; Method fromGetMethod = clazzFrom.getMethod("get" + field); value = fromGetMethod.invoke(objectFrom); //è®¾ç½®å€¼ toSetMethod.invoke(objectTo, value); &#125; catch (NoSuchMethodException e) &#123; throw new RuntimeException(e); &#125; catch (InvocationTargetException e) &#123; throw new RuntimeException(e); &#125; catch (IllegalAccessException e) &#123; throw new RuntimeException(e); &#125; &#125; &#125; &#125; å†ä½¿ç”¨ä¹‹å‰æˆ‘ä»¬é¦–å…ˆéœ€è¦æž„å»ºå¥½ä¸»çš„æ•°æ®è¡¨ï¼Œç„¶åŽnewä¸€ä¸ªæ—¥å¿—è¡¨çš„å¯¹è±¡ã€‚ åœ¨setLogValueModelToModel()æ–¹æ³•ä¸­ï¼š åˆ†åˆ«èŽ·å¾—æ•°æ®è¡¨å’Œæ—¥å¿—è¡¨å¯¹è±¡çš„ç±»ç±»åž‹ã€‚ èŽ·å–åˆ°æ—¥å¿—å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•é›†åˆã€‚ éåŽ†è¯¥é›†åˆï¼Œå¹¶æ‹¿åˆ°è¯¥æ–¹æ³•çš„åç§°ã€‚ åªå–å…¶ä¸­setå¼€å¤´çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯setæ–¹æ³•ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨å¾ªçŽ¯ä¸­ä¸ºæ—¥å¿—å¯¹è±¡çš„æ¯ä¸€ä¸ªå­—æ®µèµ‹å€¼ã€‚ ä¹‹åŽæˆªå–æ–¹æ³•åç§°èŽ·å¾—å…·ä½“çš„å­—æ®µåç§°ã€‚ ç”¨ä¹‹å‰æˆªå–çš„å­—æ®µåç§°ï¼Œé€šè¿‡getMethod()æ–¹æ³•è¿”å›žæ•°æ®è¡¨ä¸­çš„è¯¥å­—æ®µçš„getteræ–¹æ³•ã€‚ ç›¸å½“äºŽæ‰§è¡Œäº†String content = content.getContent(); æ‰§è¡Œè¯¥æ–¹æ³•èŽ·å¾—è¯¥å­—æ®µå…·ä½“çš„å€¼ã€‚ åˆ©ç”¨å½“å‰å¾ªçŽ¯çš„setteræ–¹æ³•ä¸ºæ—¥å¿—å¯¹è±¡çš„æ¯ä¸€ä¸ªå­—æ®µèµ‹å€¼ã€‚ ç›¸å½“äºŽæ‰§è¡Œäº†log.setContent(&quot;asdsf&quot;); å…¶ä¸­å­—æ®µåç§°ä¸ºLogIdæ—¶è·³å‡ºäº†å½“å‰å¾ªçŽ¯ï¼Œå› ä¸ºLogIdæ˜¯æ—¥å¿—è¡¨çš„ä¸»é”®ï¼Œæ˜¯ä¸éœ€è¦èµ‹å€¼çš„ã€‚ å½“å¾ªçŽ¯ç»“æŸæ—¶ï¼Œæ—¥å¿—å¯¹è±¡ä¹Ÿå°±æž„å»ºå®Œæˆäº†ã€‚ä¹‹åŽåªéœ€è¦ä¿å­˜åˆ°æ•°æ®åº“ä¸­å³å¯ã€‚ æ€»ç»“åå°„å…¶å®žæ˜¯éžå¸¸è€—èµ„æºçš„ï¼Œå†ä½¿ç”¨è¿‡ç¨‹ä¸­è¿˜æ˜¯è¦æ…Žç”¨ã€‚å…¶ä¸­å¯¹methodã€fieldã€constructorç­‰å¯¹è±¡åšç¼“å­˜ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Reflect</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(å…«)åŠ¨æ€åˆ‡æ¢æ•°æ®æº]]></title>
    <url>%2F2017%2F01%2F05%2FSSM8%2F</url>
    <content type="text"><![CDATA[å‰è¨€ åœ¨çŽ°åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­åº”è¯¥å¤§å¤šæ•°æœ‹å‹éƒ½æœ‰é‡åˆ°è¿‡åˆ‡æ¢æ•°æ®æºçš„éœ€æ±‚ã€‚æ¯”å¦‚çŽ°åœ¨å¸¸ç”¨çš„æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œæˆ–è€…å°±æ˜¯æœ‰ä¸¤ä¸ªæ•°æ®åº“çš„æƒ…å†µï¼Œè¿™äº›éƒ½éœ€è¦ç”¨åˆ°åˆ‡æ¢æ•°æ®æºã€‚ æ‰‹åŠ¨åˆ‡æ¢æ•°æ®æºä½¿ç”¨Springçš„AbstractRoutingDataSourceç±»æ¥è¿›è¡Œæ‹“å±•å¤šæ•°æ®æºã€‚ è¯¥ç±»å°±ç›¸å½“äºŽä¸€ä¸ªdataSourceçš„è·¯ç”±ï¼Œç”¨äºŽæ ¹æ®keyå€¼æ¥è¿›è¡Œåˆ‡æ¢å¯¹åº”çš„dataSourceã€‚ ä¸‹é¢ç®€å•æ¥çœ‹ä¸‹AbstractRoutingDataSourceç±»çš„å‡ æ®µå…³é”®æºç ï¼š123456789101112131415161718192021222324252627282930313233343536373839@Overridepublic Connection getConnection() throws SQLException &#123; return determineTargetDataSource().getConnection();&#125;@Overridepublic Connection getConnection(String username, String password) throws SQLException &#123; return determineTargetDataSource().getConnection(username, password);&#125;/** * Retrieve the current target DataSource. Determines the * &#123;@link #determineCurrentLookupKey() current lookup key&#125;, performs * a lookup in the &#123;@link #setTargetDataSources targetDataSources&#125; map, * falls back to the specified * &#123;@link #setDefaultTargetDataSource default target DataSource&#125; if necessary. * @see #determineCurrentLookupKey() */protected DataSource determineTargetDataSource() &#123; Assert.notNull(this.resolvedDataSources, "DataSource router not initialized"); Object lookupKey = determineCurrentLookupKey(); DataSource dataSource = this.resolvedDataSources.get(lookupKey); if (dataSource == null &amp;&amp; (this.lenientFallback || lookupKey == null)) &#123; dataSource = this.resolvedDefaultDataSource; &#125; if (dataSource == null) &#123; throw new IllegalStateException("Cannot determine target DataSource for lookup key [" + lookupKey + "]"); &#125; return dataSource;&#125;/** * Determine the current lookup key. This will typically be * implemented to check a thread-bound transaction context. * &lt;p&gt;Allows for arbitrary keys. The returned key needs * to match the stored lookup key type, as resolved by the * &#123;@link #resolveSpecifiedLookupKey&#125; method. */protected abstract Object determineCurrentLookupKey(); å¯ä»¥çœ‹åˆ°å…¶ä¸­èŽ·å–é“¾æŽ¥çš„æ–¹æ³•getConnection()è°ƒç”¨çš„determineTargetDataSourceåˆ™æ˜¯å…³é”®æ–¹æ³•ã€‚è¯¥æ–¹æ³•ç”¨äºŽè¿”å›žæˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®æºã€‚ å…¶ä¸­å‘¢åˆæ˜¯determineCurrentLookupKey()æ–¹æ³•æ¥è¿”å›žå½“å‰æ•°æ®æºçš„keyå€¼ã€‚ä¹‹åŽé€šè¿‡è¯¥keyå€¼åœ¨resolvedDataSourcesè¿™ä¸ªmapä¸­æ‰¾åˆ°å¯¹åº”çš„value(è¯¥valueå°±æ˜¯æ•°æ®æº)ã€‚ resolvedDataSourcesè¿™ä¸ªmapåˆ™æ˜¯åœ¨ï¼š123456789101112131415@Overridepublic void afterPropertiesSet() &#123; if (this.targetDataSources == null) &#123; throw new IllegalArgumentException("Property 'targetDataSources' is required"); &#125; this.resolvedDataSources = new HashMap&lt;Object, DataSource&gt;(this.targetDataSources.size()); for (Map.Entry&lt;Object, Object&gt; entry : this.targetDataSources.entrySet()) &#123; Object lookupKey = resolveSpecifiedLookupKey(entry.getKey()); DataSource dataSource = resolveSpecifiedDataSource(entry.getValue()); this.resolvedDataSources.put(lookupKey, dataSource); &#125; if (this.defaultTargetDataSource != null) &#123; this.resolvedDefaultDataSource = resolveSpecifiedDataSource(this.defaultTargetDataSource); &#125;&#125; è¿™ä¸ªæ–¹æ³•é€šè¿‡targetDataSourcesè¿™ä¸ªmapæ¥è¿›è¡Œèµ‹å€¼çš„ã€‚targetDataSourcesåˆ™æ˜¯æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œèµ‹å€¼çš„ï¼Œä¸‹é¢ä¼šè®²åˆ°ã€‚ å†æ¥çœ‹çœ‹determineCurrentLookupKey()æ–¹æ³•ï¼Œä»Žprotectedæ¥ä¿®é¥°å°±å¯ä»¥çœ‹å‡ºæ˜¯éœ€è¦æˆ‘ä»¬æ¥è¿›è¡Œé‡å†™çš„ã€‚ DynamicDataSource å’Œ DataSourceHolderäºŽæ˜¯æˆ‘æ–°å¢žäº†DynamicDataSourceç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617package com.crossoverJie.util;import org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;/** * Function: * * @author chenjiec * Date: 2017/1/2 ä¸Šåˆ12:22 * @since JDK 1.7 */public class DynamicDataSource extends AbstractRoutingDataSource &#123; @Override protected Object determineCurrentLookupKey() &#123; return DataSourceHolder.getDataSources(); &#125;&#125; ä»£ç å¾ˆç®€å•ï¼Œç»§æ‰¿äº†AbstractRoutingDataSourceç±»å¹¶é‡å†™äº†å…¶ä¸­çš„determineCurrentLookupKey()æ–¹æ³•ã€‚ è¿™é‡Œç›´æŽ¥ç”¨DataSourceHolderè¿”å›žäº†ä¸€ä¸ªæ•°æ®æºã€‚ DataSourceHolderä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920package com.crossoverJie.util;/** * Function:åŠ¨æ€æ•°æ®æº * * @author chenjiec * Date: 2017/1/2 ä¸Šåˆ12:19 * @since JDK 1.7 */public class DataSourceHolder &#123; private static final ThreadLocal&lt;String&gt; dataSources = new ThreadLocal&lt;String&gt;(); public static void setDataSources(String dataSource) &#123; dataSources.set(dataSource); &#125; public static String getDataSources() &#123; return dataSources.get(); &#125;&#125; è¿™é‡Œæˆ‘ä½¿ç”¨äº†ThreadLocalæ¥ä¿å­˜äº†æ•°æ®æºï¼Œå…³äºŽThreadLocalçš„çŸ¥è¯†ç‚¹å¯ä»¥æŸ¥çœ‹ä»¥ä¸‹è¿™ç¯‡æ–‡ç« ï¼šè§£å¯†ThreadLocal ä¹‹åŽåœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®æˆ‘ä»¬çš„æ•°æ®æºï¼Œå°±æ˜¯ä¸Šæ–‡è®²åˆ°çš„ä¸ºtargetDataSourcesèµ‹å€¼ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566&lt;bean id="ssm1DataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close"&gt; &lt;!-- æŒ‡å®šè¿žæŽ¥æ•°æ®åº“çš„é©±åŠ¨ --&gt; &lt;property name="driverClassName" value="$&#123;jdbc.driverClass&#125;" /&gt; &lt;property name="url" value="$&#123;jdbc.url&#125;" /&gt; &lt;property name="username" value="$&#123;jdbc.user&#125;" /&gt; &lt;property name="password" value="$&#123;jdbc.password&#125;" /&gt; &lt;!-- é…ç½®åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§ --&gt; &lt;property name="initialSize" value="3" /&gt; &lt;property name="minIdle" value="3" /&gt; &lt;property name="maxActive" value="20" /&gt; &lt;!-- é…ç½®èŽ·å–è¿žæŽ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt; &lt;property name="maxWait" value="60000" /&gt; &lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿žæŽ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="timeBetweenEvictionRunsMillis" value="60000" /&gt; &lt;!-- é…ç½®ä¸€ä¸ªè¿žæŽ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="minEvictableIdleTimeMillis" value="300000" /&gt; &lt;property name="validationQuery" value="SELECT 'x'" /&gt; &lt;property name="testWhileIdle" value="true" /&gt; &lt;property name="testOnBorrow" value="false" /&gt; &lt;property name="testOnReturn" value="false" /&gt; &lt;!-- æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿žæŽ¥ä¸ŠPSCacheçš„å¤§å° --&gt; &lt;property name="poolPreparedStatements" value="true" /&gt; &lt;property name="maxPoolPreparedStatementPerConnectionSize" value="20" /&gt; &lt;!-- é…ç½®ç›‘æŽ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼ŒåŽ»æŽ‰åŽç›‘æŽ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ --&gt; &lt;property name="filters" value="stat" /&gt; &lt;/bean&gt; &lt;bean id="ssm2DataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close"&gt; &lt;!-- æŒ‡å®šè¿žæŽ¥æ•°æ®åº“çš„é©±åŠ¨ --&gt; &lt;property name="driverClassName" value="$&#123;jdbc.driverClass&#125;"/&gt; &lt;property name="url" value="$&#123;jdbc.url2&#125;"/&gt; &lt;property name="username" value="$&#123;jdbc.user2&#125;"/&gt; &lt;property name="password" value="$&#123;jdbc.password2&#125;"/&gt; &lt;property name="initialSize" value="3"/&gt; &lt;property name="minIdle" value="3"/&gt; &lt;property name="maxActive" value="20"/&gt; &lt;!-- é…ç½®èŽ·å–è¿žæŽ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt; &lt;property name="maxWait" value="60000"/&gt; &lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿žæŽ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="timeBetweenEvictionRunsMillis" value="60000"/&gt; &lt;!-- é…ç½®ä¸€ä¸ªè¿žæŽ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="minEvictableIdleTimeMillis" value="300000"/&gt; &lt;property name="validationQuery" value="SELECT 'x'"/&gt; &lt;property name="testWhileIdle" value="true"/&gt; &lt;property name="testOnBorrow" value="false"/&gt; &lt;property name="testOnReturn" value="false"/&gt; &lt;!-- æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿žæŽ¥ä¸ŠPSCacheçš„å¤§å° --&gt; &lt;property name="poolPreparedStatements" value="true"/&gt; &lt;property name="maxPoolPreparedStatementPerConnectionSize" value="20"/&gt; &lt;!-- é…ç½®ç›‘æŽ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼ŒåŽ»æŽ‰åŽç›‘æŽ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ --&gt; &lt;property name="filters" value="stat"/&gt; &lt;/bean&gt; &lt;bean id="dataSource" class="com.crossoverJie.util.DynamicDataSource"&gt; &lt;property name="targetDataSources"&gt; &lt;map key-type="java.lang.String"&gt; &lt;entry key="ssm1DataSource" value-ref="ssm1DataSource"/&gt; &lt;entry key="ssm2DataSource" value-ref="ssm2DataSource"/&gt; &lt;/map&gt; &lt;/property&gt; &lt;!--é»˜è®¤æ•°æ®æº--&gt; &lt;property name="defaultTargetDataSource" ref="ssm1DataSource"/&gt; &lt;/bean&gt; è¿™é‡Œåˆ†åˆ«é…ç½®äº†ä¸¤ä¸ªæ•°æ®æºï¼šssm1DataSourceå’Œssm2DataSourceã€‚ä¹‹åŽå†é€šè¿‡Springçš„ä¾èµ–æ³¨å…¥æ–¹å¼å°†ä¸¤ä¸ªæ•°æ®æºè®¾ç½®è¿›targetDataSourcesã€‚ æŽ¥ä¸‹æ¥çš„ç”¨æ³•ç›¸æ¯”å¤§å®¶ä¹Ÿåº”è¯¥çŒœåˆ°äº†ã€‚ å°±æ˜¯åœ¨æ¯æ¬¡è°ƒç”¨æ•°æ®åº“ä¹‹å‰æˆ‘ä»¬éƒ½è¦å…ˆé€šè¿‡DataSourceHolderæ¥è®¾ç½®å½“å‰çš„æ•°æ®æºã€‚çœ‹ä¸‹demoï¼š123456@Testpublic void selectByPrimaryKey() throws Exception &#123; DataSourceHolder.setDataSources(Constants.DATASOURCE_TWO); Datasource datasource = dataSourceService.selectByPrimaryKey(7); System.out.println(JSON.toJSONString(datasource));&#125; è¯¦è§æˆ‘çš„å•æµ‹ã€‚ ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯éžå¸¸ç®€å•ã€‚ä½†æ˜¯ä¸çŸ¥é“å¤§å®¶æ³¨æ„åˆ°æ²¡æœ‰ï¼Œè¿™æ ·çš„åšæ³•æ§½ç‚¹å¾ˆå¤šï¼š æ¯æ¬¡ä½¿ç”¨éœ€è¦æ‰‹åŠ¨åˆ‡æ¢ï¼Œæ€»æœ‰ä¸€äº›äººä¼šå¿˜è®°å†™(æ¯”å¦‚æˆ‘)ã€‚ å¦‚æžœæ˜¯åŽæœŸéœ€æ±‚å˜äº†ï¼ŒæŸ¥è¯¢å…¶ä»–çš„è¡¨äº†è¿˜å¾—ä¸€ä¸ªä¸ªæ”¹å›žæ¥ã€‚ é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥è‡ªåŠ¨çš„å¸®æˆ‘ä»¬åˆ‡æ¢å‘¢ï¼Ÿ è‚¯å®šæ˜¯æœ‰çš„ï¼Œå¤§å®¶åº”è¯¥ä¹Ÿæƒ³å¾—åˆ°ã€‚å°±æ˜¯åˆ©ç”¨Springçš„AOPäº†ã€‚ è‡ªåŠ¨åˆ‡æ¢æ•°æ®æºé¦–å…ˆè¦å®šä¹‰å¥½æˆ‘ä»¬çš„åˆ‡é¢ç±»DataSourceExchange:1234567891011121314151617181920212223242526272829303132333435363738394041package com.crossoverJie.util;import org.aspectj.lang.JoinPoint;/** * Function:æ‹¦æˆªå™¨æ–¹æ³• * * @author chenjiec * Date: 2017/1/3 ä¸Šåˆ12:34 * @since JDK 1.7 */public class DataSourceExchange &#123; /** * * @param point */ public void before(JoinPoint point) &#123; //èŽ·å–ç›®æ ‡å¯¹è±¡çš„ç±»ç±»åž‹ Class&lt;?&gt; aClass = point.getTarget().getClass(); //èŽ·å–åŒ…åç”¨äºŽåŒºåˆ†ä¸åŒæ•°æ®æº String whichDataSource = aClass.getName().substring(25, aClass.getName().lastIndexOf(".")); if ("ssmone".equals(whichDataSource)) &#123; DataSourceHolder.setDataSources(Constants.DATASOURCE_ONE); &#125; else &#123; DataSourceHolder.setDataSources(Constants.DATASOURCE_TWO); &#125; &#125; /** * æ‰§è¡ŒåŽå°†æ•°æ®æºç½®ä¸ºç©º */ public void after() &#123; DataSourceHolder.setDataSources(null); &#125;&#125; é€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨æ‰§è¡Œæ•°æ®åº“æ“ä½œä¹‹å‰åšä¸€ä¸ªåˆ‡é¢ã€‚ é€šè¿‡JoinPointå¯¹è±¡èŽ·å–ç›®æ ‡å¯¹è±¡ã€‚ åœ¨ç›®æ ‡å¯¹è±¡ä¸­èŽ·å–åŒ…åæ¥åŒºåˆ†ä¸åŒçš„æ•°æ®æºã€‚ æ ¹æ®ä¸åŒæ•°æ®æºæ¥è¿›è¡Œèµ‹å€¼ã€‚ æ‰§è¡Œå®Œæ¯•ä¹‹åŽå°†æ•°æ®æºæ¸…ç©ºã€‚ å…³äºŽä¸€äº›JoinPointçš„APIï¼š1234567891011121314package org.aspectj.lang;import org.aspectj.lang.reflect.SourceLocation;public interface JoinPoint &#123; String toString(); //è¿žæŽ¥ç‚¹æ‰€åœ¨ä½ç½®çš„ç›¸å…³ä¿¡æ¯ String toShortString(); //è¿žæŽ¥ç‚¹æ‰€åœ¨ä½ç½®çš„ç®€çŸ­ç›¸å…³ä¿¡æ¯ String toLongString(); //è¿žæŽ¥ç‚¹æ‰€åœ¨ä½ç½®çš„å…¨éƒ¨ç›¸å…³ä¿¡æ¯ Object getThis(); //è¿”å›žAOPä»£ç†å¯¹è±¡ Object getTarget(); //è¿”å›žç›®æ ‡å¯¹è±¡ Object[] getArgs(); //è¿”å›žè¢«é€šçŸ¥æ–¹æ³•å‚æ•°åˆ—è¡¨ Signature getSignature(); //è¿”å›žå½“å‰è¿žæŽ¥ç‚¹ç­¾å SourceLocation getSourceLocation();//è¿”å›žè¿žæŽ¥ç‚¹æ–¹æ³•æ‰€åœ¨ç±»æ–‡ä»¶ä¸­çš„ä½ç½® String getKind(); //è¿žæŽ¥ç‚¹ç±»åž‹ StaticPart getStaticPart(); //è¿”å›žè¿žæŽ¥ç‚¹é™æ€éƒ¨åˆ†&#125; ä¸ºäº†é€šè¿‡åŒ…åæ¥åŒºåˆ†ä¸åŒæ•°æ®æºï¼Œæˆ‘å°†ç›®å½•ç»“æž„ç¨å¾®è°ƒæ•´äº†ä¸‹ï¼š å°†ä¸¤ä¸ªä¸åŒçš„æ•°æ®æºçš„å®žçŽ°ç±»æ”¾åˆ°ä¸åŒçš„åŒ…ä¸­ï¼Œè¿™æ ·ä»ŠåŽå¦‚æžœè¿˜éœ€è¦æ–°å¢žå…¶ä»–æ•°æ®æºä¹Ÿå¯ä»¥çµæ´»çš„åˆ‡æ¢ã€‚ çœ‹ä¸‹Springçš„é…ç½®ï¼š123456789101112131415161718192021&lt;bean id="dataSourceExchange" class="com.crossoverJie.util.DataSourceExchange"/&gt;&lt;!--é…ç½®åˆ‡é¢æ‹¦æˆªæ–¹æ³• --&gt;&lt;aop:config proxy-target-class="false"&gt; &lt;!--å°†com.crossoverJie.serviceåŒ…ä¸‹çš„æ‰€æœ‰selectå¼€å¤´çš„æ–¹æ³•åŠ å…¥æ‹¦æˆª åŽ»æŽ‰selectåˆ™åŠ å…¥æ‰€æœ‰æ–¹æ³• --&gt; &lt;aop:pointcut id="controllerMethodPointcut" expression=" execution(* com.crossoverJie.service.*.select*(..))"/&gt; &lt;aop:pointcut id="selectMethodPointcut" expression=" execution(* com.crossoverJie.dao..*Mapper.select*(..))"/&gt; &lt;aop:advisor advice-ref="methodCacheInterceptor" pointcut-ref="controllerMethodPointcut"/&gt; &lt;!--æ‰€æœ‰æ•°æ®åº“æ“ä½œçš„æ–¹æ³•åŠ å…¥åˆ‡é¢--&gt; &lt;aop:aspect ref="dataSourceExchange"&gt; &lt;aop:pointcut id="dataSourcePointcut" expression="execution(* com.crossoverJie.service.*.*(..))"/&gt; &lt;aop:before pointcut-ref="dataSourcePointcut" method="before"/&gt; &lt;aop:after pointcut-ref="dataSourcePointcut" method="after"/&gt; &lt;/aop:aspect&gt;&lt;/aop:config&gt; è¿™æ˜¯åœ¨æˆ‘ä»¬ä¸Šä¸€ç¯‡æ•´åˆredisç¼“å­˜çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹çš„ã€‚è¿™æ ·ç¼“å­˜å’Œå¤šæ•°æ®æºéƒ½æ»¡è¶³äº†ã€‚ å®žé™…ä½¿ç”¨ï¼š12345@Testpublic void selectByPrimaryKey() throws Exception &#123; Rediscontent rediscontent = rediscontentService.selectByPrimaryKey(30); System.out.println(JSON.toJSONString(rediscontent));&#125; è¿™æ ·çœ‹èµ·æ¥å°±å’Œä½¿ç”¨ä¸€ä¸ªæ•°æ®æºè¿™æ ·ç®€å•ï¼Œå†ä¹Ÿä¸ç”¨å…³å¿ƒåˆ‡æ¢çš„é—®é¢˜äº†ã€‚ æ€»ç»“ä¸è¿‡æŒ‰ç…§è¿™æ ·çš„å†™æ³•æ˜¯æ— æ³•åšåˆ°åœ¨ä¸€ä¸ªäº‹åŠ¡é‡ŒæŽ§åˆ¶ä¸¤ä¸ªæ•°æ®æºçš„ã€‚è¿™ä¸ªæˆ‘è¿˜åœ¨å­¦ä¹ ä¸­ï¼Œæœ‰ç›¸å…³ç»éªŒçš„å¤§ç‰›ä¸å¦¨æŒ‡ç‚¹ä¸€ä¸‹ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>AOP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GoodBye 2016,Welcome 2017 | ç å†œç Œå¢™è®°]]></title>
    <url>%2F2016%2F12%2F31%2FGoodBye%202016%2CWelcome%202017%20%7C%20%E7%A0%81%E5%86%9C%E7%A0%8C%E5%A2%99%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æ—©åœ¨è¿™ä¸ªæœˆåˆçš„æ—¶å€™æˆ‘å°±å¾ˆæƒ³å†™ä¸€ç¯‡å¹´ç»ˆæ€»ç»“äº†ï¼Œå› ä¸ºè¿™ä¸€å¹´ç›¸å¯¹äºŽåŽ»å¹´ç¡®å®žæ˜¯ç»åŽ†çš„å¤ªå¤šäº†ã€‚ç»“æžœä¸€ç›´ç­‰åˆ°31å·ï¼Œåœ¨å®¶é‡Œå’Œåª³å¦‡åƒå®Œæ™šé¥­å°±é©¬ä¸Šæ‰“å¼€ç”µè„‘å¼€ç ã€‚ äº”æœˆäºŒåä¸‰-ç¬¬ä¸€æ¬¡è·³æ§½ æ ¹æ®æ•´å¹´çš„æ—¶é—´çº¿å¼€å§‹ç¬¬ä¸€ä»¶å¤§äº‹è‡ªç„¶å°±æ˜¯æ¢å…¬å¸äº†ã€‚ å…ˆæ¥ç‚¹å‰æ™¯æè¦:æˆ‘æ˜¯14å¹´11æœˆä»½å‚åŠ å·¥ä½œçš„ã€‚å½“æ—¶å…¶å®žè¿˜æ²¡æœ‰æ¯•ä¸šå°±åœ¨ä¸€å®¶ç»™å¤§åž‹ä¼ä¸šåšå®šåˆ¶è½¯ä»¶å¼€å‘çš„å…¬å¸å®žä¹ ã€‚åˆšå¼€å§‹å·¥ä½œçš„æ—¶å€™ä»€ä¹ˆäº‹æƒ…éƒ½è§‰å¾—éžå¸¸æ–°å¥‡ï¼Œä¸€ä¸ªåœ¨å­¦æ ¡å­¦çš„ä¸œè¥¿èƒ½è¿ç”¨åˆ°å®žé™…å¼€å‘ä¸­å¹¶èƒ½ç»™ç”¨æˆ·å¸¦æ¥ä¾¿åˆ©è®©æˆ‘è§‰å¾—åšç å†œçœŸæ˜¯ä¸€ä»¶éžå¸¸æ­£ç¡®çš„é€‰æ‹©å•Š(pså½“æ—¶çœŸæ˜¯å¤ªå¹´è½»)ã€‚ åŽæ¥çœŸæ˜¯é€ åŒ–å¼„äººï¼Œå½“æ—¶è´Ÿè´£æˆ‘å‚ä¸Žçš„è¿™ä¸ªé¡¹ç›®çš„è´Ÿè´£äººè·³æ§½äº†ï¼Œæˆ‘è‡ªç„¶å°±æˆäº†æ•´ä¸ªå…¬å¸æœ€ç†Ÿæ‚‰æ­¤é¡¹ç›®çš„äººäº†ã€‚çŽ°åœ¨ä¸å¾—ä¸ä½©æœå…¬å¸è€æ¿çœŸæ˜¯å¿ƒå¤§å•Šï¼Œå±…ç„¶è®©ä¸€ä¸ªå®žä¹ ç”Ÿæ¥è´Ÿè´£è¿™ä¸ªé¡¹ç›®ã€‚å°±è¿™æ ·æˆ‘æˆäº†æ•´ä¸ªé¡¹ç›®çš„è´Ÿè´£äººï¼Œä»Žä¹‹åŽçš„å¼€å‘åˆ°æµ‹è¯•åˆ°ä¸Šçº¿åˆ°åŽé¢çš„ç»´æŠ¤å‡ ä¹Žéƒ½æ˜¯æˆ‘ä¸€ä¸ªäººåœ¨è´Ÿè´£ã€‚æ¥ä¸€å¼ å½“æ—¶ä¸Šçº¿çš„æˆªå›¾ï¼š ç”±äºŽè¿™æ¬¡é¡¹ç›®çš„é¡ºåˆ©éªŒæ”¶ï¼Œå…¬å¸ä¹Ÿå¯¹æˆ‘è¶Šæ¥è¶Šä¿¡ä»»ã€‚ä¹‹åŽä¹Ÿå°±ç†æ‰€å½“ç„¶çš„åˆè´Ÿè´£äº†å‡ ä¸ªé¡¹ç›®ã€‚ è™½ç„¶ç¦»å¼€äº†ä½†çœŸçš„éžå¸¸æ„Ÿè°¢å…¬å¸å½“æ—¶å¯¹ä¸€ä¸ªä»€ä¹ˆéƒ½ä¸æ‡‚çš„æ–°äººç»™äºˆä¿¡ä»»ã€‚ ä¹‹åŽéšç€æŠ€æœ¯çš„æå‡æˆ‘æŽ¥è§¦äº†githubã€vç«™è¿™æ ·çš„æŠ€æœ¯è®ºå›ï¼Œé€æ¸çš„å‘çŽ°å¤©å¤–æœ‰å¤©ï¼Œæˆ‘è¿™ç‚¹é›•è™«å°æŠ€çœŸçš„å®Œå…¨ä¸ç®—ä»€ä¹ˆï¼ŒçœŸæ­£æœºé‡ä¸ŽæŒ‘æˆ˜å¹¶å­˜çš„åœ°æ–¹æ˜¯äº’è”ç½‘ã€‚ ä½†æ˜¯æ­¤æ—¶æˆ‘å·²ç»åœ¨è¿™å®¶å…¬å¸åšäº†ä¸€å¹´å¤šäº†ï¼Œçªç„¶ç¦»å¼€è¿™ä¸ªèˆ’é€‚åœˆæ¥åˆ°ä¸€ä¸ªé™Œç”Ÿçš„çŽ¯å¢ƒæ˜¯éœ€è¦å¾ˆå¤§å‹‡æ°”çš„ï¼Œæˆ–è€…è¯´éœ€è¦ä¸€ä¸ªåˆºæ¿€ç‚¹ã€‚ æ­£å¥½@å˜Ÿçˆ·æˆäº†è¿™ä¸ªå¯¼ç«ç´¢ã€‚é‚£ä¸ªæ—¶å€™æˆ‘æ­£åœ¨æ­æˆ‘çš„ä¸ªäººåšå®¢æ­£å¥½çœ‹åˆ°äº†ä»–çš„æ–‡ç« ï¼Œè§‰å¾—å†™å¾—éžå¸¸å¥½ã€‚è€Œä¸”æ­£å¥½ä»–ä¹Ÿæ­£å‡†å¤‡è½¬å‘äº’è”ç½‘ï¼ŒäºŽæ˜¯æˆ‘ç»™ä»–å†™äº†ä¸€å°å¾ˆé•¿çš„é‚®ä»¶è¯´äº†æˆ‘å¿ƒä¸­çš„ä¸€äº›ç–‘æƒ‘ä¸Žé¡¾è™‘è®©ä»–ç»™ç‚¹å»ºè®®ã€‚ åœ¨ä»–çš„å»ºè®®ä¹‹ä¸‹æˆ‘æ‰å¼€å§‹æŠ•é€’ç®€åŽ†å‡†å¤‡æ¢ä¸€å®¶äº’è”ç½‘å…¬å¸ï¼Œæ„Ÿè°¢å˜Ÿçˆ·ç»™äº†æˆ‘ä¸€ä¸ªè¿™ä¹ˆæ­£ç¡®çš„å»ºè®®ã€‚ ä¹‹åŽæˆ‘é¡ºåˆ©çš„è¿›å…¥äº†ä¸€ä¸ªåˆ›ä¸šå…¬å¸ï¼Œå¼€å§‹äº†ç‹­ä¹‰çš„äº’è”ç½‘å¼€å‘é“è·¯ï¼Œä¸ºä»€ä¹ˆæ˜¯ç‹­ä¹‰è¯·æŽ¥ç€å¾€åŽçœ‹ã€‚ æ­å»ºä¸ªäººåšå®¢ æ­å»ºåšå®¢è¿™äº‹ä¹Ÿæ˜¯å¿…é¡»çš„æ‹¿å‡ºæ¥è¯´ä¸€è¯´çš„ã€‚ ä¸Šé¢è¯´åˆ°æˆ‘çœ‹äº†å˜Ÿçˆ·çš„åšå®¢æ‰å¼€å§‹æ­å»ºè‡ªå·±çš„åšå®¢ï¼Œåˆ°çŽ°åœ¨ä¸ºæ­¢ç”±äºŽæˆ‘çš„æ‹–å»¶ç—‡(åŠ ä¸Šæ˜¯çœŸçš„æ‡’)ä¸€å…±å†™äº†20ç¯‡ã€‚ä¸èƒ½è¯´å†™çš„æœ‰å¤šå¥½ï¼Œä½†ç¡®å®žæ˜¯æˆ‘åœ¨å·¥ä½œå’Œå­¦ä¹ ä¸­çš„ä¸€äº›æ€»ç»“ã€‚ è®©æˆ‘æ„å¤–çš„æ˜¯æˆ‘åšå®¢çš„è®¿é—®é‡ï¼Œä¸‹å›¾æ˜¯æˆ‘cnzzçš„ç»Ÿè®¡æˆªå›¾ï¼š å…­æœˆäºŒåä¸€-å¼€æºé¡¹ç›®å…³äºŽå¼€æºé¡¹ç›®ï¼Œä¹‹å‰æˆ‘åœ¨githubä¸Šé¢çœ‹å¾ˆå¤šä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼Œä¹Ÿå¾ˆä½©æœé‚£äº›ä½œè€…ï¼ŒäºŽæ˜¯å°±æƒ³ç€è‡ªå·±èƒ½ä¸èƒ½ä¹Ÿæžä¸€ä¸ªï¼Œä½†æ˜¯ä¸€æ¥å°±é€ ä¸ªè½®å­å¯¹æˆ‘æ¥è¯´ç¡®å®žæœ‰ç‚¹ä¸çŽ°å®žã€‚ äºŽæ˜¯æˆ‘æ¢äº†ä¸€ä¸ªæ€è·¯ï¼Œç”±äºŽçŽ°åœ¨æˆ‘å‹‰å¼ºä¹Ÿä¸ç®—æ˜¯æ–°å…¥é—¨çš„èœé¸Ÿäº†ï¼Œä½†æˆ‘æ˜¯ä»Žèœé¸Ÿè¿‡æ¥çš„ï¼Œæ·±çŸ¥åˆšå¼€å§‹çš„æ—¶å€™æ‰¾èµ„æ–™çš„ç—›è‹¦ã€‚ä¸æ˜¯èµ„æ–™å¤ªè€å°±æ˜¯æ²¡æœ‰ä½“ç³»ï¼Œè®²ä¸€ç‚¹æ˜¯ä¸€ç‚¹çš„é‚£ç§ã€‚ äºŽæ˜¯å°±æœ‰äº†çŽ°åœ¨è¿™ä¸ªé¡¹ç›®:ä¼šä¸å®šæœŸæ›´æ–°ä¸€äº›åœ¨å®žé™…å¼€å‘ä¸­ä½¿ç”¨çš„æŠ€å·§(ps:ç›®å‰ä¸æ˜¯å¾ˆå¿™åŸºæœ¬ä¸Šä¸€å‘¨ä¸€æ›´)ã€‚ æ²¡æœ‰å¤æ‚çš„ä¸šåŠ¡æµç¨‹ï¼Œæ›´ä¸æ˜¯XXXXç³»ç»Ÿï¼Œåªæœ‰ä¸€äº›æŠ€æœ¯çš„åˆ†äº«ã€‚ ä»Žå…­æœˆäºŒåä¸€å·åˆ°çŽ°åœ¨è¿˜æ˜¯æœ‰100å¤šé¢—æ˜Ÿäº†ï¼š ä¹æœˆäºŒåä¸‰-ç¬¬äºŒæ¬¡è·³æ§½çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯è§‰å¾—æˆ‘æœ‰ç—…å•Šï¼Œæ€Žä¹ˆåˆæ˜¯è·³æ§½ã€‚ã€‚ã€‚ å…¶å®žæˆ‘ä¹Ÿä¸æƒ³ï¼Œæˆ‘åœ¨ä¸Šé¢è¯´åˆ°å¼€å§‹äº†æˆ‘çš„ç‹­ä¹‰äº’è”ç½‘å¼€å‘ï¼Œä¸ºä»€ä¹ˆæ˜¯ç‹­ä¹‰å‘¢ï¼Ÿ å› ä¸ºåšäº†ä¸€æ®µæ—¶é—´æ‰å‘çŽ°è¿™ä¸ªé¡¹ç›®é™¤äº†æ˜¯éƒ¨ç½²åœ¨äº‘æœåŠ¡å™¨ä¸Šå’Œæœ‰ä¸€ä¸ªå¾®ä¿¡ç«¯ä¹‹å¤–å’Œæˆ‘ä¹‹å‰æ‰€åšçš„é¡¹ç›®è²Œä¼¼æ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œè¿˜æ˜¯ä¸€ä¸ªç®¡ç†ç³»ç»Ÿã€‚ è¿™é‡Œæˆ‘ä¸è¯„ä»·å…¬å¸çš„ä¸šåŠ¡ï¼Œä½†æ˜¯å…¬å¸çš„æŠ€æœ¯æ€»ç›‘åœ¨ä¿®æ”¹é—®é¢˜çš„æ—¶å€™æ˜¯ç›´æŽ¥åœ¨äº‘æœåŠ¡å™¨ä¸Šç™»é™†æ•°æ®åº“åˆ é™¤æ•°æ®ï¼Œä¼šä¸ä¼šè§‰å¾—å¾ˆå¥‡è‘©ã€‚æœ€å¥‡è‘©çš„æ˜¯åˆ é™¤çš„æ—¶å€™å¿˜äº†å†™whereæ¡ä»¶å¯¼è‡´æŠŠæ•´å¼ è¡¨çš„æ•°æ®éƒ½åˆ äº†ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æžœæ˜¯ä½ ä½ ä¼šä¸ä¼šæ€€ç–‘é‚£å•¥ã€‚ã€‚ é™¤æ­¤ä¹‹å¤–æŠ€æœ¯æ€»ç›‘æœ¬äººè¿˜æ˜¯æŒºå¥½çš„ï¼Œä¸è¿‡æˆ‘æ›´è§‰å¾—ä»–é€‚åˆåšé”€å”®æ€»ç›‘ã€‚ åŠ ä¸ŠåŽæ¥å…¬å¸çš„ä¸šåŠ¡æ²¡æœ‰å‘å±•èµ·æ¥ï¼Œæ‰€åšçš„ç³»ç»Ÿåˆè€æ˜¯å‡ºé—®é¢˜(è”æƒ³ä¸Šæ–‡)ï¼ŒåŠ ä¸Šè¿˜åœ¨æµä¼ æˆ‘ä»¬æŠ€æœ¯éƒ¨è¦è£äººã€‚é‚£æˆ‘è¿˜ä¸å¦‚è‡ªå·±èµ°(çŽ°åœ¨Vç«™é€›å¤šäº†çªç„¶è§‰å¾—å¥½äº)ã€‚ äºŽæ˜¯æˆ‘å¼€å§‹äº†æˆ‘çš„ç¬¬äºŒæ¬¡è·³æ§½ï¼Œå‰åŽæ—¶é—´æ‰é—´éš”4ä¸ªæœˆï¼Œä¸å¾—ä¸æ„Ÿæ…¨å‘½è¿å¼„äººå•Šã€‚ ä¹‹åŽæˆ‘æ¥åˆ°çŽ°åœ¨è¿™å®¶å‘˜å·¥5000ä½™äººçš„çœŸæ­£çš„äº’è”ç½‘å…¬å¸ï¼Œå¼€å§‹äº†çœŸæ­£æ„ä¹‰çš„äº’è”ç½‘å¼€å‘ã€‚è¿™é‡Œå¿…é¡»å¾—æ„Ÿè°¢æˆ‘çš„é¢è¯•å®˜ä¹Ÿæ˜¯æˆ‘çŽ°åœ¨è¿™ä¸ªé¡¹ç›®çš„leaderï¼Œç»™äº†æˆ‘è¿™ä¸ªäº’è”ç½‘èœé¸Ÿæœºä¼šã€‚ ä¸è¿‡å‘½è¿æ€»æ˜¯å¦‚æ­¤çš„ç›¸è¯†ï¼Œæ˜Žå¹´ä¹Ÿå°±æ˜¯ä¸‹å‘¨ä»–å°±æ¢éƒ¨é—¨äº†ï¼Œæ„å‘³ç€çŽ°åœ¨è¿™ä¸ªé¡¹ç›®æˆ‘åˆæˆè´Ÿè´£äººäº†ã€‚å¸Œæœ›ä¸€åˆ‡é¡ºåˆ©å§ã€‚ æŠ€æœ¯ç›¸å…³å‰é¢è¯´åˆ°æˆ‘æ˜¯ä¹æœˆä»½çš„æ—¶å€™æ‰è¿›å…¥è¿™å®¶æ­£çœŸæ„ä¹‰çš„äº’è”ç½‘å…¬å¸çš„ï¼Œæ‰€ä»¥ä½“æœ¯æå‡æœ€æ˜Žæ˜¾ä¹Ÿæ˜¯åœ¨è¿™æ®µæ—¶é—´ã€‚ è¿™æ®µæ—¶é—´æ‰€å­¦çš„èµ·ç æ˜¯æˆ‘åœ¨å‰é¢ä¸¤å®¶å…¬å¸ä¸€å¹´éƒ½å­¦ä¸åˆ°çš„ï¼Œè¿™é‡Œæˆ‘å¤§è‡´åˆ—äº†ä¸€ä¸‹ï¼š ç†Ÿæ‚‰äº†ä¸€ä¸ªäº’è”ç½‘äº§å“çš„ç”Ÿå‘½å‘¨æœŸ(å…³äºŽå¼€å‘ã€æµ‹è¯•ã€é¢„å‘å¸ƒã€ç°åº¦ä»¥åŠä¸Šçº¿) ç†Ÿæ‚‰äº†ä¸€äº›å…³äºŽå¹¶å‘ã€ä¸»ä»Žã€ç¼“å­˜ã€è°ƒåº¦ã€å®¹å™¨è¿™äº›ä¸»æµçš„æŠ€æœ¯ã€‚ æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œå­¦ä¼šäº†ä¸åŠ ç­ä¸èˆ’æœæ–¯åŸºã€‚ èº«ä½“ç›¸å…³ä¸çŸ¥æ˜¯é”™è§‰è¿˜æ˜¯ä»€ä¹ˆï¼Œæ„Ÿè§‰ä»Šå¹´çœ‹åˆ°ITè¡Œä¸šçŒæ­»æˆ–è€…æ˜¯å‡ºäº‹çš„æ–°é—»è¶Šæ¥è¶Šå¤šï¼ŒåŠ ä¸Šæˆ‘è¿™ä¸ªä»Šå¹´æ‰22å²çš„é’å¹´æœ‰æ—¶å€™ä¹Ÿä¼šè…°ç–¼è„–å­é…¸ï¼Œå¯¼è‡´æˆ‘å¯¹äºŽèº«ä½“ä¹Ÿæ˜¯è¶Šæ¥è¶Šæ‹…å¿§ã€‚ å…¶å®žæˆ‘ä»Žåˆä¸­çš„æ—¶å€™å°±å¼€å§‹æ‰“ç¯®çƒï¼Œåœ¨å·¥ä½œä¹‹å‰ä¹Ÿæ˜¯å¯¹ç¯®çƒå®Œå…¨æ˜¯ç—´è¿·çš„çŠ¶æ€ï¼Œæ¯å¤©ä¸æ‰“çƒå°±æµ‘èº«éš¾å—ã€‚åˆšå·¥ä½œçš„é‚£æ®µæ—¶é—´è¿˜èƒ½åšæŒæ¯å‘¨æœ«åŽ»æ‰“çƒï¼Œä½†æ˜¯ä»Šå¹´èƒ½åšåˆ°ä¸€ä¸ªæœˆæ‰“ä¸€æ¬¡éƒ½éžå¸¸éš¾å¾—äº†ã€‚ã€‚ å†æ­¤ï¼Œæˆ‘ç«‹ä¸ªflagï¼Œæ˜Žå¤©ä¸‹åˆå‡ºåŽ»æ‰“çƒï¼Œæ˜Žå¹´åšæŒè‡³å°‘æ¯ä¸¤å‘¨æ‰“ä¸€æ¬¡çƒã€‚ 2017å°ç›®æ ‡åˆ°è¿™é‡Œä¹ŸåŸºæœ¬ä¸Šæ€»ç»“çš„å·®ä¸å¤šäº†ï¼Œè¿˜æœ‰åŠä¸ªå°æ—¶å°±æ˜¯17å¹´äº†ã€‚ è¿˜æ˜¯å®šä¸€ä¸ª17å¹´çš„å°ç›®æ ‡å§ï¼š åšå®¢åšæŒå†™ï¼Œè‡³å°‘ä¿æŒä¸¤å‘¨ä¸€æ›´ã€‚ å¼€æºé¡¹ç›®åšæŒç»´æŠ¤ï¼Œäº‰å–é€ ä¸€ä¸ªè½®å­å‡ºæ¥ã€‚ åšæŒé”»ç‚¼ï¼Œæˆ‘è¿˜å¾—å…»å®¶ç³Šå£ã€‚ æœ€åŽå¸Œæœ›å®¶äººæœ‹å‹éƒ½å¹³å¹³å®‰å®‰ã€‚]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>æ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(ä¸ƒ)åœ¨JavaWebåº”ç”¨ä¸­ä½¿ç”¨Redis]]></title>
    <url>%2F2016%2F12%2F18%2FSSM7%2F</url>
    <content type="text"><![CDATA[å‰è¨€ç”±äºŽæœ€è¿‘æ¢(mang)äº†(de)å®¶(yi)å…¬(bi)å¸æŽ¥è§¦äº†æ–°çš„ä¸œè¥¿æ‰€ä»¥å¾ˆä¹…æ²¡æœ‰æ›´æ–°äº†ã€‚è¿™æ¬¡è°ˆè°ˆRedisï¼Œå…³äºŽRedisåº”è¯¥å¾ˆå¤šæœ‹å‹å°±ç®—æ²¡æœ‰ç”¨è¿‡ä¹Ÿå¬è¿‡ï¼Œç®—æ˜¯è¿™å‡ å¹´æœ€æµè¡Œçš„NoSqlä¹‹ä¸€äº†ã€‚Redisçš„åº”ç”¨åœºæ™¯éžå¸¸å¤šè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œè¿™æ¬¡å°±ä»¥ä¸€ä¸ªæœ€ç®€å•çš„ä¹Ÿæœ€å¸¸ç”¨çš„ ç¼“å­˜æ•°æ® æ¥ä¸¾ä¾‹ã€‚å…ˆæ¥çœ‹ä¸€å¼ æ•ˆæžœå›¾ï¼š ä½œç”¨å°±æ˜¯åœ¨æ¯æ¬¡æŸ¥è¯¢æŽ¥å£çš„æ—¶å€™é¦–å…ˆåˆ¤æ–­Redisä¸­æ˜¯å¦æœ‰ç¼“å­˜ï¼Œæœ‰çš„è¯å°±è¯»å–ï¼Œæ²¡æœ‰å°±æŸ¥è¯¢æ•°æ®åº“å¹¶ä¿å­˜åˆ°Redisä¸­ï¼Œä¸‹æ¬¡å†æŸ¥è¯¢çš„è¯å°±ä¼šç›´æŽ¥ä»Žç¼“å­˜ä¸­è¯»å–äº†ã€‚Redisä¸­çš„ç»“æžœï¼šä¹‹åŽæŸ¥è¯¢rediså‘çŽ°ç¡®å®žæ˜¯å­˜è¿›æ¥äº†ã€‚ Rediså®‰è£…ä¸Žä½¿ç”¨é¦–å…ˆç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯å®‰è£…Redisã€‚æˆ‘æ˜¯åœ¨æˆ‘VPSä¸Šè¿›è¡Œå®‰è£…çš„ï¼Œæ“ä½œç³»ç»Ÿæ˜¯CentOS6.5ã€‚ ä¸‹è½½Redishttps://redis.io/downloadï¼Œæˆ‘æœºå™¨ä¸Šå®‰è£…çš„æ˜¯3.2.5 å°†ä¸‹è½½ä¸‹æ¥çš„â€™reidis-3.2.5-tar.gzâ€™ä¸Šä¼ åˆ°usr/localè¿™ä¸ªç›®å½•è¿›è¡Œè§£åŽ‹ã€‚ è¿›å…¥è¯¥ç›®å½•ã€‚ ç¼–è¯‘å®‰è£… 12makemake install ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶ã€‚ è¿™é‡Œæˆ‘åªæ˜¯ç®€å•çš„åŠ ä¸Šå¯†ç è€Œå·²ã€‚12vi redis.confrequirepass ä½ çš„å¯†ç  å¯åŠ¨Redis å¯åŠ¨æ—¶å€™è¦é€‰æ‹©æˆ‘ä»¬ä¹‹å‰ä¿®æ”¹çš„é…ç½®æ–‡ä»¶æ‰èƒ½ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚1234è¿›å…¥srcç›®å½•cd /usr/local/redis-3.2.5/srcå¯åŠ¨æœåŠ¡./redis-server ../redis.conf ç™»é™†redis1./redis-cli -a ä½ çš„å¯†ç  Springæ•´åˆRedisè¿™é‡Œæˆ‘å°±ç›´æŽ¥å¼€å§‹ç”¨Springæ•´åˆæ¯•ç«Ÿåœ¨å®žé™…ä½¿ç”¨ä¸­éƒ½æ˜¯å’ŒSpringä¸€èµ·ä½¿ç”¨çš„ã€‚ ä¿®æ”¹Springé…ç½®æ–‡ä»¶åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970&lt;!-- jedis é…ç½® --&gt; &lt;bean id="poolConfig" class="redis.clients.jedis.JedisPoolConfig"&gt; &lt;property name="maxIdle" value="$&#123;redis.maxIdle&#125;"/&gt; &lt;property name="maxWaitMillis" value="$&#123;redis.maxWait&#125;"/&gt; &lt;property name="testOnBorrow" value="$&#123;redis.testOnBorrow&#125;"/&gt; &lt;/bean&gt; &lt;!-- redisæœåŠ¡å™¨ä¸­å¿ƒ --&gt; &lt;bean id="connectionFactory" class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory"&gt; &lt;property name="poolConfig" ref="poolConfig"/&gt; &lt;property name="port" value="$&#123;redis.port&#125;"/&gt; &lt;property name="hostName" value="$&#123;redis.host&#125;"/&gt; &lt;property name="password" value="$&#123;redis.password&#125;"/&gt; &lt;property name="timeout" value="$&#123;redis.timeout&#125;"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;bean id="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate"&gt; &lt;property name="connectionFactory" ref="connectionFactory"/&gt; &lt;property name="keySerializer"&gt; &lt;bean class="org.springframework.data.redis.serializer.StringRedisSerializer"/&gt; &lt;/property&gt; &lt;property name="valueSerializer"&gt; &lt;bean class="org.springframework.data.redis.serializer.JdkSerializationRedisSerializer"/&gt; &lt;/property&gt; &lt;/bean&gt; &lt;!-- cacheé…ç½® --&gt; &lt;bean id="methodCacheInterceptor" class="com.crossoverJie.intercept.MethodCacheInterceptor"&gt; &lt;property name="redisUtil" ref="redisUtil"/&gt; &lt;/bean&gt; &lt;bean id="redisUtil" class="com.crossoverJie.util.RedisUtil"&gt; &lt;property name="redisTemplate" ref="redisTemplate"/&gt; &lt;/bean&gt; &lt;!--é…ç½®åˆ‡é¢æ‹¦æˆªæ–¹æ³• --&gt; &lt;aop:config proxy-target-class="true"&gt; &lt;!--å°†com.crossoverJie.serviceåŒ…ä¸‹çš„æ‰€æœ‰selectå¼€å¤´çš„æ–¹æ³•åŠ å…¥æ‹¦æˆª åŽ»æŽ‰selectåˆ™åŠ å…¥æ‰€æœ‰æ–¹æ³•w --&gt; &lt;aop:pointcut id="controllerMethodPointcut" expression=" execution(* com.crossoverJie.service.*.select*(..))"/&gt; &lt;aop:pointcut id="selectMethodPointcut" expression=" execution(* com.crossoverJie.dao..*Mapper.select*(..))"/&gt; &lt;aop:advisor advice-ref="methodCacheInterceptor" pointcut-ref="controllerMethodPointcut"/&gt; &lt;/aop:config&gt;``` æ›´å¤šçš„é…ç½®å¯ä»¥ç›´æŽ¥åœ¨æºç é‡Œé¢æŸ¥çœ‹ï¼š[https://github.com/crossoverJie/SSM/blob/master/src/main/resources/spring-mybatis.xml](https://github.com/crossoverJie/SSM/blob/master/src/main/resources/spring-mybatis.xml)ã€‚ä»¥ä¸Šéƒ½å†™æœ‰æ³¨é‡Šï¼Œä¹Ÿéƒ½æ˜¯ä¸€äº›ç®€å•çš„é…ç½®ç›¸ä¿¡éƒ½èƒ½çœ‹æ‡‚ã€‚ä¸‹é¢æˆ‘ä¼šç€é‡è¯´ä¸‹å¦‚ä½•é…ç½®ç¼“å­˜çš„ã€‚# Springåˆ‡é¢ä½¿ç”¨ç¼“å­˜Springçš„`AOP`çœŸæ˜¯æ˜¯ä¸€ä¸ªå¥½ä¸œè¥¿ï¼Œè¿˜ä¸å¤ªæ¸…æ¥šæ˜¯ä»€ä¹ˆçš„åŒå­¦å»ºè®®å…ˆè‡ªè¡Œ`Google`ä¸‹å§ã€‚åœ¨ä¸ä½¿ç”¨åˆ‡é¢çš„æ—¶å€™å¦‚æžœæˆ‘ä»¬æƒ³ç»™æŸä¸ªæ–¹æ³•åŠ å…¥ç¼“å­˜çš„è¯è‚¯å®šæ˜¯åœ¨æ–¹æ³•è¿”å›žä¹‹å‰å°±è¦åŠ å…¥ç›¸åº”çš„é€»è¾‘åˆ¤æ–­ï¼Œåªæœ‰ä¸€ä¸ªæˆ–å‡ ä¸ªå€’è¿˜å¥½ï¼Œå¦‚æžœæœ‰å‡ åä¸Šç™¾ä¸ªçš„è¯é‚£GGäº†ï¼Œè€Œä¸”ç»´æŠ¤èµ·æ¥ä¹Ÿç‰¹åˆ«éº»çƒ¦ã€‚&gt; å¥½åœ¨Springçš„AOPå¯ä»¥å¸®æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&gt; è¿™æ¬¡å°±åœ¨æˆ‘ä»¬éœ€è¦åŠ å…¥ç¼“å­˜æ–¹æ³•çš„åˆ‡é¢åŠ å…¥è¿™ä¸ªé€»è¾‘ï¼Œå¹¶ä¸”åªéœ€è¦ä¸€ä¸ªé…ç½®å³å¯æžå®šï¼Œå°±æ˜¯ä¸Šæ–‡ä¸­æ‰€æåˆ°çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š```xml &lt;!--é…ç½®åˆ‡é¢æ‹¦æˆªæ–¹æ³• --&gt; &lt;aop:config proxy-target-class="true"&gt; &lt;!--å°†com.crossoverJie.serviceåŒ…ä¸‹çš„æ‰€æœ‰selectå¼€å¤´çš„æ–¹æ³•åŠ å…¥æ‹¦æˆª åŽ»æŽ‰selectåˆ™åŠ å…¥æ‰€æœ‰æ–¹æ³•w --&gt; &lt;aop:pointcut id="controllerMethodPointcut" expression=" execution(* com.crossoverJie.service.*.select*(..))"/&gt; &lt;aop:pointcut id="selectMethodPointcut" expression=" execution(* com.crossoverJie.dao..*Mapper.select*(..))"/&gt; &lt;aop:advisor advice-ref="methodCacheInterceptor" pointcut-ref="controllerMethodPointcut"/&gt; &lt;/aop:config&gt; è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è¡¨è¾¾å¼execution(* com.crossoverJie.service.*.select*(..))æ¥æ‹¦æˆªserviceä¸­æ‰€æœ‰ä»¥selectå¼€å¤´çš„æ–¹æ³•ã€‚è¿™æ ·åªè¦æˆ‘ä»¬è¦å°†åŠ å…¥çš„ç¼“å­˜çš„æ–¹æ³•ä»¥selectå‘½åå¼€å¤´çš„è¯æ¯æ¬¡è¿›å…¥æ–¹æ³•ä¹‹å‰éƒ½ä¼šè¿›å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„MethodCacheInterceptoræ‹¦æˆªå™¨ã€‚è¿™é‡Œè´´ä¸€ä¸‹MethodCacheInterceptorä¸­å¤„ç†é€»è¾‘çš„æ ¸å¿ƒæ–¹æ³•ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546@Override public Object invoke(MethodInvocation invocation) throws Throwable &#123; Object value = null; String targetName = invocation.getThis().getClass().getName(); String methodName = invocation.getMethod().getName(); // ä¸éœ€è¦ç¼“å­˜çš„å†…å®¹ //if (!isAddCache(StringUtil.subStrForLastDot(targetName), methodName)) &#123; if (!isAddCache(targetName, methodName)) &#123; // æ‰§è¡Œæ–¹æ³•è¿”å›žç»“æžœ return invocation.proceed(); &#125; Object[] arguments = invocation.getArguments(); String key = getCacheKey(targetName, methodName, arguments); logger.debug("redisKey: " + key); try &#123; // åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜ if (redisUtil.exists(key)) &#123; return redisUtil.get(key); &#125; // å†™å…¥ç¼“å­˜ value = invocation.proceed(); if (value != null) &#123; final String tkey = key; final Object tvalue = value; new Thread(new Runnable() &#123; @Override public void run() &#123; if (tkey.startsWith("com.service.impl.xxxRecordManager")) &#123; redisUtil.set(tkey, tvalue, xxxRecordManagerTime); &#125; else if (tkey.startsWith("com.service.impl.xxxSetRecordManager")) &#123; redisUtil.set(tkey, tvalue, xxxSetRecordManagerTime); &#125; else &#123; redisUtil.set(tkey, tvalue, defaultCacheExpireTime); &#125; &#125; &#125;).start(); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); if (value == null) &#123; return invocation.proceed(); &#125; &#125; return value; &#125; å…ˆæ˜¯æŸ¥çœ‹äº†å½“å‰æ–¹æ³•æ˜¯å¦åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•ä¸­ï¼Œå¦‚æžœä¸æ˜¯çš„è¯å°±ç›´æŽ¥è¿”å›žï¼Œä¸è¿›å…¥æ‹¦æˆªå™¨ã€‚ ä¹‹åŽåˆ©ç”¨åå°„èŽ·å–çš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç”Ÿæˆredisçš„keyã€‚ ç”¨keyåœ¨redisä¸­æŸ¥è¯¢æ˜¯å¦å·²ç»æœ‰ç¼“å­˜ã€‚ æœ‰ç¼“å­˜å°±ç›´æŽ¥è¿”å›žç¼“å­˜å†…å®¹ï¼Œä¸å†ç»§ç»­æŸ¥è¯¢æ•°æ®åº“ã€‚ å¦‚æžœæ²¡æœ‰ç¼“å­˜å°±æŸ¥è¯¢æ•°æ®åº“å¹¶å°†è¿”å›žä¿¡æ¯åŠ å…¥åˆ°redisä¸­ã€‚ ä½¿ç”¨PageHelperè¿™æ¬¡ä¸ºäº†åˆ†é¡µæ–¹ä¾¿ä½¿ç”¨äº†æ¯”è¾ƒæµè¡Œçš„PageHelperæ¥å¸®æˆ‘ä»¬æ›´ç®€å•çš„è¿›è¡Œåˆ†é¡µã€‚é¦–å…ˆæ˜¯æ–°å¢žä¸€ä¸ªmybatisçš„é…ç½®æ–‡ä»¶mybatis-configï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;&lt;configuration&gt; &lt;settings&gt; &lt;setting name="cacheEnabled" value="true"/&gt; &lt;setting name="lazyLoadingEnabled" value="true"/&gt; &lt;setting name="multipleResultSetsEnabled" value="true"/&gt; &lt;setting name="useColumnLabel" value="true"/&gt; &lt;setting name="useGeneratedKeys" value="false"/&gt; &lt;setting name="autoMappingBehavior" value="PARTIAL"/&gt; &lt;setting name="defaultExecutorType" value="SIMPLE"/&gt; &lt;setting name="defaultStatementTimeout" value="25"/&gt; &lt;setting name="safeRowBoundsEnabled" value="false"/&gt; &lt;setting name="mapUnderscoreToCamelCase" value="false"/&gt; &lt;setting name="localCacheScope" value="SESSION"/&gt; &lt;setting name="jdbcTypeForNull" value="OTHER"/&gt; &lt;setting name="lazyLoadTriggerMethods" value="equals,clone,hashCode,toString"/&gt; &lt;/settings&gt; &lt;plugins&gt; &lt;!-- com.github.pagehelperä¸ºPageHelperç±»æ‰€åœ¨åŒ…å --&gt; &lt;plugin interceptor="com.github.pagehelper.PageHelper"&gt; &lt;property name="dialect" value="mysql"/&gt; &lt;!-- è¯¥å‚æ•°é»˜è®¤ä¸ºfalse --&gt; &lt;!-- è®¾ç½®ä¸ºtrueæ—¶ï¼Œä¼šå°†RowBoundsç¬¬ä¸€ä¸ªå‚æ•°offsetå½“æˆpageNumé¡µç ä½¿ç”¨ --&gt; &lt;!-- å’ŒstartPageä¸­çš„pageNumæ•ˆæžœä¸€æ · --&gt; &lt;property name="offsetAsPageNum" value="true"/&gt; &lt;!-- è¯¥å‚æ•°é»˜è®¤ä¸ºfalse --&gt; &lt;!-- è®¾ç½®ä¸ºtrueæ—¶ï¼Œä½¿ç”¨RowBoundsåˆ†é¡µä¼šè¿›è¡ŒcountæŸ¥è¯¢ --&gt; &lt;property name="rowBoundsWithCount" value="true"/&gt; &lt;!-- è®¾ç½®ä¸ºtrueæ—¶ï¼Œå¦‚æžœpageSize=0æˆ–è€…RowBounds.limit = 0å°±ä¼šæŸ¥è¯¢å‡ºå…¨éƒ¨çš„ç»“æžœ --&gt; &lt;!-- ï¼ˆç›¸å½“äºŽæ²¡æœ‰æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢ï¼Œä½†æ˜¯è¿”å›žç»“æžœä»ç„¶æ˜¯Pageç±»åž‹ï¼‰ &lt;property name="pageSizeZero" value="true"/&gt; --&gt; &lt;!-- 3.3.0ç‰ˆæœ¬å¯ç”¨ - åˆ†é¡µå‚æ•°åˆç†åŒ–ï¼Œé»˜è®¤falseç¦ç”¨ --&gt; &lt;!-- å¯ç”¨åˆç†åŒ–æ—¶ï¼Œå¦‚æžœpageNum&lt;1ä¼šæŸ¥è¯¢ç¬¬ä¸€é¡µï¼Œå¦‚æžœpageNum&gt;pagesä¼šæŸ¥è¯¢æœ€åŽä¸€é¡µ --&gt; &lt;!-- ç¦ç”¨åˆç†åŒ–æ—¶ï¼Œå¦‚æžœpageNum&lt;1æˆ–pageNum&gt;pagesä¼šè¿”å›žç©ºæ•°æ® --&gt; &lt;property name="reasonable" value="true"/&gt; &lt;!-- 3.5.0ç‰ˆæœ¬å¯ç”¨ - ä¸ºäº†æ”¯æŒstartPage(Object params)æ–¹æ³• --&gt; &lt;!-- å¢žåŠ äº†ä¸€ä¸ª`params`å‚æ•°æ¥é…ç½®å‚æ•°æ˜ å°„ï¼Œç”¨äºŽä»ŽMapæˆ–ServletRequestä¸­å–å€¼ --&gt; &lt;!-- å¯ä»¥é…ç½®pageNum,pageSize,count,pageSizeZero,reasonable,ä¸é…ç½®æ˜ å°„çš„ç”¨é»˜è®¤å€¼ --&gt; &lt;!-- ä¸ç†è§£è¯¥å«ä¹‰çš„å‰æä¸‹ï¼Œä¸è¦éšä¾¿å¤åˆ¶è¯¥é…ç½® --&gt; &lt;property name="params" value="pageNum=start;pageSize=limit;"/&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/configuration&gt; æŽ¥ç€åœ¨mybatisçš„é…ç½®æ–‡ä»¶ä¸­å¼•å…¥æ¬¡é…ç½®æ–‡ä»¶ï¼š1234567&lt;bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"&gt; &lt;property name="dataSource" ref="dataSource" /&gt; &lt;!-- è‡ªåŠ¨æ‰«æmapping.xmlæ–‡ä»¶ --&gt; &lt;property name="mapperLocations" value="classpath:mapping/*.xml"&gt;&lt;/property&gt; &lt;!--åŠ å…¥PageHelper--&gt; &lt;property name="configLocation" value="classpath:mybatis-config.xml"/&gt;&lt;/bean&gt; æŽ¥ç€åœ¨serviceæ–¹æ³•ä¸­ï¼š1234567891011@Overridepublic PageEntity&lt;Rediscontent&gt; selectByPage(Integer pageNum, Integer pageSize) &#123; PageHelper.startPage(pageNum, pageSize); //å› ä¸ºæ˜¯demoï¼Œæ‰€ä»¥è¿™é‡Œé»˜è®¤æ²¡æœ‰æŸ¥è¯¢æ¡ä»¶ã€‚ List&lt;Rediscontent&gt; rediscontents = rediscontentMapper.selectByExample(new RediscontentExample()); PageEntity&lt;Rediscontent&gt; rediscontentPageEntity = new PageEntity&lt;Rediscontent&gt;(); rediscontentPageEntity.setList(rediscontents); int size = rediscontentMapper.selectByExample(new RediscontentExample()).size(); rediscontentPageEntity.setCount(size); return rediscontentPageEntity;&#125; åªéœ€è¦ä½¿ç”¨PageHelper.startPage(pageNum, pageSize);æ–¹æ³•å°±å¯ä»¥å¸®æˆ‘ä»¬ç®€å•çš„åˆ†é¡µäº†ã€‚è¿™é‡Œæˆ‘è‡ªå®šä¹‰äº†ä¸€ä¸ªåˆ†é¡µå·¥å…·ç±»PageEntityæ¥æ›´æ–¹ä¾¿çš„å¸®æˆ‘ä»¬åœ¨ä¹‹åŽç”ŸæˆJSONæ•°æ®ã€‚123456789101112131415161718192021222324252627282930package com.crossoverJie.util;import java.io.Serializable;import java.util.List;/** * åˆ†é¡µå®žä½“ * * @param &lt;T&gt; */public class PageEntity&lt;T&gt; implements Serializable &#123; private List&lt;T&gt; list;// åˆ†é¡µåŽçš„æ•°æ® private Integer count; public Integer getCount() &#123; return count; &#125; public void setCount(Integer count) &#123; this.count = count; &#125; public List&lt;T&gt; getList() &#123; return list; &#125; public void setList(List&lt;T&gt; list) &#123; this.list = list; &#125;&#125; æ›´å¤šPageHelperçš„ä½¿ç”¨è¯·æŸ¥çœ‹ä¸€ä¸‹é“¾æŽ¥ï¼šhttps://github.com/pagehelper/Mybatis-PageHelper å‰ç«¯è”è°ƒæŽ¥ä¸‹æ¥çœ‹ä¸‹æŽ§åˆ¶å±‚RedisController:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.crossoverJie.controller;import com.crossoverJie.pojo.Rediscontent;import com.crossoverJie.service.RediscontentService;import com.crossoverJie.util.CommonUtil;import com.crossoverJie.util.PageEntity;import com.github.pagehelper.PageHelper;import net.sf.json.JSONArray;import net.sf.json.JSONObject;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import javax.servlet.http.HttpServletResponse;@Controller@RequestMapping("/redis")public class RedisController &#123; private static Logger logger = LoggerFactory.getLogger(RedisController.class); @Autowired private RediscontentService rediscontentService; @RequestMapping("/redis_list") public void club_list(HttpServletResponse response, @RequestParam(value = "page", defaultValue = "0") int page, @RequestParam(value = "pageSize", defaultValue = "0") int pageSize) &#123; JSONObject jsonObject = new JSONObject(); JSONObject jo = new JSONObject(); try &#123; JSONArray ja = new JSONArray(); PageHelper.startPage(1, 10); PageEntity&lt;Rediscontent&gt; rediscontentPageEntity = rediscontentService.selectByPage(page, pageSize); for (Rediscontent rediscontent : rediscontentPageEntity.getList()) &#123; JSONObject jo1 = new JSONObject(); jo1.put("rediscontent", rediscontent); ja.add(jo1); &#125; jo.put("redisContents", ja); jo.put("count", rediscontentPageEntity.getCount()); jsonObject = CommonUtil.parseJson("1", "æˆåŠŸ", jo); &#125; catch (Exception e) &#123; jsonObject = CommonUtil.parseJson("2", "æ“ä½œå¼‚å¸¸", ""); logger.error(e.getMessage(), e); &#125; //æž„å»ºè¿”å›ž CommonUtil.responseBuildJson(response, jsonObject); &#125;&#125; è¿™é‡Œå°±ä¸åšè¿‡å¤šè§£é‡Šäº†ï¼Œå°±æ˜¯ä»Žredisæˆ–è€…æ˜¯serviceä¸­æŸ¥è¯¢å‡ºæ•°æ®å¹¶è¿”å›žã€‚ å‰ç«¯çš„æ˜¾ç¤ºç•Œé¢åœ¨https://github.com/crossoverJie/SSM/blob/master/src/main/webapp/redis/showRedis.jspä¸­(å¹¶ä¸æ˜¯å‰ç«¯ï¼Œå°†å°±çœ‹)ã€‚å…¶ä¸­æ ¸å¿ƒçš„redis_list.jsçš„ä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485var page = 1, rows = 10;$(document).ready(function () &#123; initJqPaginator(); //åŠ è½½ load_redis_list(); $(".query_but").click(function () &#123;//æŸ¥è¯¢æŒ‰é’® page = 1; load_redis_list(); &#125;);&#125;);//åˆå§‹åŒ–åˆ†é¡µfunction initJqPaginator() &#123; $.jqPaginator('#pagination', &#123; totalPages: 100, visiblePages: 10, currentPage: 1, first: '&lt;li class="prev"&gt;&lt;a href="javascript:;"&gt;é¦–é¡µ&lt;/a&gt;&lt;/li&gt;', last: '&lt;li class="prev"&gt;&lt;a href="javascript:;"&gt;æœ«é¡µ&lt;/a&gt;&lt;/li&gt;', prev: '&lt;li class="prev"&gt;&lt;a href="javascript:;"&gt;ä¸Šä¸€é¡µ&lt;/a&gt;&lt;/li&gt;', next: '&lt;li class="next"&gt;&lt;a href="javascript:;"&gt;ä¸‹ä¸€é¡µ&lt;/a&gt;&lt;/li&gt;', page: '&lt;li class="page"&gt;&lt;a href="javascript:;"&gt;&#123;&#123;page&#125;&#125;&lt;/a&gt;&lt;/li&gt;', onPageChange: function (num, type) &#123; page = num; if (type == "change") &#123; load_redis_list(); &#125; &#125; &#125;);&#125;//åˆ—è¡¨function create_club_list(redisContens) &#123; var phone = 0; var html = '&lt;div class="product_box"&gt;' + '&lt;div class="br"&gt;' + '&lt;div class="product_link"&gt;' + '&lt;div class="product_phc"&gt;' + '&lt;img class="phc" src="" &gt;' + '&lt;/div&gt;' + '&lt;span class="product_name"&gt;' + redisContens.id + '&lt;/span&gt;&lt;/div&gt;' + '&lt;div class="product_link toto"&gt;' + redisContens.content + '&lt;/div&gt;' + '&lt;div class="product_link toto"&gt;' + '&lt;span&gt;' + "" + '&lt;/span&gt;' + '&lt;/div&gt;' + '&lt;div class="product_link toto"&gt;' + '&lt;span&gt;' + phone + '&lt;/span&gt;&lt;/div&gt;' + '&lt;div class="product_link toto"&gt;' + '&lt;span&gt;' + 0 + '&lt;/span&gt;&lt;/div&gt;' + '&lt;div class="product_link toto product_operation"&gt;' + '&lt;span onclick="edit_club(' + 0 + ')"&gt;ç¼–è¾‘&lt;/span&gt;' + '&lt;span onclick="edit_del(' + 0 + ')"&gt;åˆ é™¤&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;' + '&lt;/div&gt;'; return html;&#125;//åŠ è½½åˆ—è¡¨function load_redis_list() &#123; var name = $("#name").val(); $.ajax(&#123; type: 'POST', url: getPath() + '/redis/redis_list', async: false, data: &#123;name: name, page: page, pageSize: rows&#125;, datatype: 'json', success: function (data) &#123; if (data.result == 1) &#123; $(".product_length_number").html(data.data.count); var html = ""; var count = data.data.count; for (var i = 0; i &lt; data.data.redisContents.length; i++) &#123; var redisContent = data.data.redisContents[i]; html += create_club_list(redisContent.rediscontent); &#125; $(".product_content").html(html); //è¿™é‡Œæ˜¯åˆ†é¡µçš„æ’ä»¶ $('#pagination').jqPaginator('option', &#123; totalPages: (Math.ceil(count / rows) &lt; 1 ? 1 : Math.ceil(count / rows)), currentPage: page &#125;); &#125; else &#123; alert(data.msg); &#125; &#125; &#125;); $(".product_box:even").css("background", "#e6e6e6");//éš”è¡Œå˜è‰²&#125; å…¶å®žå°±æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚æŽ¥å£ï¼Œå¹¶æ ¹æ®è¿”å›žæ•°æ®åŠ¨æ€ç”ŸæˆDomè€Œå·²ã€‚ æ€»ç»“ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„redisçš„åº”ç”¨ã€‚redisçš„åº”ç”¨åœºæ™¯è¿˜éžå¸¸çš„å¤šï¼Œæ¯”å¦‚çŽ°åœ¨æˆ‘æ‰€åœ¨åšçš„ä¸€ä¸ªé¡¹ç›®å°±æœ‰ç”¨æ¥å¤„ç†çŸ­ä¿¡éªŒè¯ç çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¹‹åŽæœ‰æ—¶é—´å¯ä»¥å†™ä¸€ä¸ªdemoã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.gitGitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(å…­)è·¨åŸŸä¼ è¾“]]></title>
    <url>%2F2016%2F10%2F18%2FSSM6%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸çŸ¥å¤§å®¶åœ¨å¹³æ—¶çš„å¼€å‘è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰é‡åˆ°è¿‡è·¨åŸŸè®¿é—®èµ„æºçš„é—®é¢˜ï¼Œæˆ‘ä¸å·§åœ¨ä¸Šå‘¨å°±ç¢°åˆ°ä¸€ä¸ªè¿™æ ·çš„é—®é¢˜ï¼Œå¹¸è¿çš„æ˜¯åœ¨å…¬å¸å‰ç«¯åŒå­¦çš„å¸®å¿™ä¸‹è§£å†³äº†è¯¥é—®é¢˜ã€‚ ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜ï¼Ÿ åªè¦åè®®ã€åŸŸåã€ç«¯å£æœ‰ä»»ä½•ä¸€ä¸ªä¸åŒï¼Œéƒ½è¢«å½“ä½œæ˜¯ä¸åŒçš„åŸŸ åªè¦æ˜¯åœ¨ä¸åŒåŸŸä¸­æ˜¯æ— æ³•è¿›è¡Œé€šä¿¡çš„ã€‚ åŸºäºŽä»¥ä¸Šçš„çš„å‡ºå‘ç‚¹ï¼Œæˆ‘ä»¬åˆæœ‰è·¨åŸŸå…±äº«èµ„æºçš„éœ€æ±‚(è­¬å¦‚çŽ°åœ¨æµè¡Œçš„å‰åŽç«¯åˆ†ç¦»ä¹‹åŽåˆ†åˆ«éƒ¨ç½²çš„æƒ…å†µ)ï¼Œæœ¬æ–‡æ‰€é‡‡ç”¨çš„è§£å†³åŠžæ³•æ˜¯JSONPï¼Œè¯´åˆ°JSONPå°±ä¼šé¦–å…ˆæƒ³åˆ°JSONã€‚è™½ç„¶åªæœ‰ä¸€å­—ä¹‹å·®ä½†æ„ä¹‰å´å®Œå…¨ä¸ä¸€æ ·ï¼Œé¦–å…ˆç§‘æ™®ä¸€ä¸‹JSONã€‚ JSON å…¶å®žçŽ°åœ¨JSONå·²ç»æ˜¯ç›¸å½“æµè¡Œäº†ï¼Œåªè¦æ¶‰åŠåˆ°å‰åŽç«¯çš„æ•°æ®äº¤äº’å¤§éƒ½éƒ½æ˜¯é‡‡ç”¨çš„JSON(ä¸ç®¡æ˜¯webè¿˜æ˜¯androidå’ŒIOS)ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œå°±ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå°±ç®—æ˜¯æ²¡æœ‰ç”¨è¿‡çš„åŒå­¦ä¹Ÿèƒ½å¾ˆå¿«æ˜Žç™½å…¶ä¸­çš„æ„æ€ã€‚ PostMané¦–å…ˆç»™å¤§å®¶å®‰åˆ©ä¸€æ¬¾åŽç«¯å¼€å‘çš„åˆ©å™¨PostMan,å¯ä»¥ç”¨äºŽæ¨¡æ‹Ÿå‡ ä¹Žæ‰€æœ‰çš„HTTPè¯·æ±‚ï¼Œåœ¨å¼€å‘é˜¶æ®µè°ƒè¯•åŽç«¯æŽ¥å£éžå¸¸æœ‰ç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªChromeæ’ä»¶ï¼Œå¯ä»¥ç›´æŽ¥åœ¨googleå•†åº—æœç´¢ç›´æŽ¥ä¸‹è½½(å½“ç„¶å‰æä½ æ‡‚å¾—)ã€‚ä¹‹åŽç•Œé¢å°±å¦‚ä¸‹ï¼šã€‚ç•Œé¢éžå¸¸ç®€æ´ï¼Œæœ‰ç‚¹å¼€å‘ç»éªŒçš„ç«¥éž‹åº”è¯¥éƒ½ä¼šä½¿ç”¨ï¼Œä¸å¤ªä¼šç”¨çš„ç›´æŽ¥googleä¸‹å°±å¯ä»¥äº†æ¯”è¾ƒç®€å•ã€‚æŽ¥ç€æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨PostManæ¥å‘èµ·ä¸€æ¬¡è¯·æ±‚èŽ·å–JSONäº†ã€‚è¿™é‡Œä»¥æˆ‘SSMé¡¹ç›®ä¸ºä¾‹,ä¹Ÿæ­£å¥½æœ‰æš´éœ²ä¸€ä¸ªJSONçš„æŽ¥å£ã€‚åœ°å€å¦‚ä¸‹:http://www.crossoverjie.top/SSM/content_loadã€‚ç›´æŽ¥åœ¨POSTMANä¸­çš„åœ°å€æ è¾“å…¥è¯¥åœ°å€ï¼Œé‡‡ç”¨GETçš„æ–¹å¼è¯·æ±‚ï¼Œä¹‹åŽæ‰€è¿”å›žçš„å°±æ˜¯JSONæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ç”±äºŽJavascriptåŽŸç”Ÿçš„å°±æ”¯æŒJSONï¼Œæ‰€ä»¥è§£æžèµ·æ¥éžå¸¸æ–¹ä¾¿ã€‚ JSONPå¥½äº†ï¼Œç»ˆäºŽå¯ä»¥è°ˆè°ˆJSONPäº†ã€‚ä¹‹å‰è¯´é“JSONPæ˜¯ç”¨æ¥è§£å†³è·¨åŸŸé—®é¢˜çš„ï¼Œé‚£ä¹ˆä»–æ˜¯å¦‚ä½•è§£å†³çš„å‘¢ã€‚ç»è¿‡æˆ‘ä»¬å¼€å‘ç•Œçš„å‰è¾ˆä»¬å‘çŽ°ï¼ŒHTMLä¸­æ‹¥æœ‰SRCå±žæ€§çš„æ ‡ç­¾éƒ½ä¸å—è·¨åŸŸçš„å½±å“ï¼Œæ¯”å¦‚ï¼š&lt;script&gt;ã€&lt;img&gt;ã€&lt;iframe&gt;æ ‡ç­¾ã€‚ç”±äºŽJSåŽŸç”Ÿæ”¯æŒJSONçš„è§£æžï¼ŒäºŽæ˜¯æˆ‘ä»¬é‡‡ç”¨&lt;script&gt;çš„æ–¹å¼æ¥å¤„ç†è·¨åŸŸè§£æžï¼Œä»£ç å¦‚ä¸‹ä¸€çœ‹å°±æ˜Žç™½ã€‚webç«¯:1234567891011121314151617181920212223242526272829303132&lt;html lang="zh"&gt;&lt;head&gt; &lt;script type="text/javascript"&gt; $(document).ready(function()&#123; $.ajax(&#123; type: "get", async: false, url: "http://www.crossoverjie.top/SSM/jsonpInfo?callback=getUser&amp;userId=3", dataType: "jsonp", jsonp: "callback",//ä¸€èˆ¬é»˜è®¤ä¸º:callback jsonpCallback:"getUser",//è‡ªå®šä¹‰çš„jsonpå›žè°ƒå‡½æ•°åç§°ï¼Œé»˜è®¤ä¸ºjQueryè‡ªåŠ¨ç”Ÿæˆçš„éšæœºå‡½æ•°åï¼Œä¹Ÿå¯ä»¥å†™"?"ï¼ŒjQueryä¼šè‡ªåŠ¨ä¸ºä½ å¤„ç†æ•°æ® success: function(json)&#123; /** * èŽ·å¾—æœåŠ¡å™¨è¿”å›žçš„ä¿¡æ¯ã€‚ * å¯ä»¥åšå…·ä½“çš„ä¸šåŠ¡å¤„ç†ã€‚ */ alert('ç”¨æˆ·ä¿¡æ¯ï¼šIDï¼š ' + json.userId + ' ï¼Œå§“åï¼š ' + json.username + 'ã€‚'); &#125;, error: function()&#123; alert('fail'); &#125; &#125;); &#125;); &lt;/script&gt;&lt;/head&gt;&lt;body oncontextmenu="return false"&gt;&lt;/body&gt;&lt;/html&gt; å…¶ä¸­æˆ‘ä»¬é‡‡ç”¨äº†JQueryç»™æˆ‘å°è£…å¥½çš„å‡½æ•°ï¼Œè¿™æ ·å°±å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬è§£æžäº†ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹ä»£ç ä¸­çš„http://www.crossoverjie.top/SSM/jsonpInfo?callback=getUser&amp;userId=3è¿™ä¸ªåœ°å€è¿”å›žçš„æ˜¯ä»€ä¹ˆå†…å®¹ï¼Œè¿˜æ˜¯æ”¾åˆ°POSTMANä¸­æ‰§è¡Œå¦‚ä¸‹ï¼šã€‚å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰€ä¼ é€’çš„callbackå‚æ•°å¸¦ç€æŸ¥è¯¢çš„æ•°æ®åˆåŽŸå°ä¸åŠ¨çš„è¿”å›žç»™æˆ‘ä»¬äº†ï¼Œè¿™æ ·çš„è¯å³ä½¿æˆ‘ä»¬ä¸ä½¿ç”¨JQueryç»™æˆ‘å°è£…å¥½çš„å‡½æ•°ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªå’Œcallbackåç§°ä¸€æ ·çš„å‡½æ•°ä¸€æ ·æ˜¯å¯ä»¥è§£æžå…¶ä¸­çš„æ•°æ®çš„ï¼Œåªæ˜¯Jqueryå¸®æˆ‘ä»¬åšäº†è€Œå·²ã€‚ å‰ç«¯æ²¡é—®é¢˜äº†ï¼Œé‚£ä¹ˆåŽç«¯åˆæ˜¯å¦‚ä½•å®žçŽ°çš„å‘¢ï¼Ÿä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š1234567@RequestMapping(value = "/jsonpInfo",method = &#123; RequestMethod.GET &#125;)@ResponseBodypublic Object jsonpInfo(String callback,Integer userId) throws IOException &#123; User user = userService.getUserById(userId); JSONPObject jsonpObject = new JSONPObject(callback,user) ; return jsonpObject ;&#125; åŽç«¯é‡‡ç”¨äº†jacksonä¸­çš„JSONPObjectè¿™ä¸ªç±»çš„ä¸€ä¸ªæž„é€ æ–¹æ³•ï¼Œåªéœ€è¦å°†callbackå­—æ®µå’Œéœ€è¦è½¬æˆJSONå­—ç¬¦ä¸²çš„å¯¹è±¡æ”¾è¿›åŽ»å³å¯ã€‚éœ€è¦ä¸»è¦çš„æ˜¯éœ€è¦ä½¿ç”¨@ResponseBodyæ³¨è§£æ‰èƒ½æˆåŠŸè¿”å›žã€‚ æ€»ç»“å…¶å®žç½‘ä¸Šè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•æ¥å¤„ç†è·¨åŸŸé—®é¢˜ï¼Œä¸è¿‡æˆ‘è§‰å¾—è¿™æ ·çš„æ–¹å¼æœ€ä¸ºç®€å•ã€‚åŒæ ·JSONPä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œæ¯”å¦‚ï¼šåªæ”¯æŒGETæ–¹å¼çš„HTTPè¯·æ±‚ã€‚ä»¥ä¸Šä»£ç ä¾ç„¶åœ¨åšä¸»çš„SSMé¡¹ç›®ä¸­ï¼Œå¦‚æœ‰éœ€è¦å¯ä»¥ç›´æŽ¥FORKã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JSONP</tag>
        <tag>JSON</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxï¼ˆäºŒï¼‰æœåŠ¡å™¨è¿è¡ŒçŽ¯å¢ƒé…ç½®]]></title>
    <url>%2F2016%2F09%2F20%2FLinux-normal2%2F</url>
    <content type="text"><![CDATA[å‰è¨€Linuxç›¸ä¿¡å¯¹å¤§å¤šæ•°ç¨‹åºå‘˜æ¥è¯´éƒ½ä¸é™Œç”Ÿï¼Œæ¯•ç«Ÿåœ¨æœåŠ¡å™¨ç«¯ä¾ç„¶è¿˜æ˜¯éœ¸ä¸»åœ°ä½è€Œä¸”ä¸æ¯«æ²¡æœ‰é€€å±…äºŒçº¿çš„æ„æ€ï¼Œä»¥è‡³äºŽçŽ°åœ¨å‡ ä¹Žæ¯ä¸€ä¸ªè½¯ä»¶å¼€å‘çš„ç›¸å…³äººå‘˜éƒ½å¾—æˆ–å¤šæˆ–å°‘çš„çŸ¥é“ä¸€äº›Linuxçš„ç›¸å…³å†…å®¹ï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨åˆšæ‹¿åˆ°ä¸€å°äº‘æœåŠ¡å™¨(é‡‡ç”¨centos)æ¥è¿›è¡Œè¿è¡ŒçŽ¯å¢ƒçš„æ­å»ºï¼ŒåŒ…æ‹¬JDKã€Mysqlã€Tomcatä»¥åŠnginxã€‚ç›¸ä¿¡å¯¹äºŽå°ç™½æ¥è¯´å¾ˆæœ‰å¿…è¦çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä¸ªäººçš„ä¸€ä¸ªè®°å½•ã€‚ è¯¥æœåŠ¡å™¨çš„ç”¨é€”æ˜¯ç”¨äºŽéƒ¨ç½²JavaEEé¡¹ç›®ã€‚éƒ¨ç½²ä¹‹åŽçš„æ•ˆæžœå›¾å¦‚ä¸‹: JDKå®‰è£…ç”±äºŽæˆ‘ä»¬ä¹‹åŽéœ€è¦éƒ¨ç½²çš„æ˜¯JavaEEé¡¹ç›®ï¼Œæ‰€ä»¥é¦–å…ˆç¬¬ä¸€æ­¥å°±æ˜¯å®‰è£…JDKäº†ã€‚ å¸è½½è‡ªå¸¦çš„openJDKçŽ°åœ¨çš„æœåŠ¡å™¨æ‹¿æ¥ä¹‹åŽä¸€èˆ¬éƒ½æ˜¯é»˜è®¤ç»™æˆ‘ä»¬å®‰è£…ä¸€ä¸ªopenJDKï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å¸è½½æŽ‰ã€‚ ä½¿ç”¨rpm -qa | grep javaå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨æœ‰Javaã€‚ ä½¿ç”¨rpm -e --nodeps ç›¸å…³åº”ç”¨åç§°æ¥è¿›è¡Œå¸è½½ã€‚(ç›¸å…³åº”ç”¨åç§°å°±æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤ä¸­æ˜¾ç¤ºå‡ºæ¥çš„åç§°å¤åˆ¶åˆ°è¿™é‡Œå¸è½½å³å¯)ã€‚ ä¸‹è½½å¹¶å®‰è£…JDK ä¹‹åŽæ˜¯ä¸‹è½½ORACLEæ‰€æä¾›çš„JDKï¼Œä¼ é€é—¨æ ¹æ®è‡ªå·±ç³»ç»Ÿçš„æƒ…å†µä¸‹è½½å¯¹åº”ç‰ˆæœ¬å³å¯ã€‚ç¬”è€…ä½¿ç”¨çš„æ˜¯jdk-8u101-linux-x64.rpmç‰ˆæœ¬ã€‚ ç„¶åŽä½¿ç”¨FTPå·¥å…·ä¸Šä¼ åˆ°/usr/javaç›®å½•ä¸‹å³å¯ï¼Œæ²¡æœ‰javaç›®å½•æ–°å»ºä¸€ä¸ªå³å¯ã€‚ ç„¶åŽä½¿ç”¨rpm -ivh jdk-8u101-linux-x64.rpmå‘½ä»¤è¿›è¡Œè§£åŽ‹å®‰è£…ã€‚ profileæ–‡ä»¶é…ç½®å®‰è£…å®Œæˆä¹‹åŽä½¿ç”¨vi /etc/profileå‘½ä»¤ç¼–è¾‘profileæ–‡ä»¶(æ³¨æ„è¯¥æ–‡ä»¶è·¯å¾„æ˜¯æŒ‡æ ¹ç›®å½•ä¸‹çš„etcæ–‡ä»¶å¤¹ä¸è¦æ‰¾é”™äº†)ã€‚åœ¨è¯¥æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š123export JAVA_HOME=/usr/java/jdk-8u101-linux-x64export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarexport PATH=$PATH:$JAVA_HOME/bin ä¿å­˜ä¹‹åŽè¿è¡Œsource /etc/profileä½¿é…ç½®ç”Ÿæ•ˆã€‚ éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸä¹‹åŽæˆ‘ä»¬ä½¿ç”¨åœ¨windowså¹³å°ä¹Ÿæœ‰çš„å‘½ä»¤java -versionï¼Œå¦‚æžœè¾“å‡ºå¦‚å›¾ï¼šè¡¨ç¤ºå®‰è£…æˆåŠŸã€‚ MySQLå®‰è£…å¸è½½è‡ªå¸¦çš„Mysqlé¦–å…ˆç¬¬ä¸€æ­¥è¿˜æ˜¯è¦å¸è½½æŽ‰è‡ªå¸¦çš„mysqlã€‚rpm -e --nodeps mysqlå‘½ä»¤å’Œä¹‹å‰ä¸€æ ·åªæ˜¯æŠŠåº”ç”¨åç§°æ¢æˆmysqläº†è€Œå·²ã€‚ ä½¿ç”¨yumæ¥å®‰è£…mysqlä¹‹åŽæˆ‘ä»¬é‡‡ç”¨yumæ¥å®‰è£…mysqlã€‚è¿™æ ·çš„æ–¹å¼æœ€ç®€å•ä¾¿æ·ã€‚yum install -y mysql-server mysql mysql-deveæ‰§è¡Œè¯¥å‘½ä»¤ç›´åˆ°å‡ºçŽ°Complete!æç¤ºä¹‹åŽè¡¨ç¤ºå®‰è£…æˆåŠŸã€‚rpm -qi mysql-serverä¹‹åŽä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬å®‰è£…çš„mysqlä¿¡æ¯ã€‚ mysqlç›¸å…³é…ç½®ä½¿ç”¨service mysqld startæ¥å¯åŠ¨mysqlæœåŠ¡(ç¬¬ä¸€æ¬¡ä¼šè¾“å‡ºå¾ˆå¤šä¿¡æ¯)ï¼Œä¹‹åŽå°±ä¸ä¼šäº†ã€‚ç„¶åŽæˆ‘ä»¬å¯ä»¥ä½¿ç”¨chkconfig mysqld onå‘½ä»¤å°†mysqlè®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ã€‚è¾“å…¥chkconfig --list | grep mysqlå‘½ä»¤æ˜¾ç¤ºå¦‚ä¸‹å›¾ï¼šè¡¨ç¤ºè®¾ç½®æˆåŠŸã€‚ä½¿ç”¨mysqladmin -u root password &#39;root&#39;ä¸ºrootè´¦æˆ·è®¾ç½®å¯†ç ã€‚ è®¾ç½®è¿œç¨‹ä½¿ç”¨1234grant all privileges on *.* to &apos;root&apos;@&apos;%&apos; identified by &apos;123456&apos; with grant option;# rootæ˜¯ç”¨æˆ·åï¼Œ%ä»£è¡¨ä»»æ„ä¸»æœºï¼Œ&apos;123456&apos;æŒ‡å®šçš„ç™»å½•å¯†ç ï¼ˆè¿™ä¸ªå’Œæœ¬åœ°çš„rootå¯†ç å¯ä»¥è®¾ç½®ä¸åŒçš„ï¼Œäº’ä¸å½±å“ï¼‰flush privileges; # é‡è½½ç³»ç»Ÿæƒé™exit; éªŒè¯ä½¿ç”¨ä½¿ç”¨mysql -u root -prootæ¥ç™»å½•mysqlã€‚å¦‚æžœå‡ºçŽ°ä»¥ä¸‹ç•Œé¢è¡¨ç¤ºè®¾ç½®æˆåŠŸã€‚ Tomcatå®‰è£…Tomcatä¹Ÿæ˜¯æˆ‘ä»¬è¿è¡ŒJavaEEé¡¹ç›®å¿…å¤‡çš„ä¸€ä¸ªä¸­é—´ä»¶ã€‚ ç¬¬ä¸€æ­¥éœ€è¦ä¸‹è½½linuxçš„Tomcatï¼Œä¼ é€é—¨ã€‚æ ¹æ®è‡ªå·±ç³»ç»Ÿç‰ˆæœ¬è¿›è¡Œä¸‹è½½å³å¯ã€‚ä¹‹åŽå°†apache-tomcat-8.5.5.tar.gzä¸Šä¼ åˆ°/usr/localç›®å½•ä¸­ã€‚ è§£åŽ‹è¯¥åŽ‹ç¼©åŒ…tar -zxv -f apache-tomcat-8.5.5.tar.gz,å†ä½¿ç”¨mv apache-tomcat-8.5.5 tomcatå°†è§£åŽ‹çš„Tomcatç§»åŠ¨åˆ°å¤–å±‚çš„Tomcatç›®å½•ä¸­ã€‚ è¿›å…¥/usr/local/tomcat/apache-tomcat-8.5.5/binç›®å½•ä½¿ç”¨./startup.batå‘½ä»¤å¯åŠ¨tomcatã€‚ å› ä¸ºtomcatä½¿ç”¨çš„é»˜è®¤ç«¯å£æ˜¯8080ï¼Œlinuxé˜²ç«å¢™é»˜è®¤æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œéœ€è¦æ‰‹åŠ¨å°†å…¶æ‰“å¼€ã€‚ä½¿ç”¨vi + /etc/sysconfig/iptablesç¼–è¾‘iptables(æ³¨æ„etcç›®å½•æ˜¯æ ¹ç›®å½•ä¸‹çš„)ï¼ŒåŠ å…¥ä»¥ä¸‹ä»£ç :12-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT è¿™é‡Œæˆ‘ä»¬å¼€æ”¾äº†8080å’Œ80ç«¯å£ï¼Œä¹‹åŽå®‰è£…nginxå°±ä¸ç”¨åœ¨å¼€æ”¾äº†ã€‚ ps:è¿™é‡Œç”¨åˆ°äº†ç®€å•çš„vimå‘½ä»¤ã€‚æŒ‰iè¿›å…¥æ’å…¥æ¨¡å¼ï¼Œè¾“å…¥ä¸Šé¢ä¸¤æ®µä»£ç ã€‚ä¹‹åŽæŒ‰escé€€å‡ºæ’å…¥æ¨¡å¼ã€‚å†æŒ‰:wqä¿å­˜å…³é—­å³å¯ã€‚ä¹‹åŽä½¿ç”¨service iptables restartå‘½ä»¤é‡å¯é˜²ç«å¢™å³å¯ã€‚åœ¨æµè§ˆå™¨è¾“å…¥æœåŠ¡å™¨çš„ip+8080å¦‚æžœå‡ºçŽ°Tomcatçš„æ¬¢è¿Žé¡µå³è¡¨æ˜ŽTomcatå®‰è£…æˆåŠŸã€‚ nginxå®‰è£…æœ€åŽæ˜¯å®‰è£…nginxï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨æœ€ç®€å•çš„yumçš„æ–¹å¼æ¥è¿›è¡Œå®‰è£…ã€‚ é¦–å…ˆä½¿ç”¨ä»¥ä¸‹å‡ ä¸ªå‘½ä»¤å®‰è£…å¿…å¤‡çš„å‡ ä¸ªåº“ï¼š 123yum -y install pcre*yum -y install openssl*yum -y install gcc ä¹‹åŽå®‰è£…nginxã€‚ 1234567cd /usr/local/wget http://nginx.org/download/nginx-1.4.2.tar.gztar -zxvf nginx-1.4.2.tar.gzcd nginx-1.4.2 ./configure --prefix=/usr/local/nginx --with-http_stub_status_modulemakemake install ä¹‹åŽå°±å¯ä»¥ä½¿ç”¨/usr/local/nginx/sbin/nginxå‘½ä»¤æ¥å¯åŠ¨nginxäº†ã€‚è¾“å…¥æœåŠ¡å™¨çš„IPåœ°å€ï¼Œå¦‚æžœå‡ºçŽ°nginxçš„æ¬¢è¿Žç•Œé¢è¡¨ç¤ºå®‰è£…æˆåŠŸäº†ã€‚ nginxé…ç½®è¿™é‡Œæˆ‘å°±ç®€å•è´´ä»¥ä¸‹æˆ‘çš„é…ç½®ï¼Œä¸»è¦å°±æ˜¯é…ç½®ä¸€ä¸ªupstream,ä¹‹åŽåœ¨serverä¸­å¼•ç”¨é…ç½®çš„é‚£ä¸ªupstreamå³å¯ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125#user nobody;worker_processes 1;#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;#pid logs/nginx.pid;events &#123; worker_connections 1024;&#125;http &#123; include mime.types; default_type application/octet-stream; #log_format main &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos; # &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos; # &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; upstream crossover_main &#123; server 127.0.0.1:8080; &#125; server &#123; listen 80; server_name www.crossoverjie.top; #charset koi8-r; #access_log logs/host.access.log main; location / &#123; proxy_pass http://crossover_main/examples/; proxy_set_header Host $http_host; proxy_set_header X-Forwarded-For $remote_addr; index index.jsp; &#125; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \.php$ &#123; # proxy_pass http://127.0.0.1; #&#125; # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \.php$ &#123; # root html; # fastcgi_pass 127.0.0.1:9000; # fastcgi_index index.php; # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # include fastcgi_params; #&#125; # deny access to .htaccess files, if Apache&apos;s document root # concurs with nginx&apos;s one # #location ~ /\.ht &#123; # deny all; #&#125; &#125; # another virtual host using mix of IP-, name-, and port-based configuration # #server &#123; # listen 8000; # listen somename:8080; # server_name somename alias another.alias; # location / &#123; # root html; # index index.html index.htm; # &#125; #&#125; # HTTPS server # #server &#123; # listen 443; # server_name localhost; # ssl on; # ssl_certificate cert.pem; # ssl_certificate_key cert.key; # ssl_session_timeout 5m; # ssl_protocols SSLv2 SSLv3 TLSv1; # ssl_ciphers HIGH:!aNULL:!MD5; # ssl_prefer_server_ciphers on; # location / &#123; # root html; # index index.html index.htm; # &#125; #&#125;&#125; ä¹‹åŽæˆ‘ä»¬åœ¨åœ°å€æ è¾“å…¥æœåŠ¡å™¨çš„IPåœ°å€(å¦‚æžœæœ‰åŸŸåè§£æžäº†æœåŠ¡å™¨çš„IPå¯ä»¥ç›´æŽ¥è¾“å…¥åŸŸå)å°±ä¼šè¿›å…¥æˆ‘ä»¬åœ¨upstreamä¸­é…ç½®çš„åœ°å€åŠ ä¸Šåœ¨serverä¸­çš„åœ°å€ã€‚æ ¹æ®æˆ‘è¿™é‡Œçš„é…ç½®æœ€åŽè§£æžåœ°å€å°±æ˜¯http://127.0.0.1:8080/examplesåº”è¯¥æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚æœ€ç»ˆçš„ç»“æžœæ˜¯æˆ‘åœ¨ç‰‡å¤´æ”¾çš„é‚£å¼ æˆªå›¾ä¸€æ ·ã€‚ æ€»ç»“è¿™æ˜¯ä¸€ä¸ªç®€å•çš„åŸºäºŽcentOSçš„è¿è¡ŒçŽ¯å¢ƒé…ç½®ï¼Œå¯¹äºŽå°ç™½ç»ƒæ‰‹åº”è¯¥æ˜¯å¤Ÿäº†ï¼Œæœ‰ä¸æ¸…æ¥šå’Œé”™è¯¯çš„åœ°æ–¹æ¬¢è¿ŽæŒ‡å‡ºåæ­£æˆ‘ä¹Ÿä¸ä¼šå›žå¤ã€‚ ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>Linuxç¬”è®°</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>centos</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(äº”)åŸºäºŽwebSocketçš„èŠå¤©å®¤]]></title>
    <url>%2F2016%2F09%2F04%2FSSM5%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸çŸ¥å¤§å®¶åœ¨å¹³æ—¶çš„éœ€æ±‚ä¸­æœ‰æ²¡æœ‰é‡åˆ°éœ€è¦å®žæ—¶å¤„ç†ä¿¡æ¯çš„æƒ…å†µï¼Œå¦‚ç«™å†…ä¿¡ï¼Œè®¢é˜…ï¼ŒèŠå¤©ä¹‹ç±»çš„ã€‚åœ¨è¿™ä¹‹å‰æˆ‘ä»¬é€šå¸¸æƒ³åˆ°çš„æ–¹æ³•ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨è½®è®­çš„æ–¹å¼æ¯éš”ä¸€å®šçš„æ—¶é—´å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ä»Žè€ŒèŽ·å¾—æœ€æ–°çš„æ•°æ®ï¼Œä½†è¿™æ ·ä¼šæµªè´¹æŽ‰å¾ˆå¤šçš„èµ„æºå¹¶ä¸”ä¹Ÿä¸æ˜¯å®žæ—¶çš„ï¼ŒäºŽæ˜¯éšç€HTML5çš„æŽ¨å‡ºå¸¦æ¥äº†websocketå¯ä»¥æ ¹æœ¬çš„è§£å†³ä»¥ä¸Šé—®é¢˜å®žçŽ°çœŸæ­£çš„å®žæ—¶ä¼ è¾“ã€‚ websocketæ˜¯ä»€ä¹ˆï¼Ÿè‡³äºŽwebsocketæ˜¯ä»€ä¹ˆã€æœ‰ä»€ä¹ˆç”¨è¿™æ ·çš„é—®é¢˜ä¸€Googleä¸€å¤§æŠŠï¼Œè¿™é‡Œæˆ‘å°±ç®€è¦çš„è¯´äº›websocketå†æœ¬æ¬¡å®žä¾‹ä¸­çš„ä½œç”¨å§ã€‚ç”±äºŽåœ¨æœ¬æ¬¡å®žä¾‹ä¸­éœ€è¦å®žçŽ°çš„æ˜¯ä¸€ä¸ªèŠå¤©å®¤ï¼Œä¸€ä¸ªå®žæ—¶çš„èŠå¤©å®¤ã€‚å¦‚ä¸‹å›¾ï¼šé‡‡ç”¨websocketä¹‹åŽå¯ä»¥è®©å‰ç«¯å’Œå’ŒåŽç«¯åƒC/Sæ¨¡å¼ä¸€æ ·å®žæ—¶é€šä¿¡ï¼Œä¸å†éœ€è¦æ¯æ¬¡å•ç‹¬å‘é€è¯·æ±‚ã€‚ç”±äºŽæ˜¯åŸºäºŽH5çš„æ‰€ä»¥å¯¹äºŽè€çš„æµè§ˆå™¨å¦‚IE7ã€IE8ä¹‹ç±»çš„å°±æ²¡åŠžæ³•äº†ï¼Œä¸è¿‡H5æ˜¯å¤§åŠ¿æ‰€è¶‹è¿™ç‚¹ä¸ç”¨æ‹…å¿ƒã€‚ åŽç«¯æ—¢ç„¶æŽ¨å‡ºäº†websocketï¼Œä½œä¸ºçŽ°åœ¨ä¸»æµçš„Javaè‚¯å®šä¹Ÿæœ‰ç›¸åº”çš„æ”¯æŒï¼Œæ‰€ä»¥åœ¨JavaEE7ä¹‹åŽä¹Ÿå¯¹websocketåšå‡ºäº†è§„èŒƒï¼Œæ‰€ä»¥æœ¬æ¬¡çš„ä»£ç ç†è®ºä¸Šæ˜¯è¦è¿è¡Œåœ¨Java1.7+å’ŒTomcat7.0+ä¹‹ä¸Šçš„ã€‚çœ‹è¿‡æˆ‘å‰é¢å‡ ç¯‡æ–‡ç« çš„æœ‹å‹åº”è¯¥éƒ½çŸ¥é“æœ¬æ¬¡å®žä¾‹ä¹Ÿæ˜¯è¿è¡Œåœ¨ä¹‹å‰çš„SSMä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚é¦–å…ˆç¬¬ä¸€æ­¥éœ€è¦åŠ å…¥websocketçš„ä¾èµ–ï¼š123456789101112&lt;!-- https://mvnrepository.com/artifact/javax.websocket/javax.websocket-api --&gt;&lt;dependency&gt; &lt;groupId&gt;javax.websocket&lt;/groupId&gt; &lt;artifactId&gt;javax.websocket-api&lt;/artifactId&gt; &lt;version&gt;1.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-websocket&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;&lt;/dependency&gt; ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨websocketæ‰€éœ€è¦ç”¨åˆ°çš„åŒ…ã€‚spring-websocketè¿™ä¸ªä¸»è¦æ˜¯åœ¨ä¹‹åŽéœ€è¦åœ¨websocketçš„åŽç«¯æ³¨å…¥serviceæ‰€éœ€è¦çš„ã€‚ä¹‹åŽå†çœ‹ä¸€ä¸‹åŽç«¯çš„æ ¸å¿ƒä»£ç MyWebSocket.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135package com.crossoverJie.controller;/** * Created by Administrator on 2016/8/7. */import com.crossoverJie.pojo.Content;import com.crossoverJie.service.ContentService;import org.apache.camel.BeanInject;import org.apache.camel.EndpointInject;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;import org.springframework.stereotype.Controller;import org.springframework.web.context.support.SpringBeanAutowiringSupport;import org.springframework.web.socket.server.standard.SpringConfigurator;import java.io.IOException;import java.text.SimpleDateFormat;import java.util.Date;import java.util.concurrent.CopyOnWriteArraySet;import javax.annotation.PostConstruct;import javax.websocket.OnClose;import javax.websocket.OnError;import javax.websocket.OnMessage;import javax.websocket.OnOpen;import javax.websocket.Session;import javax.websocket.server.ServerEndpoint;//è¯¥æ³¨è§£ç”¨æ¥æŒ‡å®šä¸€ä¸ªURIï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ä¸ªURIæ¥è¿žæŽ¥åˆ°WebSocketã€‚/** ç±»ä¼¼Servletçš„æ³¨è§£mappingã€‚æ— éœ€åœ¨web.xmlä¸­é…ç½®ã€‚ * configurator = SpringConfigurator.classæ˜¯ä¸ºäº†ä½¿è¯¥ç±»å¯ä»¥é€šè¿‡Springæ³¨å…¥ã€‚ */@ServerEndpoint(value = "/websocket",configurator = SpringConfigurator.class)public class MyWebSocket &#123; //é™æ€å˜é‡ï¼Œç”¨æ¥è®°å½•å½“å‰åœ¨çº¿è¿žæŽ¥æ•°ã€‚åº”è¯¥æŠŠå®ƒè®¾è®¡æˆçº¿ç¨‹å®‰å…¨çš„ã€‚ private static int onlineCount = 0; public MyWebSocket() &#123; &#125; @Autowired private ContentService contentService ; //concurrentåŒ…çš„çº¿ç¨‹å®‰å…¨Setï¼Œç”¨æ¥å­˜æ”¾æ¯ä¸ªå®¢æˆ·ç«¯å¯¹åº”çš„MyWebSocketå¯¹è±¡ã€‚ // è‹¥è¦å®žçŽ°æœåŠ¡ç«¯ä¸Žå•ä¸€å®¢æˆ·ç«¯é€šä¿¡çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨Mapæ¥å­˜æ”¾ï¼Œå…¶ä¸­Keyå¯ä»¥ä¸ºç”¨æˆ·æ ‡è¯† private static CopyOnWriteArraySet&lt;MyWebSocket&gt; webSocketSet = new CopyOnWriteArraySet&lt;MyWebSocket&gt;(); //ä¸Žå®¢æˆ·ç«¯çš„è¿žæŽ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ® private Session session; /** * è¿žæŽ¥å»ºç«‹æˆåŠŸè°ƒç”¨çš„æ–¹æ³• * @param session å¯é€‰çš„å‚æ•°ã€‚sessionä¸ºä¸ŽæŸä¸ªå®¢æˆ·ç«¯çš„è¿žæŽ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ® */ @OnOpen public void onOpen(Session session)&#123; this.session = session; webSocketSet.add(this); //åŠ å…¥setä¸­ addOnlineCount(); //åœ¨çº¿æ•°åŠ 1 System.out.println("æœ‰æ–°è¿žæŽ¥åŠ å…¥ï¼å½“å‰åœ¨çº¿äººæ•°ä¸º" + getOnlineCount()); &#125; /** * è¿žæŽ¥å…³é—­è°ƒç”¨çš„æ–¹æ³• */ @OnClose public void onClose()&#123; webSocketSet.remove(this); //ä»Žsetä¸­åˆ é™¤ subOnlineCount(); //åœ¨çº¿æ•°å‡1 System.out.println("æœ‰ä¸€è¿žæŽ¥å…³é—­ï¼å½“å‰åœ¨çº¿äººæ•°ä¸º" + getOnlineCount()); &#125; /** * æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åŽè°ƒç”¨çš„æ–¹æ³• * @param message å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯ * @param session å¯é€‰çš„å‚æ•° */ @OnMessage public void onMessage(String message, Session session) &#123; System.out.println("æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯:" + message); //ç¾¤å‘æ¶ˆæ¯ for(MyWebSocket item: webSocketSet)&#123; try &#123; item.sendMessage(message); &#125; catch (IOException e) &#123; e.printStackTrace(); continue; &#125; &#125; &#125; /** * å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨ * @param session * @param error */ @OnError public void onError(Session session, Throwable error)&#123; System.out.println("å‘ç”Ÿé”™è¯¯"); error.printStackTrace(); &#125; /** * è¿™ä¸ªæ–¹æ³•ä¸Žä¸Šé¢å‡ ä¸ªæ–¹æ³•ä¸ä¸€æ ·ã€‚æ²¡æœ‰ç”¨æ³¨è§£ï¼Œæ˜¯æ ¹æ®è‡ªå·±éœ€è¦æ·»åŠ çš„æ–¹æ³•ã€‚ * @param message * @throws IOException */ public void sendMessage(String message) throws IOException&#123; //ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“ Content content = new Content() ; content.setContent(message); SimpleDateFormat sm = new SimpleDateFormat("yyyy-MM-dd HH:mm:dd") ; content.setCreateDate(sm.format(new Date())); contentService.insertSelective(content) ; this.session.getBasicRemote().sendText(message); //this.session.getAsyncRemote().sendText(message); &#125; public static synchronized int getOnlineCount() &#123; return onlineCount; &#125; public static synchronized void addOnlineCount() &#123; MyWebSocket.onlineCount++; &#125; public static synchronized void subOnlineCount() &#123; MyWebSocket.onlineCount--; &#125;&#125; è¿™å°±æ˜¯æ•´ä¸ªwebsocketçš„åŽç«¯ä»£ç ã€‚çœ‹èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ä¸»è¦å°±æ˜¯ä½¿ç”¨é‚£å‡ ä¸ªæ³¨è§£ã€‚æ¯å½“æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è¿žå…¥ã€å…³é—­ã€å‘é€æ¶ˆæ¯éƒ½ä¼šè°ƒç”¨å„è‡ªæ³¨è§£çš„æ–¹æ³•ã€‚è¿™é‡Œæˆ‘è®²ä¸€ä¸‹sendMessage()è¿™ä¸ªæ–¹æ³•ã€‚ websocketç»•å‘åœ¨sendMessage()æ–¹æ³•ä¸­æˆ‘åªæƒ³å®žçŽ°ä¸€ä¸ªç®€å•çš„åŠŸèƒ½ï¼Œå°±æ˜¯å°†æ¯æ¬¡çš„èŠå¤©è®°å½•éƒ½å­˜åˆ°æ•°æ®åº“ä¸­ã€‚çœ‹ä¼¼ä¸€ä¸ªç®€å•çš„åŠŸèƒ½ç¡¬æ˜¯èŠ±äº†æˆ‘åŠå¤©çš„æ—¶é—´ã€‚æˆ‘å…ˆæ˜¯æŒ‰ç…§ä»¥å‰çš„æƒ¯æ€§æ€ç»´åªéœ€è¦åœ¨è¿™ä¸ªç±»ä¸­æ³¨å…¥serviceå³å¯ã€‚ä½†æ˜¯æ— è®ºæ€Žä¹ˆå¼„æ¯æ¬¡éƒ½æ³¨å…¥ä¸è¿›æ¥éƒ½æ˜¯nullã€‚æœ€åŽæ²¡åŠžæ³•åªæœ‰googleäº†ï¼Œæœ€åŽç»ˆäºŽåœ¨ç¥žçº§ç¤¾åŒºStackOverFlowä¸­æ‰¾åˆ°äº†ç­”æ¡ˆï¼Œå°±æ˜¯å‰è¾¹æ‰€è¯´çš„éœ€è¦æ·»åŠ çš„ç¬¬äºŒä¸ª mavenä¾èµ–ï¼Œç„¶åŽåŠ å…¥@ServerEndpoint(value = &quot;/websocket&quot;,configurator = SpringConfigurator.class)è¿™ä¸ªæ³¨è§£å³å¯åˆ©ç”¨Springæ³¨å…¥äº†ã€‚æŽ¥ç€å°±å¯ä»¥åšæ¶ˆæ¯çš„ä¿å­˜äº†ã€‚ å‰ç«¯å‰ç«¯æˆ‘é‡‡ç”¨äº†Bootstrapåšçš„ï¼Œä¸å¤ªæ¸…æ¥šBootstrapçš„ç«¥éž‹å»ºè®®å…ˆçœ‹ä¸‹å®˜æ–¹æ–‡æ¡£ä¹Ÿæ¯”è¾ƒç®€å•ã€‚è¿˜æ˜¯å…ˆè´´ä¸€ä¸‹ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146&lt;%@ page language="java" import="java.util.*" pageEncoding="UTF-8" %&gt;&lt;% String path = request.getContextPath(); String basePath = request.getScheme() + "://" + request.getServerName() + ":" + request.getServerPort() + path + "/";%&gt;&lt;!DOCTYPE HTML&gt;&lt;html&gt;&lt;head&gt; &lt;base href="&lt;%=basePath%&gt;"&gt; &lt;!-- Bootstrap --&gt; &lt;link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"&gt; &lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt; &lt;!-- WARNING: Respond.js doesn't work if you view the page via file:// --&gt; &lt;!--[if lt IE 9]&gt; &lt;script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"&gt;&lt;/script&gt; &lt;script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"&gt;&lt;/script&gt; &lt;![endif]--&gt; &lt;script type="text/javascript" charset="utf-8" src="&lt;%=path%&gt;/ueditor/ueditor.config.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" charset="utf-8" src="&lt;%=path%&gt;/ueditor/ueditor.all.min.js"&gt; &lt;/script&gt; &lt;!--å»ºè®®æ‰‹åŠ¨åŠ åœ¨è¯­è¨€ï¼Œé¿å…åœ¨ieä¸‹æœ‰æ—¶å› ä¸ºåŠ è½½è¯­è¨€å¤±è´¥å¯¼è‡´ç¼–è¾‘å™¨åŠ è½½å¤±è´¥--&gt; &lt;!--è¿™é‡ŒåŠ è½½çš„è¯­è¨€æ–‡ä»¶ä¼šè¦†ç›–ä½ åœ¨é…ç½®é¡¹ç›®é‡Œæ·»åŠ çš„è¯­è¨€ç±»åž‹ï¼Œæ¯”å¦‚ä½ åœ¨é…ç½®é¡¹ç›®é‡Œé…ç½®çš„æ˜¯è‹±æ–‡ï¼Œè¿™é‡ŒåŠ è½½çš„ä¸­æ–‡ï¼Œé‚£æœ€åŽå°±æ˜¯ä¸­æ–‡--&gt; &lt;script type="text/javascript" charset="utf-8" src="&lt;%=path%&gt;/ueditor/lang/zh-cn/zh-cn.js"&gt;&lt;/script&gt; &lt;title&gt;èŠå¤©å®¤&lt;/title&gt;&lt;/head&gt;&lt;body data="/ssm"&gt;&lt;input id="text" type="text"/&gt;&lt;button onclick="send()"&gt;å‘é€&lt;/button&gt;&lt;button onclick="closeWebSocket()"&gt;å…³é—­è¿žæŽ¥&lt;/button&gt;&lt;div id="message"&gt;&lt;/div&gt;&lt;div class="container-fluid"&gt; &lt;div class="row"&gt; &lt;div class="col-md-12"&gt; &lt;div class="panel panel-primary"&gt; &lt;div class="panel-heading"&gt;èŠå¤©å®¤&lt;/div&gt; &lt;div id="msg" class="panel-body"&gt; &lt;/div&gt; &lt;div class="panel-footer"&gt; åœ¨çº¿äººæ•°&lt;span id="onlineCount"&gt;1&lt;/span&gt;äºº &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div class="container-fluid"&gt; &lt;div class="row"&gt; &lt;div class="col-md-12"&gt; &lt;script id="editor" type="text/plain" style="width:1024px;height:200px;"&gt;&lt;/script&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div class="container-fluid"&gt; &lt;div class="row"&gt; &lt;div class="col-md-12"&gt; &lt;p class="text-right"&gt; &lt;button onclick="sendMsg();" class="btn btn-success"&gt;å‘é€&lt;/button&gt; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;script type="text/javascript"&gt; var ue = UE.getEditor('editor'); var websocket = null; //åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocket if ('WebSocket' in window) &#123; websocket = new WebSocket("ws://192.168.0.102:8080/ssm/websocket"); &#125; else &#123; alert("å¯¹ä¸èµ·ï¼ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒwebSocket") &#125; //è¿žæŽ¥å‘ç”Ÿé”™è¯¯çš„å›žè°ƒæ–¹æ³• websocket.onerror = function () &#123; setMessageInnerHTML("error"); &#125;; //è¿žæŽ¥æˆåŠŸå»ºç«‹çš„å›žè°ƒæ–¹æ³• websocket.onopen = function (event) &#123; setMessageInnerHTML("åŠ å…¥è¿žæŽ¥"); &#125;; //æŽ¥æ”¶åˆ°æ¶ˆæ¯çš„å›žè°ƒæ–¹æ³• websocket.onmessage = function (event) &#123; setMessageInnerHTML(event.data); &#125;; //è¿žæŽ¥å…³é—­çš„å›žè°ƒæ–¹æ³• websocket.onclose = function () &#123; setMessageInnerHTML("æ–­å¼€è¿žæŽ¥"); &#125;; //ç›‘å¬çª—å£å…³é—­äº‹ä»¶ï¼Œå½“çª—å£å…³é—­æ—¶ï¼Œä¸»åŠ¨åŽ»å…³é—­websocketè¿žæŽ¥ï¼Œ // é˜²æ­¢è¿žæŽ¥è¿˜æ²¡æ–­å¼€å°±å…³é—­çª—å£ï¼Œserverç«¯ä¼šæŠ›å¼‚å¸¸ã€‚ window.onbeforeunload = function () &#123; var is = confirm("ç¡®å®šå…³é—­çª—å£ï¼Ÿ"); if (is)&#123; websocket.close(); &#125; &#125;; //å°†æ¶ˆæ¯æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š function setMessageInnerHTML(innerHTML) &#123; $("#msg").append(innerHTML+"&lt;br/&gt;") &#125;; //å…³é—­è¿žæŽ¥ function closeWebSocket() &#123; websocket.close(); &#125; //å‘é€æ¶ˆæ¯ function send() &#123; var message = $("#text").val() ; websocket.send(message); $("#text").val("") ; &#125; function sendMsg()&#123; var msg = ue.getContent(); websocket.send(msg); ue.setContent(''); &#125;&lt;/script&gt;&lt;!-- jQuery (necessary for Bootstrap's JavaScript plugins) --&gt;&lt;script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"&gt;&lt;/script&gt;&lt;!-- Include all compiled plugins (below), or include individual files as needed --&gt;&lt;script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" src="&lt;%=path%&gt;/js/Globals.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" src="&lt;%=path%&gt;/js/websocket.js"&gt;&lt;/script&gt;&lt;/html&gt; å…¶å®žå…¶ä¸­é‡è¦çš„å°±æ˜¯é‚£å‡ ä¸ªJSæ–¹æ³•ï¼Œéƒ½å†™æœ‰æ³¨é‡Šã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œ1234567//åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocketif ('WebSocket' in window) &#123; websocket = new WebSocket("ws://192.168.0.102:8080/ssm/websocket");&#125;else &#123; alert("å¯¹ä¸èµ·ï¼ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒwebSocket")&#125; å½“é¡¹ç›®è·‘èµ·æ¥ä¹‹åŽéœ€è¦å°†è¿™é‡Œçš„åœ°å€æ”¹ä¸ºä½ é¡¹ç›®çš„åœ°å€å³å¯ã€‚å“¦å¯¹äº†ï¼Œæˆ‘åœ¨è¿™é‡Œé‡‡ç”¨äº†ç™¾åº¦çš„ä¸€ä¸ªUeditorçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨(è™½ç„¶ç™¾åº¦æœç´¢æˆ‘çŽ°åœ¨å¾ˆå°‘ç”¨äº†ï¼Œä½†æ˜¯è¿™ä¸ªç¼–è¾‘å™¨ç¡®å®žè¿˜ä¸é”™)ï¼Œè¿™ä¸ªç¼–è¾‘å™¨ä¹Ÿæ¯”è¾ƒç®€å•åªéœ€è¦ä¸ªæ€§åŒ–çš„é…ç½®ä¸€ä¸‹ä¸ªäººçš„éœ€æ±‚å³å¯ã€‚ Ueditorç›¸å…³é…ç½®ç›´æŽ¥ä½¿ç”¨æˆ‘é¡¹ç›®è¿è¡Œçš„ç«¥éž‹å°±ä¸éœ€è¦é‡æ–°ä¸‹è½½äº†ï¼Œæˆ‘å°†èµ„æºæ”¾åœ¨äº†webappç›®å½•ä¸‹çš„ueditoræ–‡ä»¶å¤¹ä¸‹é¢çš„ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯æˆ‘ä»¬é¦–å…ˆéœ€è¦å°†jsp--&gt;libä¸‹çš„jaråŒ…åŠ å…¥åˆ°é¡¹ç›®ä¸­ã€‚åŠ å¥½ä¹‹åŽä¼šå‡ºçŽ°ä¸€ä¸ªæƒ³ä¸‹çš„ç®­å¤´è¡¨ç¤ºå·²ç»å¼•å…¥æˆåŠŸã€‚ï¼Œä¹‹åŽä¿®æ”¹è¯¥ç›®å½•ä¸‹çš„config.jsonæ–‡ä»¶ï¼Œä¸»è¦ä¿®æ”¹ä»¥ä¸‹å†…å®¹å³å¯ï¼š123456"imageAllowFiles": [".png", ".jpg", ".jpeg", ".gif", ".bmp"], /* ä¸Šä¼ å›¾ç‰‡æ ¼å¼æ˜¾ç¤º */"imageCompressEnable": true, /* æ˜¯å¦åŽ‹ç¼©å›¾ç‰‡,é»˜è®¤æ˜¯true */"imageCompressBorder": 1600, /* å›¾ç‰‡åŽ‹ç¼©æœ€é•¿è¾¹é™åˆ¶ */"imageInsertAlign": "none", /* æ’å…¥çš„å›¾ç‰‡æµ®åŠ¨æ–¹å¼ */"imageUrlPrefix": "http://192.168.0.102:8080/ssm", /* å›¾ç‰‡è®¿é—®è·¯å¾„å‰ç¼€ */"imagePathFormat": "/ueditor/jsp/upload/image/&#123;yyyy&#125;&#123;mm&#125;&#123;dd&#125;/&#123;time&#125;&#123;rand:6&#125;", è¿™é‡Œä¸»è¦æ˜¯è¦ä¿®æ”¹imageUrlPrefixä¸ºä½ è‡ªå·±çš„é¡¹ç›®åœ°å€å°±å¯ä»¥äº†ã€‚ueditorä¸€ä¸ªæˆ‘è®¤ä¸ºå¾ˆä¸é”™çš„å°±æ˜¯ä»–æ”¯æŒå›¾ç‰‡ã€å¤šå›¾ã€æˆªå›¾ä¸Šä¼ ï¼Œè€Œä¸”éƒ½ä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™åŽç«¯æŽ¥å£ï¼Œæ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶ã€å›¾ç‰‡éƒ½ä¼šä¿å­˜åˆ°é¡¹ç›®å‘å¸ƒå‡ºåŽ»çš„jsp--&gt;uploadæ–‡ä»¶å¤¹ä¸‹ä¸€çœ‹å°±æ˜Žç™½äº†ã€‚æ›´å¤šå…³äºŽueditorçš„é…ç½®å¯ä»¥æŸ¥çœ‹å®˜ç½‘ã€‚ å…¶ä¸­å€¼å¾—æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œç”±äºŽé¡¹ç›®é‡‡ç”¨äº†Spring MVCå¹¶æ‹¦æˆªäº†æ‰€æœ‰çš„è¯·æ±‚ï¼Œå¯¼è‡´é™æ€èµ„æºä¸èƒ½è®¿é—®ï¼Œå¦‚æžœæ˜¯éœ€è¦ç”¨åˆ°ä¸Šä¼ txtæ–‡ä»¶ä¹‹ç±»çš„éœ€æ±‚å¯ä»¥å‚ç…§web.xmlä¸­ä¿®æ”¹ï¼Œå¦‚ä¸‹:1234&lt;servlet-mapping&gt; &lt;servlet-name&gt;default&lt;/servlet-name&gt; &lt;url-pattern&gt;*.txt&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; è¿™æ ·å°±å¯ä»¥è®¿é—®txtæ–‡ä»¶äº†ï¼Œå¦‚æžœè¿˜éœ€è¦ä¸Šä¼ PPTä¹‹ç±»çš„å°±ä»¥æ­¤ç±»æŽ¨ã€‚ æ€»ç»“è¿™æ ·ä¸€ä¸ªç®€å•çš„åŸºäºŽwebsocketçš„èŠå¤©å®¤å°±ç®—å®Œæˆäº†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å°†é¡¹ç›®éƒ¨ç½²åˆ°å¤–ç½‘æœåŠ¡å™¨ä¸Šè¿™æ ·å¥½åŸºå‹ä¹‹é—´å°±å¯ä»¥æ„‰å¿«çš„èŠ(zhuang)å¤©(bi)äº†ã€‚å½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å†è¿™åŸºç¡€ä¹‹ä¸ŠåŠ å…¥å®žæ—¶åœ¨çº¿äººæ•°ï¼Œç”¨æˆ·åå’ŒIPä¹‹ç±»çš„ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.gitä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>websocket</tag>
        <tag>HTML5</tag>
        <tag>ueditor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(å››)WebServiceå…¥é—¨è¯¦è§£]]></title>
    <url>%2F2016%2F08%2F02%2FSSM4%2F</url>
    <content type="text"><![CDATA[å‰è¨€webserviceè¿™ä¸ªä¸çŸ¥é“å¤§å®¶é¦–æ¬¡æŽ¥è§¦çš„æ—¶å€™æ˜¯æ€Žä¹ˆç†è§£çš„ï¼Œåæ­£æˆ‘è®°å¾—æˆ‘å½“æ—¶ç¬¬ä¸€æ¬¡æŽ¥è§¦è¿™ä¸ªä¸œè¥¿çš„æ—¶å€™ä»¥ä¸ºåˆæ˜¯ä¸€ä¸ªXXæ¡†æž¶ï¼Œè§‰å¾—è¿˜æŒºé«˜å¤§ä¸Šã€‚ç„¶è€Œè¿™ä¸€åˆ‡åœ¨ä¹‹åŽæˆ‘ä½¿ç”¨è¿‡åŽæ‰å‘çŽ°è¿™äº›å…¨éƒ½æ˜¯YYã€‚é‚£ä¹ˆwebserviceåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Œæ ¹æ®æˆ‘è‡ªå·±çš„ç†è§£ï¼šç®€å•æ¥è¯´å°±åƒæ˜¯ä¸€ä¸ªå…¬å¼€çš„æŽ¥å£ï¼Œå…¶ä»–ç³»ç»Ÿä¸ç®¡ä½ æ˜¯ç”¨ä»€ä¹ˆè¯­è¨€æ¥ç¼–å†™çš„éƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªæŽ¥å£ï¼Œå¹¶å¯ä»¥è¿”å›žç›¸åº”çš„æ•°æ®ç»™ä½ ã€‚å°±åƒæ˜¯çŽ°åœ¨å¾ˆå¤šçš„å¤©æ°”åº”ç”¨ï¼Œä»–ä»¬è‚¯å®šä¸ä¼šè‡ªå·±åŽ»æžä¸€ä¸ªæ°”è±¡å±€ä¹‹ç±»çš„éƒ¨é—¨åŽ»ç›‘æµ‹å¤©æ°”ï¼Œå¤§å¤šéƒ½æ˜¯ç›´æŽ¥è°ƒç”¨ä¸€ä¸ªå¤©æ°”æŽ¥å£ï¼Œç„¶åŽè¿”å›žå¤©æ°”æ•°æ®ï¼Œç›¸å…³åº”ç”¨å°±å¯ä»¥å°†è¿™äº›ä¿¡æ¯å±•ç¤ºç»™ç”¨æˆ·äº†ã€‚é€šå¸¸æ¥è¯´å‘å¸ƒè¿™ç±»æŽ¥å£çš„åº”ç”¨éƒ½æ˜¯ç”¨ä¸€ä¸¤ç§è¯­è¨€æ¥ç¼–å†™å³å¯ï¼Œä½†æ˜¯è°ƒç”¨è¿™ä¸ªæŽ¥å£åº”ç”¨å¯èƒ½ä¼šæ˜¯å„ç§è¯­è¨€æ¥ç¼–å†™çš„ï¼Œä¸ºäº†æ»¡è¶³è¿™æ ·çš„éœ€æ±‚webserviceå‡ºçŽ°äº†ã€‚ ç®€å•æ¥è¯´webserviceå°±æ˜¯ä¸ºäº†æ»¡è¶³ä»¥ä¸Šéœ€æ±‚è€Œå®šä¹‰å‡ºæ¥çš„è§„èŒƒã€‚ Springæ•´åˆCXFåœ¨Javaä¸­å®žçŽ°webserviceæœ‰å¤šç§æ–¹æ³•ï¼Œjavaæœ¬èº«åœ¨jdk1.7ä¹‹åŽä¹Ÿå¯¹webserviceæœ‰äº†é»˜è®¤çš„å®žçŽ°ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬å®žé™…å¼€å‘ä¸­ä¸€èˆ¬è¿˜æ˜¯ä¼šä½¿ç”¨æ¡†æž¶æ¥ï¼Œæ¯”å¦‚è¿™é‡Œæ‰€æåˆ°çš„CXFå°±æœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚åºŸè¯æˆ‘å°±ä¸å¤šè¯´äº†ï¼Œç›´æŽ¥è®²Springæ•´åˆCXFï¼Œæ¯•ç«ŸçŽ°åœ¨çš„JavaEEå¼€å‘æ˜¯ç¦»ä¸å¼€Springäº†ã€‚è¯¥é¡¹ç›®è¿˜æ˜¯åŸºäºŽä¹‹å‰çš„SSMè¿›è¡Œå¼€å‘çš„ã€‚ åŠ å…¥mavenä¾èµ–ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯è¦åŠ å…¥mavenä¾èµ–ï¼š12345678910111213141516171819&lt;!--cxf--&gt;&lt;!-- https://mvnrepository.com/artifact/org.apache.cxf/cxf-rt-frontend-jaxws --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt; &lt;artifactId&gt;cxf-rt-frontend-jaxws&lt;/artifactId&gt; &lt;version&gt;3.1.6&lt;/version&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/org.apache.cxf/cxf-core --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt; &lt;artifactId&gt;cxf-core&lt;/artifactId&gt; &lt;version&gt;3.1.6&lt;/version&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/org.apache.cxf/cxf-rt-transports-http --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt; &lt;artifactId&gt;cxf-rt-transports-http&lt;/artifactId&gt; &lt;version&gt;3.1.6&lt;/version&gt;&lt;/dependency&gt; web.xmlé…ç½®æŽ¥ç€æˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸ªCXFçš„servletï¼š123456789&lt;!--å®šä¹‰ä¸€ä¸ªcxfçš„servlet--&gt;&lt;servlet&gt; &lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt; &lt;servlet-class&gt;org.apache.cxf.transport.servlet.CXFServlet&lt;/servlet-class&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;/webservice/*&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; ä¹‹åŽåªè¦æˆ‘ä»¬è®¿é—®webservice/*è¿™ä¸ªåœ°å€å°±ä¼šè¿›å…¥CXFçš„servletä¸­ã€‚ æ•´åˆSpringé…ç½®æŽ¥ä¸‹æ¥æ˜¯æœ€é‡è¦çš„ä¸€éƒ¨ï¼Œç”¨Springæ•´åˆCXFï¼šåœ¨è¿™ä¹‹å‰æˆ‘æœ‰æ–°å»ºä¸€ä¸ªCXFçš„åŒ…ï¼Œå¦‚ä¸‹å›¾ï¼šè¿™é‡Œæœ‰ä¸¤ä¸ªä¸»è¦ç±» HelloWorldæŽ¥å£ã€‚ å®žçŽ°HelloWorldæŽ¥å£çš„HelloWorldImplç±»ã€‚ä»£ç å¦‚ä¸‹ï¼šHelloWorld.java12345678package com.crossoverJie.cxf;import javax.jws.WebService;@WebServicepublic interface HelloWorld &#123; public String say(String str);&#125; å…¶ä¸­å°±åªå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„say()æ–¹æ³•ã€‚HelloWorldImpl.java1234567891011package com.crossoverJie.cxf.impl;import com.crossoverJie.cxf.HelloWorld;import org.springframework.stereotype.Component;import javax.jws.WebService;@Component("helloWorld")@WebServicepublic class HelloWorldImpl implements HelloWorld &#123; public String say(String str) &#123; return "Hello"+str; &#125;&#125; è¿™é‡Œå°±æ˜¯å¯¹say()æ–¹æ³•çš„ç®€å•å®žçŽ°ã€‚æŽ¥ä¸‹æ¥å°±æ˜¯æ•´åˆSpringäº†ï¼Œç”±äºŽéœ€è¦ä½¿ç”¨åˆ°CXFçš„æ ‡ç­¾ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ é¢å¤–çš„å‘½åè·¯å¾„å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:context="http://www.springframework.org/schema/context" xmlns:jee="http://www.springframework.org/schema/jee" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:jaxws="http://cxf.apache.org/jaxws" xsi:schemaLocation=" http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd"&gt; &lt;import resource="classpath:META-INF/cxf/cxf.xml"/&gt; &lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml"/&gt; &lt;!-- è‡ªåŠ¨æ‰«æwebService --&gt; &lt;context:component-scan base-package="com.crossoverJie.cxf" /&gt; &lt;!-- å®šä¹‰webserviceçš„å‘å¸ƒæŽ¥å£ --&gt; &lt;jaxws:endpoint implementor="#helloWorld" address="/HelloWorld"&lt;/beans&gt; æ›´åŠ å…·ä½“çš„é…ç½®å¯ä»¥æŸ¥çœ‹å®˜æ–¹ç»™å‡ºçš„æ–‡æ¡£:http://cxf.apache.org/docs/how-do-i-develop-a-service.htmlã€‚#helloWorldæŒ‡çš„æ˜¯æˆ‘ä»¬åœ¨HelloWorldImplç±»ä¸­æ‰€è‡ªå®šä¹‰çš„åå­—ï¼Œ/HelloWorldåˆ™æ˜¯æˆ‘ä»¬éœ€è¦è®¿é—®çš„åœ°å€ã€‚ä¹‹åŽæˆ‘ä»¬è¿è¡Œé¡¹ç›®è¾“å…¥è¯¥åœ°å€ï¼šhttp://127.0.0.1:8080/ssm/webservice/HelloWorld?wsdlå¦‚æžœå‡ºçŽ°å¦‚ä¸‹ç•Œé¢ï¼šåˆ™è¯´æ˜Žæˆ‘ä»¬çš„webserviceå‘å¸ƒæˆåŠŸäº†ã€‚æŽ¥ä¸‹æ¥åªéœ€è¦é€šè¿‡å®¢æˆ·ç«¯è°ƒç”¨è¿™ä¸ªæŽ¥å£å³å¯èŽ·å¾—è¿”å›žç»“æžœäº†ã€‚ æ€»ç»“ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„webserviceå…¥é—¨å®žä¾‹ï¼Œæ›´å¤šçš„å…³äºŽCXFæ‹¦æˆªå™¨ï¼Œå®¢æˆ·ç«¯è°ƒç”¨å°±æ²¡æœ‰åšè¿‡å¤šä»‹ç»ï¼ŒåŽç»­æœ‰æ—¶é—´çš„è¯å†æŽ¥ç€æ›´æ–°ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.gitä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IDEA</tag>
        <tag>CXF</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(ä¸‰)Shiroä½¿ç”¨è¯¦è§£]]></title>
    <url>%2F2016%2F07%2F15%2FSSM3%2F</url>
    <content type="text"><![CDATA[å‰è¨€ç›¸æ¯”æœ‰åšè¿‡ä¼ä¸šçº§å¼€å‘çš„ç«¥éž‹åº”è¯¥éƒ½æœ‰åšè¿‡æƒé™å®‰å…¨ä¹‹ç±»çš„åŠŸèƒ½å§ï¼Œæœ€å…ˆå¼€å§‹æˆ‘é‡‡ç”¨çš„æ˜¯å»ºç”¨æˆ·è¡¨,è§’è‰²è¡¨,æƒé™è¡¨ï¼Œä¹‹åŽåœ¨æ‹¦æˆªå™¨ä¸­å¯¹æ¯ä¸€ä¸ªè¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œå†åˆ°æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢çœ‹å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è¯¥æƒé™ï¼Œè¿™æ ·çš„è®¾è®¡èƒ½æ»¡è¶³å¤§å¤šæ•°ä¸­å°åž‹ç³»ç»Ÿçš„éœ€æ±‚ã€‚ä¸è¿‡è¿™ç¯‡æ‰€ä»‹ç»çš„Shiroèƒ½æ»¡è¶³ä¹‹å‰çš„æ‰€æœ‰éœ€æ±‚ï¼Œå¹¶ä¸”ä½¿ç”¨ç®€å•ï¼Œå®‰å…¨æ€§é«˜ï¼Œè€Œä¸”çŽ°åœ¨è¶Šæ¥è¶Šçš„å¤šä¼ä¸šéƒ½åœ¨ä½¿ç”¨Shiroï¼Œè¿™åº”è¯¥æ˜¯ä¸€ä¸ªæ”¶å…¥çš„ä½ çš„æŠ€èƒ½åº“ã€‚ åˆ›å»ºè‡ªå®šä¹‰MyRealmç±»æœ‰å…³Shiroçš„åŸºç¡€çŸ¥è¯†æˆ‘è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†ï¼Œç›´æŽ¥æ¥å¹²è´§ï¼Œåˆ°æœ€åŽä¼šæ•´åˆSpringæ¥è¿›è¡Œæƒé™éªŒè¯ã€‚é¦–å…ˆåœ¨ä½¿ç”¨Shiroçš„æ—¶å€™æˆ‘ä»¬è¦è€ƒè™‘åœ¨ä»€ä¹ˆæ ·çš„çŽ¯å¢ƒä¸‹ä½¿ç”¨ï¼š ç™»å½•çš„éªŒè¯ å¯¹æŒ‡å®šè§’è‰²çš„éªŒè¯ å¯¹URLçš„éªŒè¯ åŸºæœ¬ä¸Šæˆ‘ä»¬ä¹Ÿå°±è¿™ä¸‰ä¸ªéœ€æ±‚ï¼Œæ‰€ä»¥åŒæ—¶æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸‰ä¸ªæ–¹æ³•ï¼š findUserByUserName(String username)æ ¹æ®usernameæŸ¥è¯¢ç”¨æˆ·ï¼Œä¹‹åŽShiroä¼šæ ¹æ®æŸ¥è¯¢å‡ºæ¥çš„Userçš„å¯†ç æ¥å’Œæäº¤ä¸Šæ¥çš„å¯†ç è¿›è¡Œæ¯”å¯¹ã€‚ findRoles(String username)æ ¹æ®usernameæŸ¥è¯¢è¯¥ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²ï¼Œç”¨äºŽè§’è‰²éªŒè¯ã€‚ findPermissions(String username)æ ¹æ®usernameæŸ¥è¯¢ä»–æ‰€æ‹¥æœ‰çš„æƒé™ä¿¡æ¯ï¼Œç”¨äºŽæƒé™åˆ¤æ–­ã€‚ ä¸‹é¢æˆ‘è´´ä¸€ä¸‹æˆ‘çš„mapperä»£ç (PS:è¯¥é¡¹ç›®ä¾ç„¶æ˜¯åŸºäºŽä¹‹å‰çš„SSMï¼Œä¸å¤ªæ¸…æ¥šæ•´åˆçš„è¯·çœ‹SSMä¸€)ã€‚123456789101112131415161718192021222324252627&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;&lt;mapper namespace="com.crossoverJie.dao.T_userDao" &gt; &lt;resultMap id="BaseResultMap" type="com.crossoverJie.pojo.T_user" &gt; &lt;result property="id" column="id"/&gt; &lt;result property="userName" column="userName"/&gt; &lt;result property="password" column="password"/&gt; &lt;result property="roleId" column="roleId"/&gt; &lt;/resultMap&gt; &lt;sql id="Base_Column_List" &gt; id, username, password,roleId &lt;/sql&gt; &lt;select id="findUserByUsername" parameterType="String" resultMap="BaseResultMap"&gt; select &lt;include refid="Base_Column_List"/&gt; from t_user where userName=#&#123;userName&#125; &lt;/select&gt; &lt;select id="findRoles" parameterType="String" resultType="String"&gt; select r.roleName from t_user u,t_role r where u.roleId=r.id and u.userName=#&#123;userName&#125; &lt;/select&gt; &lt;select id="findPermissions" parameterType="String" resultType="String"&gt; select p.permissionName from t_user u,t_role r,t_permission p where u.roleId=r.id and p.roleId=r.id and u.userName=#&#123;userName&#125; &lt;/select&gt;&lt;/mapper&gt; å¾ˆç®€å•åªæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åº”ä¸Šé¢æ‰€è¯´çš„ä¸‰ä¸ªæ–¹æ³•ã€‚å¯¹sqlç¨å¾®ç†Ÿæ‚‰ç‚¹çš„ç«¥éž‹åº”è¯¥éƒ½èƒ½çœ‹æ‡‚ï¼Œä¸å¤ªæ¸…æ¥šå°±æ‹·åˆ°æ•°æ®åº“ä¸­æ‰§è¡Œä¸€ä¸‹å°±è¡Œäº†ï¼Œæ•°æ®åº“çš„Sqlä¹Ÿåœ¨æˆ‘çš„githubä¸Šã€‚å®žä½“ç±»å°±æ¯”è¾ƒç®€å•äº†ï¼Œå°±åªæœ‰å››ä¸ªå­—æ®µä»¥åŠget,setæ–¹æ³•ã€‚æˆ‘å°±è¿™é‡Œå°±ä¸è´´äº†ï¼Œå…·ä½“å¯ä»¥åŽ»githubä¸Šforkæˆ‘çš„æºç ã€‚ çŽ°åœ¨å°±éœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„MyRealmç±»ï¼Œè¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒé‡è¦çš„ã€‚ç»§æ‰¿è‡³Shiroçš„AuthorizingRealmç±»ï¼Œç”¨äºŽå¤„ç†è‡ªå·±çš„éªŒè¯é€»è¾‘ï¼Œä¸‹é¢è´´ä¸€ä¸‹æˆ‘çš„ä»£ç ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package com.crossoverJie.shiro;import com.crossoverJie.pojo.T_user;import com.crossoverJie.service.T_userService;import org.apache.shiro.authc.AuthenticationException;import org.apache.shiro.authc.AuthenticationInfo;import org.apache.shiro.authc.AuthenticationToken;import org.apache.shiro.authc.SimpleAuthenticationInfo;import org.apache.shiro.authz.AuthorizationInfo;import org.apache.shiro.authz.SimpleAuthorizationInfo;import org.apache.shiro.realm.AuthorizingRealm;import org.apache.shiro.subject.PrincipalCollection;import javax.annotation.Resource;import java.util.Set;/** * Created with IDEA * Created by $&#123;jie.chen&#125; on 2016/7/14. * Shiroè‡ªå®šä¹‰åŸŸ */public class MyRealm extends AuthorizingRealm &#123; @Resource private T_userService t_userService; /** * ç”¨äºŽçš„æƒé™çš„è®¤è¯ã€‚ * @param principalCollection * @return */ @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) &#123; String username = principalCollection.getPrimaryPrincipal().toString() ; SimpleAuthorizationInfo info = new SimpleAuthorizationInfo() ; Set&lt;String&gt; roleName = t_userService.findRoles(username) ; Set&lt;String&gt; permissions = t_userService.findPermissions(username) ; info.setRoles(roleName); info.setStringPermissions(permissions); return info; &#125; /** * é¦–å…ˆæ‰§è¡Œè¿™ä¸ªç™»å½•éªŒè¯ * @param token * @return * @throws AuthenticationException */ @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException &#123; //èŽ·å–ç”¨æˆ·è´¦å· String username = token.getPrincipal().toString() ; T_user user = t_userService.findUserByUsername(username) ; if (user != null)&#123; //å°†æŸ¥è¯¢åˆ°çš„ç”¨æˆ·è´¦å·å’Œå¯†ç å­˜æ”¾åˆ° authenticationInfoç”¨äºŽåŽé¢çš„æƒé™åˆ¤æ–­ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°éšä¾¿æ”¾ä¸€ä¸ªå°±è¡Œäº†ã€‚ AuthenticationInfo authenticationInfo = new SimpleAuthenticationInfo(user.getUserName(),user.getPassword(), "a") ; return authenticationInfo ; &#125;else&#123; return null ; &#125; &#125;&#125; ç»§æ‰¿AuthorizingRealmç±»ä¹‹åŽå°±éœ€è¦è¦†å†™å®ƒçš„ä¸¤ä¸ªæ–¹æ³•ï¼ŒdoGetAuthorizationInfo,doGetAuthenticationInfoï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨æˆ‘éƒ½æœ‰å†™æ³¨é‡Šï¼Œé€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•ã€‚doGetAuthenticationInfoæ˜¯ç”¨äºŽç™»å½•éªŒè¯çš„ï¼Œåœ¨ç™»å½•çš„æ—¶å€™éœ€è¦å°†æ•°æ®å°è£…åˆ°Shiroçš„ä¸€ä¸ªtokenä¸­ï¼Œæ‰§è¡Œshiroçš„login()æ–¹æ³•ï¼Œä¹‹åŽåªè¦æˆ‘ä»¬å°†MyRealmè¿™ä¸ªç±»é…ç½®åˆ°Springä¸­ï¼Œç™»å½•çš„æ—¶å€™Shiroå°±ä¼šè‡ªåŠ¨çš„è°ƒç”¨doGetAuthenticationInfo()æ–¹æ³•è¿›è¡ŒéªŒè¯ã€‚å“¦å¯¹äº†ï¼Œå¿˜äº†è´´ä¸‹ç™»å½•çš„Controlleräº†ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455package com.crossoverJie.controller;import com.crossoverJie.pojo.T_user;import com.crossoverJie.service.T_userService;import org.apache.shiro.SecurityUtils;import org.apache.shiro.authc.UsernamePasswordToken;import org.apache.shiro.subject.Subject;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import javax.annotation.Resource;/** * Created with IDEA * Created by $&#123;jie.chen&#125; on 2016/7/14. * åŽå°Controller */@Controller@RequestMapping("/")public class T_userController &#123; @Resource private T_userService t_userService ; @RequestMapping("/loginAdmin") public String login(T_user user, Model model)&#123; Subject subject = SecurityUtils.getSubject() ; UsernamePasswordToken token = new UsernamePasswordToken(user.getUserName(),user.getPassword()) ; try &#123; subject.login(token); return "admin" ; &#125;catch (Exception e)&#123; //è¿™é‡Œå°†å¼‚å¸¸æ‰“å°å…³é—­æ˜¯å› ä¸ºå¦‚æžœç™»å½•å¤±è´¥çš„è¯ä¼šè‡ªåŠ¨æŠ›å¼‚å¸¸// e.printStackTrace(); model.addAttribute("error","ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯") ; return "../../login" ; &#125; &#125; @RequestMapping("/admin") public String admin()&#123; return "admin"; &#125; @RequestMapping("/student") public String student()&#123; return "admin" ; &#125; @RequestMapping("/teacher") public String teacher()&#123; return "admin" ; &#125;&#125; ä¸»è¦å°±æ˜¯login()æ–¹æ³•ã€‚é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯ç™»å½•éªŒè¯çš„æ—¶å€™ä¸æ˜¯åƒä¹‹å‰é‚£æ ·ç›´æŽ¥æŸ¥è¯¢æ•°æ®åº“ç„¶åŽè¿”å›žæ˜¯å¦æœ‰ç”¨æˆ·äº†ï¼Œè€Œæ˜¯è°ƒç”¨subjectçš„login()æ–¹æ³•,å°±æ˜¯æˆ‘ä¸Šé¢æåˆ°çš„ï¼Œè°ƒç”¨login()æ–¹æ³•æ—¶Shiroä¼šè‡ªåŠ¨è°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„MyRealmç±»ä¸­çš„doGetAuthenticationInfo()æ–¹æ³•è¿›è¡ŒéªŒè¯çš„ï¼ŒéªŒè¯é€»è¾‘æ˜¯å…ˆæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ï¼Œå¦‚æžœæŸ¥è¯¢åˆ°çš„è¯å†å°†æŸ¥è¯¢åˆ°çš„ç”¨æˆ·åå’Œå¯†ç æ”¾åˆ°SimpleAuthenticationInfoå¯¹è±¡ä¸­ï¼ŒShiroä¼šè‡ªåŠ¨æ ¹æ®ç”¨æˆ·è¾“å…¥çš„å¯†ç å’ŒæŸ¥è¯¢åˆ°çš„å¯†ç è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æžœåŒ¹é…ä¸ä¸Šå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ŒåŒ¹é…ä¸Šä¹‹åŽå°±ä¼šæ‰§è¡ŒdoGetAuthorizationInfo()è¿›è¡Œç›¸åº”çš„æƒé™éªŒè¯ã€‚doGetAuthorizationInfo()æ–¹æ³•çš„å¤„ç†é€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæ ¹æ®ç”¨æˆ·åèŽ·å–åˆ°ä»–æ‰€æ‹¥æœ‰çš„è§’è‰²ä»¥åŠæƒé™ï¼Œç„¶åŽèµ‹å€¼åˆ°SimpleAuthorizationInfoå¯¹è±¡ä¸­å³å¯ï¼ŒShiroå°±ä¼šæŒ‰ç…§æˆ‘ä»¬é…ç½®çš„XXè§’è‰²å¯¹åº”XXæƒé™æ¥è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¸ªé…ç½®åœ¨ä¸‹é¢çš„æ•´åˆä¸­ä¼šè®²åˆ°ã€‚ æ•´åˆSpringæŽ¥ä¸‹æ¥åº”è¯¥æ˜¯å¤§å®¶æ¯”è¾ƒå…³ç³»çš„ä¸€æ­¥ï¼šæ•´åˆSpringã€‚æˆ‘æ˜¯åœ¨ä¹‹å‰çš„Spring SpringMVC Mybatisçš„åŸºç¡€ä¸Šè¿›è¡Œæ•´åˆçš„ã€‚ web.xmlé…ç½®é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨web.xmlè¿›è¡Œé…ç½®Shiroçš„è¿‡æ»¤å™¨ã€‚æˆ‘åªè´´Shiroéƒ¨åˆ†çš„ï¼Œå…¶ä½™çš„å’Œä¹‹å‰é…ç½®æ˜¯ä¸€æ ·çš„ã€‚1234567891011121314&lt;!-- shiroè¿‡æ»¤å™¨å®šä¹‰ --&gt;&lt;filter&gt; &lt;filter-name&gt;shiroFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt; &lt;init-param&gt; &lt;!-- è¯¥å€¼ç¼ºçœä¸ºfalse,è¡¨ç¤ºç”Ÿå‘½å‘¨æœŸç”±SpringApplicationContextç®¡ç†,è®¾ç½®ä¸ºtrueåˆ™è¡¨ç¤ºç”±ServletContainerç®¡ç† --&gt; &lt;param-name&gt;targetFilterLifecycle&lt;/param-name&gt; &lt;param-value&gt;true&lt;/param-value&gt; &lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;shiroFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt; é…ç½®è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿™æ ·ä¼šè¿‡æ»¤æ‰€æœ‰çš„è¯·æ±‚ã€‚ä¹‹åŽæˆ‘ä»¬è¿˜éœ€è¦åœ¨Springä¸­é…ç½®ä¸€ä¸ªshiroFilterçš„beanã€‚ spring-mybatis.xmlé…ç½®ç”±äºŽè¿™é‡Œé…ç½®è¾ƒå¤šï¼Œæˆ‘å°±å…¨éƒ¨è´´ä¸€ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd"&gt; &lt;!-- è‡ªåŠ¨æ‰«æ --&gt; &lt;context:component-scan base-package="com.crossoverJie" /&gt; &lt;!-- å¼•å…¥é…ç½®æ–‡ä»¶ --&gt; &lt;bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt; &lt;property name="location" value="classpath:jdbc.properties" /&gt; &lt;/bean&gt; &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close"&gt; &lt;!-- æŒ‡å®šè¿žæŽ¥æ•°æ®åº“çš„é©±åŠ¨ --&gt; &lt;property name="driverClassName" value="$&#123;jdbc.driverClass&#125;" /&gt; &lt;property name="url" value="$&#123;jdbc.url&#125;" /&gt; &lt;property name="username" value="$&#123;jdbc.user&#125;" /&gt; &lt;property name="password" value="$&#123;jdbc.password&#125;" /&gt; &lt;!-- é…ç½®åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§ --&gt; &lt;property name="initialSize" value="3" /&gt; &lt;property name="minIdle" value="3" /&gt; &lt;property name="maxActive" value="20" /&gt; &lt;!-- é…ç½®èŽ·å–è¿žæŽ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt; &lt;property name="maxWait" value="60000" /&gt; &lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿žæŽ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="timeBetweenEvictionRunsMillis" value="60000" /&gt; &lt;!-- é…ç½®ä¸€ä¸ªè¿žæŽ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="minEvictableIdleTimeMillis" value="300000" /&gt; &lt;property name="validationQuery" value="SELECT 'x'" /&gt; &lt;property name="testWhileIdle" value="true" /&gt; &lt;property name="testOnBorrow" value="false" /&gt; &lt;property name="testOnReturn" value="false" /&gt; &lt;!-- æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿žæŽ¥ä¸ŠPSCacheçš„å¤§å° --&gt; &lt;property name="poolPreparedStatements" value="true" /&gt; &lt;property name="maxPoolPreparedStatementPerConnectionSize" value="20" /&gt; &lt;!-- é…ç½®ç›‘æŽ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼ŒåŽ»æŽ‰åŽç›‘æŽ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ --&gt; &lt;property name="filters" value="stat" /&gt; &lt;/bean&gt; &lt;!-- springå’ŒMyBatiså®Œç¾Žæ•´åˆï¼Œä¸éœ€è¦mybatisçš„é…ç½®æ˜ å°„æ–‡ä»¶ --&gt; &lt;bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"&gt; &lt;property name="dataSource" ref="dataSource" /&gt; &lt;!-- è‡ªåŠ¨æ‰«æmapping.xmlæ–‡ä»¶ --&gt; &lt;property name="mapperLocations" value="classpath:mapping/*.xml"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;!-- DAOæŽ¥å£æ‰€åœ¨åŒ…åï¼ŒSpringä¼šè‡ªåŠ¨æŸ¥æ‰¾å…¶ä¸‹çš„ç±» --&gt; &lt;bean class="org.mybatis.spring.mapper.MapperScannerConfigurer"&gt; &lt;property name="basePackage" value="com.crossoverJie.dao" /&gt; &lt;property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;!-- (äº‹åŠ¡ç®¡ç†)transaction manager, use JtaTransactionManager for global tx --&gt; &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt; &lt;property name="dataSource" ref="dataSource" /&gt; &lt;/bean&gt; &lt;!-- é…ç½®è‡ªå®šä¹‰Realm --&gt; &lt;bean id="myRealm" class="com.crossoverJie.shiro.MyRealm"/&gt; &lt;!-- å®‰å…¨ç®¡ç†å™¨ --&gt; &lt;bean id="securityManager" class="org.apache.shiro.web.mgt.DefaultWebSecurityManager"&gt; &lt;property name="realm" ref="myRealm"/&gt; &lt;/bean&gt; &lt;!-- Shiroè¿‡æ»¤å™¨ æ ¸å¿ƒ--&gt; &lt;bean id="shiroFilter" class="org.apache.shiro.spring.web.ShiroFilterFactoryBean"&gt; &lt;!-- Shiroçš„æ ¸å¿ƒå®‰å…¨æŽ¥å£,è¿™ä¸ªå±žæ€§æ˜¯å¿…é¡»çš„ --&gt; &lt;property name="securityManager" ref="securityManager"/&gt; &lt;!-- èº«ä»½è®¤è¯å¤±è´¥ï¼Œåˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢çš„é…ç½® --&gt; &lt;property name="loginUrl" value="/login.jsp"/&gt; &lt;!-- æƒé™è®¤è¯å¤±è´¥ï¼Œåˆ™è·³è½¬åˆ°æŒ‡å®šé¡µé¢ --&gt; &lt;property name="unauthorizedUrl" value="/nopower.jsp"/&gt; &lt;!-- Shiroè¿žæŽ¥çº¦æŸé…ç½®,å³è¿‡æ»¤é“¾çš„å®šä¹‰ --&gt; &lt;property name="filterChainDefinitions"&gt; &lt;value&gt; &lt;!--anon è¡¨ç¤ºåŒ¿åè®¿é—®ï¼Œä¸éœ€è¦è®¤è¯ä»¥åŠæŽˆæƒ--&gt; /loginAdmin=anon &lt;!--authcè¡¨ç¤ºéœ€è¦è®¤è¯ æ²¡æœ‰è¿›è¡Œèº«ä»½è®¤è¯æ˜¯ä¸èƒ½è¿›è¡Œè®¿é—®çš„--&gt; /admin*=authc /student=roles[teacher] /teacher=perms["user:create"] &lt;/value&gt; &lt;/property&gt; &lt;/bean&gt; &lt;!-- ä¿è¯å®žçŽ°äº†Shiroå†…éƒ¨lifecycleå‡½æ•°çš„beanæ‰§è¡Œ --&gt; &lt;bean id="lifecycleBeanPostProcessor" class="org.apache.shiro.spring.LifecycleBeanPostProcessor"/&gt; &lt;!-- å¼€å¯Shiroæ³¨è§£ --&gt; &lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator" depends-on="lifecycleBeanPostProcessor"/&gt; &lt;bean class="org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor"&gt; &lt;property name="securityManager" ref="securityManager"/&gt; &lt;/bean&gt;&lt;/beans&gt; åœ¨è¿™é‡Œæˆ‘ä»¬é…ç½®äº†ä¸Šæ–‡ä¸­æ‰€æåˆ°çš„è‡ªå®šä¹‰myRealm,è¿™æ ·Shiroå°±å¯ä»¥æŒ‰ç…§æˆ‘ä»¬è‡ªå®šä¹‰çš„é€»è¾‘æ¥è¿›è¡Œæƒé™éªŒè¯äº†ã€‚å…¶ä½™çš„éƒ½æ¯”è¾ƒç®€å•ï¼Œçœ‹æ³¨é‡Šåº”è¯¥éƒ½èƒ½æ˜Žç™½ã€‚ç€é‡è®²è§£ä¸€ä¸‹ï¼š12345678910111213&lt;property name="filterChainDefinitions"&gt; &lt;value&gt; &lt;!--anon è¡¨ç¤ºåŒ¿åè®¿é—®ï¼Œä¸éœ€è¦è®¤è¯ä»¥åŠæŽˆæƒ--&gt; /loginAdmin=anon &lt;!--authcè¡¨ç¤ºéœ€è¦è®¤è¯ æ²¡æœ‰è¿›è¡Œèº«ä»½è®¤è¯æ˜¯ä¸èƒ½è¿›è¡Œè®¿é—®çš„--&gt; /admin*=authc /student=roles[teacher] /teacher=perms["user:create"] &lt;/value&gt;&lt;/property&gt; /loginAdmin=anonçš„æ„æ€çš„æ„æ€æ˜¯ï¼Œå‘èµ·/loginAdminè¿™ä¸ªè¯·æ±‚æ˜¯ä¸éœ€è¦è¿›è¡Œèº«ä»½è®¤è¯çš„ï¼Œè¿™ä¸ªè¯·æ±‚åœ¨è¿™æ¬¡é¡¹ç›®ä¸­æ˜¯ä¸€ä¸ªç™»å½•è¯·æ±‚ï¼Œä¸€èˆ¬å¯¹äºŽè¿™æ ·çš„è¯·æ±‚éƒ½æ˜¯ä¸éœ€è¦èº«ä»½è®¤è¯çš„ã€‚ /admin*=authcè¡¨ç¤º /admin,/admin1,/admin2è¿™æ ·çš„è¯·æ±‚éƒ½æ˜¯éœ€è¦è¿›è¡Œèº«ä»½è®¤è¯çš„ï¼Œä¸ç„¶æ˜¯ä¸èƒ½è®¿é—®çš„ã€‚ /student=roles[teacher]è¡¨ç¤ºè®¿é—®/studentè¯·æ±‚çš„ç”¨æˆ·å¿…é¡»æ˜¯teacherè§’è‰²ï¼Œä¸ç„¶æ˜¯ä¸èƒ½è¿›è¡Œè®¿é—®çš„ã€‚ /teacher=perms[â€œuser:createâ€]è¡¨ç¤ºè®¿é—®/teacherè¯·æ±‚æ˜¯éœ€è¦å½“å‰ç”¨æˆ·å…·æœ‰user:createæƒé™æ‰èƒ½è¿›è¡Œè®¿é—®çš„ã€‚æ›´å¤šç›¸å…³æƒé™è¿‡æ»¤çš„èµ„æ–™å¯ä»¥è®¿é—®shiroçš„å®˜æ–¹ä»‹ç»ï¼šä¼ é€é—¨ ä½¿ç”¨Shiroæ ‡ç­¾åº“Shiroè¿˜æœ‰ç€å¼ºå¤§æ ‡ç­¾åº“ï¼Œå¯ä»¥åœ¨å‰ç«¯å¸®æˆ‘èŽ·å–ä¿¡æ¯å’Œåšåˆ¤æ–­ã€‚æˆ‘è´´ä¸€ä¸‹æˆ‘è¿™é‡Œç™»å½•å®Œæˆä¹‹åŽæ˜¾ç¤ºçš„ç•Œé¢ï¼š12345678910111213141516171819202122232425&lt;%-- Created by IntelliJ IDEA. User: Administrator Date: 2016/7/14 Time: 13:17 To change this template use File | Settings | File Templates.--%&gt;&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;&lt;%@ taglib prefix="shiro" uri="http://shiro.apache.org/tags" %&gt;&lt;html&gt;&lt;head&gt; &lt;title&gt;åŽå°&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;shiro:hasRole name="admin"&gt; è¿™æ˜¯adminè§’è‰²ç™»å½•ï¼š&lt;shiro:principal&gt;&lt;/shiro:principal&gt;&lt;/shiro:hasRole&gt;&lt;shiro:hasPermission name="user:create"&gt; æœ‰user:createæƒé™ä¿¡æ¯&lt;/shiro:hasPermission&gt;&lt;br&gt;ç™»å½•æˆåŠŸ&lt;/body&gt;&lt;/html&gt; è¦æƒ³ä½¿ç”¨Shiroæ ‡ç­¾ï¼Œåªéœ€è¦å¼•å…¥ä¸€ä¸‹æ ‡ç­¾å³å¯ï¼š&lt;%@ taglib prefix=&quot;shiro&quot; uri=&quot;http://shiro.apache.org/tags&quot; %&gt;å…¶å®žè‹±è¯­ç¨å¾®å¥½ç‚¹çš„ç«¥éž‹åº”è¯¥éƒ½èƒ½çœ‹æ‡‚ã€‚ä¸‹é¢æˆ‘å¤§æ¦‚ä»‹ç»ä¸‹ä¸€äº›æ ‡ç­¾çš„ç”¨æ³•ï¼š å…·æœ‰adminè§’è‰²æ‰ä¼šæ˜¾ç¤ºæ ‡ç­¾å†…çš„ä¿¡æ¯ã€‚ èŽ·å–ç”¨æˆ·ä¿¡æ¯ã€‚é»˜è®¤è°ƒç”¨Subject.getPrincipal()èŽ·å–ï¼Œå³ Primary Principalã€‚ ç”¨æˆ·æ‹¥æœ‰user:createè¿™ä¸ªæƒé™æ‰å›žæ˜¾ç¤ºæ ‡ç­¾å†…çš„ä¿¡æ¯ã€‚æ›´å¤šçš„æ ‡ç­¾å¯ä»¥æŸ¥çœ‹å®˜ç½‘ï¼šä¼ é€é—¨ æ•´ä½“æµ‹è¯• è¿™æ˜¯æˆ‘çš„æµ‹è¯•æ•°æ®ã€‚é¦–å…ˆæ¥éªŒè¯ä¸€ä¸‹ç™»å½•ï¼šå…ˆè¾“å…¥ä¸€ä¸ªé”™è¯¯çš„è´¦å·å’Œå¯†ç ï¼š æŽ¥ä¸‹æ¥è¾“å…¥ä¸€ä¸ªæ­£ç¡®çš„ï¼š å¯ä»¥çœ‹åˆ°æˆ‘ç™»å½•çš„ç”¨æˆ·æ˜¯crossoverJieä»–æ˜¯æœ‰adminçš„è§’è‰²ï¼Œå¹¶ä¸”æ‹¥æœ‰user:*(ps:ç³»ç»Ÿæ•°æ®è¯¦è§ä¸Šé¢çš„æ•°æ®åº“æˆªå›¾)çš„æƒé™ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼š 123456&lt;shiro:hasRole name="admin"&gt; è¿™æ˜¯adminè§’è‰²ç™»å½•ï¼š&lt;shiro:principal&gt;&lt;/shiro:principal&gt;&lt;/shiro:hasRole&gt;&lt;shiro:hasPermission name="user:create"&gt; æœ‰user:createæƒé™ä¿¡æ¯&lt;/shiro:hasPermission&gt; æ˜¯èƒ½æ˜¾ç¤ºå‡ºæ ‡ç­¾å†…çš„ä¿¡æ¯ï¼Œå¹¶æŠŠç”¨æˆ·ä¿¡æ¯ä¹Ÿæ˜¾ç¤ºå‡ºæ¥äº†ã€‚æŽ¥ç€æˆ‘ä»¬æ¥è®¿é—®ä¸€ä¸‹/studentè¿™ä¸ªè¯·æ±‚ï¼Œå› ä¸ºåœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­ï¼š 12345678910111213&lt;property name="filterChainDefinitions"&gt; &lt;value&gt; &lt;!--anon è¡¨ç¤ºåŒ¿åè®¿é—®ï¼Œä¸éœ€è¦è®¤è¯ä»¥åŠæŽˆæƒ--&gt; /loginAdmin=anon &lt;!--authcè¡¨ç¤ºéœ€è¦è®¤è¯ æ²¡æœ‰è¿›è¡Œèº«ä»½è®¤è¯æ˜¯ä¸èƒ½è¿›è¡Œè®¿é—®çš„--&gt; /admin*=authc /student=roles[teacher] /teacher=perms["user:create"] &lt;/value&gt;&lt;/property&gt; åªæœ‰teacherè§’è‰²æ‰èƒ½è®¿é—®/studentè¿™ä¸ªè¯·æ±‚çš„ï¼š æžœç„¶ï¼ŒShiroåšäº†å®‰å…¨æŽ§åˆ¶æ˜¯ä¸èƒ½è¿›è¡Œè®¿é—®çš„ã€‚ç„¶åŽæˆ‘ä»¬æ¢aaaç”¨æˆ·ç™»å½•ï¼Œä»–æ­£å¥½æ˜¯teacherè§’è‰²ï¼Œçœ‹èƒ½ä¸èƒ½è®¿é—®/studentã€‚ æžœç„¶æ˜¯èƒ½è®¿é—®çš„ã€‚å› ä¸ºæˆ‘åœ¨æŽ§åˆ¶å™¨é‡Œè®¿é—®/studentè¿”å›žçš„æ˜¯åŒä¸€ä¸ªç•Œé¢æ‰€ä»¥çœ‹åˆ°çš„è¿˜æ˜¯è¿™ä¸ªç•Œé¢ã€‚ 1234@RequestMapping("/teacher")public String teacher()&#123; return "admin" ;&#125; å¹¶ä¸”æ²¡æœ‰æ˜¾ç¤ºä¹‹å‰Shiroæ ‡ç­¾å†…çš„å†…å®¹ã€‚å…¶ä»–çš„æˆ‘å°±ä¸æµ‹äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±åœ¨æ•°æ®åº“é‡ŒåŠ ä¸€äº›æ•°æ®ï¼Œæˆ–è€…æ˜¯æ”¹ä¸‹æ‹¦æˆªçš„æƒé™å¤šè¯•è¯•ï¼Œè¿™æ ·å¯¹Shiroçš„ç†è§£å°±ä¼šæ›´åŠ æ·±åˆ»ã€‚ MD5åŠ å¯†Shiroè¿˜å°è£…äº†ä¸€ä¸ªæˆ‘è®¤ä¸ºéžå¸¸ä¸é”™çš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯MD5åŠ å¯†ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920package com.crossoverJie.shiro;import org.apache.shiro.crypto.hash.Md5Hash;/** * Created with IDEA * åŸºäºŽShiroçš„MD5åŠ å¯† * Created by $&#123;jie.chen&#125; on 2016/7/13. */public class MD5Util &#123; public static String md5(String str,String salt)&#123; return new Md5Hash(str,salt).toString() ; &#125; public static void main(String[] args) &#123; String md5 = md5("abc123","crossoverjie") ; System.out.println(md5); &#125;&#125; ä»£ç éžå¸¸ç®€å•ï¼Œåªéœ€è¦è°ƒç”¨Md5Hash(str,salt)æ–¹æ³•å³å¯ï¼Œè¿™é‡Œå¤šäº†ä¸€ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ç”¨å¤šè§£é‡Šï¼Œæ˜¯éœ€è¦åŠ å¯†çš„å­—ç¬¦ä¸²ã€‚ç¬¬äºŒä¸ªå‚æ•°saltä¸­æ–‡ç¿»è¯‘å«ç›ï¼ŒåŠ å¯†çš„æ—¶å€™æˆ‘ä»¬ä¼ ä¸€ä¸ªå­—ç¬¦ä¸²è¿›åŽ»ï¼Œåªè¦è¿™ä¸ªsaltä¸è¢«æ³„éœ²å‡ºåŽ»ï¼Œé‚£åŽŸåˆ™ä¸ŠåŠ å¯†ä¹‹åŽæ˜¯æ— æ³•è¢«è§£å¯†çš„ï¼Œåœ¨å­˜ç”¨æˆ·å¯†ç çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ï¼Œæ„Ÿè§‰è¿˜æ˜¯éžå¸¸å±Œçš„ã€‚ æ€»ç»“ä»¥ä¸Šå°±æ˜¯Shiroå®žé™…ä½¿ç”¨çš„æ¡ˆä¾‹ï¼Œå°†çš„æ¯”è¾ƒåˆç•¥ï¼Œä½†æ˜¯å…³äºŽShiroçš„æ ¸å¿ƒä¸œè¥¿éƒ½åœ¨é‡Œé¢äº†ã€‚å¤§å®¶å¯ä»¥åŽ»æˆ‘çš„githubä¸Šä¸‹è½½æºç ï¼Œåªè¦æŒ‰ç…§æˆ‘ç»™çš„æ•°æ®åº“å°±æ²¡æœ‰é—®é¢˜ï¼Œé¡¹ç›®è·‘èµ·æ¥ä¹‹åŽè¯•ç€æ”¹ä¸‹é‡Œé¢çš„ä¸œè¥¿å¯ä»¥åŠ æ·±å¯¹Shiroçš„ç†è§£ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.gitä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IDEA</tag>
        <tag>Shiro</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(äºŒ)Luceneå…¨æ–‡æ£€ç´¢]]></title>
    <url>%2F2016%2F07%2F06%2FSSM2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å¤§å®¶å¹³æ—¶è‚¯å®šéƒ½æœ‰ç”¨è¿‡å…¨æ–‡æ£€ç´¢å·¥å…·ï¼Œæœ€å¸¸ç”¨çš„ç™¾åº¦è°·æ­Œå°±æ˜¯å…¶ä¸­çš„å…¸åž‹ã€‚å¦‚æžœè‡ªå·±èƒ½å¤Ÿåšä¸€ä¸ªé‚£æ˜¯ä¸æ˜¯æƒ³æƒ³å°±é€¼æ ¼æ»¡æ»¡å‘¢ã€‚Apacheå°±ä¸ºæˆ‘ä»¬æä¾›äº†è¿™æ ·ä¸€ä¸ªæ¡†æž¶ï¼Œä»¥ä¸‹å°±æ˜¯åœ¨å®žé™…å¼€å‘ä¸­åŠ å…¥Luceneçš„ä¸€ä¸ªå°Demoã€‚ èŽ·å–Mavenä¾èµ–é¦–å…ˆçœ‹ä¸€ä¸‹å®žé™…è¿è¡Œçš„æ•ˆæžœå›¾ï¼šè¿™ä¸ªé¡¹ç›®æ˜¯åŸºäºŽä¹‹å‰ä½¿ç”¨IDEAæ­å»ºçš„SSMçš„åŸºç¡€ä¸Šè¿›è¡Œå¢žåŠ çš„ï¼Œå»ºè®®å°ç™½å…ˆçœ‹ä¸‹ä¸€æˆ‘ã€‚ä¸Šä¸€ç¯‡åšå®¢ï¼Œä»¥åŠå…±äº«åœ¨Githubä¸Šçš„æºç ã€‚ä»¥ä¸‹æ˜¯Luceneæ‰€éœ€è¦çš„ä¾èµ–ï¼š1234567891011121314151617181920212223242526272829303132333435&lt;!--åŠ å…¥lucene--&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.lucene/lucene-core --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt; &lt;artifactId&gt;lucene-core&lt;/artifactId&gt; &lt;version&gt;$&#123;lucene.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.lucene/lucene-queryparser --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt; &lt;artifactId&gt;lucene-queryparser&lt;/artifactId&gt; &lt;version&gt;$&#123;lucene.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.lucene/lucene-analyzers-common --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt; &lt;artifactId&gt;lucene-analyzers-common&lt;/artifactId&gt; &lt;version&gt;$&#123;lucene.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!--luceneä¸­æ–‡åˆ†è¯--&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.lucene/lucene-analyzers-smartcn --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt; &lt;artifactId&gt;lucene-analyzers-smartcn&lt;/artifactId&gt; &lt;version&gt;$&#123;lucene.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!--luceneé«˜äº®--&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.lucene/lucene-highlighter --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt; &lt;artifactId&gt;lucene-highlighter&lt;/artifactId&gt; &lt;version&gt;$&#123;lucene.version&#125;&lt;/version&gt; &lt;/dependency&gt; å…·ä½“çš„ç”¨é€”æˆ‘éƒ½å†™æœ‰æ³¨é‡Šã€‚åœ¨IDEAä¸­ä¿®æ”¹äº†Pom.xmlæ–‡ä»¶ä¹‹åŽåªéœ€è¦ç‚¹å‡»å¦‚å›¾æ‰€ç¤ºçš„æŒ‰é’®å³å¯é‡æ–°èŽ·å–ä¾èµ–ï¼š ç¼–å†™Luceneå·¥å…·ç±»è¿™ä¸ªå·¥å…·ç±»ä¸­çš„å…·ä½“ä»£ç æˆ‘å°±ä¸å•ç‹¬æå‡ºæ¥è¯´äº†ï¼Œæ¯ä¸ªå…³é”®çš„åœ°æ–¹æˆ‘éƒ½å†™æœ‰æ³¨é‡Šï¼Œä¸æ¸…æ¥šçš„å†è®¨è®ºã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164package com.crossoverJie.lucene;import com.crossoverJie.pojo.User;import org.apache.lucene.analysis.TokenStream;import org.apache.lucene.analysis.cn.smart.SmartChineseAnalyzer;import org.apache.lucene.document.Document;import org.apache.lucene.document.Field;import org.apache.lucene.document.StringField;import org.apache.lucene.document.TextField;import org.apache.lucene.index.*;import org.apache.lucene.queryparser.classic.QueryParser;import org.apache.lucene.search.*;import org.apache.lucene.search.highlight.*;import org.apache.lucene.store.Directory;import org.apache.lucene.store.FSDirectory;import java.io.StringReader;import java.nio.file.Paths;import java.util.LinkedList;import java.util.List;import com.crossoverJie.util.*;/** * åšå®¢ç´¢å¼•ç±» * @author Administrator * */public class LuceneIndex &#123; private Directory dir=null; /** * èŽ·å–IndexWriterå®žä¾‹ * @return * @throws Exception */ private IndexWriter getWriter()throws Exception&#123; /** * ç”Ÿæˆçš„ç´¢å¼•æˆ‘æ”¾åœ¨äº†Cç›˜ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ”¾åœ¨å…·ä½“ä½ç½® */ dir= FSDirectory.open(Paths.get("C://lucene")); SmartChineseAnalyzer analyzer=new SmartChineseAnalyzer(); IndexWriterConfig iwc=new IndexWriterConfig(analyzer); IndexWriter writer=new IndexWriter(dir, iwc); return writer; &#125; /** * æ·»åŠ åšå®¢ç´¢å¼• * @param user */ public void addIndex(User user)throws Exception&#123; IndexWriter writer=getWriter(); Document doc=new Document(); doc.add(new StringField("id",String.valueOf(user.getUserId()), Field.Store.YES)); /** * yesæ˜¯ä¼šå°†æ•°æ®å­˜è¿›ç´¢å¼•ï¼Œå¦‚æžœæŸ¥è¯¢ç»“æžœä¸­éœ€è¦å°†è®°å½•æ˜¾ç¤ºå‡ºæ¥å°±è¦å­˜è¿›åŽ»ï¼Œå¦‚æžœæŸ¥è¯¢ç»“æžœ * åªæ˜¯æ˜¾ç¤ºæ ‡é¢˜ä¹‹ç±»çš„å°±å¯ä»¥ä¸ç”¨å­˜ï¼Œè€Œä¸”å†…å®¹è¿‡é•¿ä¸å»ºè®®å­˜è¿›åŽ» * ä½¿ç”¨TextFieldç±»æ˜¯å¯ä»¥ç”¨äºŽæŸ¥è¯¢çš„ã€‚ */ doc.add(new TextField("username", user.getUsername(), Field.Store.YES)); doc.add(new TextField("description",user.getDescription(), Field.Store.YES)); writer.addDocument(doc); writer.close(); &#125; /** * æ›´æ–°åšå®¢ç´¢å¼• * @param user * @throws Exception */ public void updateIndex(User user)throws Exception&#123; IndexWriter writer=getWriter(); Document doc=new Document(); doc.add(new StringField("id",String.valueOf(user.getUserId()), Field.Store.YES)); doc.add(new TextField("username", user.getUsername(), Field.Store.YES)); doc.add(new TextField("description",user.getDescription(), Field.Store.YES)); writer.updateDocument(new Term("id", String.valueOf(user.getUserId())), doc); writer.close(); &#125; /** * åˆ é™¤æŒ‡å®šåšå®¢çš„ç´¢å¼• * @param userId * @throws Exception */ public void deleteIndex(String userId)throws Exception&#123; IndexWriter writer=getWriter(); writer.deleteDocuments(new Term("id", userId)); writer.forceMergeDeletes(); // å¼ºåˆ¶åˆ é™¤ writer.commit(); writer.close(); &#125; /** * æŸ¥è¯¢ç”¨æˆ· * @param q æŸ¥è¯¢å…³é”®å­— * @return * @throws Exception */ public List&lt;User&gt; searchBlog(String q)throws Exception&#123; /** * æ³¨æ„çš„æ˜¯æŸ¥è¯¢ç´¢å¼•çš„ä½ç½®å¾—æ˜¯å­˜æ”¾ç´¢å¼•çš„ä½ç½®ï¼Œä¸ç„¶ä¼šæ‰¾ä¸åˆ°ã€‚ */ dir= FSDirectory.open(Paths.get("C://lucene")); IndexReader reader = DirectoryReader.open(dir); IndexSearcher is=new IndexSearcher(reader); BooleanQuery.Builder booleanQuery = new BooleanQuery.Builder(); SmartChineseAnalyzer analyzer=new SmartChineseAnalyzer(); /** * usernameå’Œdescriptionå°±æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡ŒæŸ¥æ‰¾çš„ä¸¤ä¸ªå­—æ®µ * åŒæ—¶åœ¨å­˜æ”¾ç´¢å¼•çš„æ—¶å€™è¦ä½¿ç”¨TextFieldç±»è¿›è¡Œå­˜æ”¾ã€‚ */ QueryParser parser=new QueryParser("username",analyzer); Query query=parser.parse(q); QueryParser parser2=new QueryParser("description",analyzer); Query query2=parser2.parse(q); booleanQuery.add(query, BooleanClause.Occur.SHOULD); booleanQuery.add(query2, BooleanClause.Occur.SHOULD); TopDocs hits=is.search(booleanQuery.build(), 100); QueryScorer scorer=new QueryScorer(query); Fragmenter fragmenter = new SimpleSpanFragmenter(scorer); /** * è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ¥è‡ªå®šä¹‰æŸ¥æ‰¾å…³é”®å­—é«˜äº®æ—¶çš„æ ·å¼ã€‚ */ SimpleHTMLFormatter simpleHTMLFormatter=new SimpleHTMLFormatter("&lt;b&gt;&lt;font color='red'&gt;","&lt;/font&gt;&lt;/b&gt;"); Highlighter highlighter=new Highlighter(simpleHTMLFormatter, scorer); highlighter.setTextFragmenter(fragmenter); List&lt;User&gt; userList=new LinkedList&lt;User&gt;(); for(ScoreDoc scoreDoc:hits.scoreDocs)&#123; Document doc=is.doc(scoreDoc.doc); User user=new User(); user.setUserId(Integer.parseInt(doc.get(("id")))); user.setDescription(doc.get(("description"))); String username=doc.get("username"); String description=doc.get("description"); if(username!=null)&#123; TokenStream tokenStream = analyzer.tokenStream("username", new StringReader(username)); String husername=highlighter.getBestFragment(tokenStream, username); if(StringUtil.isEmpty(husername))&#123; user.setUsername(username); &#125;else&#123; user.setUsername(husername); &#125; &#125; if(description!=null)&#123; TokenStream tokenStream = analyzer.tokenStream("description", new StringReader(description)); String hContent=highlighter.getBestFragment(tokenStream, description); if(StringUtil.isEmpty(hContent))&#123; if(description.length()&lt;=200)&#123; user.setDescription(description); &#125;else&#123; user.setDescription(description.substring(0, 200)); &#125; &#125;else&#123; user.setDescription(hContent); &#125; &#125; userList.add(user); &#125; return userList; &#125;&#125; æŸ¥è¯¢Controllerçš„ç¼–å†™æŽ¥ä¸‹æ¥æ˜¯æŸ¥è¯¢Controllerï¼š123456789101112131415161718192021222324@RequestMapping("/q")public String search(@RequestParam(value = "q", required = false,defaultValue = "") String q, @RequestParam(value = "page", required = false, defaultValue = "1") String page, Model model, HttpServletRequest request) throws Exception &#123; LuceneIndex luceneIndex = new LuceneIndex() ; List&lt;User&gt; userList = luceneIndex.searchBlog(q); /** * å…³äºŽæŸ¥è¯¢ä¹‹åŽçš„åˆ†é¡µæˆ‘é‡‡ç”¨çš„æ˜¯æ¯æ¬¡åˆ†é¡µå‘èµ·çš„è¯·æ±‚éƒ½æ˜¯å°†æ‰€æœ‰çš„æ•°æ®æŸ¥è¯¢å‡ºæ¥ï¼Œ * å…·ä½“æ˜¯ç¬¬å‡ é¡µå†æˆªå–å¯¹åº”é¡µæ•°çš„æ•°æ®ï¼Œå…¸åž‹çš„æ‹¿ç©ºé—´æ¢æ—¶é—´çš„åšæ³•ï¼Œå¦‚æžœå„ä½æœ‰ä»€ä¹ˆ * é«˜æ‹›æ¬¢è¿Žå—æ•™ã€‚ */ Integer toIndex = userList.size() &gt;= Integer.parseInt(page) * 5 ? Integer.parseInt(page) * 5 : userList.size(); List&lt;User&gt; newList = userList.subList((Integer.parseInt(page) - 1) * 5, toIndex); model.addAttribute("userList",newList) ; String s = this.genUpAndDownPageCode(Integer.parseInt(page), userList.size(), q, 5, request.getServletContext(). getContextPath()); model.addAttribute("pageHtml",s) ; model.addAttribute("q",q) ; model.addAttribute("resultTotal",userList.size()) ; model.addAttribute("pageTitle","æœç´¢å…³é”®å­—'" + q + "'ç»“æžœé¡µé¢") ; return "queryResult";&#125; å…¶ä¸­æœ‰ç”¨åˆ°ä¸€ä¸ªgenUpAndDownPageCode()æ–¹æ³•æ¥ç”Ÿæˆåˆ†é¡µçš„Htmlä»£ç ï¼Œå¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132/** * æŸ¥è¯¢ä¹‹åŽçš„åˆ†é¡µ * @param page * @param totalNum * @param q * @param pageSize * @param projectContext * @return */private String genUpAndDownPageCode(int page,Integer totalNum,String q,Integer pageSize,String projectContext)&#123; long totalPage=totalNum%pageSize==0?totalNum/pageSize:totalNum/pageSize+1; StringBuffer pageCode=new StringBuffer(); if(totalPage==0)&#123; return ""; &#125;else&#123; pageCode.append("&lt;nav&gt;"); pageCode.append("&lt;ul class='pager' &gt;"); if(page&gt;1)&#123; pageCode.append("&lt;li&gt;&lt;a href='"+projectContext+"/q?page="+(page-1)+"&amp;q="+q+"'&gt;ä¸Šä¸€é¡µ&lt;/a&gt;&lt;/li&gt;"); &#125;else&#123; pageCode.append("&lt;li class='disabled'&gt;&lt;a href='#'&gt;ä¸Šä¸€é¡µ&lt;/a&gt;&lt;/li&gt;"); &#125; if(page&lt;totalPage)&#123; pageCode.append("&lt;li&gt;&lt;a href='"+projectContext+"/q?page="+(page+1)+"&amp;q="+q+"'&gt;ä¸‹ä¸€é¡µ&lt;/a&gt;&lt;/li&gt;"); &#125;else&#123; pageCode.append("&lt;li class='disabled'&gt;&lt;a href='#'&gt;ä¸‹ä¸€é¡µ&lt;/a&gt;&lt;/li&gt;"); &#125; pageCode.append("&lt;/ul&gt;"); pageCode.append("&lt;/nav&gt;"); &#125; return pageCode.toString();&#125; ä»£ç æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ ¹æ®çš„é¡µæ•°ã€æ€»é¡µæ•°æ¥ç”Ÿæˆåˆ†é¡µä»£ç ï¼Œå¯¹äº†æˆ‘å‰ç«¯é‡‡ç”¨çš„æ˜¯çŽ°åœ¨æµè¡Œçš„Bootstrapï¼Œè¿™ä¸ªæœ‰ä¸ä¼šçš„å¯ä»¥åŽ»ä»–å®˜ç½‘çœ‹çœ‹ï¼Œæ¯”è¾ƒç®€å•æ˜“ä¸Šæ‰‹ã€‚æŽ¥ä¸‹æ¥åªéœ€è¦ç¼–å†™æ˜¾ç¤ºç•Œé¢å°±å¤§åŠŸå‘Šæˆäº†ã€‚ æ˜¾ç¤ºç•Œé¢æˆ‘åªè´´å…³é”®ä»£ç ï¼Œå…·ä½“çš„å¯ä»¥åŽ»Githubä¸ŠæŸ¥çœ‹ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041&lt;c:choose&gt; &lt;c:when test="$&#123;userList.size()==0 &#125;"&gt; &lt;div align="center" style="padding-top: 20px"&gt;&lt;font color="red"&gt;$&#123;q&#125;&lt;/font&gt;æœªæŸ¥è¯¢åˆ°ç»“æžœï¼Œè¯·æ¢ä¸ªå…³é”®å­—è¯•è¯•ï¼&lt;/div&gt; &lt;/c:when&gt; &lt;c:otherwise&gt; &lt;div align="center" style="padding-top: 20px"&gt; æŸ¥è¯¢&lt;font color="red"&gt;$&#123;q&#125;&lt;/font&gt;å…³é”®å­—ï¼Œçº¦$&#123;resultTotal&#125;æ¡è®°å½•ï¼ &lt;/div&gt; &lt;c:forEach var="u" items="$&#123;userList &#125;" varStatus="status"&gt; &lt;div class="panel-heading "&gt; &lt;div class="row"&gt; &lt;div class="col-md-6"&gt; &lt;div class="row"&gt; &lt;div class="col-md-12"&gt; &lt;b&gt; &lt;a href="&lt;%=path %&gt;/user/showUser/$&#123;u.userId&#125;"&gt;$&#123;u.username&#125;&lt;/a&gt; &lt;/b&gt; &lt;br/&gt; $&#123;u.description&#125; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="col-md-4 col-md-offset-2"&gt; &lt;p class="text-muted text-right"&gt; $&#123;u.password&#125; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="panel-footer"&gt; &lt;p class="text-right"&gt; &lt;span class="label label-default"&gt; &lt;span class="glyphicon glyphicon-comment" aria-hidden="true"&gt;&lt;/span&gt; $&#123;u.password&#125; &lt;/span&gt; &lt;/p&gt; &lt;/div&gt; &lt;/c:forEach&gt; &lt;/c:otherwise&gt; &lt;/c:choose&gt; åˆ©ç”¨JSTLæ ‡ç­¾å³å¯å°†æ•°æ®å¾ªçŽ¯å±•ç¤ºå‡ºæ¥ï¼Œå…³é”®å­—å°±ä¸éœ€è¦å•ç‹¬åšå¤„ç†äº†ï¼Œåœ¨åŽå°æŸ¥è¯¢çš„æ—¶å€™å·²ç»åšäº†ä¿®æ”¹äº†ã€‚ æ€»ç»“å…³äºŽå…¨æ–‡æ£€ç´¢çš„æ¡†æž¶ä¸æ­¢Luceneè¿˜æœ‰solrï¼Œå…·ä½“è°å¥½æœ‰ä»€ä¹ˆåŒºåˆ«æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šï¼Œå‡†å¤‡ä¸‹æ¥èŠ±ç‚¹æ—¶é—´ç ”ç©¶ä¸‹ã€‚å“¦å¯¹äº†ï¼Œæœ€è¿‘åˆæœ‰ç‚¹æƒ³åšAndroidå¼€å‘äº†ï¼Œæ„Ÿè§‰åšç‚¹ä¸œè¥¿èƒ½å¤Ÿå®žå®žåœ¨åœ¨çš„æ‘¸å¾—åˆ°é€¼æ ¼ç¡®å®žè¦é«˜äº›(çŽ°åœ¨ä¸»è¦åœ¨åšåŽç«¯å¼€å‘)ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…³æ³¨ä¸‹ã€‚å“¦å¯¹äº†ï¼Œç›´æŽ¥è¿è¡Œæˆ‘ä»£ç çš„æœ‹å‹è¦ä¸‹æ³¨æ„ï¼š é¦–å…ˆè¦å°†æ•°æ®åº“å€’åˆ°è‡ªå·±çš„MySQLä¸Š ä¹‹åŽåœ¨é¦–æ¬¡è¿è¡Œçš„æ—¶å€™éœ€è¦ç‚¹å‡»é‡æ–°ç”Ÿæˆç´¢å¼•æŒ‰é’®ç”Ÿæˆä¸€éç´¢å¼•ä¹‹åŽæ‰èƒ½è¿›è¡Œæœç´¢ï¼Œå› ä¸ºçŽ°åœ¨çš„æ•°æ®æ˜¯ç›´æŽ¥å­˜åˆ°æ•°æ®åº“ä¸­çš„ï¼Œå¹¶æ²¡æœ‰åœ¨æ–°å¢žçš„æ—¶å€™å°±å¢žåŠ ç´¢å¼•ï¼Œåœ¨å®žé™…å¼€å‘çš„æ—¶å€™éœ€è¦åœ¨æ–°å¢žæ•°æ®é‚£é‡Œå†ç”Ÿæˆä¸€ä»½ç´¢å¼•ï¼Œå°±ç›´æŽ¥è°ƒç”¨LuceneIndexç±»ä¸­çš„addIndexæ–¹æ³•ä¼ å…¥å®žä½“å³å¯ï¼Œå†åšæ›´æ–°ã€åˆ é™¤æ“ä½œçš„æ—¶å€™ä¹ŸåŒæ ·éœ€è¦å¯¹ç´¢å¼•åšæ“ä½œã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IDEA</tag>
        <tag>Lucene</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(ä¸€)æ¡†æž¶çš„æ•´åˆ]]></title>
    <url>%2F2016%2F06%2F28%2FSSM1%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘è¿™å‡ å¹´JetBrainså…¬å¸å¼€å‘çš„IDEAæ˜¯è¶Šæ¥è¶Šæµè¡Œäº†ï¼Œç”šè‡³Googleçš„å®˜æ–¹IDEéƒ½æ˜¯IDEAæ¥å®šåˆ¶çš„ï¼Œå¯è§IDEAçš„å‘å±•è¶‹åŠ¿æ˜¯è¶Šæ¥è¶Šå¥½ï¼Œç”±äºŽåšä¸»æŽ¥è§¦IDEAçš„æ—¶é—´ä¹Ÿä¸é•¿ï¼Œæ‰€ä»¥æœ‰å…³IDEAå’ŒEclipseçš„åŒºåˆ«å’Œä¼˜åŠ£åŠ¿è¯·è‡ªè¡Œç™¾åº¦äº†ã€‚å€Ÿæ­¤æœºä¼šæˆ‘å°±ä½¿ç”¨IDEAæ¥æ•´åˆä¸€ä¸‹SSMï¼Œé’ˆå¯¹äºŽåˆå­¦è€…(åˆæ¬¡ä½¿ç”¨IDEAå’ŒJAVAEEåˆå­¦è€…)è¿˜æ˜¯æœ‰å¸®åŠ©çš„ã€‚ æ–°å»ºSSMé¡¹ç›®å“¦å¯¹äº†ï¼Œå…³äºŽIDEAçš„ç‰ˆæœ¬é—®é¢˜å¼ºçƒˆå»ºè®®ä½¿ç”¨æ——èˆ°ç‰ˆï¼Œæœ‰æ¡ä»¶çš„å°±è´­ä¹°ï¼Œæ²¡æ¡ä»¶çš„å˜›ã€‚ã€‚å¤©æœä½ æ‡‚çš„ã€‚åœ¨æ¬¢è¿Žç•Œé¢ç‚¹å‡»Create New Projectã€‚ä¹‹åŽé€‰æ‹©Maven(æ–°å»ºJAVAEEé¡¹ç›®æ˜¯éœ€è¦å®‰è£…JDKçš„ï¼Œè¿™ä¸ªå°±ä¸åœ¨è¿™é‡Œè®²è§£äº†ã€‚)é€‰å¥½ä¹‹åŽç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚ä¹‹åŽå¡«å…¥GroupIDå’ŒArtifactIDè¿™é‡Œå°½é‡æŒ‰ç…§Mavençš„å‘½åè§„èŒƒæ¥å³å¯ã€‚ä¹‹åŽç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œå¡«å…¥é¡¹ç›®åç§°ï¼Œè¿™é‡Œæˆ‘å»ºè®®å’Œä¹‹å‰å¡«å†™çš„ArtifactIDåç§°ä¸€æ ·å³å¯ã€‚ç‚¹å‡»Finishå®Œæˆé¡¹ç›®çš„åˆ›å»ºã€‚ä¹‹åŽå°½é‡ä¸è¦åšå…¶ä»–æ“ä½œï¼Œè®©IDEAå®Œæˆç´¢å¼•åˆ›å»ºã€‚ å®Œå–„ç›®å½•ç»“æž„é¦–å…ˆè§‚å¯Ÿä¸€ä¸‹IDEAç»™æˆ‘ä»¬ç”Ÿæˆçš„ç›®å½•ç»“æž„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Mavenç›®å½•ã€‚ä½†æ˜¯å…¶ä¸­å°‘äº†ä¸€ä¸ªwebappç›®å½•ç”¨äºŽå­˜æ”¾jspã€cssã€jsã€å›¾ç‰‡ä¹‹ç±»çš„æ–‡ä»¶ã€‚ä¹‹åŽè¿˜éœ€è¦å®Œå–„æˆ‘ä»¬çš„ç›®å½•ç»“æž„ï¼Œå¦‚ä¸‹å›¾ï¼šä»¥ä¸Šçš„å‘½åéƒ½æ˜¯æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­å¸¸ç”¨çš„å‘½åè§„åˆ™ï¼Œä¸ä¸€å®šæŒ‰ç…§æˆ‘è¿™æ ·æ¥ï¼Œä½†æ˜¯æœ€å¥½æ˜¯æœ‰ä¸€å®šçš„è§„èŒƒã€‚ POM.xmlpom.xmlæ˜¯æ•´ä¸ªmavençš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œé‡Œé¢æœ‰å¯¹é¡¹ç›®çš„æè¿°å’Œé¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–ã€‚å“¦å¯¹äº†ï¼Œåœ¨ä¿®æ”¹pom.xmlæ–‡ä»¶ä¹‹å‰æˆ‘ä»¬æœ€å¥½å…ˆè®¾ç½®ä¸€ä¸‹è¯¥é¡¹ç›®çš„Mavenè®¾ç½®(IDEAå¯¹æ¯ä¸ªé¡¹ç›®çš„mavenè®¾ç½®å’ŒEclipseä¸ä¸€æ ·ï¼Œä¸æ˜¯è®¾ç½®ä¸€æ¬¡å°±å¯äº†ï¼Œå¦‚æžœä»ŠåŽè¿˜è¦æ–°å»ºé¡¹ç›®é‚£å°±è¿˜éœ€è¦è®¾ç½®ï¼ŒåŒæ—¶æŒ‰ä½ctrl,alt,sæ˜¯æ‰“å¼€è®¾ç½®çš„å¿«æ·é”®ï¼Œæ›´å¤šæœ‰å…³IDEAçš„æ“ä½œä»ŠåŽä¼šæ›´æ–°ç›¸å…³åšæ–‡ã€‚) IDEAçš„Mavenè®¾ç½®åœ¨Eclipseä¸­ç”¨è¿‡Mavençš„éƒ½åº”è¯¥çŸ¥é“ï¼Œè¿™é‡Œæ˜¯å°†é¡¹ç›®çš„Mavenæ¢æˆæˆ‘ä»¬è‡ªå·±å®‰è£…çš„Mavenï¼Œä¸‹é¢ä¸¤ä¸ªç›®å½•æ˜¯é€‰æ‹©Mavené…ç½®æ–‡ä»¶ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŽŸå› åœ¨Eclipseä¸­é€‰æ‹©äº†é…ç½®æ–‡ä»¶ä¹‹åŽä¼šè‡ªåŠ¨çš„å°†Mavenæœ¬åœ°åŽ‚åº“çš„è·¯å¾„æ›´æ”¹ä¸ºä½ settings.xmlä¸­é…ç½®çš„è·¯å¾„ã€‚æ—¢ç„¶è¿™é‡Œæ²¡æœ‰è‡ªåŠ¨é€‰ä¸­é‚£æˆ‘ä»¬å°±æ‰‹åŠ¨ä¿®æ”¹å³å¯ï¼Œå°½é‡ä¸è¦æ”¾åœ¨Cç›˜ï¼Œä¸€æ˜¯ç”¨ä¹…ä¹‹åŽæœ¬åœ°åŽ‚åº“å ç”¨çš„ç©ºé—´ä¼šæ¯”è¾ƒå¤§ï¼ŒäºŒæ˜¯ä¸‡ä¸€ç³»ç»Ÿå´©æºƒçš„è¯è¿˜æœ‰å¯èƒ½æ‰¾å›žæ¥ã€‚ ä¿®æ”¹pom.xmlä»¥ä¸‹æ˜¯æˆ‘çš„pom.xmlæ–‡ä»¶ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!--suppress MavenModelInspection --&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;source&gt;1.6&lt;/source&gt; &lt;target&gt;1.6&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;spring.version&gt;4.1.4.RELEASE&lt;/spring.version&gt; &lt;jackson.version&gt;2.5.0&lt;/jackson.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- spring --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-beans&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-tx&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-web&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-test&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- ä½¿ç”¨SpringMVCéœ€é…ç½® --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- å…³ç³»åž‹æ•°æ®åº“æ•´åˆæ—¶éœ€é…ç½® å¦‚hibernate jpaç­‰ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-orm&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt; &lt;version&gt;1.2.4&lt;/version&gt; &lt;/dependency&gt; &lt;!-- log4j --&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.17&lt;/version&gt; &lt;/dependency&gt; &lt;!-- mysqlè¿žæŽ¥ --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.34&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.3.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;1.0.18&lt;/version&gt; &lt;/dependency&gt; &lt;!-- json --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt; &lt;version&gt;$&#123;jackson.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-core&lt;/artifactId&gt; &lt;version&gt;$&#123;jackson.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;$&#123;jackson.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- aop --&gt; &lt;dependency&gt; &lt;groupId&gt;org.aspectj&lt;/groupId&gt; &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt; &lt;version&gt;1.8.4&lt;/version&gt; &lt;/dependency&gt; &lt;!-- servlet --&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;servlet-api&lt;/artifactId&gt; &lt;version&gt;3.0-alpha-1&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;jstl&lt;/artifactId&gt; &lt;version&gt;1.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt; &lt;version&gt;3.4&lt;/version&gt; &lt;/dependency&gt; &lt;!-- ä¸Šä¼ æ–‡ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;commons-fileupload&lt;/groupId&gt; &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt; &lt;version&gt;1.3.1&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; å…³äºŽmavençš„çŸ¥è¯†ç‚¹æˆ‘å°±ä¸ç»†è®²äº†ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸€ä¸ªæ•´åˆæ•™ç¨‹ã€‚ spring-mvc.xmlè¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯springMVCçš„é…ç½®æ–‡ä»¶ï¼šé‡Œé¢çš„æˆ‘éƒ½å†™æœ‰æ³¨é‡Šï¼Œåº”è¯¥éƒ½èƒ½çœ‹æ‡‚ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xmlns:context="http://www.springframework.org/schema/context" xmlns:mvc="http://www.springframework.org/schema/mvc" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd"&gt; &lt;!-- è‡ªåŠ¨æ‰«æè¯¥åŒ…ï¼Œä½¿SpringMVCè®¤ä¸ºåŒ…ä¸‹ç”¨äº†@controlleræ³¨è§£çš„ç±»æ˜¯æŽ§åˆ¶å™¨ --&gt; &lt;context:component-scan base-package="com.crossoverJie.controller" /&gt; &lt;!--é¿å…IEæ‰§è¡ŒAJAXæ—¶ï¼Œè¿”å›žJSONå‡ºçŽ°ä¸‹è½½æ–‡ä»¶ --&gt; &lt;!--&lt;bean id="mappingJacksonHttpMessageConverter" class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter"&gt; &lt;property name="supportedMediaTypes"&gt; &lt;list&gt; &lt;value&gt;text/html;charset=UTF-8&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt;--&gt; &lt;mvc:annotation-driven/&gt; &lt;!-- å¯åŠ¨SpringMVCçš„æ³¨è§£åŠŸèƒ½ï¼Œå®Œæˆè¯·æ±‚å’Œæ³¨è§£POJOçš„æ˜ å°„ --&gt; &lt;!-- å®šä¹‰è·³è½¬çš„æ–‡ä»¶çš„å‰åŽç¼€ ï¼Œè§†å›¾æ¨¡å¼é…ç½®--&gt; &lt;bean class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt; &lt;!-- è¿™é‡Œçš„é…ç½®æˆ‘çš„ç†è§£æ˜¯è‡ªåŠ¨ç»™åŽé¢actionçš„æ–¹æ³•returnçš„å­—ç¬¦ä¸²åŠ ä¸Šå‰ç¼€å’ŒåŽç¼€ï¼Œå˜æˆä¸€ä¸ª å¯ç”¨çš„urlåœ°å€ --&gt; &lt;property name="prefix" value="/WEB-INF/jsp/" /&gt; &lt;property name="suffix" value=".jsp" /&gt; &lt;/bean&gt; &lt;!-- é…ç½®æ–‡ä»¶ä¸Šä¼ ï¼Œå¦‚æžœæ²¡æœ‰ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ å¯ä»¥ä¸ç”¨é…ç½®ï¼Œå½“ç„¶å¦‚æžœä¸é…ï¼Œé‚£ä¹ˆé…ç½®æ–‡ä»¶ä¸­ä¹Ÿä¸å¿…å¼•å…¥ä¸Šä¼ ç»„ä»¶åŒ… --&gt; &lt;bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver"&gt; &lt;!-- é»˜è®¤ç¼–ç  --&gt; &lt;property name="defaultEncoding" value="utf-8" /&gt; &lt;!-- æ–‡ä»¶å¤§å°æœ€å¤§å€¼ --&gt; &lt;property name="maxUploadSize" value="10485760000" /&gt; &lt;!-- å†…å­˜ä¸­çš„æœ€å¤§å€¼ --&gt; &lt;property name="maxInMemorySize" value="40960" /&gt; &lt;/bean&gt; &lt;!-- é…ç½®æ‹¦æˆªå™¨ --&gt; &lt;!--&lt;mvc:interceptors&gt; &lt;mvc:interceptor&gt; &amp;lt;!&amp;ndash; &lt;mvc:mapping path="/**"/&gt;æ‹¦æˆªæ‰€æœ‰ &amp;ndash;&amp;gt; &lt;mvc:mapping path="/user/**"/&gt; &lt;mvc:mapping path="/role/**"/&gt; &lt;mvc:mapping path="/function/**"/&gt; &lt;mvc:mapping path="/news/**"/&gt; &lt;mvc:mapping path="/img/**"/&gt; &lt;bean class="com.crossoverJie.intercept.Intercept"&gt;&lt;/bean&gt; &lt;/mvc:interceptor&gt; &lt;/mvc:interceptors&gt;--&gt;&lt;/beans&gt; å…³äºŽä¸Šé¢æ‹¦æˆªå™¨æ³¨é‡ŠæŽ‰çš„é‚£é‡Œï¼Œé…ç½®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ•´åˆé¡¹ç›®ï¼Œæ‰€ä»¥é‡Œè¾¹ä¹Ÿæ²¡æœ‰ç”¨åˆ°æ‹¦æˆªå™¨ï¼Œä¸ºäº†é˜²æ­¢è¿è¡ŒæŠ¥é”™æ‰€ä»¥å°±å…ˆæ³¨é‡ŠæŽ‰äº†ã€‚å¦‚æžœåŽç»­éœ€è¦å¢žåŠ æ‹¦æˆªå™¨ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œçš„é…ç½®ã€‚ spring-mybatis.xmlè¿™ä¸ªæ˜¯springå’Œmybatisçš„æ•´åˆé…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­è¿˜æœ‰Druidè¿žæŽ¥æ± çš„é…ç½®ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd"&gt; &lt;!-- è‡ªåŠ¨æ‰«æ --&gt; &lt;context:component-scan base-package="com.crossoverJie" /&gt; &lt;!-- å¼•å…¥é…ç½®æ–‡ä»¶ --&gt; &lt;bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt; &lt;property name="location" value="classpath:jdbc.properties" /&gt; &lt;/bean&gt; &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close"&gt; &lt;!-- æŒ‡å®šè¿žæŽ¥æ•°æ®åº“çš„é©±åŠ¨ --&gt; &lt;property name="driverClassName" value="$&#123;jdbc.driverClass&#125;" /&gt; &lt;property name="url" value="$&#123;jdbc.url&#125;" /&gt; &lt;property name="username" value="$&#123;jdbc.user&#125;" /&gt; &lt;property name="password" value="$&#123;jdbc.password&#125;" /&gt; &lt;!-- é…ç½®åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§ --&gt; &lt;property name="initialSize" value="3" /&gt; &lt;property name="minIdle" value="3" /&gt; &lt;property name="maxActive" value="20" /&gt; &lt;!-- é…ç½®èŽ·å–è¿žæŽ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt; &lt;property name="maxWait" value="60000" /&gt; &lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿žæŽ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="timeBetweenEvictionRunsMillis" value="60000" /&gt; &lt;!-- é…ç½®ä¸€ä¸ªè¿žæŽ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="minEvictableIdleTimeMillis" value="300000" /&gt; &lt;property name="validationQuery" value="SELECT 'x'" /&gt; &lt;property name="testWhileIdle" value="true" /&gt; &lt;property name="testOnBorrow" value="false" /&gt; &lt;property name="testOnReturn" value="false" /&gt; &lt;!-- æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿žæŽ¥ä¸ŠPSCacheçš„å¤§å° --&gt; &lt;property name="poolPreparedStatements" value="true" /&gt; &lt;property name="maxPoolPreparedStatementPerConnectionSize" value="20" /&gt; &lt;!-- é…ç½®ç›‘æŽ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼ŒåŽ»æŽ‰åŽç›‘æŽ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ --&gt; &lt;property name="filters" value="stat" /&gt; &lt;/bean&gt; &lt;!-- springå’ŒMyBatiså®Œç¾Žæ•´åˆï¼Œä¸éœ€è¦mybatisçš„é…ç½®æ˜ å°„æ–‡ä»¶ --&gt; &lt;bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"&gt; &lt;property name="dataSource" ref="dataSource" /&gt; &lt;!-- è‡ªåŠ¨æ‰«æmapping.xmlæ–‡ä»¶ --&gt; &lt;property name="mapperLocations" value="classpath:mapping/*.xml"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;!-- DAOæŽ¥å£æ‰€åœ¨åŒ…åï¼ŒSpringä¼šè‡ªåŠ¨æŸ¥æ‰¾å…¶ä¸‹çš„ç±» --&gt; &lt;bean class="org.mybatis.spring.mapper.MapperScannerConfigurer"&gt; &lt;property name="basePackage" value="com.crossoverJie.dao" /&gt; &lt;property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;!-- (äº‹åŠ¡ç®¡ç†)transaction manager, use JtaTransactionManager for global tx --&gt; &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt; &lt;property name="dataSource" ref="dataSource" /&gt; &lt;/bean&gt;&lt;/beans&gt; ä»¥ä¸Šä¸¤ä¸ªå°±æ˜¯æœ€é‡è¦çš„é…ç½®æ–‡ä»¶äº†ï¼Œåªè¦å…¶ä¸­çš„åŒ…åå’Œé…ç½®æ–‡ä»¶ä¸­çš„åå­—ä¸€æ ·å°±ä¸ä¼šå‡ºé—®é¢˜ã€‚å…³äºŽxxMpper.xmlä»¥åŠå®žä½“ç±»çš„ç”Ÿæˆï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©mybatis-generatorè‡ªåŠ¨ç”Ÿæˆå·¥å…·æ¥ç”Ÿæˆï¼Œæ–¹ä¾¿å¿«æ·ã€‚ IDEAé…ç½®Tomcatå…³äºŽTomcatçš„ä¸‹è½½ä¸Žå®‰è£…æˆ‘è¿™é‡Œå°±ä¸å¤šä»‹ç»äº†ã€‚æŒ‰ç…§ä¸‹å›¾é€‰æ‹©ï¼šåœ¨nameä¸­ä¸ºè¿™ä¸ªTomcatè¾“å…¥ä¸€ä¸ªåå­—ã€‚ä¹‹åŽé€‰æ‹©ä½ æœ¬åœ°Tomcatçš„ç›®å½•ç‚¹å‡»Okå³å¯ã€‚ç‚¹å‡»applyå’Œä¿å­˜ä¹‹åŽå°±è¿”å›žé¦–é¡µå³å¯çœ‹åˆ°Tomcatçš„æ ‡è¯†ã€‚æ ¹æ®éœ€è¦ç‚¹å‡»Runå’ŒDebugå³å¯è¿è¡Œã€‚ è¿è¡Œç»“æžœå¦‚ä¸‹ï¼šç‚¹å‡»ä¸Šå›¾çš„2,3,4å¯çœ‹åˆ°ä¸åŒç”¨æˆ·çš„ç»“æžœï¼Œå¦‚æžœä½ èµ°åˆ°è¿™ä¸€æ­¥ï¼Œé‚£ä¹ˆæ­å–œä½ æ•´åˆæˆåŠŸã€‚ æ€»ç»“ä»¥ä¸Šæºç éƒ½åœ¨githubä¸Šã€‚é¡¹ç›®åœ°å€ï¼šSSMæ¬¢è¿Žæ‹ç –ã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
        <tag>SpringMVC</tag>
        <tag>Mybatis</tag>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ—¥å¸¸è®°å½•ï¼ˆä¸‰ï¼‰æ›´æ¢Hexoä¸»é¢˜]]></title>
    <url>%2F2016%2F06%2F18%2Fnormal-skill3%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç”±äºŽåšä¸»çš„å–œæ–°åŽŒæ—§ï¼Œå†ç»è¿‡ä¸€æ®µæ—¶é—´å¯¹ä¸Šä¸€ä¸ªä¸»é¢˜çš„å®¡ç¾Žç–²åŠ³åŠ ä¸Šæˆ‘ä¸“(zhuang)ç ”(bi)çš„ç²¾ç¥žäºŽæ˜¯å°±æƒ³æ‰¾ä¸€ä¸ªBæ ¼è¾ƒé«˜çš„ä¸»é¢˜ã€‚ç»è¿‡ä¸€æ®µæ—¶é—´çš„æŸ¥æ‰¾å‘çŽ°NexTè¿™ä¸ªä¸»é¢˜ç®€æ´è€Œä¸å¤±åŽä¸½ï¼Œä½Žè°ƒè€Œä¸å¤±é€¼æ ¼(å°±ä¸æ”¶å¹¿å‘Šè´¹äº†)ç‰¹åˆ«é€‚åˆæˆ‘ï¼ŒæŽ¥ç€å°±ç€æ‰‹å¼€å¹²ã€‚ å®‰è£…NexTä¸»é¢˜ä»ŽGitä¸Šå…‹éš†ä¸»é¢˜è¿™é‡Œæˆ‘å°±ä¸ä»‹ç»æœ‰å…³Hexoçš„ä¸œè¥¿äº†ï¼Œé»˜è®¤æ˜¯çŸ¥é“å¦‚ä½•æ­å»ºHexoåšå®¢çš„ã€‚è¿˜ä¸å¤ªæ¸…æ¥šçš„è¯·è‡ªè¡Œç™¾åº¦ã€‚é¦–å…ˆå°†NexTä¸»é¢˜å…ˆå…‹éš†åˆ°è‡ªå·±ç”µè„‘ä¸Šï¼š cd your-hexo-site git clone https://github.com/iissnan/hexo-theme-next themes/nextã€‚å®‰è£…ä¸»é¢˜æŽ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦å°†ç«™ç‚¹ä¸‹çš„_config.ymlé…ç½®æ–‡ä»¶ä¸­çš„ä¸»é¢˜é…ç½®æ›´æ¢æˆNextï¼Œå¦‚ä¸‹å›¾ï¼šå…¶å®žè¿™æ ·ä¸»é¢˜å°±é…å¥½äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚ NexTä¸»é¢˜é…ç½®Hexoé…ç½®æ–‡ä»¶ç›¸å…³é…ç½®Nextä¸»é¢˜çš„ä¸ªäººå¤´åƒæ˜¯åœ¨Hexoé…ç½®æ–‡ä»¶ä¸­çš„ã€‚NexTåŒæ ·ä¹Ÿæ”¯æŒå¤šè¯´é…ç½®ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ä½ è‡ªå·±çš„å¤šè¯´è´¦å·ä¹Ÿé…ç½®åˆ°Hexoçš„é…ç½®æ–‡ä»¶ä¸­å³å¯ã€‚duoshuo_shortname: your name Nexté…ç½®æ–‡ä»¶ç›¸å…³é…ç½®NexTä¸»é¢˜éžå¸¸å¸å¼•æˆ‘çš„ä¸€ç‚¹å°±æ˜¯ä»–æ”¯æŒæ‰“èµåŠŸèƒ½ï¼Œè¿™è®©æˆ‘è¿™ç§ç©·é€¼ç¨‹åºçŒ¿åˆçœ‹åˆ°äº†ç”Ÿè·¯(å¤šåŠä¹Ÿæ²¡äººä¼šç»™æˆ‘æ‰“èµ)ï¼Œä»¥ä¸‹ä¸€æ®µé…ç½®å³å¯åœ¨æ¯ç¯‡åšæ–‡ä¸‹è¾¹å¼€å¯æ‰“èµåŠŸèƒ½ã€‚å¾®ä¿¡ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æˆ‘æ‰¾äº†åŠå¤©æ²¡æœ‰æ‰¾åˆ°ç”Ÿæˆå¾®ä¿¡æ”¯ä»˜ç çš„åœ°æ–¹ã€‚å…¶ä»–çš„ä¸€äº›é…ç½®æˆ‘è§‰å¾—éƒ½æ¯”è¾ƒç®€å•ï¼Œçœ‹å®˜æ–¹çš„å¸®åŠ©æ–‡æ¡£ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œæœ‰é—®é¢˜çš„æˆ‘ä»¬å¯ä»¥å†è®¨è®ºã€‚ ä¸€ä¸ªç»•å‘æŒ‡å—æˆ‘åœ¨æ¢å®ŒNexTä¹‹åŽå‘çŽ°åœ¨é¦–é¡µè¿™é‡Œæ˜¾ç¤ºçš„åˆ†ç±»å’Œä¾¿ç­¾çš„ç»Ÿè®¡éƒ½æ˜¯å¯¹çš„ï¼Œä½†æ˜¯ç‚¹è¿›åŽ»ä¹‹åŽå°±æ˜¯ç©ºç™½çš„ã€‚æˆ‘æŸ¥çœ‹äº†Hexoå’ŒNexTçš„æ–‡æ¡£å‘çŽ°æˆ‘å†™çš„æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä¹‹åŽå°±æ‡µé€¼äº†ã€‚ã€‚ã€‚å„ä½æœ‰ç¢°åˆ°è¿™ä¸ªé—®é¢˜çš„å¯ä»¥å¾€ä¸‹çœ‹ã€‚ ç»•å‘ä¹‹åŽæˆ‘ä»”ç»†çš„æŸ¥é˜…äº†NexTçš„æ–‡æ¡£ï¼Œå‘çŽ°ä»–æ‰€ä½¿ç”¨çš„tagså’Œcategoriesæ–‡ä»¶å¤¹ä¸‹çš„index.mdçš„æ ¼å¼æ˜¯è¿™æ ·çš„ï¼š12345---title: tagsdate: 2016-06-16 02:13:06type: &quot;tags&quot;--- è¿™å’Œæˆ‘ä¹‹å‰ä½¿ç”¨çš„JackManä¸»é¢˜æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„(æœ‰å…³JackManä¸»é¢˜å¯ä»¥è‡ªè¡ŒæŸ¥é˜…)ã€‚ä¹‹åŽæˆ‘è®²categoriesæ–‡ä»¶ä¸‹çš„index.mdæ–‡ä»¶ä¹Ÿæ¢æˆè¿™æ ·çš„æ ¼å¼å°±æ²¡æœ‰é—®é¢˜äº†ã€‚å¦‚æžœä½ å’Œæˆ‘ä¸€æ ·çœ¼ç¥žä¸å¥½çš„è¯å»ºè®®é…å‰¯çœ¼é•œã€‚ æ€»ç»“å…¶å®žä»¥ä¸Šçš„å¾ˆå¤šä¸œè¥¿éƒ½æ˜¯åœ¨NexTå®˜æ–¹æ–‡æ¡£é‡ŒæŸ¥å¾—åˆ°çš„ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä¼šå°è¯•æä¸€ç‚¹pull requestæ¥æ›´åŠ æ·±å…¥çš„äº†è§£Hexoã€‚]]></content>
      <categories>
        <category>æ—¥å¸¸è®°å½•</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ—¥å¸¸è®°å½•ï¼ˆäºŒï¼‰SpringMvcå¯¼å‡ºExcel]]></title>
    <url>%2F2016%2F06%2F14%2Fnormal-skill2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç›¸ä¿¡å¾ˆå¤šæœ‹å‹åœ¨å®žé™…å·¥ä½œä¸­éƒ½ä¼šè¦å°†æ•°æ®å¯¼å‡ºæˆExcelçš„éœ€æ±‚ï¼Œé€šå¸¸è¿™æ ·çš„åšæ³•æœ‰ä¸¤ç§ã€‚ä¸€æ˜¯é‡‡ç”¨JXLæ¥ç”ŸæˆExcelï¼Œä¹‹åŽä¿å­˜åˆ°æœåŠ¡å™¨ï¼Œç„¶åŽåœ¨ç”Ÿæˆé¡µé¢ä¹‹åŽä¸‹è½½è¯¥æ–‡ä»¶ã€‚äºŒæ˜¯ä½¿ç”¨POIæ¥ç”ŸæˆExcelï¼Œä¹‹åŽä½¿ç”¨Streamçš„æ–¹å¼è¾“å‡ºåˆ°å‰å°ç›´æŽ¥ä¸‹è½½(ps:å½“ç„¶ä¹Ÿå¯ä»¥ç”Ÿæˆåˆ°æœåŠ¡å™¨ä¸­å†ä¸‹è½½ã€‚)ã€‚è¿™é‡Œæˆ‘ä»¬è®¨è®ºç¬¬äºŒç§ã€‚è‡³äºŽä¸¤ç§æ–¹å¼çš„ä¼˜ç¼ºç‚¹è¯·è‡ªè¡Œç™¾åº¦ã€‚ Struts2çš„æ–¹å¼é€šå¸¸æˆ‘ä¼šå°†å·²ç»ç”Ÿæˆå¥½çš„HSSFWorkbookæ”¾åˆ°ä¸€ä¸ªInputStreamä¸­ï¼Œç„¶åŽå†åˆ°xmlé…ç½®æ–‡ä»¶ä¸­å°†è¿”å›žç»“æžœæ›´æ”¹ä¸ºstreamçš„æ–¹å¼ã€‚å¦‚ä¸‹ï¼š12345678private void responseData(HSSFWorkbook wb) throws IOException &#123; ByteArrayOutputStream baos = new ByteArrayOutputStream(); wb.write(baos); baos.flush(); byte[] aa = baos.toByteArray(); excelStream = new ByteArrayInputStream(aa, 0, aa.length); baos.close();&#125; é…ç½®æ–‡ä»¶ï¼š1234567&lt;action name="exportXxx" class="xxxAction" method="exportXxx"&gt; &lt;result name="exportSuccess" type="stream"&gt; &lt;param name="inputName"&gt;excelStream&lt;/param&gt; &lt;param name="contentType"&gt;application/vnd.ms-excel&lt;/param&gt; &lt;param name="contentDisposition"&gt;attachment;filename="Undefined.xls"&lt;/param&gt; &lt;/result&gt;&lt;/action&gt; è¿™æ ·å³å¯è¾¾åˆ°ç‚¹å‡»é“¾æŽ¥å³å¯ç›´æŽ¥ä¸‹è½½æ–‡ä»¶çš„ç›®çš„ã€‚ SpringMVCçš„æ–¹å¼å…ˆè´´ä»£ç ï¼š123456789101112131415@RequestMapping("/exportXxx.action")public void exportXxx(HttpServletRequest request, HttpServletResponse response, @RequestParam(value="scheduleId", defaultValue="0")int scheduleId)&#123; HSSFWorkbook wb = createExcel(scheduleId) ; try &#123; response.setHeader("Content-Disposition", "attachment; filename=appointmentUser.xls"); response.setContentType("application/vnd.ms-excel; charset=utf-8") ; OutputStream out = response.getOutputStream() ; wb.write(out) ; out.flush(); out.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; å…¶å®žspringMVCå’ŒStruts2çš„åŽŸç†ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯Struts2æ˜¯æ‰åŽ»é…ç½®æ–‡ä»¶çš„æ–¹å¼ã€‚é¦–å…ˆæ˜¯ä½¿ç”¨createExcel()è¿™ä¸ªæ–¹æ³•æ¥ç”ŸæˆExcelå¹¶è¿”å›žï¼Œæœ€åŽåˆ©ç”¨rresponseå³å¯å‘å‰å°è¾“å‡ºExcelï¼Œè¿™ç§æ–¹æ³•æ˜¯é€šç”¨çš„ï¼Œä¹Ÿå¯ä»¥è¯•ç”¨ä¸ŽServletã€Struts2ç­‰ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨responseçš„å¤´ä¿¡æ¯ä¸­è®¾ç½®ç›¸åº”çš„è¾“å‡ºä¿¡æ¯å³å¯ã€‚ æ€»ç»“ä¸ç®¡æ˜¯ä½¿ç”¨Struts2ï¼Œè¿˜æ˜¯ä½¿ç”¨SpringMVCç©¶å…¶æ ¹æœ¬éƒ½æ˜¯ä½¿ç”¨çš„responseï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬æŠŠresponseç†è§£é€äº†ä¸ç®¡æ˜¯ä¸‹è½½å›¾ç‰‡ã€worldã€Excelè¿˜æ˜¯å…¶ä»–ä»€ä¹ˆæ–‡ä»¶éƒ½æ˜¯ä¸€æ ·çš„ã€‚]]></content>
      <categories>
        <category>æ—¥å¸¸è®°å½•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>poi</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ—¥å¸¸è®°å½•ï¼ˆä¸€ï¼‰MySQLè¢«é”è§£å†³æ–¹æ¡ˆ]]></title>
    <url>%2F2016%2F06%2F05%2Fnormal-skill1%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç”±äºŽå‰æ®µæ—¶é—´ä¸ºäº†è®©éƒ¨ç½²åœ¨Linuxä¸­çš„é¡¹ç›®è®¿é—®å¦ä¸€å°æœåŠ¡å™¨çš„MySQLï¼Œç»è¿‡å„ç§æŠ˜è…¾å°±æŠŠrootç”¨æˆ·ç»™å¼„å‡ºé—®é¢˜äº†ï¼Œå¯¼è‡´æ­»æ´»ç™»ä¸ä¸ŠPS:Linuxä¸­çš„é¡¹ç›®è¿˜æ˜¯æ²¡æœ‰è¿žä¸Šã€‚ã€‚(è¿™æ˜¯åŽè¯äº†ã€‚)ã€‚ç»è¿‡å„ç§æŸ¥é˜…èµ„æ–™ç»ˆäºŽæ‰¾åˆ°è§£å†³æ–¹æ³•äº†ã€‚ æŠ¥é”™å¦‚ä¸‹ï¼šAccess denied for user &#39;root&#39;@&#39;localhost&#39; (using password:YES) å…³é—­MySQLæœåŠ¡ï¼Œä¿®æ”¹MySQLåˆå§‹æ–‡ä»¶æ‰“å¼€MySQLç›®å½•ä¸‹çš„my-default.iniæ–‡ä»¶ï¼Œå¦‚å›¾ï¼šåœ¨æœ€åŽä¸€è¡ŒåŠ å…¥skip-grant-tablesä¹‹åŽä¿å­˜ã€‚ç„¶åŽé‡å¯MySQLæœåŠ¡ã€‚ ç”¨å‘½ä»¤è¡Œç™»å½•MySQLä¿®æ”¹ROOTè´¦å·å¯†ç ç”¨å‘½ä»¤è¡Œç™»å½•MySQLè¾“å…¥mysql -uroot -p,ä¸ç”¨è¾“å…¥å¯†ç ï¼Œç›´æŽ¥æ•²å›žè½¦å³å¯è¿›å…¥ã€‚å¦‚ä¸‹å›¾ï¼šä¹‹åŽæ‰§è¡Œä»¥ä¸‹è¯­å¥ä¿®æ”¹ROOTç”¨æˆ·å¯†ç ï¼š use mysql; update user set password=PASSWORD(&quot;ä½ çš„å¯†ç &quot;) where user=&#39;root&#39;; è¿˜åŽŸmy-default.iniæ–‡ä»¶æœ€åŽè¿˜åŽŸé…ç½®æ–‡ä»¶ï¼Œä¹‹åŽé‡å¯MySQLæœåŠ¡å³å¯æ­£å¸¸ç™»å½•äº†ã€‚]]></content>
      <categories>
        <category>æ—¥å¸¸è®°å½•</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaå¤šçº¿ç¨‹ï¼ˆäºŒï¼‰æœ‰è¿”å›žå€¼çš„å¤šçº¿ç¨‹]]></title>
    <url>%2F2016%2F05%2F27%2Fjava-thread2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹è¦ä¹ˆæ˜¯ç»§æ‰¿Threadç±»ï¼Œè¦ä¹ˆæ˜¯å®žçŽ°RunnableæŽ¥å£ï¼Œç„¶åŽé‡å†™ä¸€ä¸‹run()æ–¹æ³•å³å¯ã€‚ä½†æ˜¯åªæœ‰çš„è¯å¦‚æžœæœ‰æ­»é”ã€å¯¹å…±äº«èµ„æºçš„è®¿é—®å’Œéšæ—¶ç›‘æŽ§çº¿ç¨‹çŠ¶æ€å°±ä¸è¡Œäº†ï¼ŒäºŽæ˜¯åœ¨Java5ä¹‹åŽå°±æœ‰äº†CallableæŽ¥å£ã€‚ ç®€å•çš„å®žçŽ°æœ‰è¿”å›žå€¼çš„çº¿ç¨‹ä»£ç å¦‚ä¸‹ï¼šCallableFutureç±»1234567891011121314151617181920212223242526272829303132333435package top.crosssoverjie.study.Thread;import java.util.concurrent.ExecutionException;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.Future;public class CallableFuture &#123; public static void main(String[] args) &#123; //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ±  ExecutorService pool = Executors.newFixedThreadPool(3) ; //åˆ›å»ºä¸‰ä¸ªæœ‰è¿”å›žå€¼çš„ä»»åŠ¡ CallableTest2 c1 = new CallableTest2("çº¿ç¨‹1") ; CallableTest2 c2 = new CallableTest2("çº¿ç¨‹2") ; CallableTest2 c3 = new CallableTest2("çº¿ç¨‹3") ; Future f1 = pool.submit(c1) ; Future f2 = pool.submit(c2) ; Future f3 = pool.submit(c3) ; try &#123; System.out.println(f1.get().toString()); System.out.println(f2.get().toString()); System.out.println(f3.get().toString()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125;finally&#123; pool.shutdown(); &#125; &#125;&#125; Â·CallableTest2Â·ç±»ï¼š123456789101112131415161718package top.crosssoverjie.study.Thread;import java.util.concurrent.Callable;public class CallableTest2 implements Callable &#123; private String name ; public CallableTest2(String name) &#123; this.name = name; &#125; @Override public Object call() throws Exception &#123; return name+"è¿”å›žäº†ä¸œè¥¿"; &#125; &#125; è¿è¡Œç»“æžœï¼š123çº¿ç¨‹1è¿”å›žäº†ä¸œè¥¿çº¿ç¨‹2è¿”å›žäº†ä¸œè¥¿çº¿ç¨‹3è¿”å›žäº†ä¸œè¥¿ æ€»ç»“ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œéœ€è¦äº†è§£æ›´å¤šè¯¦æƒ…å¯ä»¥åŽ»çœ‹é‚£å‡ ä¸ªç±»çš„APIã€‚]]></content>
      <categories>
        <category>javaå¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Callable</tag>
        <tag>ExecutorService</tag>
        <tag>Future</tag>
        <tag>Executors</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®©ç™¾åº¦å’Œgoogleæ”¶å½•æˆ‘ä»¬çš„ç½‘ç«™]]></title>
    <url>%2F2016%2F05%2F19%2Fbaidu-google%2F</url>
    <content type="text"><![CDATA[å‰è¨€èŠ±äº†å‡ å¤©æ—¶é—´ç»ˆäºŽæŠŠè¿™ä¸ªçœ‹ä¼¼é«˜å¤§ä¸Šçš„åšå®¢æžå¥½äº†ï¼Œä½†æ˜¯å‘çŽ°åªèƒ½é€šè¿‡åœ¨åœ°å€æ è¾“å…¥åœ°å€è¿›è¡Œè®¿é—®ï¼Œè¿™å¾ˆæ˜Žæ˜¾å’Œæˆ‘è£…Xè£…åˆ°åº•çš„æ€§æ ¼ï¼ŒäºŽæ˜¯ä¹Žåœ¨æŸ¥é˜…äº†å˜Ÿçˆ·çš„åšå®¢ï¼Œå’Œæˆ‘å„ç§ç™¾åº¦ç»ˆäºŽæžå‡ºæ¥äº†ã€‚ è®©è°·æ­Œæ”¶å½•è®©è°·æ­Œæ”¶å½•è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆæˆ‘ä»¬è‚¯å®šæ˜¯è¦ç¿»å¢™çš„(è¿™ä¸ªå°±ä¸ä»”ç»†è¯´äº†ï¼Œå…·ä½“ç™¾åº¦ã€‚)ç”±äºŽæˆ‘è¿™é‡Œçªç„¶ç™»ä¸ä¸Šgoogleè´¦å·äº†ï¼Œæ‰€ä»¥ä¸‹æ¬¡è¡¥å……æˆªå›¾ã€‚åŒä½“æ¥è¯´å°±æ˜¯ä»¥ä¸‹æ­¥éª¤ï¼š ä¸‹è½½googleçš„htmléªŒè¯æ–‡ä»¶æ”¾åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ï¼Œä½¿googleèƒ½å¤Ÿè®¿é—®å¾—åˆ°ã€‚ åœ¨è°·æ­Œç«™é•¿å·¥å…·é‡ŒåŠ ä¸Šè‡ªå·±çš„ç«™ç‚¹åœ°å›¾ã€‚ åˆ›å»ºç«™ç‚¹åœ°å›¾ç«™ç‚¹åœ°å›¾æ˜¯ä¸€ç§æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶åˆ—å‡ºæ‚¨ç½‘ç«™ä¸Šçš„ç½‘é¡µï¼Œä»Žè€Œå°†æ‚¨ç½‘ç«™å†…å®¹çš„ç»„ç»‡æž¶æž„å‘ŠçŸ¥Googleå’Œå…¶ä»–æœç´¢å¼•æ“Žï¼Œä»¥ä¾¿æ›´åŠ æ™ºèƒ½çš„æŠ“å–ä½ çš„ç½‘ç«™ä¿¡æ¯ã€‚é¦–å…ˆæˆ‘ä»¬è¦ä¸ºHexoå®‰è£…è°·æ­Œå’Œç™¾åº¦çš„æ’ä»¶(åšä¸»æ˜¯ç”¨Hexoæ¥æ­å»ºçš„åšå®¢)ï¼Œå¦‚ä¸‹ï¼š123npm install hexo-generator-sitemap --savenpm install hexo-generator-baidu-sitemap --save åœ¨åšå®¢çš„æ ¹ç›®å½•ä¸­çš„_config.ymlæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼šä¹‹åŽéƒ¨ç½²ä¸ŠåŽ»ä¹‹åŽå¦‚æžœåœ¨åœ°å€æ åŽé¢åŠ ä¸Šç«™ç‚¹åœ°å›¾å¦‚ä¸‹çš„è¯è¡¨ç¤ºéƒ¨ç½²æˆåŠŸï¼š è®©ç™¾åº¦æ”¶å½•æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥è®©ç™¾åº¦æ”¶å½•æˆ‘ä»¬çš„ç½‘ç«™ã€‚ç¬¬ä¸€ç§ï¼šä¸»åŠ¨æŽ¨é€æˆ‘ç”¨Javaå†™äº†ä¸€ä¸ªå°ç¨‹åºï¼Œå¯ä»¥æ‰‹å·¥çš„è‡ªå·±æŽ¨é€åœ°å€ç»™ç™¾åº¦ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990package top.crossoverjie.post;import java.io.BufferedReader;import java.io.IOException;import java.io.InputStreamReader;import java.io.PrintWriter;import java.net.URL;import java.net.URLConnection;public class Post &#123; public static void main(String[] args) &#123; String url = "http://data.zz.baidu.com/urls?site=crossoverjie.top&amp;token=1002EzhDReuy34dq";// ç½‘ç«™çš„æœåŠ¡å™¨è¿žæŽ¥ String[] param = &#123; // éœ€è¦æŽ¨é€çš„ç½‘å€// "http://crossoverjie.top/tags",// "http://crossoverjie.top/categories", //"http://crossoverjie.top/about/" "http://crossoverjie.top/2016/05/14/java-thread1" &#125;; String json = Post(url, param);// æ‰§è¡ŒæŽ¨é€æ–¹æ³• System.out.println("ç»“æžœæ˜¯" + json); // æ‰“å°æŽ¨é€ç»“æžœ &#125; /** * ç™¾åº¦é“¾æŽ¥å®žæ—¶æŽ¨é€ * * @param PostUrl * @param Parameters * @return */ public static String Post(String PostUrl, String[] Parameters) &#123; if (null == PostUrl || null == Parameters || Parameters.length == 0) &#123; return null; &#125; String result = ""; PrintWriter out = null; BufferedReader in = null; try &#123; // å»ºç«‹URLä¹‹é—´çš„è¿žæŽ¥ URLConnection conn = new URL(PostUrl).openConnection(); // è®¾ç½®é€šç”¨çš„è¯·æ±‚å±žæ€§ conn.setRequestProperty("Host", "data.zz.baidu.com"); conn.setRequestProperty("User-Agent", "curl/7.12.1"); conn.setRequestProperty("Content-Length", "83"); conn.setRequestProperty("Content-Type", "text/plain"); // å‘é€POSTè¯·æ±‚å¿…é¡»è®¾ç½®å¦‚ä¸‹ä¸¤è¡Œ conn.setDoInput(true); conn.setDoOutput(true); // èŽ·å–connå¯¹åº”çš„è¾“å‡ºæµ out = new PrintWriter(conn.getOutputStream()); // å‘é€è¯·æ±‚å‚æ•° String param = ""; for (String s : Parameters) &#123; param += s + "\n"; &#125; out.print(param.trim()); // è¿›è¡Œè¾“å‡ºæµçš„ç¼“å†² out.flush(); // é€šè¿‡BufferedReaderè¾“å…¥æµæ¥è¯»å–Urlçš„å“åº” in = new BufferedReader( new InputStreamReader(conn.getInputStream())); String line; while ( (line = in.readLine()) != null) &#123; result += line; &#125; &#125; catch (Exception e) &#123; System.out.println("å‘é€postè¯·æ±‚å‡ºçŽ°å¼‚å¸¸ï¼" + e); e.printStackTrace(); &#125; finally &#123; try &#123; if (out != null) &#123; out.close(); &#125; if (in != null) &#123; in.close(); &#125; &#125; catch (IOException ex) &#123; ex.printStackTrace(); &#125; &#125; return result; &#125;&#125; è¿è¡Œä¹‹åŽç»“æžœå¦‚ä¸‹ï¼š1ç»“æžœæ˜¯&#123;"remain":499,"success":1&#125; remainè¡¨ç¤ºè¿˜æœ‰å¤šå°‘å¯ä»¥æŽ¨é€ï¼Œæˆ‘è¿™é‡Œè¡¨ç¤ºè¿˜æœ‰499æ¡ã€‚successè¡¨ç¤ºæˆåŠŸæŽ¨é€äº†å¤šå°‘æ¡é“¾æŽ¥ï¼Œæˆ‘è¿™é‡Œè¡¨ç¤ºæˆåŠŸæŽ¨é€äº†ä¸€æ¡é“¾æŽ¥ã€‚ ç¬¬äºŒç§æ˜¯ä¸»åŠ¨æŽ¨é€ï¼Œå¯ä»¥æŒ‰ç…§ç™¾åº¦çš„æ•™ç¨‹è¿›è¡Œé…ç½®ï¼š ç¬¬ä¸‰ç§å°±æ˜¯é…ç½®ç«™ç‚¹åœ°å›¾äº†ï¼ŒæŒ‰ç…§ä¹‹å‰å°†çš„å°†ç«™ç‚¹åœ°å›¾å®‰è£…åˆ°é¡¹ç›®ä¸­ï¼Œå‚ç…§æˆ‘çš„é…ç½®å³å¯ï¼šå¦‚æžœèƒ½åƒæˆ‘è¿™ä¸ªä¸€æ ·çŠ¶æ€æ­£å¸¸ï¼Œèƒ½èŽ·å–åˆ°URLæ•°é‡å°±è¡¨ç¤ºæˆåŠŸäº†ã€‚ æ€»ç»“åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¸æ˜¯æˆ‘é»‘ç™¾åº¦ï¼Œç™¾åº¦çš„æ•ˆçŽ‡çœŸæ˜¯å¤ªä½Žäº†ã€‚æˆ‘å¤´ä¸€å¤©åœ¨googleæäº¤ä¸ŠåŽ»ç¬¬äºŒå¤©å°±èƒ½æ”¶åˆ°äº†ï¼Œç™¾åº¦æ˜¯æˆ‘æäº¤äº†å¤§æ¦‚ä¸€å‘¨å¤šæ‰ç»™æˆ‘æ”¶å½•è¿›åŽ»ï¼Œè¿™å½“ç„¶è‚¯å®šä¹Ÿå’Œæˆ‘çš„å†…å®¹æœ‰å…³ç³»ã€‚]]></content>
      <categories>
        <category>å°æŠ€å·§</category>
      </categories>
      <tags>
        <tag>baidu</tag>
        <tag>google</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaå¤šçº¿ç¨‹ï¼ˆä¸€ï¼‰å¤šçº¿ç¨‹åŸºç¡€]]></title>
    <url>%2F2016%2F05%2F14%2Fjava-thread1%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ¬æ–‡ä¸»è¦è®²è§£javaå¤šçº¿ç¨‹çš„åŸºç¡€ï¼Œä»¥åŠä¸€äº›å¸¸ç”¨æ–¹æ³•ã€‚å…³äºŽçº¿ç¨‹åŒæ­¥ã€ExecutorServiceæ¡†æž¶æˆ‘ä¼šæ”¾åˆ°åŽç»­çš„æ–‡ç« è¿›è¡Œè®²è§£ã€‚ è¿›ç¨‹ä¸Žçº¿ç¨‹çš„åŒºåˆ«è¿›ç¨‹è¿›ç¨‹ç®€å•çš„æ¥è¯´å°±æ˜¯åœ¨å†…å­˜ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥å¯åŠ¨å¤šä¸ªçº¿ç¨‹ã€‚æ¯”å¦‚åœ¨windowsä¸­ä¸€ä¸ªè¿è¡ŒEXEæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚ çº¿ç¨‹åŒä¸€ä¸ªçº¿ç¨‹ä¸­çš„è¿›ç¨‹å…±ç”¨ç›¸åŒçš„åœ°å€ç©ºé—´ï¼ŒåŒæ—¶å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å†…å­˜å’Œå…¶ä»–èµ„æºã€‚ çº¿ç¨‹Demo-ç»§æ‰¿Threadç±»é¦–å…ˆæˆ‘ä»¬æˆ‘ä»¬ç»§æ‰¿java.lang.Threadç±»æ¥åˆ›å»ºçº¿ç¨‹ã€‚12345678910111213141516171819202122232425262728293031package top.crosssoverjie.study.Thread;public class TestThread &#123; public static void main(String[] args) &#123; System.out.println("ä¸»çº¿ç¨‹IDæ˜¯ï¼š" + Thread.currentThread().getId()); MyThread my = new MyThread("çº¿ç¨‹1"); my.start() ; MyThread my2 = new MyThread("çº¿ç¨‹2") ; /** * è¿™é‡Œç›´æŽ¥è°ƒç”¨my2çš„run()æ–¹æ³•ã€‚ */ my2.run() ; &#125;&#125;class MyThread extends Thread &#123; private String name; public MyThread(String name) &#123; this.name = name; &#125; @Override public void run() &#123; System.out.println("åå­—ï¼š" + name + "çš„çº¿ç¨‹IDæ˜¯=" + Thread.currentThread().getId()); &#125;&#125; è¾“å‡ºç»“æžœ:123ä¸»çº¿ç¨‹IDæ˜¯ï¼š1åå­—ï¼šçº¿ç¨‹2çš„çº¿ç¨‹IDæ˜¯=1åå­—ï¼šçº¿ç¨‹1çš„çº¿ç¨‹IDæ˜¯=9 ç”±è¾“å‡ºç»“æžœæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š myå’Œmy2çš„çº¿ç¨‹IDä¸ç›¸åŒï¼Œmy2å’Œä¸»çº¿ç¨‹IDç›¸åŒã€‚è¯´æ˜Žç›´æŽ¥è°ƒç”¨run()æ–¹æ³•ä¸ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œè€Œæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ç›´æŽ¥è°ƒç”¨çš„run()æ–¹æ³•,å’Œæ™®é€šçš„æ–¹æ³•è°ƒç”¨æ²¡æœ‰åŒºåˆ«ã€‚ è™½ç„¶myçš„start()æ–¹æ³•æ˜¯åœ¨my2çš„run()æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œä½†æ˜¯å´æ˜¯åŽè¾“å‡ºå†…å®¹ï¼Œè¯´æ˜Žæ–°å»ºçš„çº¿ç¨‹å¹¶ä¸ä¼šå½±å“ä¸»çº¿ç¨‹çš„æ‰§è¡Œã€‚ çº¿ç¨‹Demo-å®žçŽ°RunnableæŽ¥å£é™¤äº†ç»§æ‰¿java.lang.Threadç±»ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®žçŽ°java.lang.RunnableæŽ¥å£æ¥åˆ›å»ºçº¿ç¨‹ã€‚12345678910111213141516171819202122232425262728293031package top.crosssoverjie.study.Thread;public class TestRunnable &#123; public static void main(String[] args) &#123; System.out.println("ä¸»çº¿ç¨‹çš„çº¿ç¨‹IDæ˜¯"+Thread.currentThread().getId()); MyThread2 my = new MyThread2("çº¿ç¨‹1") ; Thread t = new Thread(my) ; t.start() ; MyThread2 my2 = new MyThread2("çº¿ç¨‹2") ; Thread t2 = new Thread(my2) ; /** * æ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸ä¼šåˆ›å»ºçº¿ç¨‹ï¼Œä¾ç„¶æ˜¯ä¸»çº¿ç¨‹ */ t2.run() ; &#125;&#125;class MyThread2 implements Runnable&#123; private String name ; public MyThread2(String name)&#123; this.name = name ; &#125; @Override public void run() &#123; System.out.println("çº¿ç¨‹"+name+"çš„çº¿ç¨‹IDæ˜¯"+Thread.currentThread().getId()); &#125; &#125; è¾“å‡ºç»“æžœ:123ä¸»çº¿ç¨‹çš„çº¿ç¨‹IDæ˜¯1çº¿ç¨‹çº¿ç¨‹2çš„çº¿ç¨‹IDæ˜¯1çº¿ç¨‹çº¿ç¨‹1çš„çº¿ç¨‹IDæ˜¯9 notes: å®žçŽ°Runnableçš„æ–¹å¼éœ€è¦å°†å®žçŽ°RunnableæŽ¥å£çš„ç±»ä½œä¸ºå‚æ•°ä¼ é€’ç»™Threadï¼Œç„¶åŽé€šè¿‡Threadç±»è°ƒç”¨Start()æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹ã€‚ è¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè‡³äºŽé€‰æ‹©å“ªä¸€ç§è¦çœ‹è‡ªå·±çš„éœ€æ±‚ã€‚ç›´æŽ¥ç»§æ‰¿Threadç±»çš„è¯ä»£ç è¦ç®€æ´ä¸€äº›ï¼Œä½†æ˜¯ç”±äºŽjavaåªæ”¯æŒå•ç»§æ‰¿ï¼Œæ‰€ä»¥å¦‚æžœè¦ç»§æ‰¿å…¶ä»–ç±»çš„åŒæ—¶éœ€è¦å®žçŽ°çº¿ç¨‹é‚£å°±åªèƒ½å®žçŽ°RunnableæŽ¥å£äº†ï¼Œè¿™é‡Œæ›´æŽ¨èå®žçŽ°RunnableæŽ¥å£ã€‚ å®žé™…ä¸Šå¦‚æžœæˆ‘ä»¬æŸ¥çœ‹Threadç±»çš„æºç æˆ‘ä»¬ä¼šå‘çŽ°Threadæ˜¯å®žçŽ°äº†RunnableæŽ¥å£çš„ï¼š çº¿ç¨‹ä¸­å¸¸ç”¨çš„æ–¹æ³• åºå· æ–¹æ³• ä»‹ç» 1 public void start() ä½¿è¯¥çº¿ç¨‹æ‰§è¡Œï¼Œjavaè™šæ‹Ÿæœºä¼šè°ƒç”¨è¯¥çº¿ç¨‹çš„run()æ–¹æ³•ã€‚ 2 public final void setName(String name) ä¿®æ”¹çº¿ç¨‹åç§°ã€‚ 3 public final void setPriority(int privority) ä¿®æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚ 4 public final void setDaemon(false on) å°†è¯¥çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹æˆ–ç”¨æˆ·çº¿ç¨‹ï¼Œå½“æ­£åœ¨è¿è¡Œçº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹æ—¶ï¼Œjavaè™šæ‹Ÿæœºé€€å‡ºï¼Œè¯¥æ–¹æ³•å¿…é¡»åœ¨å¯åŠ¨çº¿ç¨‹å‰è°ƒç”¨ã€‚ 5 public final void join(long mills) ç­‰å¾…è¯¥çº¿ç¨‹çš„ç»ˆæ­¢æ—¶é—´æœ€é•¿ä¸ºmillsæ¯«ç§’ã€‚ 6 public void interrupt() ä¸­æ–­çº¿ç¨‹ã€‚ 7 public static boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºŽæ´»åŠ¨çŠ¶æ€ã€‚å¦‚æžœè¯¥çº¿ç¨‹å·²ç»å¯åŠ¨å°šæœªç»ˆæ­¢ï¼Œåˆ™ä¸ºæ´»åŠ¨çŠ¶æ€ã€‚ 8 public static void yield() æš‚åœå½“å‰çº¿ç¨‹æ‰§è¡Œçš„å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚ 9 public static void sleep(long mills) åœ¨æŒ‡å®šæ¯«ç§’æ•°å†…ï¼Œè®©å½“å‰æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ (æš‚åœ)ã€‚ 10 public static Thread currentThread() è¿”å›žå½“å‰çº¿ç¨‹çš„å¼•ç”¨ã€‚ æ–¹æ³•è¯¦è§£- public static void sleep(long mills)1234567891011121314151617181920212223242526272829303132333435package top.crosssoverjie.study.Thread;public class TestSleep &#123; private int i = 10 ; private Object ob = new Object() ; public static void main(String[] args) &#123; TestSleep t = new TestSleep() ; MyThread3 thread1 = t.new MyThread3() ; MyThread3 thread2 = t.new MyThread3() ; thread1.start() ; thread2.start() ; &#125; class MyThread3 extends Thread&#123; @Override public void run() &#123; synchronized (ob) &#123; i++ ; System.out.println("içš„å€¼ï¼š"+i); System.out.println("çº¿ç¨‹ï¼š"+Thread.currentThread().getName()+"è¿›å…¥ä¼‘çœ çŠ¶æ€"); try &#123; Thread.currentThread().sleep(1000) ; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; System.out.println("çº¿ç¨‹ï¼š"+Thread.currentThread().getName()+"ä¼‘çœ ç»“æŸ"); i++; System.out.println("içš„å€¼&gt;ï¼š"+i); &#125; &#125; &#125; &#125; è¾“å‡ºç»“æžœï¼š12345678içš„å€¼ï¼š11çº¿ç¨‹ï¼šThread-0è¿›å…¥ä¼‘çœ çŠ¶æ€çº¿ç¨‹ï¼šThread-0ä¼‘çœ ç»“æŸiçš„å€¼&gt;ï¼š12içš„å€¼ï¼š13çº¿ç¨‹ï¼šThread-1è¿›å…¥ä¼‘çœ çŠ¶æ€çº¿ç¨‹ï¼šThread-1ä¼‘çœ ç»“æŸiçš„å€¼&gt;ï¼š14 ç”±è¾“å‡ºç»“æžœæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š å½“Thread0è¿›å…¥ä¼‘çœ çŠ¶æ€æ—¶ï¼ŒThread1å¹¶æ²¡æœ‰ç»§ç»­æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰å¾…Thread0ä¼‘çœ ç»“æŸé‡Šæ”¾äº†å¯¹è±¡é”ï¼ŒThread1æ‰ç»§ç»­æ‰§è¡Œã€‚å½“è°ƒç”¨sleep()æ–¹æ³•æ—¶ï¼Œå¿…é¡»æ•èŽ·å¼‚å¸¸æˆ–è€…å‘ä¸Šå±‚æŠ›å‡ºå¼‚å¸¸ã€‚å½“çº¿ç¨‹ä¼‘çœ æ—¶é—´æ»¡æ—¶ï¼Œå¹¶ä¸ä¸€å®šä¼šé©¬ä¸Šæ‰§è¡Œï¼Œå› ä¸ºæ­¤æ—¶æœ‰å¯èƒ½CPUæ­£åœ¨æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡ï¼Œæ‰€ä»¥è°ƒç”¨äº†sleep()æ–¹æ³•ç›¸å½“äºŽçº¿ç¨‹è¿›å…¥äº†é˜»å¡žçŠ¶æ€ã€‚ æ–¹æ³•è¯¦è§£- public static void yield()123456789101112131415161718192021package top.crosssoverjie.study.Thread;public class Testyield &#123; public static void main(String[] args) &#123; MyThread4 my = new MyThread4() ; my.start() ; &#125;&#125;class MyThread4 extends Thread&#123; @Override public void run() &#123; long open = System.currentTimeMillis(); int count= 0 ; for(int i=0 ;i&lt;1000000;i++)&#123; count= count+(i+1);// Thread.yield() ; &#125; long end = System.currentTimeMillis(); System.out.println("ç”¨æ—¶ï¼š"+(end-open)+"æ¯«ç§’"); &#125;&#125; è¾“å‡ºç»“æžœ:ç”¨æ—¶ï¼š1æ¯«ç§’å¦‚æžœå°† Thread.yield()æ³¨é‡Šå–æ¶ˆæŽ‰ï¼Œè¾“å‡ºç»“æžœ:ç”¨æ—¶ï¼š116æ¯«ç§’ è°ƒç”¨yield()æ–¹æ³•æ˜¯ä¸ºäº†è®©å½“å‰çº¿ç¨‹äº¤å‡ºCPUæƒé™ï¼Œè®©CPUåŽ»æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚å®ƒå’Œsleep()æ–¹æ³•ç±»ä¼¼åŒæ ·æ˜¯ä¸ä¼šé‡Šæ”¾é”ã€‚ä½†æ˜¯yield()ä¸èƒ½æŽ§åˆ¶å…·ä½“çš„äº¤å‡ºCUPçš„æ—¶é—´ã€‚å¹¶ä¸”å®ƒåªèƒ½è®©ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹èŽ·å¾—CPUæ‰§è¡Œæ—¶é—´çš„æœºä¼šã€‚ è°ƒç”¨yield()æ–¹æ³•ä¸ä¼šè®©çº¿ç¨‹è¿›å…¥é˜»å¡žçŠ¶æ€ï¼Œè€Œæ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œå®ƒåªéœ€è¦ç­‰å¾…é‡æ–°èŽ·å–CPUçš„æ—¶é—´ï¼Œè¿™ä¸€ç‚¹å’Œsleep()æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„ã€‚ æ–¹æ³•è¯¦è§£- public final void join()åœ¨å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œå¤§é‡çš„è€—æ—¶ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸»çº¿ç¨‹åˆå¿…é¡»å¾—ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åŽæ‰èƒ½ç»“æŸï¼Œè¿™å°±éœ€è¦ç”¨åˆ° join()æ–¹æ³•äº†ã€‚join()æ–¹æ³•çš„ä½œç”¨æ˜¯ç­‰å¾…çº¿ç¨‹å¯¹è±¡é”€æ¯ï¼Œå¦‚æžœå­çº¿ç¨‹æ‰§è¡Œäº†è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹å°±è¦ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åŽæ‰ä¼šé”€æ¯ï¼Œè¯·çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š123456789101112131415161718192021222324252627package top.crosssoverjie.study.Thread;public class Testjoin &#123; public static void main(String[] args) throws InterruptedException &#123; new MyThread5("t1").start() ; for (int i = 0; i &lt; 10; i++) &#123; if(i == 5)&#123; MyThread5 my =new MyThread5("t2") ; my.start() ; my.join() ; &#125; System.out.println("mainå½“å‰çº¿ç¨‹ï¼š"+Thread.currentThread().getName()+" "+i); &#125; &#125;&#125;class MyThread5 extends Thread&#123; public MyThread5(String name)&#123; super(name) ; &#125; @Override public void run() &#123; for (int i = 0; i &lt; 5; i++) &#123; System.out.println("å½“å‰çº¿ç¨‹ï¼š"+Thread.currentThread().getName()+" "+i); &#125; &#125;&#125; è¾“å‡ºç»“æžœï¼š1234567891011121314151617181920mainå½“å‰çº¿ç¨‹ï¼šmain 0å½“å‰çº¿ç¨‹ï¼št1 0å½“å‰çº¿ç¨‹ï¼št1 1mainå½“å‰çº¿ç¨‹ï¼šmain 1å½“å‰çº¿ç¨‹ï¼št1 2mainå½“å‰çº¿ç¨‹ï¼šmain 2å½“å‰çº¿ç¨‹ï¼št1 3mainå½“å‰çº¿ç¨‹ï¼šmain 3å½“å‰çº¿ç¨‹ï¼št1 4mainå½“å‰çº¿ç¨‹ï¼šmain 4å½“å‰çº¿ç¨‹ï¼št2 0å½“å‰çº¿ç¨‹ï¼št2 1å½“å‰çº¿ç¨‹ï¼št2 2å½“å‰çº¿ç¨‹ï¼št2 3å½“å‰çº¿ç¨‹ï¼št2 4mainå½“å‰çº¿ç¨‹ï¼šmain 5mainå½“å‰çº¿ç¨‹ï¼šmain 6mainå½“å‰çº¿ç¨‹ï¼šmain 7mainå½“å‰çº¿ç¨‹ï¼šmain 8mainå½“å‰çº¿ç¨‹ï¼šmain 9 å¦‚æžœæˆ‘ä»¬æŠŠjoin()æ–¹æ³•æ³¨é‡ŠæŽ‰ä¹‹åŽï¼š1234567891011121314151617181920mainå½“å‰çº¿ç¨‹ï¼šmain 0å½“å‰çº¿ç¨‹ï¼št1 0mainå½“å‰çº¿ç¨‹ï¼šmain 1å½“å‰çº¿ç¨‹ï¼št1 1mainå½“å‰çº¿ç¨‹ï¼šmain 2å½“å‰çº¿ç¨‹ï¼št1 2mainå½“å‰çº¿ç¨‹ï¼šmain 3å½“å‰çº¿ç¨‹ï¼št1 3mainå½“å‰çº¿ç¨‹ï¼šmain 4å½“å‰çº¿ç¨‹ï¼št1 4mainå½“å‰çº¿ç¨‹ï¼šmain 5mainå½“å‰çº¿ç¨‹ï¼šmain 6mainå½“å‰çº¿ç¨‹ï¼šmain 7mainå½“å‰çº¿ç¨‹ï¼šmain 8mainå½“å‰çº¿ç¨‹ï¼šmain 9å½“å‰çº¿ç¨‹ï¼št2 0å½“å‰çº¿ç¨‹ï¼št2 1å½“å‰çº¿ç¨‹ï¼št2 2å½“å‰çº¿ç¨‹ï¼št2 3å½“å‰çº¿ç¨‹ï¼št2 4 ç”±ä¸Šæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š åœ¨ä½¿ç”¨äº†join()æ–¹æ³•ä¹‹åŽä¸»çº¿ç¨‹ä¼šç­‰å¾…å­çº¿ç¨‹ç»“æŸä¹‹åŽæ‰ä¼šç»“æŸã€‚ æ–¹æ³•è¯¦è§£- setDaemon(boolean on),getDaemon()ç”¨æ¥è®¾ç½®æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹å’Œåˆ¤æ–­æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚notesï¼š å®ˆæŠ¤çº¿ç¨‹ä¾èµ–äºŽåˆ›å»ºä»–çš„çº¿ç¨‹ï¼Œè€Œç”¨æˆ·çº¿ç¨‹åˆ™ä¸éœ€è¦ã€‚å¦‚æžœåœ¨main()æ–¹æ³•ä¸­åˆ›å»ºäº†ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œé‚£ä¹ˆå½“mainæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åŽå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šå…³é—­ã€‚è€Œç”¨æˆ·çº¿ç¨‹åˆ™ä¸ä¼šï¼Œåœ¨JVMä¸­åžƒåœ¾æ”¶é›†å™¨çš„çº¿ç¨‹å°±æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚ ä¼˜é›…çš„ç»ˆæ­¢çº¿ç¨‹æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥ç»ˆæ­¢çº¿ç¨‹ï¼Œå¦‚ä¸‹ï¼š ä½¿ç”¨é€€å‡ºæ ‡è¯†ï¼Œä½¿çº¿ç¨‹æ­£å¸¸çš„é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“run()æ–¹æ³•å®ŒæˆåŽçº¿ç¨‹ç»ˆæ­¢ã€‚ ä½¿ç”¨stop()æ–¹æ³•å¼ºè¡Œå…³é—­ï¼Œè¿™ä¸ªæ–¹æ³•çŽ°åœ¨å·²ç»è¢«åºŸå¼ƒï¼Œä¸æŽ¨èä½¿ç”¨ ä½¿ç”¨interrupt()æ–¹æ³•ç»ˆæ­¢çº¿ç¨‹ã€‚ å…·ä½“çš„å®žçŽ°ä»£ç æˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡åšæ–‡ä¸­å°†åˆ°ã€‚ã€‚ çº¿ç¨‹çš„ä¼˜å…ˆçº§åœ¨æ“ä½œç³»ç»Ÿä¸­çº¿ç¨‹æ˜¯åˆ†ä¼˜å…ˆçº§çš„ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹CPUå°†ä¼šæä¾›æ›´å¤šçš„èµ„æºï¼Œåœ¨javaä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡setPriority(int newPriority)æ–¹æ³•æ¥æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚åœ¨javaä¸­åˆ†ä¸º1~10è¿™ä¸ªåä¸ªä¼˜å…ˆçº§ï¼Œè®¾ç½®ä¸åœ¨è¿™ä¸ªèŒƒå›´å†…çš„ä¼˜å…ˆçº§å°†ä¼šæŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚javaä¸­æœ‰ä¸‰ä¸ªé¢„è®¾å¥½çš„ä¼˜å…ˆçº§ï¼š public final static int MIN_PRIORITY = 1; public final static int NORM_PRIORITY = 5; public final static int MAX_PRIORITY = 10; å‚è€ƒ å¦‚ä½•ç»ˆæ­¢çº¿ç¨‹ javaå¤šçº¿ç¨‹å­¦ä¹  javaå¤šçº¿ç¨‹æ€ç»´å›¾ æ€»ç»“ä»¥ä¸Šå°±æ˜¯æˆ‘æ€»ç»“çš„javaå¤šçº¿ç¨‹åŸºç¡€çŸ¥è¯†ï¼ŒåŽç»­ä¼šè¡¥å……çº¿ç¨‹å…³é—­ã€çº¿ç¨‹çŠ¶æ€ã€çº¿ç¨‹åŒæ­¥å’Œæœ‰è¿”å›žç»“æžœçš„å¤šçº¿ç¨‹ã€‚]]></content>
      <categories>
        <category>javaå¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>Runnable</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaç¬”è®°ï¼ˆä¸€ï¼‰Javaçš„åå°„æœºåˆ¶]]></title>
    <url>%2F2016%2F05%2F10%2Fjava-reflect%2F</url>
    <content type="text"><![CDATA[å‰è¨€javaåå°„æœºåˆ¶æŒ‡çš„æ˜¯åœ¨javaè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¹äºŽä»»æ„çš„ç±»éƒ½å¯ä»¥çŸ¥é“ä»–çš„æ‰€æœ‰å±žæ€§ä»¥åŠæ–¹æ³•ï¼Œå¯¹äºŽä»»æ„ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä»»æ„çš„è°ƒç”¨ä»–çš„å±žæ€§å’Œæ–¹æ³•ï¼Œè¿™ç§åŠ¨æ€èŽ·å–å¯¹è±¡ä¿¡æ¯å’ŒåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºjavaåå°„æœºåˆ¶ï¼Œä½†æ˜¯åå°„ä½¿ç”¨ä¸å½“ä¼šé€ æˆå¾ˆé«˜çš„æˆæœ¬ã€‚ ç®€å•å®žä¾‹ åå°„èŽ·å–ç±»åç§°123456789101112131415161718package top.crosssoverjie.study;public class Reflect &#123; public static void main(String[] args) &#123; Class&lt;Reflect&gt; c1 = Reflect.class; System.out.println(c1.getName()); Reflect r1 = new Reflect() ; Class&lt;Reflect&gt; c2 = (Class&lt;Reflect&gt;) r1.getClass() ; System.out.println(c2.getName()); try &#123; Class&lt;Reflect&gt; c3 = (Class&lt;Reflect&gt;) Class.forName("top.crosssoverjie.study.Reflect"); System.out.println(c3.getName()); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; &#125;&#125; è¾“å‡ºç»“æžœï¼š 123top.crosssoverjie.study.Reflecttop.crosssoverjie.study.Reflecttop.crosssoverjie.study.Reflect ä»¥ä¸Šçš„ c1,c2,c3æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œä»–ä»¬éƒ½æœ‰ä¸€ä¸ªç»Ÿä¸€çš„åç§°ï¼šå«åšReflectç±»çš„ç±»ç±»åž‹ã€‚ åå°„çš„ç”¨å¤„èŽ·å–æˆå‘˜æ–¹æ³•12public Method getDeclaredMethod(String name,Class&lt;?&gt;...parameterTypes)//å¾—åˆ°è¯¥ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬çˆ¶ç±»çš„æ–¹æ³•ã€‚public Method getMethod(String name,Class&lt;?&gt;...parameterTypes)//èŽ·å¾—è¯¥ç±»çš„æ‰€æœ‰publicæ–¹æ³•ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„ã€‚ é€šè¿‡åå°„èŽ·å–æˆå‘˜æ–¹æ³•è°ƒç”¨çš„å®žä¾‹:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package top.crosssoverjie.study;import java.lang.reflect.Method;public class Person &#123; private String name="crossover" ; private String msg ; public Person(String name, String msg) &#123; this.name = name; this.msg = msg; System.out.println(name+"çš„æè¿°æ˜¯"+msg); &#125; public Person() &#123; super(); &#125; public void say(String name ,String msg)&#123; System.out.println(name+"è¯´ï¼š"+msg); &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getMsg() &#123; return msg; &#125; public void setMsg(String msg) &#123; this.msg = msg; &#125; public static void main(String[] args) &#123; try &#123; //é¦–å…ˆèŽ·å–ç±»ç±»åž‹ Class c1 = Class.forName("top.crosssoverjie.study.Person") ; //é€šè¿‡newInstance()æ–¹æ³•ç”Ÿæˆä¸€ä¸ªå®žä¾‹ Object o1 = c1.newInstance() ; //èŽ·å–è¯¥ç±»çš„sayæ–¹æ³• Method m1 = c1.getMethod("say", String.class,String.class) ; //é€šè¿‡invokeæ–¹æ³•è°ƒç”¨è¯¥æ–¹æ³•// m1.invoke(o1, "å¼ ä¸‰","ä½ å¥½å•Š") ; Method[] methods = c1.getDeclaredMethods() ;// for(Method m : methods)&#123;// System.out.println(m.getName());// &#125; Method[] methods2 = c1.getMethods() ; for (Method method : methods2) &#123; System.out.println(method.getName()); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; è¾“å‡ºç»“æžœï¼š1å¼ ä¸‰è¯´ï¼šä½ å¥½å•Š æ‰€ä»¥æˆ‘ä»¬åªè¦çŸ¥é“ç±»çš„å…¨é™å®šåå°±å¯ä»¥ä»»æ„çš„è°ƒç”¨é‡Œé¢çš„æ–¹æ³•ã€‚ 1234Method[] methods = c1.getDeclaredMethods() ;for(Method m : methods)&#123; System.out.println(m.getName());&#125; è¾“å‡ºç»“æžœï¼š123456maingetNamesetNamesaygetMsgsetMsg ä½¿ç”¨çš„è¿˜æ˜¯ä¹‹å‰é‚£ä¸ªPersonç±»ï¼Œæ‰€ä»¥è¿™é‡Œåªå†™äº†å…³é”®ä»£ç ã€‚è¿™é‡Œè¾“å‡ºçš„æ˜¯Personçš„æ‰€æœ‰publicæ–¹æ³•ã€‚ å¦‚æžœæˆ‘ä»¬è°ƒç”¨getMethods()æ–¹æ³•ä¼šæ˜¯ä»€ä¹ˆç»“æžœå‘¢ï¼Ÿ1234Method[] methods2 = c1.getMethods() ;for (Method method : methods2) &#123; System.out.println(method.getName());&#125; è¾“å‡ºç»“æžœ:123456789101112131415maingetNamesetNamesaygetMsgsetMsgwaitwaitwaithashCodegetClassequalstoStringnotifynotifyAll è¿™æ—¶æˆ‘ä»¬ä¼šå‘çŽ°è¿™é‡Œè¾“å‡ºçš„ç»“æžœä¼šæ¯”åˆšæ‰å¤šå¾—å¤šï¼Œè¿™æ—¶å› ä¸ºgetMethods()æ–¹æ³•è¿”å›žçš„æ˜¯åŒ…æ‹¬çˆ¶ç±»çš„æ‰€æœ‰æ–¹æ³•ã€‚ èŽ·å–æˆå‘˜å˜é‡æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åå°„æ¥èŽ·å–ç±»åŒ…æ‹¬çˆ¶ç±»çš„æˆå‘˜å˜é‡ï¼Œä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š12public Field getDeclaredFiled(String name)//èŽ·å¾—è¯¥ç±»æ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬çˆ¶ç±»çš„ã€‚public Filed getFiled(String name)//èŽ·å¾—è¯¥ç±»çš„æ‰€æœ‰çš„publicå˜é‡ï¼ŒåŒ…æ‹¬å…¶çˆ¶ç±»çš„ã€‚ è¿˜æ˜¯æŒ‰ç…§ä¹‹å‰ä¾‹å­ä¸­çš„Personç±»ä¸¾ä¾‹ï¼Œä»–å…·æœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼š12private String name="crossover" ;private String msg ; æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥èŽ·å–å…¶ä¸­çš„æˆå‘˜å˜é‡ï¼š12Class c1 = Class.forName("top.crosssoverjie.study.Person") ;Field field = c1.getDeclaredField("name");//èŽ·å–è¯¥ç±»æ‰€æœ‰çš„æˆå‘˜å±žæ€§ é€šè¿‡ä»¥ä¸‹ä¾‹å­å¯ä»¥èŽ·å–æŒ‡å®šå¯¹è±¡ä¸Šæ­¤fieldçš„å€¼ï¼š123456789101112131415161718192021222324252627282930313233343536package top.crosssoverjie.study;import java.io.File;import java.lang.reflect.Field;public class Reflect &#123; public static void main(String[] args) &#123; try &#123; Class c1 = Class.forName("top.crosssoverjie.study.Person"); Field field = c1.getDeclaredField("name") ; Object o1 = c1.newInstance() ; /** * ç”±äºŽPersonç±»ä¸­çš„nameå˜é‡æ˜¯privateä¿®é¥°çš„ï¼Œ * æ‰€ä»¥éœ€è¦æ‰‹åŠ¨å¼€å¯å…è®¸è®¿é—®ï¼Œæ˜¯publicä¿®é¥°çš„å°±ä¸éœ€è¦è®¾ç½®äº† */ field.setAccessible(true); Object name = field.get(o1) ; System.out.println(name); &#125; catch (Exception e) &#123; e.printStackTrace() ; &#125;// Class&lt;Reflect&gt; c1 = Reflect.class;// System.out.println(c1.getName());// // Reflect r1 = new Reflect() ;// Class&lt;Reflect&gt; c2 = (Class&lt;Reflect&gt;) r1.getClass() ;// System.out.println(c2.getName());// // try &#123;// Class&lt;Reflect&gt; c3 = (Class&lt;Reflect&gt;) Class.forName("top.crosssoverjie.study.Reflect");// System.out.println(c3.getName());// &#125; catch (ClassNotFoundException e) &#123;// e.printStackTrace();// &#125; &#125;&#125; è¾“å‡ºç»“æžœï¼š1crossover æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ–¹æ³•getDeclaredFieds()æ–¹æ³•æ¥èŽ·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼Œè¿”å›žæ˜¯æ˜¯ä¸€ä¸ªField[]æ•°ç»„ï¼Œåªéœ€è¦éåŽ†è¿™ä¸ªæ•°ç»„å³å¯èŽ·æ‰€æœ‰çš„æˆå‘˜å˜é‡ã€‚ä¾‹å­å¦‚ä¸‹ï¼š 1234Field[] fields = c1.getDeclaredFields() ;for(Field f :fields)&#123; System.out.println(f.getName());&#125; è¾“å‡ºç»“æžœå¦‚ä¸‹ï¼š12namemsg èŽ·å–æž„é€ æ–¹æ³•å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•æ¥èŽ·å–æž„é€ æ–¹æ³•ï¼š12public Constructor getDeclaredConstructor(Class&lt;?&gt;...parameterTypes)//èŽ·å–è¯¥ç±»çš„æ‰€æœ‰æž„é€ æ–¹æ³•ï¼Œä¸åŒ…æ‹¬çˆ¶ç±»çš„ã€‚public Constructor getConstructor(Class&lt;?&gt;...parameterTypes)//èŽ·å–è¯¥ç±»çš„æ‰€æœ‰publicä¿®é¥°çš„æž„é€ æ–¹æ³•ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„ã€‚ åœ¨ä¹‹å‰çš„Personç±»ä¸­æœ‰ä»¥ä¸‹çš„æž„é€ æ–¹æ³•ï¼š1234public Person(String name, String msg) &#123; this.name = name; this.msg = msg;&#125; æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥èŽ·å–Personç±»çš„æž„é€ æ–¹æ³•ï¼š1Constructor dc1 = c1.getDeclaredConstructor(String.class,String.class) ; å…·ä½“ä»£ç å¦‚ä¸‹ï¼š123Constructor dc1 = c1.getDeclaredConstructor(String.class,String.class) ;dc1.setAccessible(true);dc1.newInstance("å°æ˜Ž","å¾ˆå¸…") ; dc1.newInstance(&quot;å°æ˜Ž&quot;,&quot;å¾ˆå¸…&quot;);æ–¹æ³•è°ƒç”¨äº†Personç±»ä¸­çš„ï¼š12345public Person(String name, String msg) &#123; this.name = name; this.msg = msg; System.out.println(name+"çš„æè¿°æ˜¯"+msg);&#125; è¿™ä¸ªæž„é€ æ–¹æ³•ï¼Œå¦‚æžœä¸ä¼ å‚æ•°çš„è¯ï¼Œé‚£ä¹ˆè°ƒç”¨çš„å°±æ˜¯æ— å‚çš„æž„é€ æ–¹æ³•ã€‚è¾“å‡ºç»“æžœä¸º:1å°æ˜Žçš„æè¿°æ˜¯å¾ˆå¸… é€šè¿‡åå°„äº†è§£é›†åˆæ³›åž‹çš„æœ¬è´¨é€šè¿‡ä»¥ä¸‹ä¾‹å­ç¨‹åºå¯ä»¥çœ‹å‡ºï¼š1234567891011121314151617181920212223242526272829303132333435363738394041package top.crosssoverjie.study;import java.lang.reflect.Method;import java.util.ArrayList;import java.util.List;public class GenericEssence &#123; public static void main(String[] args) &#123; //å£°æ˜Žä¸¤ä¸ªlistï¼Œä¸€ä¸ªæœ‰æ³›åž‹ï¼Œä¸€ä¸ªæ²¡æœ‰æ³›åž‹ List list1 = new ArrayList() ; List&lt;String&gt; list2 = new ArrayList&lt;String&gt;() ; list2.add("ä½ å¥½") ;// list2.add(11) ;åŠ ä¸Šæ³›åž‹ä¹‹åŽåœ¨ç¼–è¯‘æœŸé—´åªèƒ½æ·»åŠ Stringï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ System.out.println("list2çš„é•¿åº¦æ˜¯ï¼š"+list2.size()); Class c1 = list1.getClass(); Class c2 = list2.getClass() ; System.out.print("c1,c2æ˜¯å¦ç›¸ç­‰:"); System.out.println(c1==c2); try &#123; //é€šè¿‡åå°„ç»•è¿‡ç¼–è¯‘å™¨åŠ¨æ€è°ƒç”¨addæ–¹æ³•ï¼Œå¯èƒ½å¦åŠ å…¥éžStringç±»åž‹çš„å…ƒç´  Method method = c2.getDeclaredMethod("add", Object.class) ; method.invoke(list2, 123) ;//åœ¨è¿™é‡ŒåŠ å…¥intç±»åž‹ï¼Œåœ¨ä¸Šé¢å¦‚æžœåŠ å…¥intä¼šå‡ºçŽ°ç¼–è¯‘æŠ¥é”™ã€‚ //list2çš„é•¿åº¦å¢žåŠ äº†ï¼Œè¯´æ˜Žæ·»åŠ æˆåŠŸäº† System.out.println("çŽ°åœ¨list2çš„é•¿åº¦æ˜¯:"+list2.size()); /** * æ‰€ä»¥å¯ä»¥çœ‹å‡ºï¼Œæ³›åž‹åªæ˜¯åœ¨ç¼–è¯‘æœŸé—´èµ·ä½œç”¨ï¼Œåœ¨ç»è¿‡ç¼–è¯‘è¿›å…¥è¿è¡ŒæœŸé—´æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚ * å°±ç®—æ˜¯ä¸æ˜¯æ³›åž‹è¦æ±‚çš„ç±»åž‹ä¹Ÿæ˜¯å¯ä»¥æ’å…¥çš„ã€‚ */ &#125; catch (Exception e) &#123; e.printStackTrace() ; &#125; &#125;&#125; æ‰€ä»¥å¯ä»¥çœ‹å‡ºï¼Œæ³›åž‹åªæ˜¯åœ¨ç¼–è¯‘æœŸé—´èµ·ä½œç”¨ï¼Œåœ¨ç»è¿‡ç¼–è¯‘è¿›å…¥è¿è¡ŒæœŸé—´æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚å°±ç®—æ˜¯ä¸æ˜¯æ³›åž‹è¦æ±‚çš„ç±»åž‹ä¹Ÿæ˜¯å¯ä»¥æ’å…¥çš„ã€‚ åå°„çŸ¥è¯†ç‚¹ æ€»ç»“ æ³›åž‹çš„åº”ç”¨æ¯”è¾ƒå¤šï¼š springçš„IOC/DIã€‚ JDBCä¸­çš„ä¸­çš„åŠ è½½é©±åŠ¨ å‚è€ƒ javaä¸­çš„åå°„æœºåˆ¶ åå°„æœºåˆ¶æ˜¯ä»€ä¹ˆ]]></content>
      <categories>
        <category>Javaç¬”è®°</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Reflect</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¬¬ä¸€æ¬¡æ€»ç»“]]></title>
    <url>%2F2016%2F05%2F07%2F%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æ˜¨å¤©åˆ°ä»Šå¤©ä¸€å…±èŠ±äº†å·®ä¸å¤šä¸¤å¤©çš„æ—¶é—´ç»ˆäºŽæŠŠåšå®¢æ­å¥½äº†ã€‚è¿˜ä¹°äº†ä¸€ä¸ªåŸŸåï¼ŒçŽ°åœ¨å°±è¿«ä¸åŠå¾…çš„æƒ³æŠŠè¿™æ®µå†…å®¹å†™ä¸‹æ¥ã€‚ æ„Ÿè°¢ é¦–å…ˆéžå¸¸æ„Ÿè°¢ å˜Ÿçˆ·çš„å¸®å¿™ï¼Œæ²¡æœ‰è¿™äº›èµ„æ–™æˆ‘å¯èƒ½è¿˜å¾—è‡ªå·±ç ”ç©¶å¥½ä¸€æ®µæ—¶é—´ã€‚ è¿‡ç¨‹ æˆ‘æ˜¯å‰å¤©æ— æ„é—´åœ¨å¾®åšä¸Šçœ‹åˆ°å˜Ÿçˆ·çš„ä¸€ç¯‡åšæ–‡ï¼Œå°±ä»”ç»†çœ‹äº†ä¸‹ï¼Œå‘çŽ°å†™çš„éžå¸¸å¥½ï¼Œç„¶åŽå°±å°†ä»–æ‰€æœ‰çš„åšæ–‡å¤§è‡´çš„æµè§ˆäº†ä¸€ä¸‹ã€‚ æˆ‘å¾ˆæ—©ä»¥å‰å°±æ‰“ç®—æ­ä¸€ä¸ªåšå®¢ï¼Œä½†æ˜¯ç™¾åº¦äº†ä¸€ä¸‹å‘çŽ°è¿˜æ˜¯æŒºéº»çƒ¦çš„ï¼ŒåŠ ä¸Šæœ€è¿‘ä¹Ÿæ¯”è¾ƒå¿™æ‰€æœ‰ä¸€ç›´ä¹Ÿå°±æ²¡æœ‰åšï¼Œç›´åˆ°çœ‹åˆ°è¿™ç¯‡åšæ–‡æ‰é¡ºåˆ©çš„æ­èµ·äº†è¿™ä¸ªåšå®¢ã€‚ä¸­é€”é‡åˆ°ä¸å°‘é—®é¢˜ä¹Ÿéƒ½é¡ºåˆ©è§£å†³äº†ï¼ŒçœŸæ˜¯å­¦åˆ°äº†ä¸å°‘çš„ä¸œè¥¿ã€‚ ç†Ÿç»ƒäº†Markdownè¯­æ³•ã€‚ çœŸæ­£ä½¿ç”¨äº†ç¼–è¾‘ç¥žå™¨ Sublimeã€‚ ä½¿ç”¨é˜¿é‡Œäº‘è§£æžäº†githubå’Œcodingé‡Œçš„PagesæœåŠ¡ã€‚ hexoå’Œå¸¸ç”¨çš„ä¸»é¢˜é…ç½®ã€‚ æˆ‘çš„é…ç½® Hexoé…ç½® JackMané…ç½®imglogo: enable: true ## display image logo true/false. src: img/logo.gif ## `.svg` and `.png` are recommended,please put image into the theme folder `/jacman/source/img`. favicon: img/favicon.ico ## size:32px*32px,`.ico` is recommended,please put image into the theme folder `/jacman/source/img`. apple_icon: img/jacman.jpg ## size:114px*114px,please put image into the theme folder `/jacman/source/img`. author_img: img/author.jpg ## size:220px*220px.display author avatar picture.if don&apos;t want to display,please don&apos;t set this. banner_img: #img/banner.jpg ## size:1920px*200px+. Banner Picture ### Theme Color theme_color: theme: &apos;#2ca6cb&apos; ##the defaut theme color is blue # ä»£ç é«˜äº®ä¸»é¢˜ # available: default | night highlight_theme: night #### index post is expanding or not index: expand: false ## default is unexpanding,so you can only see the short description of each post. excerpt_link: Read More close_aside: false #close sidebar in post page if true mathjax: false #enable mathjax if true ### Creative Commons License Support, see http://creativecommons.org/ ### you can choose: by , by-nc , by-nc-nd , by-nc-sa , by-nd , by-sa , zero creative_commons: none ç»“æŸè¯­ä»¥ä¸Šã€‚ã€‚æˆ‘åšè¿™ä¸ªåšå®¢çš„åˆè¡·ä¸€æ˜¯ä¸ºäº†è®°å½•æˆ‘çš„æ•´ä¸ªç¨‹åºçŒ¿ç”Ÿæ¶¯çš„æ•…äº‹ï¼ŒäºŒæ˜¯å¸Œæœ›èƒ½æœ‰å¤§ç¥žèƒ½åœ¨è¿‡ç¨‹ä¸­æŒ‡å‡ºæˆ‘çš„é”™è¯¯ï¼Œèƒ½è®©æˆ‘çš„æ°´å¹³æ›´è¿›ä¸€æ­¥ã€‚]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>æ€»ç»“</tag>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Markdownå°è®¡]]></title>
    <url>%2F2016%2F05%2F06%2FMarkdown%E5%B0%8F%E8%AE%A1%2F</url>
    <content type="text"><![CDATA[# æ ‡é¢˜ è¡¨ç¤ºæ ‡é¢˜ ä¸€ä¸ª#å·ä»£è¡¨ä¸€çº§æ ‡é¢˜ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ * æ— åºåˆ—è¡¨ æ— åºåˆ—è¡¨ &gt; å¼•ç”¨ å¼•ç”¨ [http://www.baidu.com](http://www.baidu.com &quot;ç™¾åº¦&quot;) ç™¾åº¦ ![è‰¾å¼—æ£®](http://i.imgur.com/TLnZ2S6.jpg)æ’å…¥å›¾ç‰‡]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxï¼ˆä¸€ï¼‰å¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2F2016%2F04%2F10%2FLinux-normal%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç”±äºŽçŽ°åœ¨JAVAå¼€å‘çš„å¾ˆå¤šåº”ç”¨éƒ½æ˜¯éƒ¨ç½²åˆ°Linuxç³»ç»Ÿä¸Šçš„ï¼Œå› æ­¤äº†è§£å’ŒæŽŒæ¡ä¸€äº›Linuxçš„å¸¸ç”¨å‘½ä»¤æ˜¯éžå¸¸æœ‰å¿…è¦çš„ï¼Œä»¥ä¸‹å°±æ˜¯åœ¨Javaå¼€å‘è¿‡ç¨‹ä¸­ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ã€‚ å¸¸ç”¨å‘½ä»¤ æŸ¥æ‰¾æ–‡ä»¶find / -name log.txtæ ¹æ®åç§°æŸ¥æ‰¾åœ¨ /ç›®å½•ä¸‹çš„ log.txtæ–‡ä»¶ã€‚ find .-name &quot;*.xml&quot;é€’å½’æŸ¥æ‰¾æ‰€æœ‰çš„xmlæ–‡ä»¶ã€‚ find .-name &quot;*.xml&quot;|xargs grep &quot;hello&quot;é€’å½’æŸ¥æ‰¾æ‰€æœ‰åŒ…å«helloçš„xmlæ–‡ä»¶ã€‚ ls -l grep &#39;jar&#39;æŸ¥æ‰¾å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰jaræ–‡ä»¶ã€‚ æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦è¿è¡Œps â€“ef|grep tomecateæ£€æŸ¥æ‰€æœ‰æœ‰å…³tomcatçš„è¿›ç¨‹ã€‚ ç»ˆæ­¢çº¿ç¨‹kill -9 19979ç»ˆæ­¢çº¿ç¨‹å·ä¸º19979çš„çº¿ç¨‹ æŸ¥çœ‹æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ã€‚ls -al æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•ã€‚pwd å¤åˆ¶æ–‡ä»¶åŒ…æ‹¬å…¶å­æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•cp -r source targetå¤åˆ¶sourceæ–‡ä»¶åˆ°targetç›®å½•ä¸­ã€‚ åˆ›å»ºä¸€ä¸ªç›®å½•mkdir newåˆ›å»ºä¸€ä¸ªnewçš„ç›®å½• åˆ é™¤ç›®å½•(å‰ææ˜¯æ­¤ç›®å½•æ˜¯ç©ºç›®å½•)rmdir sourceåˆ é™¤sourceç›®å½•ã€‚ åˆ é™¤æ–‡ä»¶ åŒ…æ‹¬å…¶å­æ–‡ä»¶rm -rf fileåˆ é™¤fileæ–‡ä»¶å’Œå…¶ä¸­çš„å­æ–‡ä»¶ã€‚-rè¡¨ç¤ºå‘ä¸‹é€’å½’ï¼Œä¸ç®¡æœ‰å¤šå°‘ç›®å½•ä¸€å¾‹åˆ é™¤-fè¡¨ç¤ºå¼ºåˆ¶åˆ é™¤ï¼Œä¸åšä»»ä½•æç¤ºã€‚ ç§»åŠ¨æ–‡ä»¶mv /temp/movefile /target åˆ‡æ¢ç”¨æˆ·su -username æŸ¥çœ‹ipifconfigæ³¨æ„æ˜¯ ifconfig ä¸æ˜¯windowsä¸­çš„ipconfig æ€»ç»“ä»¥ä¸Šå°±æ˜¯åœ¨Linuxä¸‹å¼€å‘Javaåº”ç”¨å¸¸ç”¨çš„Linuxå‘½ä»¤ï¼Œå¦‚æœ‰é—æ¼è¯·åœ¨è¯„è®ºå¤„è¡¥å……ï¼Œæˆ‘å°†ä¸å®šæœŸæ·»åŠ ã€‚]]></content>
      <categories>
        <category>Linuxç¬”è®°</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸ªäººç®€åŽ†]]></title>
    <url>%2F1994%2F08%2F08%2Fmyresume%2F</url>
    <content type="text"><![CDATA[ä¸ªäººä¿¡æ¯ é™ˆæ°/ç”·/1994 å·¥ä½œå¹´é™ï¼š3å¹´ æŠ€æœ¯åšå®¢ï¼šhttps://crossoverjie.top Githubï¼šhttp://github.com/crossoverjie æœŸæœ›èŒä½ï¼šJava é«˜çº§å·¥ç¨‹å¸ˆ è”ç³»æ–¹å¼ æ‰‹æœºï¼š18523985794 Emailï¼šcrossoverJie@gmail.com QQ/å¾®ä¿¡å·ï¼š731756881 / chycjj å·¥ä½œç»åŽ†äºšä¿¡ç§‘æŠ€ ï¼ˆ 2017å¹´05æœˆ ~ è‡³ä»Š ï¼‰IOP æ™ºèƒ½è¥é”€å¹³å°é¡¹ç›®æè¿°ï¼šæ ¹æ®ç”¨æˆ·DNAæ•°æ®ã€å½“å‰ä½ç½®ç­‰ä¿¡æ¯åˆç†çš„æŽ¨é€ç›¸åº”çš„è¥é”€æ´»åŠ¨ç»™ç”¨æˆ·ã€‚ä¸»è¦è´Ÿè´£ï¼š çŸ­ä¿¡ç¾¤å‘æ¸ é“çš„æ•´ä¸ªæµç¨‹ã€‚ çŸ­ä¿¡ç½‘å…³:ä¿è¯ 1000W+ çš„ç”¨æˆ·æ•°æ®å®‰å…¨æœ‰æ•ˆçš„é€šè¿‡çŸ­ä¿¡ç½‘å…³è¿›è¡ŒçŸ­ä¿¡ä¸‹å‘ã€‚ 51 è¥ä¸šåŽ…é¡¹ç›®æè¿°: åŸºäºŽäº‘ç«¯çš„è¿›é”€å­˜ç³»ç»Ÿã€‚ä¸»è¦è´Ÿè´£ï¼š æ”¯ä»˜æ¨¡å—ã€‚ è´¢åŠ¡æ¨¡å—ã€‚ çº¿ä¸Šåœ°å€ : https://www.51yyt.com.cn/ å…¶ä»–é¡¹ç›®è¯·æ±‚é˜²é‡ç»„ä»¶é¡¹ç›®æè¿° : å¯¹äºŽæŸäº›ä¸šåŠ¡è¦æ±‚æ¯æ¬¡è¯·æ±‚ä¿è¯å”¯ä¸€ï¼Œå¦‚æžœæ¯ä¸ªæŽ¥å£éƒ½åšæ ¡éªŒæ“ä½œçš„è¯è€¦åˆå¤ªé«˜ä¹Ÿä¸åˆ©äºŽç»´æŠ¤ã€‚åŸºäºŽæ­¤è‡ªå®šä¹‰äº† annotation ,é€šè¿‡ Spring çš„ AOP åªè¦ç»™ç›¸åº”çš„æŽ¥å£åŠ ä¸Šè¯¥æ³¨è§£å³å¯å®žçŽ°è¯·æ±‚åŽ»é‡ã€‚ å¼€æºåœ°å€: Spring ç‰ˆ: https://github.com/crossoverJie/SSM-REQUEST-CHECK SpringBoot ç‰ˆ: https://github.com/crossoverJie/springboot-cloud çŒªå…«æˆ’ç½‘ç»œæœ‰é™å…¬å¸ ï¼ˆ 2016å¹´05æœˆ ~ 2017å¹´05æœˆ ï¼‰å…«æˆ’è®¤è¯é¡¹ç›®æè¿°ï¼šä¸ºæ•´ä¸ªçŒªå…«æˆ’ç½‘æä¾›å®žåè®¤è¯æœåŠ¡ï¼Œä¸»æŽ¨äººè„¸è¯†åˆ«è®¤è¯ã€‚æœŸæœ›æ‰“é€ æˆä¸€ä¸ªæƒå¨çš„ç¬¬ä¸‰æ–¹å®žåè®¤è¯å¹³å°ã€‚åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ¨¡å—ï¼š Webç«¯äººè„¸è¯†åˆ«è®¤è¯ã€‚ ç§»åŠ¨ç«¯äººè„¸è¯†åˆ«è®¤è¯(IOS,Android)ã€‚ å›½å†…å¢ƒå¤–ä¼ä¸šå®¡æ ¸è®¤è¯ã€‚ å›½å†…æ¸¯æ¾³å°ä¸ªäººå®¡æ ¸è®¤è¯ã€‚ ä¸»è¦è´Ÿè´£ï¼š å…«æˆ’è®¤è¯æ ¸å¿ƒæœåŠ¡å¼€å‘ã€‚ æ–°è€ç³»ç»Ÿæ•°æ®è¿ç§»ã€‚ æ•´ä¸ªä¸»ç«™æ‰€ä¾èµ–çš„å®žåæŸ¥è¯¢æŽ¥å£ã€‚ çº¿ä¸Šåœ°å€ : https://do.renzheng.zbj.com/fe/page/index å…¶ä»–é¡¹ç›®Dubbo æŽ¥å£ å®žçŽ° HTTP è®¿é—®ç»„ä»¶é¡¹ç›®æè¿° : ç”±äºŽ Dubbo æŽ¥å£é€šå¸¸æ˜¯å†…éƒ¨åº”ç”¨ä¹‹é—´è¿›è¡Œè°ƒç”¨ï¼Œå½“æˆ‘ä»¬æƒ³è¦æŽ’é™¤æŽ‰è¯­è¨€çš„ç‰¹æœ‰æ€§çš„è¯æœ€å¥½è¿˜æ˜¯æä¾›ä¸€ä¸ª HTTP æŽ¥å£ã€‚åŸºäºŽæ­¤å¼€å‘äº†ä¸€ä¸ªç»„ä»¶å¯ä»¥åœ¨ä¸ä¿®æ”¹åŽŸæœ‰ Dubbo æŽ¥å£çš„å‰æä¸‹å®žçŽ° HTTP è®¿é—®ï¼Œè¿™åœ¨æŸäº›ç‰¹æœ‰çŽ¯å¢ƒä¸‹è¿›è¡Œè°ƒè¯•æ˜¯éžå¸¸æ–¹ä¾¿çš„ã€‚ å¼€æºåœ°å€ : https://github.com/crossoverJie/SSM-DUBBO-HTTP é‡åº†é©°éª…ç§‘æŠ€ ï¼ˆ 2014å¹´11æœˆ ~ 2016å¹´05æœˆ ï¼‰é•¿å®‰é©¬è‡ªè¾¾å†…éƒ¨å®¡è®¡ç³»ç»Ÿ é¡¹ç›®æè¿°ï¼šè¯¥é¡¹ç›®ä¸ºé•¿å®‰é©¬è‡ªè¾¾è´¢åŠ¡éƒ¨é—¨å†…éƒ¨ä½¿ç”¨çš„ä¸€ä¸ªå®¡è®¡ç³»ç»Ÿï¼Œç”¨äºŽå‡çº§æ•´ä¸ªé•¿é©¬å…¬å¸çš„é£Žé™©å’Œç®¡ç†å·¥ä½œã€‚ä¸»è¦è´Ÿè´£ï¼š ç¼–å†™é¡¹ç›®è¿‡ç¨‹ä¸­çš„å„ä¸ªé‡Œç¨‹ç¢‘æ–‡æ¡£ã€‚ ç³»ç»Ÿæ•°æ®åº“è®¾è®¡ã€‚ åˆ¶å®šå¹¶åˆ†é…å¼€å‘ä»»åŠ¡ã€‚ èµ„æºå…±äº«ã€ç³»ç»ŸæŒ‡å—ã€ç³»ç»Ÿç®¡ç†ã€é£Žé™©ç®¡ç†æ¨¡å—ä»£ç çš„å®žçŽ°ã€‚ é•¿å®‰æ±½è½¦è®¾è®¡æˆæœ¬ç®¡æŽ§ç³»ç»Ÿé¡¹ç›®æè¿°ï¼šè¯¥é¡¹ç›®ä¸ºé‡åº†é•¿å®‰å…¬å¸ä½¿ç”¨æˆæœ¬ç®¡æŽ§ç³»ç»Ÿï¼Œå¯¹æ•´ä¸ªæ±½è½¦ç”Ÿäº§æ‰€äº§ç”Ÿçš„æˆæœ¬è¿›è¡Œé¢„ä¼°ä¸Žç®¡ç† ä¸»è¦è´Ÿè´£ï¼š é›¶éƒ¨ä»¶å‚æ•°å‡†ç¡®çŽ‡ã€åŠæ—¶çŽ‡çš„å¼€å‘ã€‚ å¼€æºé¡¹ç›®å’Œä½œå“å¼€æºé¡¹ç›® SSMï¼šä»Ž 0 æž„å»ºä¸€å¥—åˆ†å¸ƒå¼ç³»ç»Ÿã€‚(1.2K star) springboot-cloudï¼šåŸºäºŽ SpringBoot + SpringCloud æ­å»ºçš„å¾®æœåŠ¡é¡¹ç›® æŠ€æœ¯æ–‡ç«  åŸºäºŽdubboçš„åˆ†å¸ƒå¼æž¶æž„ MQåº”ç”¨ è¯‘ ä½ å¯ä»¥ç”¨GitHubåšçš„12ä»¶ Cool äº‹æƒ… æŠ€èƒ½æ¸…å•ä»¥ä¸‹å‡ä¸ºæˆ‘ç†Ÿç»ƒä½¿ç”¨çš„æŠ€èƒ½ ä¸»åŠ›è¯­è¨€ï¼šJava æ¡†æž¶ï¼šSpring/SpringMVC/Mybatis/SpringBoot/SpringCloud/Dubbo ä¸­é—´ä»¶ï¼šKafka/Zookeeper/é…ç½®ä¸­å¿ƒ/è°ƒåº¦ä¸­å¿ƒ æ•°æ®åº“ç›¸å…³ï¼šMySQL/Oracle ç‰ˆæœ¬ç®¡ç†ã€æ–‡æ¡£å’Œè‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ï¼šSvn/Git/Jenkins å•å…ƒæµ‹è¯•ï¼šJunit/Jacoco/coveralls æœåŠ¡å™¨ : Linuxå¸¸ç”¨æ“ä½œï¼ŒåŸºæœ¬çš„ Shell è„šæœ¬ç¼–å†™ è‡´è°¢æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»æˆ‘çš„ç®€åŽ†ï¼ŒæœŸå¾…èƒ½æœ‰æœºä¼šå’Œæ‚¨å…±äº‹ã€‚]]></content>
      <categories>
        <category>resume</category>
      </categories>
      <tags>
        <tag>æ€»ç»“</tag>
      </tags>
  </entry>
</search>
